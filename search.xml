<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>金砖选拔赛</title>
      <link href="/2023/07/04/%E9%87%91%E7%A0%96%E7%9C%81%E8%B5%9B%E9%80%89%E6%8B%94%E8%B5%9B/"/>
      <url>/2023/07/04/%E9%87%91%E7%A0%96%E7%9C%81%E8%B5%9B%E9%80%89%E6%8B%94%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<h1 id="机器学习与大数据赛项"><a href="#机器学习与大数据赛项" class="headerlink" title="机器学习与大数据赛项"></a>机器学习与大数据赛项</h1><p>竞赛环境：</p><div class="table-container"><table><thead><tr><th>名称</th><th>技术规格</th></tr></thead><tbody><tr><td>Hadoop</td><td>3.3.x</td></tr><tr><td>Sqoop</td><td>1.4.x</td></tr><tr><td>Hive</td><td>2.3.x</td></tr><tr><td>Zookeeper</td><td>3.6.x</td></tr><tr><td>Flume</td><td>1.10.x</td></tr><tr><td>Spark</td><td>3.3.x</td></tr><tr><td>Flink</td><td>1.15.x</td></tr><tr><td>JDK</td><td>11</td></tr><tr><td>Scala</td><td>2.13.x</td></tr><tr><td>Python</td><td>3.7.x</td></tr></tbody></table></div><p>比赛内容:</p><blockquote><p>Hadoop 平台搭建、HDFS 数据存储、Flume 数据采集、Sqoop 数据导入、MapReduce 批处理操作、Hive 数据查询、大数据 可视化、数据整合、数据读取、数据探查、数据处理、数据 建模、模型评价。</p></blockquote><h1 id="模块A：大数据运维与应用-30分"><a href="#模块A：大数据运维与应用-30分" class="headerlink" title="模块A：大数据运维与应用(30分)"></a>模块A：大数据运维与应用(30分)</h1><blockquote><p>三天把完全分布式自己搭建了一遍，中间mysql的安装是搞了好久，hive启动失败，多半是mysql有错误，mysql那里还是要多看看。剩下的时间就是背加练了，没什么好说的</p></blockquote><h2 id="Hadoop基础环境搭建"><a href="#Hadoop基础环境搭建" class="headerlink" title="Hadoop基础环境搭建"></a>Hadoop基础环境搭建</h2><p>参考链接: <a href="https://blog.csdn.net/qq_44715376/article/details/130843233?csdn_share_tail=%7B%22type%22%3A%22blog%22%2C%22rType%22%3A%22article%22%2C%22rId%22%3A%22130843233%22%2C%22source%22%3A%22qq_44715376%22%7D&amp;fromshare=blogdetail">https://blog.csdn.net/qq_44715376/article/details/130843233?csdn_share_tail=%7B%22type%22%3A%22blog%22%2C%22rType%22%3A%22article%22%2C%22rId%22%3A%22130843233%22%2C%22source%22%3A%22qq_44715376%22%7D&amp;fromshare=blogdetail</a></p><p>1、安装虚拟机和Linux操作系统，配置IP地址、主机名、防火墙、地址映射等</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">网卡</span><br><span class="line">vi /etc/sysconfig/network-scripts/ifcfg-ens33</span><br></pre></td></tr></table></figure><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230704224936122.png" alt="image-20230704224936122"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">重启网卡</span><br><span class="line">systemctl restart netword</span><br><span class="line"></span><br><span class="line">查看网卡</span><br><span class="line">ip addr 或 ifconfig</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">主机名 ：/etc/hostname</span><br><span class="line">master</span><br><span class="line">映射：/etc/hosts</span><br><span class="line">192.168.43.10 master</span><br><span class="line">192.168.43.20 node01</span><br><span class="line">192.168.43.30 node02</span><br><span class="line">关闭防火墙</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl disable firewalld</span><br><span class="line">关闭Linunx安全子系统</span><br><span class="line">vi /etc/selinux/config</span><br><span class="line">SELINUX=disabled</span><br><span class="line">重启系统</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><p>2、安装 JDK 与 Hadoop</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">上传安装包</span><br><span class="line">解压</span><br><span class="line">tar -zxvf jdk-8u261-linux-x64.tar.gz -C /opt/softwore/</span><br><span class="line">tar -zxvf hadoop-2.7.7\ .tar.gz -C /opt/softwore</span><br><span class="line"></span><br><span class="line">修改配置文件</span><br><span class="line">vim + /etc/profile</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">JAVA_HOME</span></span><br><span class="line">export JAVA_HOME=/usr/local/src/jdk</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">HADOOP_HOME</span></span><br><span class="line">export HADOOP_HOME=/usr/local/src/hadoop</span><br><span class="line">export PATH=$PATH:$HADOOP_HOME/bin:$HADOOP_HOME/sbin</span><br><span class="line">export HDFS_NAMENODE_USER=root</span><br><span class="line">export HDFS_DATANODE_USER=root</span><br><span class="line">export HDFS_SECONDARYNAMENODE_USER=root</span><br><span class="line">export YARN_RESOURCEMANAGER_USER=root</span><br><span class="line">export YARN_NODEMANAGER_USER=root</span><br><span class="line"></span><br><span class="line">重新加载配置文件，使配置生效</span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure><p>3、完全分布式部署（HDFS)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">配置文件路径：/usr/local/src/hadoop/etc/hadoop</span><br><span class="line">HDFS</span><br><span class="line">修改 hadoop-env.sh 设置 Hadoop 环境对应的 JDK</span><br><span class="line">export JAVA_HOME=/usr/local/src/jdk</span><br><span class="line"></span><br><span class="line">配置 MapReduce 与 YARN</span><br><span class="line">修改 yarn-env.sh、mapred-env.sh 添加 JAVA_HOME 配置</span><br><span class="line">export JAVA_HOME=/usr/local/src/jdk</span><br></pre></td></tr></table></figure><ul><li><p>修改 core-site.xml 配置文件，可以使用 NotePad++ 进行配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--NameNode的访问URI，也可以写为IP，8020为默认端口--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://192.168.201.10:8020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--临时数据目录，用来存放数据，格式化时会自动生成--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>/usr/local/src/hadoop/data/tmp<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>修改 hdfs-site.xml 配置文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--Block的副本数，伪分布式要改为1--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--NameNode 元数据存放地址--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.name.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>/usr/local/src/hadoop/data/namenode<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--DataNode 副本存放地址--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.data.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>/usr/local/src/hadoop/data/datanode<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--HDFS 临时存放地址--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>/usr/local/src/hadoop/data/tmp<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--配置有secondarynamenode的主机--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.secondary.http-address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>master:50090<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>mapred-site.xml ，把 mapred-sit.xml.template 复制一份，修改为 mapred-site.xml yarn-site.xml 添加相应 配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--mapred-site.xml--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!---计算框架的运行平台配置 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--yarn-site.xml--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!---YARN 的节点辅助服务配置 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--默认是0.0.0.0 本地访问--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>master<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>在 slaves 配置文件中 添加 主机名，它指定了 DataNode 和 NodeManager所在的机器。(注意这里有可能自带workers需要修改workers)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">master</span><br><span class="line">node01</span><br><span class="line">node02</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">关机</span><br><span class="line">poweroff</span><br></pre></td></tr></table></figure></li><li><p>克隆</p></li><li><p>分发</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r /usr/local/hadoop-3.3.1 root@slave03:/usr/local</span><br></pre></td></tr></table></figure></li></ul><p>4、SSH免密登录</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">先在每一台节点生成公钥和私钥</span><br><span class="line">ssh-keygen</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">把每一个节点上的公钥文件发送到所有节点（包括自己），注意：每一条命令都需要在3个节点中执行</span><br><span class="line">ssh-copy-id master</span><br><span class="line">ssh-copy-id node01</span><br><span class="line">ssh-copy-id node02</span><br></pre></td></tr></table></figure><p>5、格式化HDFS</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#master</span><br><span class="line">hdfs namenode -format</span><br></pre></td></tr></table></figure><p>6、启动服务</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">start-dfs.sh /start-yarn.sh</span><br><span class="line"></span><br><span class="line">start-all.sh</span><br></pre></td></tr></table></figure><p>7、查看进程</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">jps</span><br><span class="line"></span><br><span class="line">#master</span><br><span class="line">[root@master hadoop]# jps</span><br><span class="line">6002 SecondaryNameNode</span><br><span class="line">6435 NodeManager</span><br><span class="line">6280 ResourceManager</span><br><span class="line">5594 NameNode</span><br><span class="line">7835 Jps</span><br><span class="line">5775 DataNode</span><br><span class="line"></span><br><span class="line">#node01</span><br><span class="line">[root@node01 hadoop]# jps</span><br><span class="line">2131 DataNode</span><br><span class="line">2532 Jps</span><br><span class="line">2271 NodeManager</span><br><span class="line"></span><br><span class="line">#node02</span><br><span class="line">[root@node02 hadoop]# jps</span><br><span class="line">2145 NodeManager</span><br><span class="line">2405 Jps</span><br><span class="line">2023 DataNode</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Hadoop常用端口说明：</span><br><span class="line">hadoop2.x</span><br><span class="line">HDFS Namenode内部通常端口:8020/9000</span><br><span class="line">HDFS Namenode对用户的查询端口:50070</span><br><span class="line">Yarn查看任务运行情况的:8088</span><br><span class="line">历史服务器:19888</span><br><span class="line"></span><br><span class="line">hadoop3.x</span><br><span class="line">HDFS Namenode内部通常端口:8020/9000/9820</span><br><span class="line">HDFS Namenode对用户的査询端口:9870</span><br><span class="line">Yarn查看任务运行情况的:8088</span><br><span class="line">历史服务器:19888</span><br></pre></td></tr></table></figure><h2 id="MySQL离线安装"><a href="#MySQL离线安装" class="headerlink" title="MySQL离线安装"></a>MySQL离线安装</h2><p>安装包<code>mysql-5.7.20-linux-glibc2.12-x86_64.tar.gz</code> 拷贝到 离线生产环境<code>/usr/local</code>目录下。 </p><p>==<strong>1、创建用户</strong>==</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加mysql用户组</span></span><br><span class="line">groupadd mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加mysql用户</span></span><br><span class="line">useradd -g mysql mysql -d /home/mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改mysql用户的登陆密码</span></span><br><span class="line">passwd mysql</span><br></pre></td></tr></table></figure><p><strong>==2、解压缩==</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/</span><br><span class="line"></span><br><span class="line">tar -xzvf mysql-<span class="number">5.7</span><span class="number">.13</span>-linux-glibc2<span class="number">.5</span>-x86_64 </span><br><span class="line"></span><br><span class="line"><span class="comment"># 改名为mysql</span></span><br><span class="line">mv mysql-<span class="number">5.7</span><span class="number">.13</span>-linux-glibc2<span class="number">.5</span>-x86_64 mysql</span><br><span class="line"></span><br><span class="line"><span class="comment">#赋予用户读写权限</span></span><br><span class="line">chown -R mysql:mysql mysql/</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 删除maridb</span></span><br><span class="line">rpm -qa | grep mariadb</span><br><span class="line">yum remove mariadb*</span><br></pre></td></tr></table></figure><p><strong>==3、创建配置文件==</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/my.cnf</span><br><span class="line"></span><br><span class="line"><span class="comment">#内容</span></span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line">port = <span class="number">3306</span></span><br><span class="line">socket = /tmp/mysql.sock</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">character_set_server=utf8</span><br><span class="line">init_connect=<span class="string">&#x27;SET NAMES utf8&#x27;</span></span><br><span class="line">basedir=/usr/local/src/mysql</span><br><span class="line">datadir=/usr/local/src/mysql/data</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line">log-error=/var/log/mysqld.log</span><br><span class="line">pid-file=/var/run/mysqld/mysqld.pid</span><br><span class="line"><span class="comment">#不区分大小写</span></span><br><span class="line">lower_case_table_names = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION</span><br><span class="line"></span><br><span class="line">max_connections=<span class="number">5000</span></span><br><span class="line"></span><br><span class="line">explicit_defaults_for_timestamp=true</span><br><span class="line"></span><br><span class="line">default-time_zone = <span class="string">&#x27;+8:00&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>==<strong>初始化文件</strong>==</p><p>1、初始化log文件，防止没有权限</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#手动编辑一下日志文件，什么也不用写，直接保存退出</span></span><br><span class="line">cd /var/log/</span><br><span class="line"></span><br><span class="line">vim mysqld.log</span><br><span class="line">：wq</span><br><span class="line"></span><br><span class="line">chmod <span class="number">777</span> mysqld.log</span><br><span class="line">chown mysql:mysql mysqld.log</span><br></pre></td></tr></table></figure><p>2、初始化pid文件，防止没有权限</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#手动编辑一下日志文件，什么也不用写，直接保存退出</span></span><br><span class="line">cd /var/run/<span class="comment">#run的文件保存在内存中，重启会删除</span></span><br><span class="line">mkdir mysqld</span><br><span class="line">cd mysqld</span><br><span class="line">vi mysqld.pid</span><br><span class="line">：wq</span><br><span class="line"><span class="comment"># 给权限</span></span><br><span class="line">cd ..</span><br><span class="line">chmod <span class="number">777</span> mysqld</span><br><span class="line">chown -R mysql:mysql mysqld</span><br></pre></td></tr></table></figure><p>创建/opt/module/mysql/data</p><p>3、初始化数据库</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 初始化数据库，并指定启动mysql的用户，否则就会在启动MySQL时出现权限不足的问题</span></span><br><span class="line">/usr/local/src/mysql/<span class="built_in">bin</span>/mysqld --initialize --user=mysql --basedir=/usr/local/src/mysql --datadir=/usr/local/src/mysql/data --lc_messages_dir=/usr/local/src/mysql/share --lc_messages=en_US</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看root的随机密码</span></span><br><span class="line">cat /var/log/mysqld.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#root@local: XXXXX   XXXXX就是初始密码</span></span><br></pre></td></tr></table></figure><p>bash_profile 在 ~ /中</p><p>==<strong>启动数据库</strong>==</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#源目录启动：</span></span><br><span class="line">/usr/local/src/mysql/support-files/mysql.server start</span><br></pre></td></tr></table></figure><p>设置开机自动启动服务</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 复制启动脚本到资源目录</span></span><br><span class="line">cp /usr/local/src/mysql/support-files/mysql.server /etc/rc.d/init.d/mysqld</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加mysqld服务控制脚本执行权限</span></span><br><span class="line">chmod +x /etc/rc.d/init.d/mysqld</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将mysqld服务加入到系统服务</span></span><br><span class="line">chkconfig --add mysqld</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查mysqld服务是否已经生效</span></span><br><span class="line">chkconfig --<span class="built_in">list</span> mysqld</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换至mysql用户，启动mysql，或者稍后下一步再启动。</span></span><br><span class="line">su mysql</span><br><span class="line"></span><br><span class="line">service mysqld start </span><br></pre></td></tr></table></figure><p>==<strong>配置环境变量</strong>==</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换至mysql用户</span></span><br><span class="line">su mysql</span><br><span class="line"></span><br><span class="line">vi .bash_profile</span><br><span class="line"><span class="comment"># 修改配置文件，增加export PATH=$PATH:/usr/local/src/mysql/bin</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 立即生效</span></span><br><span class="line">source .bash_profile</span><br></pre></td></tr></table></figure><p>==<strong>登录，修改密码</strong>==</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 系统默认会查找/usr/bin下的命令;建立一个链接文件。</span></span><br><span class="line">ln -s /usr/local/usr/mysql/<span class="built_in">bin</span>/mysql /usr/<span class="built_in">bin</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 登陆mysql的root用户</span></span><br><span class="line">mysql -uroot -p</span><br><span class="line"><span class="comment"># 输入2.4生成的 随机密码</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改root用户密码为123456</span></span><br><span class="line"><span class="built_in">set</span> password <span class="keyword">for</span> root@localhost=password(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#给权限,使用户可以远程登录</span></span><br><span class="line">mysql&gt;grant <span class="built_in">all</span> privileges on *.* to <span class="string">&#x27;新用户名&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;新密码&#x27;</span>;</span><br><span class="line"></span><br><span class="line">mysql&gt;flush privileges;</span><br></pre></td></tr></table></figure><h2 id="Hive安装"><a href="#Hive安装" class="headerlink" title="Hive安装"></a>Hive安装</h2><p>1）解压</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf /opt/softwares/apache-hive-3.1.2-bin.tar.gz  -C /opt/module</span><br></pre></td></tr></table></figure><p>2）配环境变量</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export HIVE_HOME=/opt/module/hive</span><br><span class="line">export PATH=$PATH:$HIVE_HOME/bin</span><br><span class="line">export HADOOP_CLASSPATH=&#x27;hadoop classpath&#x27;</span><br></pre></td></tr></table></figure><p>3）修改配置文件</p><p>hive-env.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/opt/module/jdk1.8</span><br><span class="line">export HIVE_HOME=/opt/module/hive</span><br><span class="line">export HADOOP_HOME=/opt/module/hadoop-3.1.3</span><br><span class="line">export HIVE_CONF_DIR=/opt/module/hive/conf</span><br></pre></td></tr></table></figure><p>hive-site.xml（可去hive/hcatalog/etc/hcatalog/目录下把proto-hive-site.xml复制到conf目录下并改名为hive-site.xml，删除第一个property之间的和除这四个以外的）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;property&gt;</span><br><span class="line">           &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;</span><br><span class="line">           &lt;value&gt;jdbc:mysql://master:3306/hive_db?createDatabaseIfNotExist=true&amp;amp;useSSL=false&lt;/value&gt;</span><br><span class="line">   &lt;/property&gt;</span><br><span class="line">   &lt;property&gt;</span><br><span class="line">           &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;</span><br><span class="line">           &lt;value&gt;root(名字看题目要求)&lt;/value&gt;</span><br><span class="line">   &lt;/property&gt;</span><br><span class="line">   &lt;property&gt;</span><br><span class="line">           &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;</span><br><span class="line">           &lt;value&gt;000000(密码看题目要求)&lt;/value&gt;</span><br><span class="line">   &lt;/property&gt;</span><br><span class="line">   &lt;property&gt;</span><br><span class="line">           &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;</span><br><span class="line">           &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;</span><br><span class="line">   &lt;/property&gt;</span><br><span class="line">   &lt;!--cli 显示表头和列名--&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;hive.cli.print.header&lt;/name&gt;</span><br><span class="line">&lt;value&gt;true&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;hive.cli.print.current.db&lt;/name&gt;</span><br><span class="line">&lt;value&gt;true&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure><p>4）拷贝jar包</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cp mysql-connector-java-5.1.37-bin.jar  /opt/module/hive/lib</span><br><span class="line">rm -rf /opt/module/hive/lib/guave-19.0.jar</span><br><span class="line">cp /opt/module/hadoop-3.1.3/share/hadoop/commond/lib/guava-27.0-jre.jar /opt/module/hive/lib</span><br></pre></td></tr></table></figure><p>5）初始化</p><p>在src下    </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">schematool -dbType mysql -initSchema</span><br></pre></td></tr></table></figure><p>6）查看</p><p>输入hive，出现hive&gt;</p><p>7）退出 exit；</p><ul><li><p>登录</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br></pre></td></tr></table></figure></li><li><p>更改密码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter user &#x27;root&#x27;@&#x27;localhost&#x27; identified by &#x27;root&#x27;;</span><br><span class="line">set password for &#x27;root&#x27;@&#x27;localhost&#x27;=&#x27;123456&#x27;;</span><br></pre></td></tr></table></figure></li><li><p>开启远程登录</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grant all privileges on *.* to &#x27;root&#x27;@&#x27;%&#x27; identified by &#x27;root&#x27; with grant option;</span><br><span class="line"></span><br><span class="line">刷新</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure></li></ul><p>3、配置hive</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">配置 conf/hive-env.sh文件中的 HADOOP_HOME</span><br><span class="line">export HADOOP_HOME=/usr/local/hadoop/</span><br></pre></td></tr></table></figure><p>4.导入jar包 和 移除jar包</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">将 mysql-connector-java-5.1.47.jar 添加到hive lib 下</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/hive/lib/</span><br><span class="line">/usr/local/hadoop/share/hadoop/common/lib/</span><br><span class="line">删除低版本的jar包，将高版本的jar包复制到原来低版本的位置即可</span><br></pre></td></tr></table></figure><p>5.修改hive-site.xml配置文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--需要登录MySQL数据库，创建一个 hive 数据库备用--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>jdbc:mysql://mater:3306/hive?</span><br><span class="line">createDatabaseIfNotExist=true<span class="symbol">&amp;amp;</span>useSSL=false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--安装MySQL数据库的驱动类--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionDriverName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--安装MySQL数据库的名称--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionUserName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>root<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--安装MySQL数据库的密码--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionPassword<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Hive使用"><a href="#Hive使用" class="headerlink" title="Hive使用"></a>Hive使用</h2><p>==1、<strong>外部表</strong>==</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> t1 (</span><br><span class="line">  cust_id STRING,</span><br><span class="line">  fname STRING,</span><br><span class="line">  lname STRING,</span><br><span class="line">  email STRING,</span><br><span class="line">  level STRING,</span><br><span class="line">  phone MAP<span class="operator">&lt;</span>STRING, STRING<span class="operator">&gt;</span>,</span><br><span class="line">  order_ids <span class="keyword">ARRAY</span><span class="operator">&lt;</span>STRING<span class="operator">&gt;</span>,</span><br><span class="line">  order_value STRUCT<span class="operator">&lt;</span>min: STRING, max: STRING, avg: STRING, total: STRING<span class="operator">&gt;</span></span><br><span class="line">)</span><br><span class="line"><span class="type">row</span> format delimited</span><br><span class="line">fields terminated <span class="keyword">by</span> <span class="string">&#x27;|&#x27;</span></span><br><span class="line">collection items terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span></span><br><span class="line">map keys terminated <span class="keyword">by</span> <span class="string">&#x27;:&#x27;</span></span><br><span class="line">location <span class="string">&#x27;/yyh&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> t1 (</span><br><span class="line"> cust_id STRING,</span><br><span class="line"> fname STRING,</span><br><span class="line"> lname STRING,</span><br><span class="line"> email STRING,</span><br><span class="line"> level STRING,</span><br><span class="line"> phone MAP<span class="operator">&lt;</span>STRING, STRING<span class="operator">&gt;</span>,</span><br><span class="line"> order_ids <span class="keyword">ARRAY</span><span class="operator">&lt;</span>STRING<span class="operator">&gt;</span>,</span><br><span class="line"> order_value STRUCT<span class="operator">&lt;</span>min: <span class="keyword">DOUBLE</span>, max: <span class="keyword">DOUBLE</span>, avg: <span class="keyword">DOUBLE</span>, total: <span class="keyword">DOUBLE</span><span class="operator">&gt;</span>)</span><br><span class="line"><span class="type">row</span> format delimited</span><br><span class="line">fields terminated <span class="keyword">by</span> <span class="string">&#x27;|&#x27;</span></span><br><span class="line">collection items terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span></span><br><span class="line">map keys terminated <span class="keyword">by</span> <span class="string">&#x27;:&#x27;</span></span><br><span class="line">location <span class="string">&#x27;/yyh&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> t5 (</span><br><span class="line"> cust_id STRING,</span><br><span class="line"> fname STRING,</span><br><span class="line"> lname STRING,</span><br><span class="line"> email STRING,</span><br><span class="line"> level STRING,</span><br><span class="line"> phone MAP<span class="operator">&lt;</span>STRING, STRING<span class="operator">&gt;</span>,</span><br><span class="line"> order_ids <span class="keyword">ARRAY</span><span class="operator">&lt;</span>STRING<span class="operator">&gt;</span>,</span><br><span class="line"> order_value STRUCT<span class="operator">&lt;</span>min: <span class="keyword">DOUBLE</span>, max: <span class="keyword">DOUBLE</span>, avg: <span class="keyword">DOUBLE</span>, total: <span class="keyword">DOUBLE</span><span class="operator">&gt;</span>)</span><br><span class="line"><span class="type">row</span> format delimited</span><br><span class="line">fields terminated <span class="keyword">by</span> <span class="string">&#x27;|&#x27;</span></span><br><span class="line">collection items terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span></span><br><span class="line">map keys terminated <span class="keyword">by</span> <span class="string">&#x27;#&#x27;</span></span><br><span class="line">location <span class="string">&#x27;/yyh&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 对上步任务创建的新表loyalty_program实现以下要求的简单查询：</span></span><br><span class="line"><span class="comment">-- 运行查询以选择客户ID1200866的HOME电话号码。并记录结果到 master 节点上 ec2-user 用户下的~/results/task4-2.txt文件中。（1分）</span></span><br><span class="line"><span class="keyword">INSERT</span> OVERWRITE <span class="keyword">LOCAL</span> DIRECTORY <span class="string">&#x27;/home/ec2-user/results&#x27;</span></span><br><span class="line"><span class="type">ROW</span> FORMAT DELIMITED</span><br><span class="line">FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;,&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> phone[<span class="string">&#x27;HOME&#x27;</span>] <span class="keyword">FROM</span> loyalty_program <span class="keyword">WHERE</span> cust_id <span class="operator">=</span> <span class="string">&#x27;1200866&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询客户ID1200866的HOME电话号码</span></span><br><span class="line"><span class="keyword">SELECT</span> phone[<span class="string">&#x27;HOME&#x27;</span>] <span class="keyword">FROM</span> loyalty_program <span class="keyword">WHERE</span> cust_id <span class="operator">=</span> <span class="string">&#x27;1200866&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 从order_ids数组中为客户ID1200866选择第三个元素</span></span><br><span class="line"><span class="keyword">SELECT</span> order_ids[<span class="number">2</span>] <span class="keyword">FROM</span> loyalty_program <span class="keyword">WHERE</span> cust_id <span class="operator">=</span> <span class="string">&#x27;1200866&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 从order_value结构中为客户ID1200866选择total属性</span></span><br><span class="line"><span class="keyword">SELECT</span> order_value.total <span class="keyword">FROM</span> loyalty_program <span class="keyword">WHERE</span> cust_id <span class="operator">=</span> <span class="string">&#x27;1200866&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>==<strong>分析数值产品评分</strong>==</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 客户评价和反馈是客户和像 Dualcore 的零售商的重要信息来源。我们希望找到客户最喜欢的产品，但必须防止评级很少的产品误导。</span></span><br><span class="line"><span class="comment">-- 探查 Hive 中的ratings表中数据，查询所有具有至少50个评级的产品中评分平均值最高的产品？并记录prod_id(产品ID)结果到 master -- 节点上 ec2-user 用户下的~/results/task4-3.txt文件中。（2分）</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> prod_id</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> prod_id, <span class="built_in">AVG</span>(rating) <span class="keyword">AS</span> avg_rating, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> rating_count</span><br><span class="line">  <span class="keyword">FROM</span> ratings</span><br><span class="line">  <span class="keyword">GROUP</span> <span class="keyword">BY</span> prod_id</span><br><span class="line">  <span class="keyword">HAVING</span> rating_count <span class="operator">&gt;=</span> <span class="number">50</span></span><br><span class="line">) t</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> avg_rating <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">1</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Sqoop安装与使用"><a href="#Sqoop安装与使用" class="headerlink" title="Sqoop安装与使用"></a>Sqoop安装与使用</h2><p>==1、<strong>上传安装包、解压</strong>==</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf sqoop-1.4.7.bin__hadoop-2.6.0.tar.gz</span><br><span class="line"></span><br><span class="line">mv sqoop-1.4.7.bin__hadoop-2.6.0 sqoop</span><br></pre></td></tr></table></figure><p>==2、<strong>拷贝jar包，MySQL，hive</strong>==</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp mysql-connector-java-5.1.46.jar hive-exec-2.3.3.jar /opt/softwore/sqoop/lib</span><br></pre></td></tr></table></figure><p>==3、<strong>配置环境变量</strong>==</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="operator">/</span>etc<span class="operator">/</span>profile</span><br><span class="line">## SQOOP_HOME</span><br><span class="line">export SQOOP_HOME<span class="operator">=</span><span class="operator">/</span>opt<span class="operator">/</span>softwore<span class="operator">/</span>sqoop</span><br><span class="line">export PATH<span class="operator">=</span>$PATH:$SQOOP_HOME<span class="operator">/</span>bin</span><br><span class="line">source <span class="operator">/</span>etc<span class="operator">/</span>profile</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>==4、<strong>修改配置 文件</strong>==</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cp sqoop-env-template.sh sqoop-env.sh</span><br><span class="line"></span><br><span class="line">修改以下内容</span><br><span class="line">export HADOOP_COMMON_HOME=/opt/softwore/hadoop</span><br><span class="line">export HADOOP_MAPRED_HOME=/opt/softwore/hadoop</span><br><span class="line">export HIVE_HOME=/opt/softwore/hive</span><br></pre></td></tr></table></figure><p>==5、<strong>测试环境</strong>==</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqoop version</span><br></pre></td></tr></table></figure><p>==6、<strong>列出数据库</strong>==</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sqoop list<span class="operator">-</span>databases \</span><br><span class="line"><span class="comment">--connect jdbc:mysql://master:3306/ \</span></span><br><span class="line"><span class="comment">--username root --password 123456</span></span><br></pre></td></tr></table></figure><p>==<strong>报错</strong>==</p><ul><li>mapreduce启动失败</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master txt]# hadoop classpath</span><br><span class="line">/opt/softwore/hadoop/etc/hadoop:/opt/softwore/hadoop/share/hadoop/common/lib/*:/opt/softwore/hadoop/share/hadoop/common/*:/opt/softwore/hadoop/share/hadoop/hdfs:/opt/softwore/hadoop/share/hadoop/hdfs/lib/*:/opt/softwore/hadoop/share/hadoop/hdfs/*:/opt/softwore/hadoop/share/hadoop/mapreduce/*:/opt/softwore/hadoop/share/hadoop/yarn:/opt/softwore/hadoop/share/hadoop/yarn/lib/*:/opt/softwore/hadoop/share/hadoop/yarn/*</span><br></pre></td></tr></table></figure><p>修改yarn-site.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.application.classpath<span class="tag">&lt;/<span class="name">name</span>&gt;</span>     <span class="tag">&lt;<span class="name">value</span>&gt;</span>/opt/softwore/hadoop/etc/hadoop:/opt/softwore/hadoop/share/hadoop/common/lib/*:/opt/softwore/hadoop/share/hadoop/common/*:/opt/softwore/hadoop/share/hadoop/hdfs:/opt/softwore/hadoop/share/hadoop/hdfs/lib/*:/opt/softwore/hadoop/share/hadoop/hdfs/*:/opt/softwore/hadoop/share/hadoop/mapreduce/*:/opt/softwore/hadoop/share/hadoop/yarn:/opt/softwore/hadoop/share/hadoop/yarn/lib/*:/opt/softwore/hadoop/share/hadoop/yarn/*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Spark安装"><a href="#Spark安装" class="headerlink" title="Spark安装"></a>Spark安装</h2><p>==1、<strong>修改Hadoop配置文件yarn-site.xml</strong>==</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--是否启动一个线程检查每个任务正使用的物理内存量，如果任务超出分配值，则直接将其杀掉，默认是true --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.pmem-check-enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--是否启动一个线程检查每个任务正使用的虚拟内存量，如果任务超出分配值，则直接将其杀掉，默认是true--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.vmem-check-enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><p>==2、<strong>解压安装包、配置</strong>==</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">解压spark，并重命名为spark-yarn</span><br><span class="line">tar -zxvf spark-2.4.7-bin-hadoop2.7.tgz</span><br><span class="line">mv spark-2.4.7-bin-hadoop2.7 spark-yarn</span><br><span class="line"></span><br><span class="line">修改spark-env.sh文件，添加java环境和yarn配置地址</span><br><span class="line">cp spark-env.sh.template spark-env.sh</span><br><span class="line">vim spark-env.sh</span><br><span class="line"></span><br><span class="line">添加内容</span><br><span class="line">export JAVA_HOME=/opt/softwore/jdk8</span><br><span class="line">export HADOOP_HOME=/opt/softwore/hadoop</span><br><span class="line">export HADOOP_CONF_DIR=/opt/softwore/hadoop/etc/hadoop</span><br><span class="line">export LD_LIBRARY_PATH=/opt/softwore/hadoop/lib/native</span><br><span class="line">export SPARK_MASTER_IP=master</span><br><span class="line">export SPARK_LOCAL_DIRS=/opt/softwore/src/spark/tmp</span><br><span class="line">export SPARK_LOG_DIR=/opt/softwore/spark/logs</span><br><span class="line">export SPARK_MASTER_PORT=7077</span><br><span class="line">export SPARK_DRIVER_MEMORY=512M</span><br><span class="line"></span><br><span class="line">修改slaves文件</span><br><span class="line">cp slaves.template slaves</span><br><span class="line">vim slaves</span><br><span class="line">master</span><br><span class="line">node01</span><br><span class="line">node02</span><br><span class="line"></span><br><span class="line">修改环境变量</span><br><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line">## SPARK_ENV</span><br><span class="line">export SPARK_HOME=/usr/local/spark-yarn</span><br><span class="line">export PATH=$PATH:$SPARK_HOME/bin:$SPARK_HOME/sbin</span><br><span class="line"></span><br><span class="line">刷新，生效</span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure><p>==3、<strong>导入jar包</strong>==</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp mysql-connector-java-5.1.47.jar /opt/softwore/spark/jars</span><br><span class="line">cp hive-common-2.3.1.jar /opt/softwore/spark/jars</span><br></pre></td></tr></table></figure><p>==4、<strong>使用Hive</strong>==</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">spark-shell</span><br><span class="line"></span><br><span class="line"><span class="comment">// 开启多行代码模式</span></span><br><span class="line">:paste</span><br><span class="line"></span><br><span class="line">saprk.sql(<span class="string">&quot;select * from yyh.t1&quot;</span>).show()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭</span></span><br><span class="line">ctrl + <span class="type">D</span></span><br></pre></td></tr></table></figure><h2 id="Spark使用"><a href="#Spark使用" class="headerlink" title="Spark使用"></a>Spark使用</h2><h4 id="省赛样卷一"><a href="#省赛样卷一" class="headerlink" title="省赛样卷一"></a>省赛样卷一</h4><blockquote><p>任务6：Spark 分布式计算（5分）</p><p>6.1 计算不重复的电影数量</p><p>6.2 计算电影平均评分</p><p>6.3 计算用户在夜晚的评分总记录数</p></blockquote><p>==<strong>实例化对象</strong>==</p><h5 id="6-1-计算不重复的电影数量"><a href="#6-1-计算不重复的电影数量" class="headerlink" title="6.1 计算不重复的电影数量"></a>6.1 计算不重复的电影数量</h5><blockquote><p>在master节点上操作，读取 hdfs 上/spark/movie_ratings.csv数据，启动 spark 计算不重复的电影（movieId）数量，并保存结果到~/results/task6-1.txt文件中。（1分）</p></blockquote><p><code>spark-shell</code>还是先开启多行代码编辑模式<code>:paste</code></p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; :paste</span><br><span class="line"><span class="comment">// Entering paste mode (ctrl-D to finish)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> data = spark.read</span><br><span class="line">                .option(<span class="string">&quot;header&quot;</span>,<span class="string">&quot;true&quot;</span>)</span><br><span class="line">                .option(<span class="string">&quot;inferSchema&quot;</span>, <span class="string">&quot;true&quot;</span>)</span><br><span class="line">                .format(<span class="string">&quot;csv&quot;</span>)</span><br><span class="line">                .load(<span class="string">&quot;hdfs:///spark/movie_ratings.csv&quot;</span>)</span><br><span class="line">                .createTempView(<span class="string">&quot;t1&quot;</span>)</span><br><span class="line">spark.sql(<span class="string">&quot;select count(distinct(movieId)) from t1&quot;</span>).show()</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> res1 = spark.sql(<span class="string">&quot;select count(distinct(movieId)) from t1&quot;</span>)</span><br><span class="line"><span class="type">Seq</span>(res1.first().toString()).toDF().write.mode(<span class="string">&quot;overwrite&quot;</span>).text(<span class="string">&quot;file:///root/results/task6-2.txt&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Exiting paste mode, now interpreting.</span></span><br><span class="line"></span><br><span class="line">+-----------------------+                                                       </span><br><span class="line">|count(<span class="type">DISTINCT</span> movieId)|</span><br><span class="line">+-----------------------+</span><br><span class="line">|                  <span class="number">14026</span>|</span><br><span class="line">+-----------------------+</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> data: <span class="type">Unit</span> = ()</span><br><span class="line"><span class="keyword">val</span> res1: org.apache.spark.sql.<span class="type">DataFrame</span> = [count(<span class="type">DISTINCT</span> movieId): bigint]</span><br></pre></td></tr></table></figure><p>保存文件的时候遇到了一些问题，因为前面我是设置了<code>.format(&quot;inferSchema&quot;, &quot;true&quot;)</code>spark自动识别字段类型，所以有的数据格式为<code>Bigint</code>,但是存文件时候spark不支持直接将<code>Bigint</code>类型转换为文本格式，这里想了想只是输出一个纯文本用不着这么麻烦我直接就强转了，但是这样是错的你强转的只是sql语句，所以还是需要麻烦一点获取<code>first()</code>其实更好的方式是将<code>Bigint</code>类型转成String，然后存到一个Seq中再转成<code>dataframe</code>格式            </p><p>还有一点就是保存到本地是<code>file:///</code></p><p><code>Seq</code>提供了许多其他的操作方法，如<code>head</code>、<code>tail</code>、<code>isEmpty</code>、<code>distinct</code>等</p><p>需要注意的是，<code>Seq</code>是不可变的，这意味着它的元素是不可变的，一旦创建，就不能修改。如果你需要可变的序列，可以使用<code>mutable.Seq</code>。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> from_unixtime(<span class="number">1112484727</span>, <span class="string">&#x27;yyyy-MM-dd HH:mm:ss&#x27;</span>);</span><br></pre></td></tr></table></figure><h5 id="6-2-计算电影平均评分"><a href="#6-2-计算电影平均评分" class="headerlink" title="6.2  计算电影平均评分"></a>6.2  计算电影平均评分</h5><blockquote><p>在master节点上操作，读取 hdfs 上/spark/movie_ratings.csv数据，运用 spark 计算电影平均评分，保留两位小数，并保存结果到~/results/task6-2.txt文件中。(平均评分=总评分数/总评分记录数）（1分）</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> res2 = spark.sql(<span class="string">&quot;select round(avg(rating),2) as avg_rating from t1&quot;</span>)</span><br><span class="line"><span class="type">Seq</span>(res2.first().toString()).toDF().write.mode(<span class="string">&quot;overwrite&quot;</span>).text(<span class="string">&quot;file:///root/results/task6-2.txt&quot;</span>)</span><br></pre></td></tr></table></figure><h5 id="6-3-计算用户在夜晚的评分总记录数"><a href="#6-3-计算用户在夜晚的评分总记录数" class="headerlink" title="6.3  计算用户在夜晚的评分总记录数"></a>6.3  计算用户在夜晚的评分总记录数</h5><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 6.3 计算用户在夜晚的评分总记录数</span></span><br><span class="line"><span class="comment">     * 在master节点上操作，读取 hdfs 上/spark/movie_ratings.csv数据，</span></span><br><span class="line"><span class="comment">     * 按照以下要求把每天的评分时间字段划分为 morning、lunch、afternoon、evening、night 五个时间段，</span></span><br><span class="line"><span class="comment">     * 并运用 spark 计算用户在夜晚（evening）的评分总记录数，并保存结果到~/results/task6-3.txt文件中。（3分）</span></span><br><span class="line"><span class="comment">     * 评分时间戳字段分类（以小时为单位）：</span></span><br><span class="line"><span class="comment">     * •morning：7~12（包含7点，不含12点）</span></span><br><span class="line"><span class="comment">     * •lunch：12~14（包含12点，不含14点）</span></span><br><span class="line"><span class="comment">     * •afternoon：14~18（包含14点，不含18点）</span></span><br><span class="line"><span class="comment">     * •evening：18~24（包含18点，不含24点）</span></span><br><span class="line"><span class="comment">     * •night：0~7（包含0点，不含7点）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> data = spark.read</span><br><span class="line">      .option(<span class="string">&quot;header&quot;</span>, <span class="string">&quot;true&quot;</span>)</span><br><span class="line">      .option(<span class="string">&quot;inferSchema&quot;</span>, <span class="string">&quot;true&quot;</span>)</span><br><span class="line">      .csv(<span class="string">&quot;C:\\Users\\beihai\\Desktop\\competition\\movie_ratings.csv&quot;</span>)</span><br><span class="line">      .createTempView(<span class="string">&quot;view1&quot;</span>)</span><br><span class="line"></span><br><span class="line">    spark.sql(</span><br><span class="line">      <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        |with t1 as (</span></span><br><span class="line"><span class="string">        |select</span></span><br><span class="line"><span class="string">        |       userId,movieId,rating,hour(from_unixtime(timestamp, &#x27;yyyy-MM-dd HH:mm:ss&#x27;)) as hour_time</span></span><br><span class="line"><span class="string">        |from</span></span><br><span class="line"><span class="string">        |       view1</span></span><br><span class="line"><span class="string">        |),</span></span><br><span class="line"><span class="string">        |t2 as (</span></span><br><span class="line"><span class="string">        |select</span></span><br><span class="line"><span class="string">        |       userId,rating,</span></span><br><span class="line"><span class="string">        |case</span></span><br><span class="line"><span class="string">        |       when hour_time &gt;= 7 and hour_time &lt; 12 then &#x27;morning&#x27;</span></span><br><span class="line"><span class="string">        |       when hour_time &gt;= 12 and hour_time &lt; 14 then &#x27;lunch&#x27;</span></span><br><span class="line"><span class="string">        |       when hour_time &gt;= 14 and hour_time &lt; 18 then &#x27;afternoon&#x27;</span></span><br><span class="line"><span class="string">        |       when hour_time &gt;= 18 and hour_time &lt; 24 then &#x27;evening&#x27;</span></span><br><span class="line"><span class="string">        |       else &#x27;night&#x27;</span></span><br><span class="line"><span class="string">        |end as evening_rating</span></span><br><span class="line"><span class="string">        |from t1</span></span><br><span class="line"><span class="string">        |)</span></span><br><span class="line"><span class="string">        |select</span></span><br><span class="line"><span class="string">        |userId, sum(rating) as rating</span></span><br><span class="line"><span class="string">        |from t2</span></span><br><span class="line"><span class="string">        |where evening_rating = &#x27;evening&#x27;</span></span><br><span class="line"><span class="string">        |group by userId</span></span><br><span class="line"><span class="string">        |order by userId</span></span><br><span class="line"><span class="string">        |&quot;&quot;&quot;</span>.stripMargin).show()</span><br><span class="line"></span><br><span class="line">    spark.sql(</span><br><span class="line">      <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        |select</span></span><br><span class="line"><span class="string">        |       userId,sum(rating) as evening_ratings</span></span><br><span class="line"><span class="string">        |from view1</span></span><br><span class="line"><span class="string">        |where</span></span><br><span class="line"><span class="string">        |       hour(from_unixtime(timestamp,&#x27;yyyy-MM-dd HH:mm:ss&#x27;)) &gt;= 18 and hour(from_unixtime(timestamp,&#x27;yyyy-MM-dd HH:mm:ss&#x27;)) &lt; 24</span></span><br><span class="line"><span class="string">        |group by userId</span></span><br><span class="line"><span class="string">        |order by userId</span></span><br><span class="line"><span class="string">        |&quot;&quot;&quot;</span>.stripMargin).show()</span><br></pre></td></tr></table></figure><h2 id="Flume安装与使用"><a href="#Flume安装与使用" class="headerlink" title="Flume安装与使用"></a>Flume安装与使用</h2><p>==1、<strong>上传安装包，解压配置</strong>==</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">tar <span class="operator">-</span>zxvf apache<span class="operator">-</span>flume<span class="number">-1.9</span><span class="number">.0</span><span class="operator">-</span>bin.tar.gz</span><br><span class="line">mv apache<span class="operator">-</span>flume<span class="number">-1.8</span><span class="number">.0</span><span class="operator">-</span>bin flume</span><br><span class="line">修改配置文件</span><br><span class="line">cp flume<span class="operator">-</span>env.sh.template flume<span class="operator">-</span>env.sh</span><br><span class="line">vim flume<span class="operator">-</span>env.sh</span><br><span class="line">export JAVA_HOME<span class="operator">=</span><span class="operator">/</span>usr<span class="operator">/</span><span class="keyword">local</span><span class="operator">/</span>src<span class="operator">/</span>jdk</span><br><span class="line">配置环境变量</span><br><span class="line">vim <span class="operator">/</span>etc<span class="operator">/</span>profile</span><br><span class="line"></span><br><span class="line">## FLUME_HOME</span><br><span class="line">export FLUME_HOME<span class="operator">=</span><span class="operator">/</span>usr<span class="operator">/</span><span class="keyword">local</span><span class="operator">/</span>flume</span><br><span class="line">export PATH<span class="operator">=</span>$PATH:$FLUME_HOME<span class="operator">/</span>bin</span><br><span class="line">测试 Flume 环境配置</span><br><span class="line">flume<span class="operator">-</span>ng version</span><br></pre></td></tr></table></figure><p>==2、<strong>Flume 入门案例</strong>==</p><ul><li><p>采集需求：监控本地指定端口（44444)，采集数据到控制台日志显示 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># example.conf</span><br><span class="line"></span><br><span class="line"># 定义Agent的名称、Source、Channel、Sink的名称</span><br><span class="line">a1.sources = r1</span><br><span class="line">a1.sinks = k1</span><br><span class="line">a1.channels = c1</span><br><span class="line"></span><br><span class="line"># 配置 Source 组件属性</span><br><span class="line">a1.sources.r1.type = netcat</span><br><span class="line">a1.sources.r1.bind = localhost</span><br><span class="line">a1.sources.r1.port = 44444</span><br><span class="line"></span><br><span class="line"># 配置 Channel 组件属性</span><br><span class="line">a1.channels.c1.type = memory</span><br><span class="line"># 内存最大存储的 event 数量</span><br><span class="line">a1.channels.c1.capacity = 10000</span><br><span class="line"># 每次最大从source中拿到sink中的event数量</span><br><span class="line">a1.channels.c1.transactionCapacity = 100</span><br><span class="line"></span><br><span class="line"># 配置 Sink 组件属性</span><br><span class="line">a1.sinks.k1.type = logger</span><br><span class="line"></span><br><span class="line"># 将源和接收器绑定到通道</span><br><span class="line">a1.sources.r1.channels = c1</span><br><span class="line">a1.sinks.k1.channel = c1</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flume<span class="operator">-</span>ng agent <span class="comment">--name a1 --conf $FLUME_HOME/conf --conf-file $FLUME_HOME/conf/example.conf</span></span><br><span class="line"><span class="operator">-</span>Dflume.root.logger<span class="operator">=</span>INFO,console</span><br></pre></td></tr></table></figure><p>本地监控需要安装</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc localhost <span class="number">44444</span></span><br></pre></td></tr></table></figure></li></ul><ul><li>监控指定目录采集数据保存到HDFS</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Namenode 端口:</span><br><span class="line"><span class="number">2.</span>x端口<span class="number">3.</span>x端口name<span class="keyword">desc</span></span><br><span class="line"><span class="number">50470</span><span class="number">9871</span>dfs.namenode.https<span class="operator">-</span>addressThe namenode secure http server address <span class="keyword">and</span> port.</span><br><span class="line"><span class="number">50070</span><span class="number">9870</span>dfs.namenode.http<span class="operator">-</span>addressThe address <span class="keyword">and</span> the base port <span class="keyword">where</span> the dfs namenode web ui will listen on.</span><br><span class="line"><span class="number">8020</span><span class="number">9820</span>fs.defaultFS指定HDFS运行时nameNode地址</span><br><span class="line">Secondary NN 端口:</span><br><span class="line"><span class="number">2.</span>x端口<span class="number">3.</span>x端口name<span class="keyword">desc</span></span><br><span class="line"><span class="number">50091</span><span class="number">9869</span>dfs.namenode.secondary.https<span class="operator">-</span>addressThe secondary namenode HTTPS server address <span class="keyword">and</span> port</span><br><span class="line"><span class="number">50090</span><span class="number">9868</span>dfs.namenode.secondary.http<span class="operator">-</span>addressThe secondary namenode HTTPS server address <span class="keyword">and</span> port</span><br><span class="line">Datanode 端口:</span><br><span class="line"><span class="number">2.</span>x端口<span class="number">3.</span>x端口name<span class="keyword">desc</span></span><br><span class="line"><span class="number">50020</span><span class="number">9867</span>dfs.datanode.ipc.addressThe datanode ipc server address <span class="keyword">and</span> port.</span><br><span class="line"><span class="number">50010</span><span class="number">9866</span>dfs.datanode.addressThe datanode server address <span class="keyword">and</span> port <span class="keyword">for</span> data transfer.</span><br><span class="line"><span class="number">50475</span><span class="number">9865</span>dfs.datanode.https.addressThe datanode secure http server address <span class="keyword">and</span> port</span><br><span class="line"><span class="number">50075</span><span class="number">9864</span>dfs.datanode.http.addressThe datanode http server address <span class="keyword">and</span> por</span><br><span class="line">Yarn 端口</span><br><span class="line"><span class="number">2.</span>x端口<span class="number">3.</span>x端口name<span class="keyword">desc</span></span><br><span class="line"><span class="number">8088</span><span class="number">8088</span>yarn.resourcemanager.webapp.addresshttp服务端口</span><br></pre></td></tr></table></figure><h2 id="Linux权限"><a href="#Linux权限" class="headerlink" title="Linux权限"></a>Linux权限</h2><p><a href="https://blog.csdn.net/qq_63992711/article/details/127042653">https://blog.csdn.net/qq_63992711/article/details/127042653</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rwx rw- r-- 这就是 111 110 100 最终即 764 权限。</span><br><span class="line"></span><br><span class="line">修改file.txt文件的权限分配设置为 rwx rw- r-- 就可以操作为 chmod 764 file.txt</span><br></pre></td></tr></table></figure><h1 id="模块B：数据分析-30分"><a href="#模块B：数据分析-30分" class="headerlink" title="模块B：数据分析(30分)"></a>模块B：数据分析(30分)</h1><blockquote><p>花了两天把省赛样题一做了一遍，感觉还不错，难点就是在前期的数据的处理上，对于所处数据的格式要有分辨，是对列处理，还是对表处理。另外对数据异常值和空值的处理时候会出现问题，就可以用替换的方式,fillna处理的时候要注意替换成数值类型的时候，需要将源数据的格式astype为数值类型。对于画图这里，其实还是对数据进行处理，难点就是对于轴处理和值处理，对于x,y最好还是zip一下或者enumerate。这一模块练的就是对数据的敏感性，还是得多刷点算法题练思维</p></blockquote><h2 id="省赛样卷一：模块B"><a href="#省赛样卷一：模块B" class="headerlink" title="省赛样卷一：模块B"></a>省赛样卷一：模块B</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用来正常显示中文标签，SimHei是黑体的英文名称</span></span><br><span class="line">plt.rcParams[<span class="string">&#x27;font.sans-serif&#x27;</span>] = [<span class="string">&#x27;SimHei&#x27;</span>]</span><br><span class="line"><span class="comment"># 解决符号显示为方块的问题</span></span><br><span class="line">plt.rcParams[<span class="string">&#x27;axes.unicode_minus&#x27;</span>] = <span class="literal">False</span></span><br></pre></td></tr></table></figure><h3 id="任务1：数据读取（1分）"><a href="#任务1：数据读取（1分）" class="headerlink" title="任务1：数据读取（1分）"></a>任务1：数据读取（1分）</h3><blockquote><p>这里任务书说着是只读取一个文件，到比赛很可能就是读取两张表进行合并</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">任务1：数据读取（1分）</span></span><br><span class="line"><span class="string">• 载入 movies.csv 文件，数据路径为 ../data/movies.csv • 结果以变量data保存</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">data1 = pd.read_csv(<span class="string">&#x27;tmdb_5000_movies.csv&#x27;</span>)</span><br><span class="line">data2 = pd.read_csv(<span class="string">&#x27;tmdb_5000_credits.csv&#x27;</span>)</span><br><span class="line"><span class="comment"># 合并表</span></span><br><span class="line">data = data1.merge(data2,how=<span class="string">&#x27;left&#x27;</span>, left_on=<span class="string">&#x27;id&#x27;</span>, right_on=<span class="string">&#x27;movie_id&#x27;</span>)</span><br></pre></td></tr></table></figure><p>这里合并完成之后可能会有重复的列，python会自动识别然后添加_x,_y这种的字段，比赛的时候要看清楚，这里可以自定义删除和重命名</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">data.rename(&#123;<span class="string">&#x27;title_x&#x27;</span>:t1,<span class="string">&#x27;title_y&#x27;</span>:t2&#125;,inplace=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># 删除有多种方式</span></span><br><span class="line"><span class="keyword">del</span> data[<span class="string">&#x27;title_x&#x27;</span>]</span><br><span class="line">data.drop(columns=[<span class="string">&#x27;title_x&#x27;</span>,<span class="string">&#x27;title_y&#x27;</span>])</span><br></pre></td></tr></table></figure><p>合并完表之后可以重置索引</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data = data.reset_index(drop=<span class="literal">True</span>)</span><br><span class="line"><span class="comment">#data.index += 1</span></span><br></pre></td></tr></table></figure><p>做完这一部分之后可以保存一些防止后期用到</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.to_csv(<span class="string">&#x27;movie.csv&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="任务2：数据处理（9分）"><a href="#任务2：数据处理（9分）" class="headerlink" title="任务2：数据处理（9分）"></a>任务2：数据处理（9分）</h3><h4 id="任务2-1（1分）"><a href="#任务2-1（1分）" class="headerlink" title="任务2-1（1分）"></a>任务2-1（1分）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">删除指定字段，具体要求如下：</span></span><br><span class="line"><span class="string">•删除homepage, original_title, overview, spoken_languages, status, tagline, movie_id字段</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">data.drop(columns=[<span class="string">&#x27;homepage&#x27;</span>, <span class="string">&#x27;original_title&#x27;</span>, <span class="string">&#x27;overview&#x27;</span>,</span><br><span class="line">                   <span class="string">&#x27;spoken_languages&#x27;</span>, <span class="string">&#x27;status&#x27;</span>, <span class="string">&#x27;tagline&#x27;</span>, <span class="string">&#x27;movie_id&#x27;</span>],inplace=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><h4 id="任务2-2（1分）"><a href="#任务2-2（1分）" class="headerlink" title="任务2-2（1分）"></a>任务2-2（1分）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">增加profit字段，该字段为每部电影的收益，具体要求如下：</span></span><br><span class="line"><span class="string">•计算每部电影的收益，收益=电影票房-电影预算</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">data.loc[:,<span class="string">&#x27;profit&#x27;</span>] = data[<span class="string">&#x27;revenue&#x27;</span>] - data[<span class="string">&#x27;budget&#x27;</span>]</span><br></pre></td></tr></table></figure><h4 id="任务2-4（1分）"><a href="#任务2-4（1分）" class="headerlink" title="任务2-4（1分）"></a>任务2-4（1分）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">处理runtime字段的缺失值，该字段有两个缺失值，具体要求如下：</span></span><br><span class="line"><span class="string">•将id为370980的缺失值填充为98</span></span><br><span class="line"><span class="string">•将id为459488的缺失值填充为81</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 先查看数据类型</span></span><br><span class="line">data[<span class="string">&#x27;runtime&#x27;</span>].dtype</span><br><span class="line"><span class="comment"># 如果不是数值类型就改成数值类型</span></span><br><span class="line">data[<span class="string">&#x27;runtime&#x27;</span>] = data[<span class="string">&#x27;runtime&#x27;</span>].astype(<span class="built_in">float</span>)</span><br><span class="line"><span class="comment"># 查看空值</span></span><br><span class="line">data[data[<span class="string">&#x27;runtime&#x27;</span>].isnull()]</span><br><span class="line"><span class="comment"># 查看非空值</span></span><br><span class="line">data[~data[<span class="string">&#x27;runtime&#x27;</span>].isnull()]</span><br><span class="line"><span class="comment">#填充</span></span><br><span class="line">data.loc[data[<span class="string">&#x27;id&#x27;</span>] == <span class="number">370980</span>, <span class="string">&#x27;runtime&#x27;</span>] = data.loc[data[<span class="string">&#x27;id&#x27;</span>] == <span class="number">370980</span>, <span class="string">&#x27;runtime&#x27;</span>].fillna(<span class="number">98</span>)</span><br><span class="line">data.loc[data[<span class="string">&#x27;id&#x27;</span>] == <span class="number">459488</span>, <span class="string">&#x27;runtime&#x27;</span>] = data.loc[data[<span class="string">&#x27;id&#x27;</span>] == <span class="number">459488</span>, <span class="string">&#x27;runtime&#x27;</span>].fillna(<span class="number">81</span>)</span><br></pre></td></tr></table></figure><p>这里遇到些问题还没解决，就是对于缺失值处理我是用<code>fillna</code>函数，并且在格式正确的情况下，inplace=True不生效，查了查百度是因为链式原因，多次调用了指定的id，那就麻烦点直接对原始数据进行替换。</p><p>如果填充的时候报错可能是索引的问题去重新搞一下索引</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.reset_index(drop=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><h4 id="任务2-5（2分）"><a href="#任务2-5（2分）" class="headerlink" title="任务2-5（2分）"></a>任务2-5（2分）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">分别对genres, keywords, production_companies, production_countries字段进行处理，具体要求如下：</span></span><br><span class="line"><span class="string">•每个字段只保留该字段内容中name键值对应的value值，并以|分隔</span></span><br><span class="line"><span class="string">提示：例如[&#123;&quot;id&quot;: 28, &quot;name&quot;: &quot;Action&quot;&#125;, &#123;&quot;id&quot;: 12, &quot;name&quot;: &quot;Adventure&quot;&#125;, &#123;&quot;id&quot;: 14, &quot;name&quot;: &quot;Fantasy&quot;&#125;, &#123;&quot;id&quot;: 878, &quot;name&quot;: &quot;Science Fiction&quot;&#125;]，处理后变为Action|Adventure|Fantasy|Science Fiction</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 这里需要导入json</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将字符串装成字典列表类型</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process_field</span>(<span class="params">element</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(element, <span class="built_in">str</span>):</span><br><span class="line">        element = json.loads(element)</span><br><span class="line">    names = [item[<span class="string">&#x27;name&#x27;</span>] <span class="keyword">for</span> item <span class="keyword">in</span> element]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;|&#x27;</span>.join(names)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用</span></span><br><span class="line">data[<span class="string">&#x27;genres&#x27;</span>]= data[<span class="string">&#x27;genres&#x27;</span>].apply(process_field)</span><br><span class="line">data[<span class="string">&#x27;keywords&#x27;</span>] = data[<span class="string">&#x27;keywords&#x27;</span>].apply(process_field)</span><br><span class="line">data[<span class="string">&#x27;production_companies&#x27;</span>] = data[<span class="string">&#x27;production_companies&#x27;</span>].apply(process_field)</span><br><span class="line">data[<span class="string">&#x27;production_countries&#x27;</span>] = data[<span class="string">&#x27;production_countries&#x27;</span>].apply(process_field)</span><br></pre></td></tr></table></figure><h4 id="任务2-6（2分）"><a href="#任务2-6（2分）" class="headerlink" title="任务2-6（2分）"></a>任务2-6（2分）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">对crew字段进行处理，具体要求如下：</span></span><br><span class="line"><span class="string">•只保留导演的名字，并以|分隔</span></span><br><span class="line"><span class="string">•将crew字段列名改为director</span></span><br><span class="line"><span class="string">提示：导演的job为Director</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crew_func</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(data, <span class="built_in">str</span>):</span><br><span class="line">        data = json.loads(data)</span><br><span class="line">    names = [item[<span class="string">&#x27;name&#x27;</span>] <span class="keyword">for</span> item <span class="keyword">in</span> data]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;|&#x27;</span>.join(names)</span><br><span class="line">data[<span class="string">&#x27;crew&#x27;</span>] = data[<span class="string">&#x27;crew&#x27;</span>].apply(crew_func)</span><br><span class="line">data.rename(columns=&#123;<span class="string">&#x27;crew&#x27;</span>:<span class="string">&#x27;director&#x27;</span>&#125;,inplace=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>最后保存</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.to_csv(<span class="string">&#x27;movie2.csv&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="任务3：数据可视化（20分）"><a href="#任务3：数据可视化（20分）" class="headerlink" title="任务3：数据可视化（20分）"></a>任务3：数据可视化（20分）</h3><h4 id="任务3-1（2分）"><a href="#任务3-1（2分）" class="headerlink" title="任务3-1（2分）"></a>任务3-1（2分）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">对电影的关键词制作词云图</span></span><br><span class="line"><span class="string">•成功制作词云图（1分）</span></span><br><span class="line"><span class="string">•词云图图形为video（1分）</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 这里可以导入jieba进行分词,PIL进行img获取</span></span><br><span class="line"><span class="comment"># import jieba</span></span><br><span class="line"><span class="keyword">from</span> wordcloud <span class="keyword">import</span> WordCloud</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> colors</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">keywords_res = keywords.<span class="built_in">str</span>.split(<span class="string">&#x27;|&#x27;</span>).explode().unique()</span><br><span class="line">key_res = <span class="string">&#x27; &#x27;</span>.join(keywords_res)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置版图口罩</span></span><br><span class="line">video_mask = np.array(Image.<span class="built_in">open</span>(<span class="string">&#x27;./img/map.jpg&#x27;</span>))</span><br><span class="line">color_list = [<span class="string">&#x27;black&#x27;</span>,<span class="string">&#x27;red&#x27;</span>,<span class="string">&#x27;orange&#x27;</span>]</span><br><span class="line">colormap = colors.ListedColormap(color_list)</span><br><span class="line"></span><br><span class="line">wordclound = WordCloud(</span><br><span class="line">    mask = video_mask,</span><br><span class="line">    background_color=<span class="string">&#x27;white&#x27;</span>,</span><br><span class="line">    colormap=colormap</span><br><span class="line">).generate(key_res)</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">10</span>,<span class="number">5</span>))</span><br><span class="line">plt.imshow(wordclound, interpolation=<span class="string">&#x27;bilinear&#x27;</span>)</span><br><span class="line">plt.axis(<span class="string">&#x27;off&#x27;</span>)</span><br><span class="line">plt.tight_layout()</span><br><span class="line">plt.savefig(<span class="string">&#x27;wordcloud_map.png&#x27;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p>词云图绘制要注意几个问题，最终genreate_from_text一定是以空格隔开的文本文字，如果比赛的时候提供了jieba包就可以</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">这里text是一维的列表格式</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">cut = jieba.cut(text)</span><br><span class="line">string = <span class="string">&#x27; &#x27;</span>.join(cut)</span><br></pre></td></tr></table></figure><p>如果需要自动化保存n张图片可以使用随机数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ranInt = random.randint(<span class="number">1</span>,<span class="number">1000000</span>)</span><br><span class="line"></span><br><span class="line">plt.savefig(<span class="string">f&#x27;./static/cloud/<span class="subst">&#123;ranInt&#125;</span>.png&#x27;</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="string">f&#x27;./static/cloud/<span class="subst">&#123;ranInt&#125;</span>.png&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="任务3-2（2分）"><a href="#任务3-2（2分）" class="headerlink" title="任务3-2（2分）"></a>任务3-2（2分）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">制作电影的时长频率分布直方图</span></span><br><span class="line"><span class="string">•直方图图形类型正确（0.5分）</span></span><br><span class="line"><span class="string">•直方图颜色为蓝色，透明度为 0.5，框线为黑色（0.5分）</span></span><br><span class="line"><span class="string">•概率密度曲线以虚线表示（0.5分）</span></span><br><span class="line"><span class="string">•X轴和Y轴标签正确，左轴为直方图Y轴，右侧为概率密度曲线轴（0.5分）</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">runtimes = data[<span class="string">&#x27;runtime&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制直方图</span></span><br><span class="line">n, bins, patches = plt.hist(runtimes, bins=<span class="number">20</span>, color=<span class="string">&#x27;skyblue&#x27;</span>, alpha=<span class="number">0.5</span>, edgecolor=<span class="string">&#x27;black&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算组距</span></span><br><span class="line">bin_width = bins[<span class="number">1</span>] - bins[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算频率/组距</span></span><br><span class="line">frequency = n / bin_width</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算频率密度</span></span><br><span class="line">total_count = <span class="built_in">len</span>(runtimes)</span><br><span class="line">density = frequency / total_count</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算频率密度</span></span><br><span class="line"><span class="comment"># freq_density = n / (len(runtimes) * bin_width)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印频率/组距和频率密度</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;频率/组距:&quot;</span>, frequency)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;频率密度1:&quot;</span>, density)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;频率密度2:&quot;</span>, freq_density)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建图形和坐标系</span></span><br><span class="line">fig, ax = plt.subplots()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制直方图</span></span><br><span class="line">ax.hist(runtimes, bins=<span class="number">20</span>, color=<span class="string">&#x27;skyblue&#x27;</span>, alpha=<span class="number">0.5</span>, edgecolor=<span class="string">&#x27;black&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ax.set_yticks(frequency)</span><br><span class="line"><span class="comment"># 创建辅助坐标轴</span></span><br><span class="line">ax2 = ax.twinx()</span><br><span class="line"><span class="comment"># ax3 = ax.twinx()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制曲线图</span></span><br><span class="line">ax2.plot(bins[:-<span class="number">1</span>], density, linestyle=<span class="string">&#x27;--&#x27;</span>, color=<span class="string">&#x27;blue&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置轴标签</span></span><br><span class="line">ax.set_xlabel(<span class="string">&#x27;电影时长（分钟）&#x27;</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">&#x27;频率/组距&#x27;</span>)</span><br><span class="line">ax2.set_ylabel(<span class="string">&#x27;频率密度&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加图例</span></span><br><span class="line">ax2.legend([<span class="string">&#x27;频率密度&#x27;</span>], loc=<span class="string">&#x27;upper right&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示图形</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>分化子图：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">n, bins, patches = plt.hist(runtimes, bins=<span class="number">20</span>, color=<span class="string">&#x27;blue&#x27;</span>, alpha=<span class="number">0.5</span>, edgecolor=<span class="string">&#x27;black&#x27;</span>)</span><br><span class="line">bin_width = bins[<span class="number">1</span>] - bins[<span class="number">0</span>]</span><br><span class="line">freq_density = n / (<span class="built_in">len</span>(runtimes) * bin_width)</span><br><span class="line">fig, ax1 = plt.subplots()</span><br><span class="line">ax2 = ax1.twinx()</span><br><span class="line">ax2.plot(bins[:-<span class="number">1</span>], freq_density, linestyle=<span class="string">&#x27;--&#x27;</span>, color=<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">ax1.set_xlabel(<span class="string">&#x27;电影时长（分钟）&#x27;</span>)</span><br><span class="line">ax1.set_ylabel(<span class="string">&#x27;频率/组距&#x27;</span>)</span><br><span class="line">ax2.set_ylabel(<span class="string">&#x27;频率密度&#x27;</span>)</span><br><span class="line">ax2.legend([<span class="string">&#x27;频率密度&#x27;</span>], loc=<span class="string">&#x27;upper right&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="任务3-3（2分）"><a href="#任务3-3（2分）" class="headerlink" title="任务3-3（2分）"></a>任务3-3（2分）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">制作电影产地分布玫瑰图</span></span><br><span class="line"><span class="string">•统计不同产地的电影数量，电影数量低于前五的产地，全部归为others</span></span><br><span class="line"><span class="string">•成功制作玫瑰图（0.5分）</span></span><br><span class="line"><span class="string">•标题为电影产地分布（0.5分）</span></span><br><span class="line"><span class="string">•标签数值正确（0.5分）</span></span><br><span class="line"><span class="string">•标签为国家：百分比，百分比保留两位小数，例如：Canada: 2.53%（0.5分）</span></span><br><span class="line"><span class="string">Canada: 2.53%，此数据为虚构的，真实数值需要自行计算</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">film_production = data[<span class="string">&#x27;production_countries&#x27;</span>].<span class="built_in">str</span>.split(<span class="string">&#x27;|&#x27;</span>).explode().value_counts()</span><br><span class="line">film_production.sort_values(ascending=<span class="literal">False</span>,inplace=<span class="literal">True</span>)</span><br><span class="line">top_countries = film_production.head(<span class="number">5</span>).index</span><br><span class="line">country_counts_others = film_production[~film_production.index.isin(top_countries)]</span><br><span class="line">country_counts_others = pd.Series(country_counts_others.<span class="built_in">sum</span>(), index=[<span class="string">&#x27;others&#x27;</span>])</span><br><span class="line">country_counts = film_production.head(<span class="number">5</span>).append(country_counts_others)</span><br><span class="line">country_counts</span><br><span class="line"><span class="comment"># 计算百分比</span></span><br><span class="line">total_count = country_counts.<span class="built_in">sum</span>()</span><br><span class="line">percentages = country_counts / total_count * <span class="number">100</span></span><br><span class="line">percentages</span><br><span class="line"><span class="comment"># 绘制玫瑰图</span></span><br><span class="line">fig, ax = plt.subplots()</span><br><span class="line">ax.set_title(<span class="string">&#x27;电影产地分布&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置突出显示的状态</span></span><br><span class="line">explode = [<span class="number">0.1</span>] * <span class="built_in">len</span>(country_counts)  <span class="comment"># 将每个占比突出显示，可以调整突出的程度</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置颜色和角度</span></span><br><span class="line">colors = plt.cm.Set3(<span class="built_in">range</span>(<span class="built_in">len</span>(country_counts)))</span><br><span class="line">angles = [i / <span class="built_in">float</span>(<span class="built_in">len</span>(country_counts)) * <span class="number">2</span> * <span class="number">3.14159</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(country_counts))]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制玫瑰图</span></span><br><span class="line">ax.pie(percentages, labels=[<span class="string">f&quot;<span class="subst">&#123;country&#125;</span>: <span class="subst">&#123;percentage:<span class="number">.2</span>f&#125;</span>%&quot;</span> <span class="keyword">for</span> country, percentage <span class="keyword">in</span> <span class="built_in">zip</span>(country_counts.index, percentages)],</span><br><span class="line">                      autopct=<span class="string">&#x27;%1.1f%%&#x27;</span>, startangle=<span class="number">90</span>, colors=colors, counterclock=<span class="literal">False</span>, explode=explode, wedgeprops=<span class="built_in">dict</span>(width=<span class="number">0.4</span>), textprops=&#123;<span class="string">&#x27;fontsize&#x27;</span>: <span class="number">10</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置图例的位置和外观</span></span><br><span class="line">ax.legend(loc=<span class="string">&#x27;center left&#x27;</span>, bbox_to_anchor=(<span class="number">1.5</span>, <span class="number">0.5</span>), title=<span class="string">&quot;产地&quot;</span>, title_fontsize=<span class="number">12</span>)</span><br><span class="line"></span><br><span class="line">plt.axis(<span class="string">&#x27;equal&#x27;</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>isin的反函数是<code>~</code> ，isin是一个非常好用的判断存在与否的函数，多用反正思维来做，比正向节省许多代码量</p><h4 id="任务3-4（2分）"><a href="#任务3-4（2分）" class="headerlink" title="任务3-4（2分）"></a>任务3-4（2分）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">统计票房均值Top10的导演，并以条形图展示</span></span><br><span class="line"><span class="string">•票房均值以整数表示，四舍五入</span></span><br><span class="line"><span class="string">•标题为票房排名Top10的导演（0.5分）</span></span><br><span class="line"><span class="string">•标签数值正确（0.5分）</span></span><br><span class="line"><span class="string">•标签位置放置右侧（0.5分）</span></span><br><span class="line"><span class="string">•纵坐标导演名字显示完全（0.5分）</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">data1 = data[[<span class="string">&#x27;director&#x27;</span>,<span class="string">&#x27;revenue&#x27;</span>]]</span><br><span class="line">data1[<span class="string">&#x27;director&#x27;</span>] = data1[<span class="string">&#x27;director&#x27;</span>].<span class="built_in">str</span>.split(<span class="string">&#x27;|&#x27;</span>)</span><br><span class="line">box_office = data1.explode(<span class="string">&#x27;director&#x27;</span>)</span><br><span class="line">director_top10 = box_office.groupby(<span class="string">&#x27;director&#x27;</span>).agg(&#123;<span class="string">&#x27;revenue&#x27;</span>: np.<span class="built_in">sum</span>&#125;).sort_values(by=<span class="string">&#x27;revenue&#x27;</span>,ascending=<span class="literal">False</span>).head(<span class="number">10</span>)</span><br><span class="line">x = director_top10.index</span><br><span class="line">y = director_top10.values.flatten()</span><br><span class="line"><span class="built_in">print</span>(x)</span><br><span class="line"><span class="built_in">print</span>(y)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x = director_top10.index</span></span><br><span class="line"><span class="string">y = director_top10.values.flatten()</span></span><br><span class="line"><span class="string">print(x)</span></span><br><span class="line"><span class="string">print(y)</span></span><br><span class="line"><span class="string">x = director_top10.index</span></span><br><span class="line"><span class="string">y = director_top10.values.flatten()</span></span><br><span class="line"><span class="string">print(x)</span></span><br><span class="line"><span class="string">print(y)</span></span><br><span class="line"><span class="string">Index([&#x27;Stan Lee&#x27;, &#x27;Steven Spielberg&#x27;, &#x27;James Cameron&#x27;, &#x27;Christopher Boyes&#x27;,</span></span><br><span class="line"><span class="string">       &#x27;Hans Zimmer&#x27;, &#x27;Peter Jackson&#x27;, &#x27;George Lucas&#x27;, &#x27;John Williams&#x27;,</span></span><br><span class="line"><span class="string">       &#x27;Kevin Kaska&#x27;, &#x27;John Lasseter&#x27;],</span></span><br><span class="line"><span class="string">      dtype=&#x27;object&#x27;, name=&#x27;director&#x27;)</span></span><br><span class="line"><span class="string">[28442552025 26807330936 25930141996 23086609676 23026826230 20078688142</span></span><br><span class="line"><span class="string"> 19652943043 18464690132 18343111015 17415920425]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">10</span>,<span class="number">6</span>),dpi=<span class="number">120</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;票房排名Top10的导演&#x27;</span>,loc=<span class="string">&#x27;left&#x27;</span>)</span><br><span class="line">plt.barh(x, y,color=<span class="string">&#x27;maroon&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">enumerate</span>(y):</span><br><span class="line">    plt.text(b, a, <span class="string">&#x27;%d&#x27;</span>%b, va=<span class="string">&#x27;center&#x27;</span>)</span><br><span class="line">plt.ticklabel_format(style=<span class="string">&#x27;plain&#x27;</span>,axis=<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line"><span class="comment"># 现在如何将x轴显示为正常数值类型，而不是科学计数法</span></span><br></pre></td></tr></table></figure><h4 id="任务3-5（2分）"><a href="#任务3-5（2分）" class="headerlink" title="任务3-5（2分）"></a>任务3-5（2分）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">分析原创电影与改编电影在收益、票房、预算方面的表现，以旋风图展示：</span></span><br><span class="line"><span class="string">•成功制作旋风图（0.5分）</span></span><br><span class="line"><span class="string">•旋风图标签数值正确，以万为单位，取整数（四舍五入）（0.5分）</span></span><br><span class="line"><span class="string">•标题为原创电影与改编电影对比图（万）（0.5分）</span></span><br><span class="line"><span class="string">•添加图例（0.5分）</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">缺少预算数据以后再做</span><br></pre></td></tr></table></figure><h4 id="任务3-6（2分）"><a href="#任务3-6（2分）" class="headerlink" title="任务3-6（2分）"></a>任务3-6（2分）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">统计各种电影类型所占的比例，以饼图展示</span></span><br><span class="line"><span class="string">•设置other类，当电影类型所占比例小于%1时，全部归到other类中（0.5分）</span></span><br><span class="line"><span class="string">•所占比例小于或等于%2时，对应的饼状图往外突出一截（0.5分）</span></span><br><span class="line"><span class="string">•数值正确，百分比保留一位小数（0.5分）</span></span><br><span class="line"><span class="string">•标题为各种电影类型所占的比例（0.5分）</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">film_type = data[<span class="string">&#x27;genres&#x27;</span>].<span class="built_in">str</span>.split(<span class="string">&#x27;|&#x27;</span>).explode().value_counts()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算所占比例</span></span><br><span class="line">film_typetotal = film_type.<span class="built_in">sum</span>()</span><br><span class="line">percentage = film_type / film_typetotal * <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 划分other类</span></span><br><span class="line">percentage[<span class="string">&#x27;other&#x27;</span>] = percentage[percentage &lt; <span class="number">1</span>].<span class="built_in">sum</span>()</span><br><span class="line">percentage = percentage[percentage &gt;= <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取index和values 开始画图</span></span><br><span class="line">x = percentage.index</span><br><span class="line">y = percentage.values</span><br><span class="line"><span class="built_in">print</span>(x)</span><br><span class="line"><span class="built_in">print</span>(y)</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">8</span>, <span class="number">8</span>))</span><br><span class="line"><span class="comment"># 判断比例是否小于等于2%并设置对应的 explode 参数</span></span><br><span class="line">explode = [<span class="number">0.1</span> <span class="keyword">if</span> percentage2 &lt;= <span class="number">2</span> <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">for</span> percentage2 <span class="keyword">in</span> percentage]</span><br><span class="line">plt.pie(y, labels=x,explode=explode, autopct=<span class="string">&#x27;%.1f%%&#x27;</span>,</span><br><span class="line">        startangle=<span class="number">90</span>, counterclock=<span class="literal">False</span>, wedgeprops=&#123;<span class="string">&#x27;linewidth&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;edgecolor&#x27;</span>: <span class="string">&#x27;white&#x27;</span>&#125;)</span><br><span class="line">plt.title(<span class="string">&#x27;各种电影类型所占的比例&#x27;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h4 id="任务3-7（2分）"><a href="#任务3-7（2分）" class="headerlink" title="任务3-7（2分）"></a>任务3-7（2分）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">任务3-7（2分）</span></span><br><span class="line"><span class="string">统计电影风格（类型）Top5随时间（1980年至今）的变化趋势，以折线图展示</span></span><br><span class="line"><span class="string">•折线图设置为顺滑模式（0.5分）</span></span><br><span class="line"><span class="string">•标题和图例不能重叠（0.5分）</span></span><br><span class="line"><span class="string">•数据起点和纵坐标没有间隙（0.5分）</span></span><br><span class="line"><span class="string">•为最大值做标记（0.5分）</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">data2 = data</span><br><span class="line">data2[<span class="string">&#x27;genres&#x27;</span>] = data2[<span class="string">&#x27;genres&#x27;</span>].<span class="built_in">str</span>.split(<span class="string">&#x27;|&#x27;</span>)</span><br><span class="line">grouped = data2.explode(<span class="string">&#x27;genres&#x27;</span>).groupby([<span class="string">&#x27;year&#x27;</span>,<span class="string">&#x27;genres&#x27;</span>]).size().reset_index(name=<span class="string">&#x27;number&#x27;</span>)</span><br><span class="line">top5_genres = grouped.groupby(<span class="string">&#x27;genres&#x27;</span>).<span class="built_in">sum</span>().nlargest(<span class="number">5</span>,<span class="string">&#x27;number&#x27;</span>).index</span><br><span class="line">top5_data = grouped[grouped[<span class="string">&#x27;genres&#x27;</span>].isin(top5_genres)]</span><br><span class="line"><span class="comment"># 绘制折线图</span></span><br><span class="line"><span class="comment"># plt.figure(figsize=(10,6))</span></span><br><span class="line"><span class="comment"># 设置 x 轴刻度范围</span></span><br><span class="line">start_year = <span class="number">1980</span></span><br><span class="line">end_year = <span class="number">2022</span></span><br><span class="line">step = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">xticks = <span class="built_in">range</span>(start_year, end_year + <span class="number">1</span>)</span><br><span class="line">plt.gca().set_prop_cycle(<span class="string">&#x27;color&#x27;</span>, [<span class="string">&#x27;blue&#x27;</span>, <span class="string">&#x27;green&#x27;</span>, <span class="string">&#x27;red&#x27;</span>, <span class="string">&#x27;orange&#x27;</span>, <span class="string">&#x27;purple&#x27;</span>])  <span class="comment"># 设置顺滑模式颜色</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> genre, data <span class="keyword">in</span> top5_data.groupby(<span class="string">&#x27;genres&#x27;</span>):</span><br><span class="line">    plt.plot(data[<span class="string">&#x27;year&#x27;</span>], data[<span class="string">&#x27;number&#x27;</span>],label=genre)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 x 轴刻度</span></span><br><span class="line"><span class="comment"># start_year = 1980</span></span><br><span class="line"><span class="comment"># end_year = 2016</span></span><br><span class="line"><span class="comment"># step = 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># years = np.arange(start_year, end_year + 1, step)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制图形的代码</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 x 轴刻度</span></span><br><span class="line"><span class="comment"># 每隔两年显示一个刻度</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 调整图形大小</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 其他绘图设置和标签等</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># plt.legend()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">import pandas as pd</span></span><br><span class="line"><span class="string">import matplotlib.pyplot as plt</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 假设数据存储在名为df的DataFrame中，包含&#x27;年份&#x27;和&#x27;电影风格&#x27;两列</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 拆分电影风格列，并根据年份和电影风格对数据进行分组和聚合，统计数量</span></span><br><span class="line"><span class="string">df[&#x27;电影风格&#x27;] = df[&#x27;电影风格&#x27;].str.split(&#x27;|&#x27;)  # 拆分电影风格列</span></span><br><span class="line"><span class="string">grouped = df.explode(&#x27;电影风格&#x27;).groupby([&#x27;年份&#x27;, &#x27;电影风格&#x27;]).size().reset_index(name=&#x27;数量&#x27;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 获取数量前五的电影风格</span></span><br><span class="line"><span class="string">top5_genres = grouped.groupby(&#x27;电影风格&#x27;).sum().nlargest(5, &#x27;数量&#x27;).index</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 筛选出数量前五的电影风格数据</span></span><br><span class="line"><span class="string">top5_data = grouped[grouped[&#x27;电影风格&#x27;].isin(top5_genres)]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 绘制折线图</span></span><br><span class="line"><span class="string">plt.figure(figsize=(10, 6))</span></span><br><span class="line"><span class="string">plt.gca().set_prop_cycle(&#x27;color&#x27;, [&#x27;blue&#x27;, &#x27;green&#x27;, &#x27;red&#x27;, &#x27;orange&#x27;, &#x27;purple&#x27;])  # 设置顺滑模式颜色</span></span><br><span class="line"><span class="string">for genre, data in top5_data.groupby(&#x27;电影风格&#x27;):</span></span><br><span class="line"><span class="string">    plt.plot(data[&#x27;年份&#x27;], data[&#x27;数量&#x27;], marker=&#x27;o&#x27;, label=genre)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 添加标题、坐标轴标签和图例</span></span><br><span class="line"><span class="string">plt.title(&#x27;Top 5 Movie Genres Over Time&#x27;)</span></span><br><span class="line"><span class="string">plt.xlabel(&#x27;Year&#x27;)</span></span><br><span class="line"><span class="string">plt.ylabel(&#x27;Count&#x27;)</span></span><br><span class="line"><span class="string">plt.legend()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 显示图形</span></span><br><span class="line"><span class="string">plt.show()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><h4 id="任务3-8（2分）"><a href="#任务3-8（2分）" class="headerlink" title="任务3-8（2分）"></a>任务3-8（2分）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">统计不同风格（类型）电影的收益能力，以条形图和折线图混合展示</span></span><br><span class="line"><span class="string">•条形图为不同电影类型的收益总和，以千亿为单位，保留两位小数（0.5分）</span></span><br><span class="line"><span class="string">•折线图为不同电影类型的收益率，收益率=收益/预算（0.5分）</span></span><br><span class="line"><span class="string">•条形图标签数值正确（0.5分）</span></span><br><span class="line"><span class="string">•折线图不显示标签数值（0.5分）</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="任务3-9（4分）"><a href="#任务3-9（4分）" class="headerlink" title="任务3-9（4分）"></a>任务3-9（4分）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">统计电影类型Top5，以条形图展示</span></span><br><span class="line"><span class="string">•条形图颜色依次为#BCEE68, #EBBDBF, #D6A5DD, #A020F0, #76CBE8 （0.5分）</span></span><br><span class="line"><span class="string">•条形图右端添加象形图片，symbols已提前给出，象形图框线为灰色grey （2分）</span></span><br><span class="line"><span class="string">•标签数值正确（0.5分）</span></span><br><span class="line"><span class="string">•标签放置条形图右侧，显示完全，不能被遮挡（1分）</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">data2 = pd.read_csv(<span class="string">&#x27;movie2.csv&#x27;</span>)</span><br><span class="line"></span><br><span class="line">data2[<span class="string">&#x27;genres&#x27;</span>] = data2[<span class="string">&#x27;genres&#x27;</span>].<span class="built_in">str</span>.split(<span class="string">&#x27;|&#x27;</span>)</span><br><span class="line">top5_genres = data2.explode(<span class="string">&#x27;genres&#x27;</span>).groupby(<span class="string">&#x27;genres&#x27;</span>).size().reset_index(name=<span class="string">&#x27;number&#x27;</span>)</span><br><span class="line"></span><br><span class="line">top5_res = top5_genres.nlargest(<span class="number">5</span>,columns=<span class="string">&#x27;number&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">genresnumber</span></span><br><span class="line"><span class="string">6Drama2297</span></span><br><span class="line"><span class="string">3Comedy1722</span></span><br><span class="line"><span class="string">17Thriller1274</span></span><br><span class="line"><span class="string">0Action1154</span></span><br><span class="line"><span class="string">14Romance894</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">genres = top5_res[<span class="string">&#x27;genres&#x27;</span>]</span><br><span class="line">number = top5_res[<span class="string">&#x27;number&#x27;</span>]</span><br><span class="line"></span><br><span class="line">colors = [<span class="string">&#x27;#BCEE68&#x27;</span>, <span class="string">&#x27;#EBBDBF&#x27;</span>, <span class="string">&#x27;#D6A5DD&#x27;</span>, <span class="string">&#x27;#A020F0&#x27;</span>, <span class="string">&#x27;#76CBE8&#x27;</span>]</span><br><span class="line"></span><br><span class="line">fig, ax = plt.subplots()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制条形图</span></span><br><span class="line">ax.barh(genres, number, color=colors, edgecolor=<span class="string">&#x27;grey&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加Unicode字符作为象形图片</span></span><br><span class="line">symbols = [<span class="string">&#x27;⚔️&#x27;</span>, <span class="string">&#x27;🌍&#x27;</span>, <span class="string">&#x27;🧙‍♂️&#x27;</span>, <span class="string">&#x27;🚀&#x27;</span>, <span class="string">&#x27;🐰&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> a,b <span class="keyword">in</span> <span class="built_in">zip</span>(genres,number):</span><br><span class="line">    ax.text(b, a, symbols[i], va=<span class="string">&#x27;center&#x27;</span>, ha=<span class="string">&#x27;left&#x27;</span>, fontsize=<span class="number">12</span>)</span><br><span class="line">ax.set_xlabel(<span class="string">&#x27;数量&#x27;</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">&#x27;电影类型&#x27;</span>)</span><br><span class="line">ax.set_title(<span class="string">&#x27;电影类型Top5&#x27;</span>)</span><br><span class="line">ax.spines[<span class="string">&#x27;right&#x27;</span>].set_visible(<span class="literal">False</span>)</span><br><span class="line">ax.spines[<span class="string">&#x27;top&#x27;</span>].set_visible(<span class="literal">False</span>)</span><br><span class="line">ax.yaxis.set_ticks_position(<span class="string">&#x27;left&#x27;</span>)</span><br><span class="line">ax.xaxis.set_ticks_position(<span class="string">&#x27;bottom&#x27;</span>)</span><br><span class="line"></span><br><span class="line">plt.tight_layout()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h1 id="模块C：机器学习"><a href="#模块C：机器学习" class="headerlink" title="模块C：机器学习"></a>模块C：机器学习</h1><blockquote><p>四天把机器学习的几种算法过了一遍，难点在特征工程，对于模型的选择只需要明白是回归，分类还是聚类就好了，另外就是对于特征值和目标值的提取需要注意，由于没有数据练，只能找b站的几个数据练了</p></blockquote><h2 id="特征工程"><a href="#特征工程" class="headerlink" title="特征工程"></a>特征工程</h2><h3 id="特征提取"><a href="#特征提取" class="headerlink" title="特征提取"></a>特征提取</h3><p>API</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sklearn.feature_extraction</span><br></pre></td></tr></table></figure><h4 id="1、字典特征提取"><a href="#1、字典特征提取" class="headerlink" title="1、字典特征提取"></a>1、字典特征提取</h4><p>需要注意的是调用转换器之后返回的是稀疏矩阵，这里sparse需要设置成false才不会返回sparse</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> feature_extraction <span class="keyword">as</span> fe</span><br><span class="line"></span><br><span class="line">data = [&#123;<span class="string">&#x27;city&#x27;</span>:<span class="string">&#x27;bj&#x27;</span>, <span class="string">&#x27;tem&#x27;</span>:<span class="number">100</span>&#125;,</span><br><span class="line">       &#123;<span class="string">&#x27;city&#x27;</span>:<span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;tem&#x27;</span>:<span class="number">300</span>&#125;,</span><br><span class="line">       &#123;<span class="string">&#x27;city&#x27;</span>:<span class="string">&#x27;sd&#x27;</span>, <span class="string">&#x27;tem&#x27;</span>:<span class="number">50</span>&#125;]</span><br><span class="line">transfer = fe.DictVectorizer(sparse=<span class="literal">False</span>)<span class="comment"># 需要设置成False</span></span><br><span class="line">data_new = transfer.fit_transform(data)</span><br><span class="line">data_new</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">array([[  1.,   0.,   0., 100.],</span></span><br><span class="line"><span class="string">       [  0.,   0.,   1., 300.],</span></span><br><span class="line"><span class="string">       [  0.,   1.,   0.,  50.]])</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><h4 id="2、文本特征提取"><a href="#2、文本特征提取" class="headerlink" title="2、文本特征提取"></a>2、文本特征提取</h4><ul><li><p>英文文本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> feature_extraction <span class="keyword">as</span> fe</span><br><span class="line"></span><br><span class="line"><span class="comment"># 文本特征提取</span></span><br><span class="line">data = [<span class="string">&quot;Lift is short, i like python&quot;</span>,</span><br><span class="line">       <span class="string">&quot;Lift is too long, i dislike sleep&quot;</span>]</span><br><span class="line">transfer = fe.text.CountVectorizer()</span><br><span class="line">data_new = transfer.fit_transform(data)</span><br><span class="line"><span class="built_in">print</span>(data_new.toarray())</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">[[0 1 1 1 0 1 1 0 0]</span></span><br><span class="line"><span class="string"> [1 1 1 0 1 0 0 1 1]]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>中文文本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 中文文本提取</span></span><br><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line">data = [<span class="string">&#x27;我爱北京天安门&#x27;</span>, <span class="string">&#x27;天安门上太阳升&#x27;</span>]</span><br><span class="line">data_new = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">    data_new.append(<span class="string">&quot; &quot;</span>.join(<span class="built_in">list</span>(jieba.cut(i))))</span><br><span class="line">data_new</span><br><span class="line">transfer = fe.text.CountVectorizer()</span><br><span class="line">data_final = transfer.fit_transform(data_new)</span><br><span class="line">data_final.toarray()</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">array([[1, 1, 0],</span></span><br><span class="line"><span class="string">       [0, 1, 1]], dtype=int64)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>3、TF-IDF</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TFidf文本提取</span></span><br><span class="line">fe.text.TfidfVectorizer().fit_transform(data_new).toarray()</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">array([[0.81480247, 0.57973867, 0.        ],</span></span><br><span class="line"><span class="string">       [0.        , 0.57973867, 0.81480247]])</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="特征降维"><a href="#特征降维" class="headerlink" title="特征降维"></a>特征降维</h3><p>降维是指在某些限定条件下，降低随机变量(特征)的个数，得到一组”不想关”主变量的过程大致就是我如果有三个特征，但是这三个特征之中有两个相关系数非常大，就选择这两者之一</p><p>==<strong>降维方式</strong>==</p><ul><li>特征选择</li><li>主成分分析（可以理解一种特征提取的方式）</li></ul><h4 id="1、特征选择"><a href="#1、特征选择" class="headerlink" title="1、特征选择"></a>1、特征选择</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Filter过滤式</span><br><span class="line">- 方差选择法：地方查特征过滤</span><br><span class="line">- 相关系数</span><br><span class="line">  - 衡量特征与特征之间的相关性</span><br><span class="line"></span><br><span class="line">Embeded嵌入式</span><br><span class="line">- 决策树</span><br><span class="line">- 正则化</span><br><span class="line">- 深度学习</span><br></pre></td></tr></table></figure><p>==<strong>过滤式</strong>==</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_selection <span class="keyword">import</span> VarianceThreshold</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">variance_demo</span>():</span><br><span class="line">    data = pd.read_csv(<span class="string">r&quot;E:\Code\Pywork\Machine\data\factor_returns.csv&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;data:\n&quot;</span>,data)</span><br><span class="line">    data = data.iloc[:, <span class="number">1</span>:-<span class="number">2</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;data:\n&quot;</span>,data)</span><br><span class="line">    <span class="comment"># 这里的threshold是阈值大于它的就会被删去</span></span><br><span class="line">    transfer = VarianceThreshold(threshold=<span class="number">5</span>)</span><br><span class="line">    data_new = transfer.fit_transform(data)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;data_new:\n&quot;</span>, data_new, data_new.shape)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    variance_demo()</span><br></pre></td></tr></table></figure><p>==<strong>相关系数</strong>==</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_selection <span class="keyword">import</span> VarianceThreshold</span><br><span class="line"><span class="keyword">from</span> scipy.stats <span class="keyword">import</span> pearsonr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">variance_demo</span>():</span><br><span class="line">    data = pd.read_csv(<span class="string">r&quot;E:\Code\Pywork\Machine\data\factor_returns.csv&quot;</span>)</span><br><span class="line">    data = data.iloc[:, <span class="number">1</span>:-<span class="number">2</span>]</span><br><span class="line">    r = pearsonr(data[<span class="string">&#x27;pe_ratio&#x27;</span>],data[<span class="string">&#x27;pb_ratio&#x27;</span>])</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;相关系数:&quot;</span>,r)</span><br><span class="line"><span class="comment">#     相关系数: PearsonRResult(statistic=-0.004389322779936274, pvalue=0.8327205496564927)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    variance_demo()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2、主成分分析-PCA"><a href="#2、主成分分析-PCA" class="headerlink" title="2、主成分分析(PCA)"></a>2、主成分分析(PCA)</h4><p>高维转低维</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sklearn.decomposition.PCA</span><br></pre></td></tr></table></figure><blockquote><p>交叉表使用: table = pd.crosstab(data[‘user_id’],data[‘aisle’])</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;array([[0.81480247, 0.57973867, 0.        ],</span></span><br><span class="line"><span class="string">       [0.        , 0.57973867, 0.81480247]])&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> decomposition <span class="keyword">as</span> sd</span><br><span class="line">transfer = sd.PCA(n_components=<span class="number">0.95</span>)<span class="comment">#小数表示保留多少原始信息，整数表示获取到几维数据</span></span><br><span class="line">data_new = transfer.fit_transform(data2)</span><br><span class="line"><span class="built_in">print</span>(data_new)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">[[ 0.57615236]</span></span><br><span class="line"><span class="string"> [-0.57615236]]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><h3 id="调优"><a href="#调优" class="headerlink" title="调优"></a>调优</h3><h4 id="网格搜索和交叉验证"><a href="#网格搜索和交叉验证" class="headerlink" title="网格搜索和交叉验证"></a>网格搜索和交叉验证</h4><p>API</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> model_selection <span class="keyword">as</span> ms</span><br><span class="line">ms.GridSearchCV(model,param_grid=xxx,cv=xxx)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> datasets <span class="keyword">as</span> sd</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> model_selection <span class="keyword">as</span> ms</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> preprocessing <span class="keyword">as</span> sp</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> neighbors <span class="keyword">as</span> sn</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> metrics <span class="keyword">as</span> sm</span><br><span class="line"><span class="keyword">from</span> sklearn.decomposition <span class="keyword">import</span> PCA</span><br><span class="line"></span><br><span class="line">iris = sd.load_iris()</span><br><span class="line">transfer = PCA(n_components=<span class="number">0.95</span>)</span><br><span class="line">x = iris.data</span><br><span class="line">y = iris.target</span><br><span class="line">x = transfer.fit_transform(x)</span><br><span class="line">train_x, test_x, train_y, test_y = ms.train_test_split(x, y, shuffle=<span class="literal">True</span>, random_state=<span class="number">5</span>, train_size=<span class="number">0.75</span>)</span><br><span class="line">transfer = sp.StandardScaler()</span><br><span class="line">train_x = transfer.fit_transform(train_x)</span><br><span class="line">test_x = transfer.transform(test_x)</span><br><span class="line">model = sn.KNeighborsClassifier()</span><br><span class="line">ms.GridSearchCV(model,param_grid=&#123;<span class="string">&quot;n_neighbors&quot;</span>:&#123;<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">11</span>&#125;&#125;,cv=<span class="number">20</span>)</span><br><span class="line">model.fit(train_x, train_y)</span><br><span class="line">pred_y = model.predict(test_x)</span><br><span class="line">sm.f1_score(test_y, pred_y, average=<span class="string">&#x27;micro&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="数据预处理"><a href="#数据预处理" class="headerlink" title="数据预处理"></a>数据预处理</h3><h4 id="1、均值移除-标准差标准化"><a href="#1、均值移除-标准差标准化" class="headerlink" title="1、均值移除 (标准差标准化)"></a>1、<strong>均值移除 (标准差标准化)</strong></h4><blockquote><p>由于一个样本的不同特征值差异较大，不利于使用现有机器学习算法进行样本处理。<br>标准差标准化也叫零均值标准化或分数标准化，是当前使用最广泛的数据标准化方法。经过该方法处理的数据均值移除可以让样本矩阵中的每一列的平均值为0，标准差为1。<br>如何使样本矩阵中的每一列的平均值为0呢？</p></blockquote><script type="math/tex; mode=display">X* = （X-mean）/ std</script><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> sklearn.preprocessing <span class="keyword">as</span> sp</span><br><span class="line"></span><br><span class="line">arr01 = np.array([</span><br><span class="line">    [<span class="number">17</span>, <span class="number">100</span>, <span class="number">4000</span>],</span><br><span class="line">    [<span class="number">20</span>, <span class="number">80</span>, <span class="number">5000</span>],</span><br><span class="line">    [<span class="number">23</span>, <span class="number">75</span>, <span class="number">5500</span>]</span><br><span class="line">])</span><br><span class="line">arr01</span><br><span class="line"><span class="comment"># 调用类，生成实例化对象</span></span><br><span class="line">scaler = sp.StandardScaler()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 先调用fit, 再调用transform()</span></span><br><span class="line">scaler.fit(arr01).transform(arr01)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用fit_transform()</span></span><br><span class="line">std_samples = scaler.fit_transform(arr01)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">array([[-1.22474487,  1.38873015, -1.33630621],</span></span><br><span class="line"><span class="string">       [ 0.        , -0.46291005,  0.26726124],</span></span><br><span class="line"><span class="string">       [ 1.22474487, -0.9258201 ,  1.06904497]])</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 逆转</span></span><br><span class="line">scaler.inverse_transform(std_samples)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用方法</span></span><br><span class="line">sp.scale(arr01)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义算法</span></span><br><span class="line">array01_mean = arr01.mean(axis=<span class="number">0</span>)</span><br><span class="line">arr01_new = (arr01-array01_mean)/arr01.std(axis=<span class="number">0</span>)</span><br><span class="line">arr01_new.mean(axis=<span class="number">0</span>)</span><br><span class="line">arr01_new.std(axis=<span class="number">0</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">sklearn</span>.preprocessing.StandardScaler(*, copy=<span class="literal">True</span>, with_mean=<span class="literal">True</span>, with_std=<span class="literal">True</span>)</span><br><span class="line">参数：</span><br><span class="line">with_mean：<span class="built_in">bool</span>, default=<span class="literal">True</span>：如果为<span class="literal">True</span>，则在缩放之前将数据居中。这在操作稀疏矩阵时不起作用（并且会引发一个异常），因为将它们居中需要构建一个密集矩阵，在常见的用例中，密集矩阵可能太大而无法容纳在内存中。</span><br><span class="line">with_std：<span class="built_in">bool</span>, default=<span class="literal">True</span>：如果为<span class="literal">True</span>，则将数据缩放为单位方差（或等效的单位标准差）。</span><br><span class="line">属性：</span><br><span class="line">scale_ ：ndarray of shape (n_features,) <span class="keyword">or</span> <span class="literal">None</span>：数据的每个特征相对缩放，以实现零均值和单位方差。通常使用np.sqrt（var）计算。如果方差为零，我们无法实现单位方差，数据保持原样，给出缩放因子<span class="number">1</span>。当with_std=<span class="literal">False</span>时，scale_等于<span class="literal">None</span>。</span><br><span class="line">mean_ ：ndarray of shape (n_features,) <span class="keyword">or</span> <span class="literal">None</span> ：训练集中每个特征的平均值。当_mean=<span class="literal">False</span>时，等于<span class="literal">None</span>。</span><br><span class="line">var_ ：ndarray of shape (n_features,) <span class="keyword">or</span> <span class="literal">None</span>：训练集中每个特征的方差。用于计算scale_ 。当std=<span class="literal">False</span>时，等于<span class="literal">None</span>。</span><br><span class="line">示例：</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>data = [[<span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">1</span>], [<span class="number">1</span>, <span class="number">1</span>]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>scaler = StandardScaler()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(scaler.fit(data))</span><br><span class="line">StandardScaler()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(scaler.mean_)</span><br><span class="line">[<span class="number">0.5</span> <span class="number">0.5</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(scaler.transform(data))</span><br><span class="line">[[-<span class="number">1.</span> -<span class="number">1.</span>]</span><br><span class="line"> [-<span class="number">1.</span> -<span class="number">1.</span>]</span><br><span class="line"> [ <span class="number">1.</span>  <span class="number">1.</span>]</span><br><span class="line"> [ <span class="number">1.</span>  <span class="number">1.</span>]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(scaler.transform([[<span class="number">2</span>, <span class="number">2</span>]]))</span><br><span class="line">[[<span class="number">3.</span> <span class="number">3.</span>]]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2、范围缩放（离差标准化）"><a href="#2、范围缩放（离差标准化）" class="headerlink" title="2、范围缩放（离差标准化）"></a>2、<strong>范围缩放（离差标准化）</strong></h4><blockquote><p>另一种标准化方法是将特征缩放到给定的最小值和最大值之间，通常介于0和1之间，或者将每个特征的最大绝对值缩放到单位大小。这可以分别使用MinMaxScaler或MaxAbsScaler实现。使用这种缩放的动机包括对非常小的特征标准差的鲁棒性，以及在稀疏数据中保持零条目。</p><p>将样本矩阵中的每一列的最小值和最大值设定为相同的区间，统一各列特征值的范围。一般情况下会把特征值缩放至[0, 1]区间。</p><p>离差标准化是对原始数据的一种线性变换，结果是将原始数据的数值映射到[0,1]区间之间。</p><script type="math/tex; mode=display">X^*=(X-min)/(max-min)</script><p>其中max为样本数据的最大值，min 为样本数据的最小值，max-min为极差。离差标准化保留了原始数据值之间的联系，是消除量纲和数据取值范围影响最简单的方法。</p><p>离差标准化的特点：</p><p>数据的整体分布情况并不会随离差标准化而发生改变，原先取值较大的数据，在做完离差标准化后的值依旧较大。</p><p>当数据和最小值相等的时候，通过离差标准化可以发现数据变为0。</p><p>同时，还可以看出离差标准化的缺点：若数据集中某个数值很大，则离差标准化的值就会接近于0，并且相互之间差别不大。若将来遇到超过目前属性[min,max]取值范围的时候，会引起系统出错，这时便需要重新确定min和max。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">scaler = sp.MinMaxScaler()</span><br><span class="line"><span class="comment"># 调用fit_transform</span></span><br><span class="line">scaler.fit_transform(arr01)</span><br><span class="line"><span class="comment"># 手写</span></span><br><span class="line">max_ = arr01.<span class="built_in">max</span>(axis=<span class="number">0</span>)</span><br><span class="line">min_ = arr01.<span class="built_in">min</span>(axis=<span class="number">0</span>)</span><br><span class="line">(arr01 - min_) / (max_ - min_)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">array([[0.        , 1.        , 0.        ],</span></span><br><span class="line"><span class="string">       [0.5       , 0.2       , 0.66666667],</span></span><br><span class="line"><span class="string">       [1.        , 0.        , 1.        ]])</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><h4 id="3、异常值缩放数据"><a href="#3、异常值缩放数据" class="headerlink" title="3、异常值缩放数据"></a>3、<strong>异常值缩放数据</strong></h4><blockquote><p>如果数据中包含了许多异常值，那么使用数据的均值和方差进行缩放可能不会很好地工作。在这些情况下，您可以使用RobustScaler作为替代品。它对数据的中心和范围使用了更可靠的估计。</p><p>使用对异常值具有鲁棒性的统计数据来缩放特征。</p><p>此缩放器删除中值，并根据分位数范围（默认为IQR：四分位数范围）缩放数据。IQR是第一个四分位数（第25分位数）和第三个四分位（第75分位数）之间的范围。通过计算训练集中样本的相关统计信息，对每个特征进行居中和缩放。然后存储中值和四分位间距，以便使用转换方法用于后续数据。</p><p>数据集的标准化是许多机器学习估计器的共同要求。通常，这是通过去除平均值并缩放到单位方差来实现的。然而，异常值通常会以负面方式影响样本均值/方差。在这种情况下，中值和四分位数范围通常会给出更好的结果。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">scaler = sp.RobustScaler()</span><br><span class="line">scaler.fit_transform(arr01)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">array([[-1.        ,  1.6       , -1.33333333],</span></span><br><span class="line"><span class="string">       [ 0.        ,  0.        ,  0.        ],</span></span><br><span class="line"><span class="string">       [ 1.        , -0.4       ,  0.66666667]])</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><h4 id="4、归一化"><a href="#4、归一化" class="headerlink" title="4、归一化"></a>4、<strong>归一化</strong></h4><blockquote><p>归一化/标准化可以去除数据单位对计算带来的影响，也就是所谓的去量纲行为，归一化/标准化实质是一种线性变换，线性变换有很多良好的性质，这些性质决定了对数据改变后不会造成“失效”，反而能提高数据的表现，这些性质是归一化/标准化的前提。</p><p>归一化/标准化的去量纲作用能够带来以下两个好处： </p><p>1）提升模型的精度。一些分类器需要计算样本之间的距离（如欧氏距离），例如KNN。如果一个特征值域范围非常大，那么距离计算就主要取决于这个特征，从而与实际情况相悖（比如这时实际情况是值域范围小的特征更重要）。 </p><p>2）提高收敛速度。对于线性模型来说，数据归一化/标准化后，最优解的寻优过程明显会变得平缓，更容易正确的收敛到最优解。</p><p>有些情况每个样本的每个特征值具体的值并不重要，但是每个样本特征值的占比更加重要。</p><div class="table-container"><table><thead><tr><th></th><th>动作</th><th>爱情</th><th>科幻</th></tr></thead><tbody><tr><td>小明</td><td>20</td><td>10</td><td>5</td></tr><tr><td>小王</td><td>4</td><td>2</td><td>1</td></tr><tr><td>小李</td><td>15</td><td>11</td><td>13</td></tr></tbody></table></div><p>所以归一化即是用每个样本的每个特征值除以该样本各个特征值绝对值的总和。变换后的样本矩阵，每个样本的特征值绝对值之和为1。</p><p>将样本单独归一化为单位范数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">API：</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">sklearn</span>.preprocessing.Normalizer(norm=<span class="string">&#x27;l2&#x27;</span>, *, copy=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">参数：</span><br><span class="line"></span><br><span class="line">norm：&#123;‘l1’, ‘l2’, ‘<span class="built_in">max</span>’&#125;, default=’l2’：用于标准化每个非零样本的范数。如果使用norm=<span class="string">&#x27;max&#x27;</span>，则值将按绝对值的最大值重新缩放。</span><br><span class="line"></span><br><span class="line">这里： l1 是曼哈顿距离l2 是欧几里得距离</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">copy：<span class="built_in">bool</span>, default=<span class="literal">True</span>：设置为<span class="literal">False</span>以执行在位行规范化并避免复制（如果输入已经是numpy数组或scipy.sparse CSR矩阵）。</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">scaler = sp.Normalizer(norm=<span class="string">&#x27;l2&#x27;</span>)</span><br><span class="line">scaler.fit_transform(arr01)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">array([[0.00424863, 0.02499197, 0.99967862],</span></span><br><span class="line"><span class="string">       [0.00399946, 0.01599782, 0.99986403],</span></span><br><span class="line"><span class="string">       [0.00418139, 0.01363498, 0.9998983 ]])</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">scaler1 = sp.Normalizer(norm=<span class="string">&#x27;l1&#x27;</span>)</span><br><span class="line">scaler1.fit_transform(arr01)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">array([[0.00412922, 0.02428953, 0.97158125],</span></span><br><span class="line"><span class="string">       [0.00392157, 0.01568627, 0.98039216],</span></span><br><span class="line"><span class="string">       [0.00410861, 0.01339764, 0.98249375]])</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><h4 id="5、二值化"><a href="#5、二值化" class="headerlink" title="5、二值化"></a>5、二值化</h4><blockquote><p>有些业务并不需要分析矩阵的详细完整数据（比如图像边缘识别只需要分析出图像边缘即可），可以根据一个事先给定的阈值，用0和1表示特征值不高于或高于阈值。二值化后的数组中每个元素非0即1，达到简化数学模型的目的。大于阈值的值映射到1，而小于或等于阈值的值则映射到0。默认阈值为0时，只有正值映射到1。</p><p>二值化是对文本计数数据的一种常见操作，分析人员可以决定只考虑特征的存在或不存在，而不是量化的出现次数。它还可以用作考虑布尔随机变量的估计器的预处理步骤（例如，在贝叶斯设置中使用伯努利分布建模）。</p><p>API：</p><p>class sklearn.preprocessing.Binarizer(*, threshold=0.0, copy=True)</p><p>参数：</p><p><code>threshold：float</code>, default=0.0：低于或等于此的特征值由0替换，高于此值由1替换。对于稀疏矩阵上的操作，阈值不能小于0。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">scaler = sp.Binarizer(threshold=<span class="number">80</span>)</span><br><span class="line">scaler.fit_transform(arr01)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">array([[0, 1, 1],</span></span><br><span class="line"><span class="string">       [0, 0, 1],</span></span><br><span class="line"><span class="string">       [0, 0, 1]])</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><h4 id="6、独热编码（onehot）"><a href="#6、独热编码（onehot）" class="headerlink" title="6、独热编码（onehot）"></a>6、独热编码（<code>onehot</code>）</h4><blockquote><p>将分类特征编码为一个热点数字数组。为样本特征的每个值建立一个由一个1和若干个0组成的序列，用该序列对所有的特征值进行编码。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">两个数三个数四个数</span><br><span class="line"><span class="number">1</span><span class="number">3</span><span class="number">2</span></span><br><span class="line"><span class="number">7</span><span class="number">5</span><span class="number">4</span></span><br><span class="line"><span class="number">1</span><span class="number">8</span><span class="number">6</span></span><br><span class="line"><span class="number">7</span><span class="number">3</span><span class="number">9</span></span><br><span class="line">为每一个数字进行独热编码：</span><br><span class="line"><span class="number">1</span>-&gt;<span class="number">10</span>    <span class="number">3</span>-&gt;<span class="number">100</span>  <span class="number">2</span>-&gt;<span class="number">1000</span></span><br><span class="line"><span class="number">7</span>-&gt;01    <span class="number">5</span>-&gt;<span class="number">0</span>10   <span class="number">4</span>-&gt;<span class="number">0</span>100</span><br><span class="line"><span class="number">8</span>-&gt;001   <span class="number">6</span>-&gt;<span class="number">00</span>10  <span class="number">9</span>-&gt;0001</span><br><span class="line">编码完毕后得到最终经过独热编码后的样本矩阵：</span><br><span class="line"><span class="number">101001000</span></span><br><span class="line"><span class="number">0</span>10100100</span><br><span class="line"><span class="number">100010010</span></span><br><span class="line">011000001</span><br><span class="line">API：</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">sklearn</span>.preprocessing.OneHotEncoder(*, categories=<span class="string">&#x27;auto&#x27;</span>, drop=<span class="literal">None</span>, sparse=<span class="literal">True</span>, dtype=&lt;<span class="keyword">class</span> <span class="string">&#x27;numpy.float64&#x27;</span>&gt;, handle_unknown=<span class="string">&#x27;error&#x27;</span>, min_frequency=<span class="literal">None</span>, max_categories=<span class="literal">None</span>)</span><br><span class="line">参数:</span><br><span class="line">categories：‘auto’ <span class="keyword">or</span> a <span class="built_in">list</span> of array-like, default=’auto’：</span><br><span class="line">“auto”：根据培训数据自动确定类别。</span><br><span class="line"><span class="built_in">list</span>:categories[i]包含第i列中预期的类别。传递的类别不应在单个功能中混合字符串和数值，并且应在数值的情况下进行排序。</span><br><span class="line">sparse：<span class="built_in">bool</span>, default=<span class="literal">True</span>：如果设置为<span class="literal">True</span>，将返回稀疏矩阵，否则将返回数组。</span><br><span class="line">min_frequency：<span class="built_in">int</span> <span class="keyword">or</span> <span class="built_in">float</span>, default=<span class="literal">None</span>：指定最低频率，低于该频率类别将被视为不常见。</span><br><span class="line">max_categories：<span class="built_in">int</span>, default=<span class="literal">None</span>：在考虑不常用类别时，为每个输入要素指定输出要素数量的上限。如果存在不常见的类别，max_categories将包括表示不常见类别的类别以及常见类别。如果无，则输出特征的数量没有限制。</span><br><span class="line"></span><br></pre></td></tr></table></figure></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> OneHotEncoder</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>enc = OneHotEncoder(handle_unknown=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>X = [[<span class="string">&#x27;Male&#x27;</span>, <span class="number">1</span>], [<span class="string">&#x27;Female&#x27;</span>, <span class="number">3</span>], [<span class="string">&#x27;Female&#x27;</span>, <span class="number">2</span>]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>enc.fit(X)</span><br><span class="line">OneHotEncoder(handle_unknown=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>enc.categories_ <span class="comment"># 每个特征的类别</span></span><br><span class="line">[array([<span class="string">&#x27;Female&#x27;</span>, <span class="string">&#x27;Male&#x27;</span>], dtype=<span class="built_in">object</span>), array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], dtype=<span class="built_in">object</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>enc.transform([[<span class="string">&#x27;Female&#x27;</span>, <span class="number">1</span>], [<span class="string">&#x27;Male&#x27;</span>, <span class="number">4</span>]]).toarray() <span class="comment"># 将结果转为数组</span></span><br><span class="line">array([[<span class="number">1.</span>, <span class="number">0.</span>, <span class="number">1.</span>, <span class="number">0.</span>, <span class="number">0.</span>],</span><br><span class="line">       [<span class="number">0.</span>, <span class="number">1.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>]])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将编码反转为原来的形式</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>enc.inverse_transform([[<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>]]) </span><br><span class="line">array([[<span class="string">&#x27;Male&#x27;</span>, <span class="number">1</span>],</span><br><span class="line">       [<span class="literal">None</span>, <span class="number">2</span>]], dtype=<span class="built_in">object</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>enc.get_feature_names_out([<span class="string">&#x27;gender&#x27;</span>, <span class="string">&#x27;group&#x27;</span>])</span><br><span class="line">array([<span class="string">&#x27;gender_Female&#x27;</span>, <span class="string">&#x27;gender_Male&#x27;</span>, <span class="string">&#x27;group_1&#x27;</span>, <span class="string">&#x27;group_2&#x27;</span>, <span class="string">&#x27;group_3&#x27;</span>], ...)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="7、标签编码"><a href="#7、标签编码" class="headerlink" title="7、标签编码"></a>7、标签编码</h4><blockquote><p>对值介于0和n_classes-1之间的目标标签进行编码。根据字符串形式的特征值在特征序列中的位置，为其指定一个数字标签，用于提供给基于数值算法的学习模型。该转换器应用于编码目标值，即y，而不是输入X。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">API：</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">sklearn</span>.preprocessing.LabelEncoder()</span><br><span class="line">无参数</span><br><span class="line">属性：</span><br><span class="line">classes_：ndarray of shape (n_classes,)：保存每个类的标签。</span><br><span class="line"></span><br></pre></td></tr></table></figure></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> sklearn.preprocessing <span class="keyword">as</span> sp</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>raw_samples = np.array([</span><br><span class="line"><span class="meta">... </span>   <span class="string">&#x27;audi&#x27;</span>, <span class="string">&#x27;ford&#x27;</span>, <span class="string">&#x27;audi&#x27;</span>, <span class="string">&#x27;toyota&#x27;</span>,</span><br><span class="line"><span class="meta">... </span>   <span class="string">&#x27;ford&#x27;</span>, <span class="string">&#x27;bmw&#x27;</span>, <span class="string">&#x27;toyota&#x27;</span>, <span class="string">&#x27;ford&#x27;</span>,</span><br><span class="line"><span class="meta">... </span>   <span class="string">&#x27;audi&#x27;</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(raw_samples)</span><br><span class="line">lbe = sp.LabelEncoder()</span><br><span class="line">lbe_samples = lbe.fit_transform(raw_samples)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(lbe_samples)</span><br><span class="line">inv_samples = lbe.inverse_transform(lbe_samples)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(inv_samples)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="8、常用"><a href="#8、常用" class="headerlink" title="8、常用"></a>8、常用</h4><div class="table-container"><table><thead><tr><th>类名</th><th>方法名</th></tr></thead><tbody><tr><td>sklearn.preprocessing.Binarizer()</td><td>sklearn.preprocessing.binarize()</td></tr><tr><td>sklearn.preprocessing.LabelBinarizer()</td><td>sklearn.preprocessing.label_binarize()</td></tr><tr><td>sklearn.preprocessing.MaxAbsScaler()</td><td>sklearn.preprocessing.maxabs_scale()</td></tr><tr><td>sklearn.preprocessing.MinMaxScaler()</td><td>sklearn.preprocessing.minmax_scale()</td></tr><tr><td>sklearn.preprocessing.Normalizer()</td><td>sklearn.preprocessing.normalize()</td></tr><tr><td>sklearn.preprocessing.StandardScaler()</td><td>sklearn.preprocessing.scale()</td></tr><tr><td>sklearn.preprocessing.RobustScaler()</td><td>sklearn.preprocessing.robust_scale()</td></tr></tbody></table></div><h2 id="回归问题"><a href="#回归问题" class="headerlink" title="回归问题"></a>回归问题</h2><blockquote><p>回归问题是一种常见的监督机器学习任务，在很多领域均有广泛应用。其典型应用包括销量预测、库存预测、股票价格预测、天气预测等</p><p>大纲：</p><p>线性回归模型的目标函数（损失函数和正则函数）、线性回归模型的优化求解、回归任务的性能指标、线性回归模型的超参数调优以及使用sklearn实现线性回归模型的应用案例。</p></blockquote><h3 id="1、线性回归简介"><a href="#1、线性回归简介" class="headerlink" title="1、线性回归简介"></a>1、线性回归简介</h3><blockquote><p>回归分析：回归分析法指利用数据统计原理，对大量统计数据进行数学处理，并确定因变量y与某些自变量x的相关关系，建立一个相关性较好的回归方程（函数表达式），并加以外推，用于预测今后的因变量的变化分析方法。回归的目标是学习一个输入x到输出y的映射f，并根据该模型预测新的测试数据x对应的响应y=f(x)’公式：</p></blockquote><script type="math/tex; mode=display">f(x,w)=w^T+b</script><h3 id="2、一元线性回归"><a href="#2、一元线性回归" class="headerlink" title="2、一元线性回归"></a>2、一元线性回归</h3><p><img src="https://picco.eu.org//img/bizhi20230710153626.png" alt=""></p><p>可以看出来最后求的就是损失函数，获取最小值min    即距离线距离和最短</p><p>可以理解我每一段都需要获取最小值，</p><h5 id="损失函数"><a href="#损失函数" class="headerlink" title="损失函数"></a>损失函数</h5><blockquote><p>损失函数就是总样本误差关于模型参数的函数，该函数属于三维数学模型，即需要找到一组<code>w0</code>，<code>w1</code>使得loss取极小值。</p><p>核心：找到w0和w1的值，使得预测值和真实值之间的平均差异最小。</p><p>损失：机器学习模型关于单个样本的预测值与真实值的差，损失越小，模型越好；如果预测值与真实值相等，就是没有损失。</p><p>损失函数：用于计算损失的函数模型每一次预测的好坏用损失函数来度量。</p><p>常见的损失函数：</p><p>l 平均平方误差（Mean Squared Error （<code>MSE</code>））：也称为 <code>L2</code> Loss，是机器学习、深度学习回归任务中最常用的一种损失函数，对离群点敏感。</p><p>l 平均绝对误差（ Mean Absolute Error（MAE））：也称为<code>L1</code> Loss，使用绝对值，<code>L1</code>损失对离群点不敏感。</p><p>l 胡伯损失（Huber）：综合了<code>L2</code>损失和<code>L1</code>损失的优点。</p></blockquote><h5 id="线性回归模型的优化求解"><a href="#线性回归模型的优化求解" class="headerlink" title="线性回归模型的优化求解"></a>线性回归模型的优化求解</h5><blockquote><p>模型的目标函数确定后，我们就可以采用合适的优化方法寻找最佳的模型参数。在线性回归模型中，模型参数包括线性回归系数<code>w1</code>，和截距<code>w0</code>。当训练数据集不大时，最小二乘线性回归可采用解析求解法求解，解析求解法涉及到大量公式推导，此处暂不做讲解。除此以外还可以使用梯度下降法求解。</p></blockquote><h5 id="梯度下降（Gradient-Descent）"><a href="#梯度下降（Gradient-Descent）" class="headerlink" title="梯度下降（Gradient Descent）"></a>梯度下降（Gradient Descent）</h5><blockquote><p>梯度下降法是求解无约束优化问题最常用的方法之一，亦被称为最速下降法。最小二乘回归和岭回归均可采用梯度下降法求解，Lasso回归由于目标函数中有L1正则函数而不可导，因此不能采用梯度下降法求解。梯度下降法是一种基于搜索的最优化方法，在机器学习中，熟练的使用梯度法（下降法或上升法）求取目标函数的最优解是非常重要的。线性回归算法模型的本质就是最小化一个损失函数，然后求出损失函数的参数的数学解； 梯度下降法是在机器学习领域中最小化损失函数的最为常用的方法。</p></blockquote><p><img src="https://picco.eu.org//img/bizhi/20230710205448.png" alt=""></p><blockquote><p>假如你迷失在山上的浓雾之中，完全看不见下山的方向，你能感觉到的只有脚下的路面坡度。快速到达山脚的一个策略就是沿着最陡的方向下坡。这就是梯度下降的做法：通过测量参数向量θ相关的损失函数的局部梯度，并不断沿着降低梯度的方向调整，直到梯度将为0，达到最小值！ 每下降一步都去选择最陡峭的方向，然后踏出一步。因此没迭代一次需要考虑两个变量，一个是方向（朝哪边走），一个是步长（走多少）。方向就是向量θ的斜率，步长是一个超参数叫做学习率（learning_rate）。</p></blockquote><p>==<strong>学习速率（learning_rate）</strong>==</p><blockquote><p>学习率是一个超参数，学习率的取值会影响获得最优解的速度; 太小，算法需要经过大量迭代才能收敛，这将耗费很长时间；反过来学习率太大，可能会越过最小值直接到达另一边，甚至有可能比之前的起点还要高，这会导致算法发散，值越来越大，无法找到最优解。学习率是超参数需要手动调节，取值范围一般在[0, 1]之间。下图展示了不同学习率对梯度下降的影响。</p></blockquote><p><img src="https://picco.eu.org//img/bizhi/20230710205526.png" alt=""></p><h3 id="3、回归相关API"><a href="#3、回归相关API" class="headerlink" title="3、回归相关API"></a>3、回归相关<code>API</code></h3><blockquote><p><code>sklearn.linear_model</code>模块下提供了线性分类器（Linear classifiers）和经典线性回归（Classical linear regressors）两种问题的实现类。其中Linear classifiers中的类是用线性回归的思想解决分类问题的，其中包含了逻辑回归分类器（<code>LogisticRegression</code>），岭回归分类器（<code>RidgeClassifier</code>），交叉验证逻辑回归分类器（<code>RidgeClassifierCV</code>），线性感知器分类器（<code>Perceptron</code>），<code>SGD</code>训练的线性分类器（<code>SGDClassifier</code>）等多种分类器。Classical linear regressors模块中提供了线性回归（<code>LinearRegression</code>），岭回归（Ridge），交叉验证岭回归（<code>RidgeCV</code>），随机梯度下降回归（<code>SGDRegressor</code>）。除此以外还有带有变量选择的回归器（Regressors with variable selection）；贝叶斯回归（Bayesian regressors）；具有变量选择的多任务线性回归器（Multi-task linear regressors with variable selection）；离群稳健回归（<code>Outlier-robust regressors</code>）；回归的广义线性模型（Generalized linear models (<code>GLM</code>) for regression）；混合模型（Miscellaneous）等。</p></blockquote><p>==1.<strong><code>LinearRegression()</code></strong>==</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">普通最小二乘线性回归。线性回归拟合系数w=（w1，…，wp）的线性模型，以最小化数据集中观察到的目标与线性近似预测的目标之间的残差平方和。</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">sklearn.linear_model.LinearRegression(*, fit_intercept=<span class="literal">True</span>, normalize=<span class="literal">False</span>, copy_X=<span class="literal">True</span>, n_jobs=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>参数名称</th><th>描述</th></tr></thead><tbody><tr><td>fit_intercept</td><td>是否计算此模型的截距。如果设置为False，则不会在计算中使用截距（即，预计数据将居中）。</td></tr><tr><td>normalize</td><td>当fit_intercept设置为False时，将忽略此参数。如果为True，则回归前将通过减去平均值并除以l2范数对回归X进行归一化。如果您希望标准化，请在对normalize=False的估计器调用fit之前使用StandardScaler。</td></tr><tr><td>copy_X</td><td>如果为True，将复制X；否则，可能会被覆盖。</td></tr><tr><td>n_jobs</td><td>用于计算的作业数</td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th>属性</th><th>描述</th></tr></thead><tbody><tr><td>coef_</td><td>系数。形状为（n_features，）或（n_targets，n_features）的数组</td></tr><tr><td>rank_</td><td>矩阵的等级X</td></tr><tr><td>intercept_</td><td>截距</td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>fit(X, y)</td><td>拟合线性模型</td></tr><tr><td>get_params([deep])</td><td>获取此估计器的参数。</td></tr><tr><td>predict(X)</td><td>使用线性模型进行预测。</td></tr><tr><td>score(X, y)</td><td>返回预测的确定系数。</td></tr><tr><td>set_params()</td><td>设置此估计器的参数。</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">示例代码：</span><br><span class="line"><span class="keyword">import</span> sklearn.linear_model <span class="keyword">as</span> lm</span><br><span class="line"><span class="comment"># 创建模型</span></span><br><span class="line">model = lm.LinearRegression()</span><br><span class="line"><span class="comment"># 训练模型</span></span><br><span class="line"><span class="comment"># 输入为一个二维数组表示的样本矩阵</span></span><br><span class="line"><span class="comment"># 输出为每个样本最终的结果</span></span><br><span class="line">model.fit(输入, 输出) <span class="comment"># 通过梯度下降法计算模型参数</span></span><br><span class="line"><span class="comment"># 预测输出  </span></span><br><span class="line"><span class="comment"># 输入array是一个二维数组，每一行是一个样本，每一列是一个特征。</span></span><br><span class="line">result = model.predict(array)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>==2.<strong><code>SGDRegressor()</code></strong>==</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">通过SGD最小化正则化经验损失拟合的线性模型。SGD代表随机梯度下降：一次估计每个样本的损失梯度，并以递减的强度计划（即学习率）更新模型。正则化器是添加到损失函数的惩罚，其使用平方欧几里德范数L2或绝对范数L1或两者的组合（弹性网）将模型参数收缩到零向量。如果参数更新由于正则化器而与0.0值交叉，则更新将被截断为0.0，以允许学习稀疏模型并实现在线特征选择。此实现可以处理表示为特征浮点值密集numpy数组的数据。</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">sklearn</span>.linear_model.SGDRegressor(loss=<span class="string">&#x27;squared_error&#x27;</span>, *, penalty=<span class="string">&#x27;l2&#x27;</span>, alpha=<span class="number">0.0001</span>, l1_ratio=<span class="number">0.15</span>, fit_intercept=<span class="literal">True</span>, max_iter=<span class="number">1000</span>, tol=<span class="number">0.001</span>, shuffle=<span class="literal">True</span>, verbose=<span class="number">0</span>, epsilon=<span class="number">0.1</span>, random_state=<span class="literal">None</span>, learning_rate=<span class="string">&#x27;invscaling&#x27;</span>, eta0=<span class="number">0.01</span>, power_t=<span class="number">0.25</span>, early_stopping=<span class="literal">False</span>, validation_fraction=<span class="number">0.1</span>, n_iter_no_change=<span class="number">5</span>, warm_start=<span class="literal">False</span>, average=<span class="literal">False</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>loss</td><td>损失函数，str，默认值为：squared_error，可选：‘squared_error’,  ‘huber’, ‘epsilon_insensitive’, or ‘squared_epsilon_insensitive’</td></tr><tr><td>penalty</td><td>正则项，可选：{‘l2’,  ‘l1’, ‘elasticnet’}, 默认值为’l2’</td></tr><tr><td>alpha</td><td>正则强度，浮点型，默认值为：0.0001。值越大，正则化越强。</td></tr><tr><td>fit_intercept</td><td>是否计算截距，布尔型，默认值为：True。是否应估计截距。如果为False，则假定数据已居中。</td></tr><tr><td>learning_rate</td><td>学习率，字符串，默认值为：invscaling，不按比例缩放。</td></tr><tr><td>eta0</td><td>学习率的初始值，浮点型，  ‘constant’, ‘invscaling’ or ‘adaptive’初始学习率，默认为0.01</td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th>属性</th><th>说明</th></tr></thead><tbody><tr><td>coef_</td><td>指定要素的权重斜率。</td></tr><tr><td>intercept_</td><td>截距项。</td></tr><tr><td>n<em>iter</em></td><td>达到停止标准之前的实际迭代次数。</td></tr><tr><td>t_</td><td>训练期间执行的体重更新次数</td></tr><tr><td>n<em>features_in</em></td><td>装配过程中看到的特征数量。</td></tr><tr><td>feature<em>names_in</em></td><td>装配过程中看到的特征名称。仅当X具有全部字符串的要素名称时才定义。</td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>fit(X, y)</td><td>用随机梯度下降拟合线性模型。</td></tr><tr><td>predict(X)</td><td>使用模型预测</td></tr><tr><td>get_params(deep=True)</td><td>获取此估计器的参数。</td></tr><tr><td>sparsify()</td><td>将系数矩阵转换为稀疏格式。</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> SGDRegressor</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> sklearn.pipeline <span class="keyword">import</span> make_pipeline</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>n_samples, n_features = <span class="number">10</span>, <span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>rng = np.random.RandomState(<span class="number">0</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y = rng.randn(n_samples)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>X = rng.randn(n_samples, n_features)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># Always scale the input. The most convenient way is to use a pipeline.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>reg = make_pipeline(StandardScaler(),</span><br><span class="line"><span class="meta">... </span>                    SGDRegressor(max_iter=<span class="number">1000</span>, tol=<span class="number">1e-3</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>reg.fit(X, y)</span><br><span class="line">Pipeline(steps=[(<span class="string">&#x27;standardscaler&#x27;</span>, StandardScaler()),</span><br><span class="line">                (<span class="string">&#x27;sgdregressor&#x27;</span>, SGDRegressor())])</span><br></pre></td></tr></table></figure><h3 id="4、案例实战：加利福尼亚房屋价格回归分析"><a href="#4、案例实战：加利福尼亚房屋价格回归分析" class="headerlink" title="4、案例实战：加利福尼亚房屋价格回归分析"></a>4、案例实战：加利福尼亚房屋价格回归分析</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> datasets <span class="keyword">as</span> sd</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> model_selection <span class="keyword">as</span> sm</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> linear_model <span class="keyword">as</span> sl</span><br><span class="line"></span><br><span class="line">data = sd.fetch_california_housing()</span><br><span class="line">x = data[<span class="string">&#x27;data&#x27;</span>]</span><br><span class="line">y = data[<span class="string">&#x27;target&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">查看形状</span></span><br><span class="line"><span class="string">x.shape</span></span><br><span class="line"><span class="string">y.shape</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">数据介绍</span></span><br><span class="line"><span class="string">print(data[&#x27;DESCR&#x27;])</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 数据已经处理好了不需要进行特征工程</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据集划分：训练集和测试集</span></span><br><span class="line">train_x, test_x, train_y, test_y = sm.train_test_split(x, y, train_size=<span class="number">0.75</span>, test_size=<span class="number">0.25</span>, shuffle=<span class="literal">True</span>, random_state=<span class="number">145</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">这里:</span></span><br><span class="line"><span class="string">train_size + test_size = 1</span></span><br><span class="line"><span class="string">shuffle = True 混洗</span></span><br><span class="line"><span class="string">random_state = 145随机数种子</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择模型</span></span><br><span class="line">model = sl.LinearRegression()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 训练模型</span></span><br><span class="line">model.fit(train_x, train_y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 预测</span></span><br><span class="line">pred_y = model.predict(test_x)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">预测这里主要看的就是看预测值与测试值之间的区别</span></span><br><span class="line"><span class="string">预测值:</span></span><br><span class="line"><span class="string">array([0.0696445 , 0.61678432, 2.02419006, ..., 1.9095006 , 2.67847098,</span></span><br><span class="line"><span class="string">       2.07215543])</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">测试值:</span></span><br><span class="line"><span class="string">array([0.988, 1.572, 1.609, ..., 1.361, 2.727, 3.167])</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 模型评估</span></span><br><span class="line">sm.mean_squared_error(test_y, pred_y)<span class="comment">#0.5406765977332207</span></span><br></pre></td></tr></table></figure><p>从上面可以看出来随机数种子的选择和对测试集和训练集的划分对最后模型的评估有着很重要的作用</p><h3 id="5、回归模型评价指标"><a href="#5、回归模型评价指标" class="headerlink" title="5、回归模型评价指标"></a>5、回归模型评价指标</h3><p>sklearn度量模块实现了几个损失、分数和效用函数来度量回归性能。其中一些已被增强以处理多输出情况：mean_squared_error、mean_absolute_error，r2_score，explained_variance_score、mean_pinball_loss、d2_pinball_score和d2_absolute _error_score。</p><div class="table-container"><table><thead><tr><th>方法名称</th><th>最优值</th><th>sklearn函数</th></tr></thead><tbody><tr><td>平均绝对误差</td><td>0.0</td><td>metrics. mean_absolute_error(y_true, y_pred)</td></tr><tr><td>平均均方误差</td><td>0.0</td><td>metrics. mean_squared_error(y_true, y_pred)</td></tr><tr><td>均方对数误差</td><td>0.0</td><td>metrics.mean_squared_log_error(y_true, y_pred)</td></tr><tr><td>中位绝对误差</td><td>0.0</td><td>metrics. median_absolute_error(y_true, y_pred)</td></tr><tr><td>最大误差</td><td>0.0</td><td>metrics.max_error(y_true, y_pred)</td></tr><tr><td>可解释方差值</td><td>1.0</td><td>metrics. explained_variance_score(y_true,  y_pred)</td></tr><tr><td>R方值</td><td>1.0</td><td>metrics. r2_score(y_true, y_pred)</td></tr></tbody></table></div><p>示例：</p><p>线性回归模型训练完毕后，可以利用测试集评估训练结果误差。sklearn.metrics提供了计算模型误差的几个常用算法：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sklearn.metrics <span class="keyword">as</span> sm</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 平均绝对值误差：1/m∑|实际输出-预测输出|</span></span><br><span class="line"> sm.mean_absolute_error(test_y, pred_y)</span><br><span class="line"><span class="comment"># 平均平方误差：SQRT(1/mΣ(实际输出-预测输出)^2)</span></span><br><span class="line"> sm.mean_squared_error(test_y, pred_y)</span><br><span class="line"><span class="comment"># 中位绝对值误差：MEDIAN(|实际输出-预测输出|)</span></span><br><span class="line"> sm.median_absolute_error(test_y, pred_y)</span><br><span class="line"><span class="comment"># 解释方差回归评分：最好分数是 1.0，越低模型越不好</span></span><br><span class="line"> sm.explained_variance_score(test_y, y_pred)</span><br><span class="line"><span class="comment"># R2得分，(0,1]区间的分值,分数越高，误差越小。</span></span><br><span class="line"> sm.r2_score(test_y, pred_y)</span><br></pre></td></tr></table></figure><h3 id="6、过拟合和欠拟合"><a href="#6、过拟合和欠拟合" class="headerlink" title="6、过拟合和欠拟合"></a>6、过拟合和欠拟合</h3><p>欠拟合</p><p>过于简单的模型，无论对于训练数据还是测试数据都无法给出足够高的预测精度，这种现象叫做欠拟合。</p><p>过拟合</p><p>过于复杂的模型，对于训练数据可以得到较高的预测精度，但对于测试数据通常精度较低，这种现象叫做过拟合。</p><p>一个性能可以接受的学习模型应该对训练数据和测试数据都有接近的预测精度，而且精度不能太低。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">训练集R2  测试集R2</span><br><span class="line"> <span class="number">0.3</span>    <span class="number">0.4</span>    欠拟合：过于简单，无法反映数据的规则</span><br><span class="line"> <span class="number">0.9</span>    <span class="number">0.2</span>    过拟合：过于复杂，太特殊，缺乏一般性</span><br><span class="line"> <span class="number">0.7</span>    <span class="number">0.6</span>    可接受：复杂度适中，既反映数据的规则，同时又不失一般性</span><br></pre></td></tr></table></figure><h3 id="7、多元线性回归"><a href="#7、多元线性回归" class="headerlink" title="7、多元线性回归"></a>7、多元线性回归</h3><p>在回归分析中，如果有两个或两个以上的自变量，就称为多元回归。</p><p>例如房屋价格预测，其中房屋价格会受到房屋面积，卧室数量，楼层，房屋年限等多种因素的影响，每个自变量对价格（因变量）的影响程度不一样</p><p><img src="https://picco.eu.org//img/bizhi/20230710205809.png" alt=""></p><h3 id="8、多项式回归"><a href="#8、多项式回归" class="headerlink" title="8、多项式回归"></a>8、多项式回归</h3><blockquote><p>如果数据比直线更复杂怎么办？可以使用线性模型来拟合非线性数据。一个简单的方法就是将每个特征的幂次方添加为一个新特征，然后在此扩展特征集上训练一个线性模型。这种技术称为多项式回归。</p></blockquote><h3 id="9、正则化线性模型"><a href="#9、正则化线性模型" class="headerlink" title="9、正则化线性模型"></a>9、正则化线性模型</h3><blockquote><p>减少过拟合的一个好方法是对模型进行正则化（即约束模型）：它拥有的自由度越少，则过拟合数据的难度就越大。</p><p>多项式模型正则化的一种简单方法是减少多项式的次数。</p><p>线性模型正则化通常是通过约束模型的权重来实现的。</p><p>岭回归、Lasso回归和弹性网络，它们实现了三种限制权重的方法</p></blockquote><p>我的理解就是数据种有脏数据，有异常值即过大或过小，而正则化就是排除这些异常</p><p>各个范式的理解：</p><p>​    <a href="https://blog.csdn.net/vincent_duan/article/details/117305250">https://blog.csdn.net/vincent_duan/article/details/117305250</a></p><ul><li><p>==<strong>岭回归</strong>==</p><p>岭回归也称为Tikhonov正则化，是线性回归的正则化版本。普通线性回归模型使用基于梯度下降的最小二乘法，在最小化损失函数的前提下，寻找最优模型参数，于此过程中，包括<strong>少数异常样本</strong>在内的全部训练数据都会对最终模型参数造成程度相等的影响，异常值对模型所带来影响<strong>无法在训练过程中</strong>被识别出来。为此，岭回归在模型迭代过程所依据的损失函数中<strong>增加了正则项</strong>，以限制模型参数对异常样本的匹配程度，进而提高模型面对多数正常样本的拟合精度。</p><p>​    线性回归+L2正则项：Ridge 回归（岭回归）</p><ol><li>超参数γ控制要对模型进行正则化的程度。如果γ=0，则岭回归仅是线性回归。如果γ非常大，则所有权重最终都非常接近于零，结果是一条经过数据均值的平线。</li><li>在执行岭回归之前缩放数据（例如使用StandardScaler）很重要，因为它对输入特征的缩放敏感</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 岭回归API：</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">sklearn</span>.linear_model.Ridge(alpha=<span class="number">1.0</span>, *, fit_intercept=<span class="literal">True</span>, copy_X=<span class="literal">True</span>, max_iter=<span class="literal">None</span>, tol=<span class="number">0.0001</span>, solver=<span class="string">&#x27;auto&#x27;</span>, positive=<span class="literal">False</span>, random_state=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure></li><li><p>==<strong>Lasso 回归</strong>==</p><p>线性回归+L1正则项：Lasso 回归（套索回归）</p><p>与岭回归一样，它也是向成本函数添加一个正则项，但是它增加的是权重向量的L1范数，而不是L2范数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rom sklearn <span class="keyword">import</span> linear_model</span><br><span class="line"></span><br><span class="line">linear_model.Lasso(alpha=<span class="number">1.0</span>, *, fit_intercept=<span class="literal">True</span>, normalize=<span class="literal">False</span>, precompute=<span class="literal">False</span>, copy_X=<span class="literal">True</span>, max_iter=<span class="number">1000</span>, tol=<span class="number">0.0001</span>, warm_start=<span class="literal">False</span>, positive=<span class="literal">False</span>, random_state=<span class="literal">None</span>, selection=<span class="string">&#x27;cyclic&#x27;</span>)</span><br></pre></td></tr></table></figure></li><li><p>==<strong>弹性网络</strong>==</p><p>弹性网络是介于岭回归和Lasso回归之间的中间地带。正则项是岭和Lasso正则项的简单混合，可以控制混合比ρ。</p><ul><li><p>当ρ=0时，弹性网络等效于岭回归；</p></li><li><p>当ρ=1时，弹性网络等于Lasso回归；</p></li></ul><blockquote><p>那么什么时候使用普通的线性回归岭、Lasso或弹性网络呢？通常，有正则化，哪怕很小，总比没有更可取一些，所以大部分情况下，应该避免使用纯线性回归。岭回归是个不错的默认选择，但是如果实际用到的特征只有少数几个，那就应该更倾向于Lasso回归或者弹性网络，因为它们会将无用特征的权重降为零。一般，弹性网络优于Lasso回归，因为当特征数量超过训练实例数量，又或者是几个特征强相关时，Lasso回归的表现可能非常不稳定。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> ElasticNet</span><br><span class="line"></span><br><span class="line">ElasticNet(alpha=<span class="number">1.0</span>, *, l1_ratio=<span class="number">0.5</span>, fit_intercept=<span class="literal">True</span>, normalize=<span class="literal">False</span>, precompute=<span class="literal">False</span>, max_iter=<span class="number">1000</span>, copy_X=<span class="literal">True</span>, tol=<span class="number">0.0001</span>, warm_start=<span class="literal">False</span>, positive=<span class="literal">False</span>, random_state=<span class="literal">None</span>, selection=<span class="string">&#x27;cyclic&#x27;</span>)</span><br></pre></td></tr></table></figure></li></ul><h2 id="逻辑回归"><a href="#逻辑回归" class="headerlink" title="逻辑回归"></a>逻辑回归</h2><blockquote><p>逻辑回归分类模型是一种基于回归思想实现分类业务的分类模型。</p><p>逻辑回归的工作原理：与线性回归模型一样，逻辑回归模型也是计算输入特征的加权和（加上偏置项），但是不同于线性回归模型直接输出结果，它输出的是结果的数理逻辑。分类问题可以分为二元分类（OvO:one-versus-all）和多元分类(OvR:one-versus-all)。</p><p> <img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230711084936733.png" alt="image-20230711084936733"></p><p>逻辑回归做二元分类时的核心思想为： </p><p>针对输出为{0, 1}的已知训练样本训练一个回归模型，使得训练样本的预测输出限制在(0, 1)的数值区间。该模型使原类别为0的样本的输出更接近于0，原类别为1的样本的输出更接近于1。这样就可以使用相同的回归模型来完成分类预测。</p></blockquote><h3 id="1、逻辑回归原理"><a href="#1、逻辑回归原理" class="headerlink" title="1、逻辑回归原理"></a>1、逻辑回归原理</h3><p>逻辑回归目标函数：</p><script type="math/tex; mode=display">逻辑函数(sigmoid)：y=1/(1+e^(-z) ); z=w^T x+b</script><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 逻辑回归相关API：</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sklearn.linear_model <span class="keyword">as</span> lm<span class="comment"># logist:逻辑</span></span><br><span class="line"><span class="comment"># 构建逻辑回归器 </span></span><br><span class="line"><span class="comment"># solver：逻辑函数中指数的函数关系（liblinear为线型函数关系）</span></span><br><span class="line"><span class="comment"># C：参数代表正则强度，为了防止过拟合。正则越大拟合效果越小。</span></span><br><span class="line">model = lm.LogisticRegression(solver=<span class="string">&#x27;liblinear&#x27;</span>, C=正则强度)</span><br><span class="line">model.fit(训练输入集，训练输出集)</span><br><span class="line">result = model.predict(带预测输入集)</span><br></pre></td></tr></table></figure><h3 id="2、交叉验证"><a href="#2、交叉验证" class="headerlink" title="2、交叉验证"></a>2、交叉验证</h3><blockquote><p>在机器学习中，因为训练集和测试集的数据划分是随机的，所以有时会重复地使用数据，以便更好地评估模型的有效性，并选出最好的模型，该做法称为交叉验证。具体而言就是对原始样本数据进行切分，然后组合成为多组不同的训练集和测试集，用训练集训练模型，用测试集评估模型。某次的训练集可能是下次的测试集，故而称为交叉验证。</p><p>交叉验证的方法有简单交叉验证、K折交叉验证和留一交叉验证3种。其中K折交叉验证应用较为广泛，它是指将数据集随机等分为K份，每次选取K-1份作为训练集，用剩下的1份作为测试集，得到K个模型后将这K个模型的平均测试效果作为最终的模型效果。</p><p> 通常来说，如果训练集相对较小，则增大K值，这样在每次迭代过程中将会有更多数据用于模型训练，同时算法时间延长；如果训练集相对较大，则减小K值，这样可以降低模型在不同的数据块上进行重复拟合性能评估的计算成本，在平均性能的基础上获得模型的准确评估。</p><p> 除了更精确地评估模型，交叉验证的另一个重要作用就是利用更精确的评估结果对模型进行参数调优，它经常与<code>GridSearch</code>网格搜索配合使用。</p></blockquote><p>就是把将训练集分为不同的折，然后将测试集交叉放进去与训练集拟合，好处就是可以学到训练集的细节</p><p><img src="C:\Users\beihai\Desktop\grid_search_cross_validation.png" alt="grid_search_cross_validation"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sklearn提供了交叉验证相关API：</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sklearn.model_selection <span class="keyword">as</span> ms</span><br><span class="line">指标值数组 = ms.cross_val_score(模型, 输入集, 输出集, cv=折叠数, scoring=指标名)</span><br></pre></td></tr></table></figure><h3 id="3、数据集划分"><a href="#3、数据集划分" class="headerlink" title="3、数据集划分"></a>3、数据集划分</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">数据集划分相关API：</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sklearn.model_selection <span class="keyword">as</span> ms</span><br><span class="line"> </span><br><span class="line"> X_train, X_test, y_train, y_test = ms.train_test_split(X, y, test_size=测试集占比, random_state=随机种子)</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>参数名称</th><th>说明</th></tr></thead><tbody><tr><td>*arrays</td><td>接收一个或多个数据集。代表需要划分的数据集，若为分类回归则分别传入数据和标签，若为聚类则传入数 据。无默认。</td></tr><tr><td>test_size</td><td>接收float，int，None类型的数据。代表测试集的大小。如果传入的为float类型的数据则需要限定在0-1之 间，代表测试集在总数中的占比；如果传入为int类型的数据，则表示测试集记录的绝对数目。该参数与  train_size可以只传入一个。在0.21版本前，若test_size和train_size均为默认则testsize为25%。</td></tr><tr><td>train_size</td><td>接收float，int，None类型的数据。代表训练集的大小。该参数与test_size可以只传入一个。</td></tr><tr><td>random_state</td><td>接收int。代表随机种子编号，相同随机种子编号产生相同的随机结果，不同的随机种子编号产生不同的随机结果。默认为None。random_state就是为了保证程序每次运行都分割一样的训练集合测试集。</td></tr><tr><td>shuffle</td><td>接收boolean。代表是否进行有放回抽样。若该参数取值为True则stratify参数必须不能为空。</td></tr><tr><td>stratify</td><td>接收array或者None。如果不为None，则使用传入的标签进行分层抽样。</td></tr></tbody></table></div><p>train_test_split是最常用的数据划分方法，在model_selection模块中还提供了其他数据集划分的函数，如<code>PredefinedSplit</code>，<code>ShuffleSplit</code>等。</p><p>划分训练集和测试集在某种程度上也是为了检查模型是否出现过拟合。过拟合指模型在训练样本中拟合程度过高，虽然它很好地契合了训练集数据，但是却丧失了泛化能力，因而不具有推广性，导致在测试集数据中的预测表现不佳。就好比每次模考都做同一份卷子，训练时得分很高，但是期末考试换了一套卷子就得分很低。而划分训练集和测试集可以用来对模型进行更好的检验。</p><h3 id="4、模型搭建"><a href="#4、模型搭建" class="headerlink" title="4、模型搭建"></a>4、模型搭建</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#模型的搭建相对比较容易，逻辑回归相关API：</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sklearn.linear_model <span class="keyword">as</span> lm</span><br><span class="line"> <span class="comment"># 构建逻辑回归器 </span></span><br><span class="line"> <span class="comment"># solver：逻辑函数中指数的函数关系（liblinear为线型函数关系）</span></span><br><span class="line"> <span class="comment"># C：参数代表正则强度，反值，为了防止过拟合。正则越大拟合效果越小。</span></span><br><span class="line"></span><br><span class="line"> model = lm.LogisticRegression(solver=<span class="string">&#x27;liblinear&#x27;</span>, C=正则强度)</span><br><span class="line"> model.fit(X_train，y_train)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">如果这里solver不选择liblinear 会默认选择 lbfgs</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">官网这样说的：The ‘newton-cg’, ‘sag’, and ‘lbfgs’ solvers support only L2 regularization with primal formulation, or no regularization. The ‘liblinear’ solver supports both L1 and L2 regularization, with a dual formulation only for the L2 penalty. The Elastic-Net regularization is only supported by the ‘saga’ solver.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><h3 id="5、分类问题模型评估"><a href="#5、分类问题模型评估" class="headerlink" title="5、分类问题模型评估"></a>5、分类问题模型评估</h3><ul><li><p>==<strong>一级指标</strong>==</p><blockquote><p>分类模型的评价指标：真假与正类负类</p><p>a. 真正例(TP) 是指模型将正类别样本正确地预测为正类别。</p><p>b. 真负例(TN) 是指模型将负类别样本正确地预测为负类别。</p><p>c. 假正例(FP) 是指模型将负类别样本错误地预测为正类别。</p><p>d. 假负例(FN) 是指将正类别样本错误地预测为负类别。</p></blockquote><p><strong>混淆矩阵</strong></p><p>混淆矩阵（也称误差矩阵，Confusion Matrix）就是分别统计分类模型归错类，归对类的观测值个数，然后把结果放在一个表里展示出来。这个表就是混淆矩阵。</p><p>|        |          | 真实值      | 真实值      |<br>| ——— | ———— | —————- | —————- |<br>|        |          | Positive    | Negative    |<br>| 预测值 | Positive | 真正例（TP) | 假正例（FP) |<br>| 预测值 | Negative | 假负例（FN) | 真负例（TN) |</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取模型分类结果的混淆矩阵的相关API：</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sklearn.metrics <span class="keyword">as</span> sm</span><br><span class="line">混淆矩阵 = sm.confusion_matrix(实际输出, 预测输出)</span><br></pre></td></tr></table></figure></li><li><p>==<strong>二级指标</strong>==</p><p>准确率(accuracy)：是指模型预测正确的样本数比上总样本数的比重。</p><p>计算公式：accuracy = (TP + TN) / (TP + TN + FP + FN)</p><p>精确率(precision_weighted)：针对每一个类别，预测正确的样本数比上预测出来的样本数。</p><p> 计算公式：precision_weighted = TP / TP + FP</p><p>召回率(recall_weighted)：针对每一个类别，预测正确的样本数比上实际存在的样本数。</p><p>​       计算公式：recall_weighted = TP / TP + FN</p><p>   某池塘有1400条鲤鱼，300只虾，300只鳖。现在以捕鲤鱼为目的。 撒一大网，逮着了700条鲤鱼，200只虾，100只鳖。那么，这些指标 分别如下：<br> 精确率 = 700 / (700 + 200 + 100) = 70%<br> 召回率 = 700 / 1400 = 50%<br> F值 = 70% <em> 50% </em> 2 / (70% + 50%) = 58.3%</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># API</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 准确率</span></span><br><span class="line">sm.accuracy_score(test_y, pred_y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 精确率</span></span><br><span class="line">sm.precision_score(test_y, pred_y)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">这里会报错：</span></span><br><span class="line"><span class="string">ValueError: Target is multiclass but average=&#x27;binary&#x27;. Please choose another average setting, one of [None, &#x27;micro&#x27;, &#x27;macro&#x27;, &#x27;weighted&#x27;].</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">只需要更改：</span></span><br><span class="line"><span class="string">sm.precision_score(test_y, pred_y, average=None)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 更改为；</span></span><br><span class="line">sm.precision_score(test_y, pred_y, average=<span class="literal">None</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">array([0.8       , 0.94444444, 1.        ])</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 精确率</span></span><br><span class="line">sm.precision_score(test_y, pred_y, average=<span class="string">&#x27;macro&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0.9148148148148149</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 召回率</span></span><br><span class="line">sm.recall_score(test_y, pred_y, average=<span class="literal">None</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">array([0.88888889, 0.89473684, 1.        ])</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 召回率</span></span><br><span class="line">sm.recall_score(test_y, pred_y, average=<span class="string">&#x27;macro&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0.9278752436647174</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>精确率和召回率有一定关系 -&gt;</p><ol><li>精确率是预测正确的比上预测出来的</li><li>召回率是预测正确的比上原来就有的</li><li>记住一个结论：精确率和召回率是此消彼长的关系</li><li>例如：抖音审核，精确率上升，召回率下降</li></ol></li><li><p>==<strong>三级指标</strong>==</p><blockquote><p>•      F1_Score(f1_weighted)：2x精确率x召回率/(精确率+召回率)</p><p>分类模型对测试集进行预测而得出的准确率(accuracy)并不能很好地反映模型的性能，为了有效判断一个预测模型的性能表现，需要结合真实值，计算出精确率(precision_weighted)、召回率(recall_weighted)、F1_Score和Cohen’s Kappa系数等指标来衡量。分值越高越好。</p><p>要全面评估模型的有效性，必须<strong>同时</strong>检查精确率(precision_weighted)和召回率(recall_weighted)。遗憾的是，精确率和召回率往往是此消彼长的情况。也就是说，提高精确率通常会降低召回率值，反之亦然。提高分类阈值，精确率可能会提高（因为FP可能会减小）；召回率会下降或保持不变（因为TP会减少或不变，且FN会增加或不变）。降低分类阈值，精确率可能会下降（因为FP可能会增加），而召回率（FN可能会减少）可能会有所提高。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># f1得分  -&gt; 召回率和精确率</span></span><br><span class="line">sm.f1_score(test_y, pred_y, average=<span class="string">&#x27;macro&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0.9203413940256047</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 分类报告</span></span><br><span class="line"><span class="built_in">print</span>(sm.classification_report(test_y, pred_y))</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">precision    recall  f1-score   support</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">           0       0.80      0.89      0.84         9</span></span><br><span class="line"><span class="string">           1       0.94      0.89      0.92        19</span></span><br><span class="line"><span class="string">           2       1.00      1.00      1.00        17</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    accuracy                           0.93        45</span></span><br><span class="line"><span class="string">   macro avg       0.91      0.93      0.92        45</span></span><br><span class="line"><span class="string">weighted avg       0.94      0.93      0.93        45</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="6、红酒分类"><a href="#6、红酒分类" class="headerlink" title="6、红酒分类"></a>6、红酒分类</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> datasets <span class="keyword">as</span> sd</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> model_selection <span class="keyword">as</span> ms</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> linear_model <span class="keyword">as</span> lm</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> metrics <span class="keyword">as</span> sm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取数据</span></span><br><span class="line">data = sd.load_wine()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看一些数据详情</span></span><br><span class="line"><span class="built_in">print</span>(data[<span class="string">&#x27;DESCR&#x27;</span>])</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"> ============================= ==== ===== ======= =====</span></span><br><span class="line"><span class="string">                                   Min   Max   Mean     SD</span></span><br><span class="line"><span class="string">    ============================= ==== ===== ======= =====</span></span><br><span class="line"><span class="string">    Alcohol:                      11.0  14.8    13.0   0.8</span></span><br><span class="line"><span class="string">    Malic Acid:                   0.74  5.80    2.34  1.12</span></span><br><span class="line"><span class="string">    Ash:                          1.36  3.23    2.36  0.27</span></span><br><span class="line"><span class="string">    Alcalinity of Ash:            10.6  30.0    19.5   3.3</span></span><br><span class="line"><span class="string">    Magnesium:                    70.0 162.0    99.7  14.3</span></span><br><span class="line"><span class="string">    Total Phenols:                0.98  3.88    2.29  0.63</span></span><br><span class="line"><span class="string">    Flavanoids:                   0.34  5.08    2.03  1.00</span></span><br><span class="line"><span class="string">    Nonflavanoid Phenols:         0.13  0.66    0.36  0.12</span></span><br><span class="line"><span class="string">    Proanthocyanins:              0.41  3.58    1.59  0.57</span></span><br><span class="line"><span class="string">    Colour Intensity:              1.3  13.0     5.1   2.3</span></span><br><span class="line"><span class="string">    Hue:                          0.48  1.71    0.96  0.23</span></span><br><span class="line"><span class="string">    OD280/OD315 of diluted wines: 1.27  4.00    2.61  0.71</span></span><br><span class="line"><span class="string">    Proline:                       278  1680     746   315</span></span><br><span class="line"><span class="string">    ============================= ==== ===== ======= =====</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取特征值和目标值</span></span><br><span class="line">x = data[<span class="string">&#x27;data&#x27;</span>]</span><br><span class="line">y = data[<span class="string">&#x27;target&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 划分数据集</span></span><br><span class="line">train_x, test_x, train_y, test_y = ms.train_test_split(x, y, train_size=<span class="number">0.75</span>, shuffle=<span class="literal">True</span>, random_state=<span class="number">7</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择模型</span></span><br><span class="line">model = lm.LogisticRegression(solver=<span class="string">&#x27;liblinear&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">这里solver切记要切换模型 不然下面训练模型会出错</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 训练模型</span></span><br><span class="line">model.fit(train_x, train_y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 预测模型</span></span><br><span class="line">pred_y = model.predict(test_x)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">array([2, 0, 2, 2, 1, 2, 1, 0, 1, 2, 0, 1, 2, 1, 1, 1, 1, 2, 0, 0, 0, 1,</span></span><br><span class="line"><span class="string">       1, 1, 0, 2, 1, 2, 2, 2, 1, 1, 2, 1, 1, 1, 2, 2, 0, 2, 0, 0, 2, 2,</span></span><br><span class="line"><span class="string">       1])</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对比真实值</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">array([2, 0, 2, 2, 1, 2, 1, 0, 1, 2, 0, 1, 2, 1, 1, 1, 1, 2, 0, 0, 1, 1,</span></span><br><span class="line"><span class="string">       1, 1, 0, 2, 1, 2, 2, 2, 1, 0, 2, 1, 1, 1, 2, 2, 0, 2, 0, 1, 2, 2,</span></span><br><span class="line"><span class="string">       1])</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 混淆矩阵</span></span><br><span class="line">sm.confusion_matrix(test_y, pred_y)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">array([[ 8,  1,  0],</span></span><br><span class="line"><span class="string">       [ 2, 17,  0],</span></span><br><span class="line"><span class="string">       [ 0,  0, 17]], dtype=int64)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">这里横轴相加为真实值的各个类的总和</span></span><br><span class="line"><span class="string">纵轴相加为预测值的各个类的总和</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 模型评估</span></span><br><span class="line"><span class="comment"># 准确率</span></span><br><span class="line">sm.accuracy_score(test_y, pred_y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 精确率</span></span><br><span class="line">sm.precision_score(test_y, pred_y, average=<span class="string">&#x27;macro&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0.9148148148148149</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 召回率</span></span><br><span class="line">sm.recall_score(test_y, pred_y, average=<span class="literal">None</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">array([0.88888889, 0.89473684, 1.        ])</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 召回率</span></span><br><span class="line">sm.recall_score(test_y, pred_y, average=<span class="string">&#x27;macro&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0.9278752436647174</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># f1得分  -&gt; 召回率和精确率</span></span><br><span class="line">sm.f1_score(test_y, pred_y, average=<span class="string">&#x27;macro&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0.9203413940256047</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 分类报告</span></span><br><span class="line"><span class="built_in">print</span>(sm.classification_report(test_y, pred_y))</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">precision    recall  f1-score   support</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">           0       0.80      0.89      0.84         9</span></span><br><span class="line"><span class="string">           1       0.94      0.89      0.92        19</span></span><br><span class="line"><span class="string">           2       1.00      1.00      1.00        17</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    accuracy                           0.93        45</span></span><br><span class="line"><span class="string">   macro avg       0.91      0.93      0.92        45</span></span><br><span class="line"><span class="string">weighted avg       0.94      0.93      0.93        45</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><h2 id="决策树"><a href="#决策树" class="headerlink" title="决策树"></a>决策树</h2><p><strong>决策树模型的几个重要概念：</strong>父节点和子节点、根节点和叶子节点。</p><p>父节点和子节点是相对的，子节点由父节点根据某一规则分裂而来，然后子节点作为新的父节点继续分裂，直至不能分裂为止。</p><p>根节点则和叶子节点是绝对的，根节点是没有父节点的节点，即初始节点，叶子节点则是没有子节点的节点，即最终节点。</p><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230711104500841.png" alt="image-20230711104500841"></p><p><strong>决策树模型的关键：</strong>就是如何选择合适的节点进行分裂。</p><h3 id="1、决策树回归器模型相关API"><a href="#1、决策树回归器模型相关API" class="headerlink" title="1、决策树回归器模型相关API"></a>1、决策树回归器模型相关API</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sklearn.tree <span class="keyword">as</span> st</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 决策树分类模型接口</span></span><br><span class="line"> sklearn.tree.DecisionTreeClassifier(*, criterion=<span class="string">&#x27;gini&#x27;</span>, splitter=<span class="string">&#x27;best&#x27;</span>, max_depth=<span class="literal">None</span>, min_samples_split=<span class="number">2</span>, min_samples_leaf=<span class="number">1</span>, min_weight_fraction_leaf=<span class="number">0.0</span>, max_features=<span class="literal">None</span>, random_state=<span class="literal">None</span>, max_leaf_nodes=<span class="literal">None</span>, min_impurity_decrease=<span class="number">0.0</span>, min_impurity_split=<span class="literal">None</span>, class_weight=<span class="literal">None</span>, ccp_alpha=<span class="number">0.0</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 决策树回归模型接口</span></span><br><span class="line"> sklearn.tree.DecisionTreeRegressor(*, criterion=<span class="string">&#x27;mse&#x27;</span>, splitter=<span class="string">&#x27;best&#x27;</span>, max_depth=<span class="literal">None</span>, min_samples_split=<span class="number">2</span>, min_samples_leaf=<span class="number">1</span>, min_weight_fraction_leaf=<span class="number">0.0</span>, max_features=<span class="literal">None</span>, random_state=<span class="literal">None</span>, max_leaf_nodes=<span class="literal">None</span>, min_impurity_decrease=<span class="number">0.0</span>, min_impurity_split=<span class="literal">None</span>, ccp_alpha=<span class="number">0.0</span>)</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td>criterion:{“gini”, “entropy”}, default=”gini”</td><td>衡量分类的质量“entropy”代表信息增益,”gini”代表基尼系数</td></tr><tr><td>max_depth</td><td>树的最大深度</td></tr><tr><td>min_samples_split</td><td>一个内部节点需要的最少的样本数</td></tr><tr><td>min_samples_leaf</td><td>一个叶节点所需要的最小样本数</td></tr><tr><td>max_leaf_nodes</td><td>最大叶子节点的值</td></tr><tr><td>class_weight</td><td>类的关联权值</td></tr></tbody></table></div><h3 id="2、鸢尾花回归决策树"><a href="#2、鸢尾花回归决策树" class="headerlink" title="2、鸢尾花回归决策树"></a>2、鸢尾花回归决策树</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> datasets <span class="keyword">as</span> sd</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> model_selection <span class="keyword">as</span> ms</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> tree <span class="keyword">as</span> st</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> metrics <span class="keyword">as</span> sm</span><br><span class="line"></span><br><span class="line">data = sd.load_iris()</span><br><span class="line">x = data.data</span><br><span class="line">y = data.target</span><br><span class="line">train_x, test_x, train_y, test_y = ms.train_test_split(x, y, train_size=<span class="number">0.75</span>, shuffle=<span class="literal">True</span>, random_state=<span class="number">7</span>)</span><br><span class="line"><span class="comment"># 选择模型</span></span><br><span class="line">model = st.DecisionTreeClassifier()</span><br><span class="line"><span class="comment"># 训练模型</span></span><br><span class="line">model.fit(train_x, train_y)</span><br><span class="line"><span class="comment"># 预测模型</span></span><br><span class="line">pred_y = model.predict(test_x)</span><br><span class="line"><span class="comment"># 模型评估</span></span><br><span class="line">sm.f1_score(test_y, pred_y, average=<span class="string">&#x27;micro&#x27;</span>)</span><br><span class="line"><span class="comment"># 绘画决策树</span></span><br><span class="line">st.plot_tree(model,feature_names=[<span class="string">&#x27;sepal length&#x27;</span>, <span class="string">&#x27;sepal width&#x27;</span>, <span class="string">&#x27;petal length&#x27;</span>, <span class="string">&#x27;petal width&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看特征的重要性</span></span><br><span class="line">model.feature_importances_</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">array([0.01786711, 0.        , 0.0329131 , 0.94921978])</span></span><br><span class="line"><span class="string">所以我们选择data的时候只需要后面两列就ok</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230711110745356.png" alt="image-20230711110745356"></p><h2 id="集合算法"><a href="#集合算法" class="headerlink" title="集合算法"></a>集合算法</h2><blockquote><p>集合算法也叫集成学习模型，它是使用一系列弱学习器（也称为基础模型或基模型）进行学习，并将各个弱学习器的结果进行整合，从而获得比单个学习器更好的学习效果。集成学习模型的常见算法有Bagging算法和Boosting算法两种。Bagging算法的典型机器学习模型为随机森林模型，而Boosting算法的典型机器学习模型为：AdaBoost、GBDT、XGBoost和LightGBM模型。</p><p>Bagging算法</p><p>Bagging算法的原理类似投票，每个弱学习器都有一票，最终根据所有弱学习器的投票，按照“少数服从多数”的原则产生最终的预测结果。</p><p>假设原始数据共有10000条，从中随机有放回地抽取10000次数据构成一个新的训练集（因为是随机有放回抽样，所以可能出现某一条数据多次被抽中，也有可能某一条数据一次也没有被抽中），每次使用一个训练集训练一个弱学习器。这样有放回地随机抽取n次后，训练结束时就能获得由不同的训练集训练出的n个弱学习器，根据这n个弱学习器的预测结果，按照“少数服从多数”的原则，获得一个更加准确、合理的最终预测结果。具体来说，在分类问题中是用n个弱学习器投票的方式获取最终结果，在回归问题中则是取n个弱学习器的平均值作为最终结果。</p><p>Boosting算法</p><p>Boosting算法的本质是将弱学习器提升为强学习器，它和Bagging算法的区别在于：Bagging算法对待所有的弱学习器一视同仁；而Boosting算法则会对弱学习器“区别对待”，通俗来讲就是注重“培养精英”和“重视错误”。</p><p>”培养精英”就是每一轮训练后对预测结果较准确的弱学习器给予较大的权重，对表现不好的弱学习器则降低其权重。这样在最终预测时，“优秀模型”的权重是大的，相当于它可以投出多票，而“一般模型”只能投出一票或不能投票。</p><p>“重视错误”就是在每一轮训练后改变训练集的权值或概率分布，通过提高在前一轮被弱学习器预测错误的样例的权值，降低前一轮被弱学习器预测正确的样例的权值，来提高弱学习器对预测错误的数据的重视程度，从而提升模型的整体预测效果。</p></blockquote><h3 id="1、随机森林"><a href="#1、随机森林" class="headerlink" title="1、随机森林"></a>1、随机森林</h3><p>​                随机森林（Random Forest）是一种经典的Bagging模型，其弱学习器为决策树模型。随机森林模型会在原始数据集中随机抽样，构成n个不同的样本数据集，然后根据这些数据集搭建n个不同的决策树模型，最后根据这些决策树模型的平均值（针对回归模型）或者投票情况（针对分类模型）来获取最终结果。为了保证模型的泛化能力（或者说通用能力），随机森林模型在建立每棵树时，往往会遵循<strong>数据随机</strong>和<strong>特征随机</strong>这两个基本原则。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#随机森林相关API：</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sklearn.ensemble <span class="keyword">as</span> se</span><br><span class="line"></span><br><span class="line"><span class="comment"># 随机森林回归模型（属于集合算法的一种）</span></span><br><span class="line"><span class="comment"># max_depth：决策树最大深度10</span></span><br><span class="line"><span class="comment"># n_estimators：构建1000棵决策树，训练模型</span></span><br><span class="line"><span class="comment"># min_samples_split: 子表中最小样本数 若小于这个数字，则不再继续向下拆分</span></span><br><span class="line">model = se.RandomForestRegressor(max_depth=<span class="number">10</span>, n_estimators=<span class="number">1000</span>,min_samples_split=<span class="number">2</span>,random_state=<span class="number">7</span>)</span><br><span class="line">model.fit(X,y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 随集森林分类模型</span></span><br><span class="line">model=RandomForestClassifier(max_depth=<span class="number">10</span>, n_estimators=<span class="number">1000</span>,min_samples_split=<span class="number">2</span>,random_state=<span class="number">7</span>)</span><br><span class="line">model.fit(X,y)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>==<strong>案例</strong>==</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> datasets <span class="keyword">as</span> sd</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> model_selection <span class="keyword">as</span> ms</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> ensemble <span class="keyword">as</span> se</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> metrics <span class="keyword">as</span> sm</span><br><span class="line"></span><br><span class="line">data = sd.load_iris()</span><br><span class="line">x = data.data</span><br><span class="line">y = data.target</span><br><span class="line"></span><br><span class="line"><span class="comment"># 划分数据集</span></span><br><span class="line">train_x, test_x, train_y, test_y = ms.train_test_split(x, y, train_size=<span class="number">0.75</span>, shuffle=<span class="literal">True</span>, random_state=<span class="number">7</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择模型</span></span><br><span class="line">model = se.RandomForestClassifier()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 训练模型</span></span><br><span class="line">model.fit(train_x, train_y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看权重</span></span><br><span class="line">model.feature_importances_</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">array([0.06178603, 0.0128437 , 0.47481514, 0.45055513])</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 预测模型</span></span><br><span class="line">pred_y = model.predict(test_x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 稀疏矩阵</span></span><br><span class="line">sm.confusion_matrix(test_y, pred_y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模型评估</span></span><br><span class="line">sm.f1_score(test_y, pred_y, average=<span class="string">&#x27;micro&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0.8947368421052632</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(sm.classification_report(test_y, pred_y))</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">              precision    recall  f1-score   support</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">           0       1.00      1.00      1.00        11</span></span><br><span class="line"><span class="string">           1       0.86      0.86      0.86        14</span></span><br><span class="line"><span class="string">           2       0.85      0.85      0.85        13</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    accuracy                           0.89        38</span></span><br><span class="line"><span class="string">   macro avg       0.90      0.90      0.90        38</span></span><br><span class="line"><span class="string">weighted avg       0.89      0.89      0.89        38</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><h3 id="2、AdaBoost"><a href="#2、AdaBoost" class="headerlink" title="2、AdaBoost"></a>2、AdaBoost</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> datasets <span class="keyword">as</span> sd</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> model_selection <span class="keyword">as</span> ms</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> linear_model <span class="keyword">as</span> lm</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> ensemble <span class="keyword">as</span> se</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> metrics <span class="keyword">as</span> sm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取数据</span></span><br><span class="line">data = sd.load_iris()</span><br><span class="line"></span><br><span class="line">x = data.data</span><br><span class="line">y = data.target</span><br><span class="line"></span><br><span class="line"><span class="comment"># 划分数据集</span></span><br><span class="line">train_x, test_x, train_y, test_y = ms.train_test_split(x, y, train_size=<span class="number">0.8</span>, shuffle=<span class="literal">True</span>, random_state=<span class="number">21</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择模型</span></span><br><span class="line">sgd = lm.SGDClassifier()</span><br><span class="line">model = se.AdaBoostClassifier(estimator=sgd, algorithm=<span class="string">&#x27;SAMME&#x27;</span>, n_estimators=<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模型训练</span></span><br><span class="line">model.fit(train_x, train_y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模型预测</span></span><br><span class="line">pred_y = model.predict(test_x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模型评估</span></span><br><span class="line"><span class="built_in">print</span>(sm.classification_report(test_y, pred_y))</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">  precision    recall  f1-score   support</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">           0       1.00      1.00      1.00        11</span></span><br><span class="line"><span class="string">           1       1.00      0.71      0.83        14</span></span><br><span class="line"><span class="string">           2       0.76      1.00      0.87        13</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    accuracy                           0.89        38</span></span><br><span class="line"><span class="string">   macro avg       0.92      0.90      0.90        38</span></span><br><span class="line"><span class="string">weighted avg       0.92      0.89      0.89        38</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><h2 id="朴素贝叶斯"><a href="#朴素贝叶斯" class="headerlink" title="朴素贝叶斯"></a>朴素贝叶斯</h2><blockquote><p>贝叶斯分类是机器学习中应用极为广泛的分类算法之一，其产生自英国数学家贝叶斯对于逆概问题的思考。朴素贝叶斯是贝叶斯模型当中最简单的一种。</p><p><strong>贝叶斯公式</strong> <strong>: </strong></p><script type="math/tex; mode=display">P(A|B) = P(B|A)P(A) / P(B)</script><p>其中P（A）为事件A发生的概率，P（B）为事件B发生的概率，P（A|B）表示在事件B发生的条件下事件A发生的概率，同理P（B|A）则表示在事件A发生的条件下事件B发生的概率。</p><p><strong>朴素贝叶斯分类是贝叶斯分类中最简单，也是常见的一种分类方法</strong>。</p><script type="math/tex; mode=display">P( Y|X1,X2,...,Xn ) = p( X1,X2,...Xn|Y) P(Y) / P(X1,X2,...Xn)</script><p>朴素贝叶斯模型假设给定目标值后各个特征之间相互独立，分子的计算公式可以写成如下形式:</p><script type="math/tex; mode=display">P( X1,X2,....Xn|Y)P(Y) = P(X1|Y)P(X2|Y)P(X3|Y)...P(Xn|Y)P(Y)</script><p>。其中<code>P（X1|Y）、P（X2|Y）、P（Y）</code>等数据都是已知的，由此可以计算在n个特征变量取不同的值的条件下，目标变量取某个值的概率，并且选择概率更高者对样本进行分类。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#朴素贝叶斯模型相关API:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sklearn.naive_bayes <span class="keyword">as</span> nb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建高斯分布朴素贝叶斯分类器,它适用于任何连续数值型的数据集。</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> datasets <span class="keyword">as</span> sd</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> feature_extraction <span class="keyword">as</span> fe</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> naive_bayes <span class="keyword">as</span> nb</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> model_selection <span class="keyword">as</span> ms</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> metrics <span class="keyword">as</span> sm</span><br><span class="line"></span><br><span class="line">data = sd.fetch_20newsgroups()</span><br><span class="line">x = data.data</span><br><span class="line">y = data.target</span><br><span class="line"></span><br><span class="line">train_x, test_x, train_y, test_y = ms.train_test_split(x, y, train_size=<span class="number">0.75</span>, random_state=<span class="number">6</span>, shuffle=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">transfer = fe.text.TfidfVectorizer()</span><br><span class="line">train_x = transfer.fit_transform(train_x)</span><br><span class="line">test_x = transfer.transform(test_x)</span><br><span class="line"></span><br><span class="line">model = nb.MultinomialNB()</span><br><span class="line">model.fit(train_x, train_y)</span><br><span class="line">pred_y = model.predict(test_x)</span><br><span class="line"></span><br><span class="line">sm.f1_score(test_y, pred_y, average=<span class="string">&#x27;micro&#x27;</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">0.8462354188759279</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><h2 id="支持向量机-SVM"><a href="#支持向量机-SVM" class="headerlink" title="支持向量机(SVM)"></a>支持向量机(SVM)</h2><p><strong>支持向量机</strong>(<strong>SVM</strong>)是一组用于分类、回归和异常值检测的监督学习方法。</p><p>支持向量机的优点是：</p><ul><li><p>在高维空间中有效。</p></li><li><p>在维数大于样本数的情况下仍然有效。</p></li><li><p>在决策函数中使用训练点的子集（称为支持向量），因此它也是内存高效的。</p></li><li><p>通用性：可以为决策函数指定不同的内核函数。提供了通用内核，但也可以指定自定义内核。</p></li></ul><p>支持向量机的缺点包括：</p><ul><li><p>​     如果特征数量远大于样本数量，在选择核函数时避免过度拟合，正则化项至关重要。</p></li><li><p>​      SVM不直接提供概率估计，这些是使用昂贵的五折交叉验证计算的。</p></li></ul><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230711150419453.png" alt="image-20230711150419453"></p><h3 id="分类（SVC）"><a href="#分类（SVC）" class="headerlink" title="分类（SVC）"></a>分类（SVC）</h3><p>SVC，NuSVC、LinearSVC是能够对数据集执行二进制和多类分类的类。</p><p>SVC和NuSVC是类似的方法，但接受的参数集略有不同，并具有不同的数学公式。另一方面，LinearSVC对于线性核的情况，是支持向量分类的另一种（更快）实现。请注意， LinearSVC不接受参数kernel，因为它被假定为线性的。</p><p> 作为其他分类器，SVC、NuSVC和 LinearSVC将两个数组作为输入：一个包含训练样本X的形状数组，以及一个形状类标签（字符串或整数）数组：(n_samples, n_features) y(n_samples)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sklearn.svm.LinearSVC(penalty=<span class="string">&#x27;l2&#x27;</span>, loss=<span class="string">&#x27;squared_hinge&#x27;</span>, *, dual=<span class="literal">True</span>, tol=<span class="number">0.0001</span>, C=<span class="number">1.0</span>, multi_class=<span class="string">&#x27;ovr&#x27;</span>, fit_intercept=<span class="literal">True</span>, intercept_scaling=<span class="number">1</span>, class_weight=<span class="literal">None</span>, verbose=<span class="number">0</span>, random_state=<span class="literal">None</span>, max_iter=<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">sklearn.svm.NuSVC(*, nu=<span class="number">0.5</span>, kernel=<span class="string">&#x27;rbf&#x27;</span>, degree=<span class="number">3</span>, gamma=<span class="string">&#x27;scale&#x27;</span>, coef0=<span class="number">0.0</span>, shrinking=<span class="literal">True</span>, probability=<span class="literal">False</span>, tol=<span class="number">0.001</span>, cache_size=<span class="number">200</span>, class_weight=<span class="literal">None</span>, verbose=<span class="literal">False</span>, max_iter=-<span class="number">1</span>, decision_function_shape=<span class="string">&#x27;ovr&#x27;</span>, break_ties=<span class="literal">False</span>, random_state=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">sklearn.svm.SVC(*, C=<span class="number">1.0</span>, kernel=<span class="string">&#x27;rbf&#x27;</span>, degree=<span class="number">3</span>, gamma=<span class="string">&#x27;scale&#x27;</span>, coef0=<span class="number">0.0</span>, shrinking=<span class="literal">True</span>, probability=<span class="literal">False</span>, tol=<span class="number">0.001</span>, cache_size=<span class="number">200</span>, class_weight=<span class="literal">None</span>, verbose=<span class="literal">False</span>, max_iter=-<span class="number">1</span>, decision_function_shape=<span class="string">&#x27;ovr&#x27;</span>, break_ties=<span class="literal">False</span>, random_state=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><h3 id="回归（SVR）"><a href="#回归（SVR）" class="headerlink" title="回归（SVR）"></a>回归（SVR）</h3><p>支持向量分类的方法可以扩展到解决回归问题。这种方法称为支持向量回归。</p><p>SVM算法非常全面，它不仅支持线性和非线性分类，而且还支持线性和非线性回归。SVM回归要做的就是让尽可能多的实例位于街道上，同时限制间隔违例（也就是不在街道上的实例）。街道的宽度由超参数ε控制，ε值越大，间隔越大；ε值越小，间隔越小。在间隔内添加更多的实例不会影响模型的预测，所以这个模型被称为ε不敏感。</p><p>支持向量分类生成的模型（如上所述）仅依赖于训练数据的一个子集，因为构建模型的成本函数不关心超出边界的训练点。类似地，支持向量回归生成的模型仅依赖于训练数据的一个子集，因为成本函数忽略了预测接近其目标的样本。</p><p>支持向量回归有 3 种不同的实现：<code>SVR、NuSVR和LinearSVR</code>。</p><p><code>LinearSVR</code>提供比<code>SVR</code>(仅考虑线性内核)更快的实现，同时<code>NuSVR</code>实现与<code>SVR</code>略有不同的公式。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># API</span></span><br><span class="line"></span><br><span class="line">sklearn.svm.LinearSVR(*, epsilon=<span class="number">0.0</span>, tol=<span class="number">0.0001</span>, C=<span class="number">1.0</span>, loss=<span class="string">&#x27;epsilon_insensitive&#x27;</span>, fit_intercept=<span class="literal">True</span>, intercept_scaling=<span class="number">1.0</span>, dual=<span class="literal">True</span>, verbose=<span class="number">0</span>, random_state=<span class="literal">None</span>, max_iter=<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">sklearn.svm.NuSVR(*, nu=<span class="number">0.5</span>, C=<span class="number">1.0</span>, kernel=<span class="string">&#x27;rbf&#x27;</span>, degree=<span class="number">3</span>, gamma=<span class="string">&#x27;scale&#x27;</span>, coef0=<span class="number">0.0</span>, shrinking=<span class="literal">True</span>, tol=<span class="number">0.001</span>, cache_size=<span class="number">200</span>, verbose=<span class="literal">False</span>, max_iter=- <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">sklearn.svm.NuSVR(*, nu=<span class="number">0.5</span>, C=<span class="number">1.0</span>, kernel=<span class="string">&#x27;rbf&#x27;</span>, degree=<span class="number">3</span>, gamma=<span class="string">&#x27;scale&#x27;</span>, coef0=<span class="number">0.0</span>, shrinking=<span class="literal">True</span>, tol=<span class="number">0.001</span>, cache_size=<span class="number">200</span>, verbose=<span class="literal">False</span>, max_iter=- <span class="number">1</span>)</span><br></pre></td></tr></table></figure><h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> datasets <span class="keyword">as</span> sd</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> model_selection <span class="keyword">as</span> ms</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> svm</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> metrics <span class="keyword">as</span> sm</span><br><span class="line"></span><br><span class="line">data = sd.load_iris()</span><br><span class="line">x = data.data</span><br><span class="line">y = data.target</span><br><span class="line"></span><br><span class="line"><span class="comment"># 划分数据集</span></span><br><span class="line">train_x, test_x, train_y, test_y = ms.train_test_split(x, y, train_size=<span class="number">0.75</span>, shuffle=<span class="literal">True</span>, random_state=<span class="number">7</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择分类模型</span></span><br><span class="line">model = svm.SVC()</span><br><span class="line"><span class="comment"># 训练分类模型</span></span><br><span class="line">model.fit(train_x, train_y)</span><br><span class="line"><span class="comment"># 预测分类模型</span></span><br><span class="line">pred_y = model.predict(test_x)</span><br><span class="line"><span class="comment"># 分离模型评估</span></span><br><span class="line"><span class="built_in">print</span>(sm.classification_report(test_y, pred_y))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;*****************************************&quot;</span>)</span><br><span class="line">sm.f1_score(test_y, pred_y, average=<span class="literal">None</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">              precision    recall  f1-score   support</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">           0       1.00      1.00      1.00        11</span></span><br><span class="line"><span class="string">           1       0.76      0.93      0.84        14</span></span><br><span class="line"><span class="string">           2       0.90      0.69      0.78        13</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    accuracy                           0.87        38</span></span><br><span class="line"><span class="string">   macro avg       0.89      0.87      0.87        38</span></span><br><span class="line"><span class="string">weighted avg       0.88      0.87      0.87        38</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">*****************************************</span></span><br><span class="line"><span class="string">array([1.        , 0.83870968, 0.7826087 ])</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 回归模型构建</span></span><br><span class="line">model2 = svm.SVR()</span><br><span class="line"><span class="comment"># 训练回归模型</span></span><br><span class="line">model2.fit(train_x, train_y)</span><br><span class="line">sm.r2_score(test_y, pred_y)</span><br></pre></td></tr></table></figure><h2 id="信用卡诈骗检测"><a href="#信用卡诈骗检测" class="headerlink" title="信用卡诈骗检测"></a>信用卡诈骗检测</h2><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230714155343300.png" alt="image-20230714155343300"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> model_selection <span class="keyword">as</span> ms</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> metrics <span class="keyword">as</span> sm</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> svm</span><br><span class="line"></span><br><span class="line">data = pd.read_csv(<span class="string">f&quot;C:\\Users\\beihai\\workpace\\金砖\\模块C\\数据\\creditcard.csv&quot;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="comment"># 获取目标值和特征值</span></span><br><span class="line">x = data.iloc[:,<span class="number">1</span>:<span class="number">30</span>]</span><br><span class="line">y = data.iloc[:,-<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 划分训练集和测试集</span></span><br><span class="line">train_x, test_x, train_y, test_y = ms.train_test_split(x, y, train_size=<span class="number">0.8</span>, shuffle=<span class="literal">True</span>, random_state=<span class="number">21</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">print(train_x.shape)</span></span><br><span class="line"><span class="string">print(test_x.shape)</span></span><br><span class="line"><span class="string">(227845, 29)</span></span><br><span class="line"><span class="string">(56962, 29)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择模型</span></span><br><span class="line">model = svm.SVC()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 训练模型</span></span><br><span class="line">model.fit(train_x, train_y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看模型</span></span><br><span class="line">model.feature_names_in_</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">array([&#x27;V1&#x27;, &#x27;V2&#x27;, &#x27;V3&#x27;, &#x27;V4&#x27;, &#x27;V5&#x27;, &#x27;V6&#x27;, &#x27;V7&#x27;, &#x27;V8&#x27;, &#x27;V9&#x27;, &#x27;V10&#x27;, &#x27;V11&#x27;,</span></span><br><span class="line"><span class="string">       &#x27;V12&#x27;, &#x27;V13&#x27;, &#x27;V14&#x27;, &#x27;V15&#x27;, &#x27;V16&#x27;, &#x27;V17&#x27;, &#x27;V18&#x27;, &#x27;V19&#x27;, &#x27;V20&#x27;,</span></span><br><span class="line"><span class="string">       &#x27;V21&#x27;, &#x27;V22&#x27;, &#x27;V23&#x27;, &#x27;V24&#x27;, &#x27;V25&#x27;, &#x27;V26&#x27;, &#x27;V27&#x27;, &#x27;V28&#x27;, &#x27;Amount&#x27;],</span></span><br><span class="line"><span class="string">      dtype=object)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 预测模型</span></span><br><span class="line">pred_y = model.predict(test_x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模型评估</span></span><br><span class="line"><span class="built_in">print</span>(sm.classification_report(test_y, pred_y))</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">              precision    recall  f1-score   support</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">           0       1.00      1.00      1.00     56853</span></span><br><span class="line"><span class="string">           1       0.91      0.29      0.44       109</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    accuracy                           1.00     56962</span></span><br><span class="line"><span class="string">   macro avg       0.96      0.65      0.72     56962</span></span><br><span class="line"><span class="string">weighted avg       1.00      1.00      1.00     56962</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># f1_score评分</span></span><br><span class="line">sm.f1_score(test_y, pred_y)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0.4444444444444445</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">%matplotlib inline</span><br><span class="line"></span><br><span class="line">data = pd.read_csv(<span class="string">f&quot;C:\\Users\\beihai\\workpace\\金砖\\模块C\\数据\\creditcard.csv&quot;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">count_classes = pd.value_counts(data[<span class="string">&#x27;Class&#x27;</span>], sort = <span class="literal">True</span>).sort_index()</span><br><span class="line"><span class="built_in">print</span>(count_classes)</span><br><span class="line">count_classes.plot(kind=<span class="string">&#x27;bar&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&quot;Fraud class histograam&quot;</span>)</span><br><span class="line">plt.xlabel(<span class="string">&quot;Class&quot;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&quot;Frequency&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line"><span class="comment"># 数据处理</span></span><br><span class="line">data[<span class="string">&#x27;normAmount&#x27;</span>] = StandardScaler().fit_transform(data[<span class="string">&#x27;Amount&#x27;</span>].to_numpy().reshape(-<span class="number">1</span>,<span class="number">1</span>))</span><br><span class="line">data = data.drop([<span class="string">&#x27;Time&#x27;</span>, <span class="string">&#x27;Amount&#x27;</span>], axis = <span class="number">1</span>)</span><br><span class="line">data.head()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下采样：使得0 和 1 所占数据一样多</span></span><br><span class="line">x = data.loc[:, data.columns != <span class="string">&#x27;Class&#x27;</span>]</span><br><span class="line">y = data.loc[:, data.columns == <span class="string">&#x27;Class&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(x.shape)</span><br><span class="line"><span class="built_in">print</span>(y.shape)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">(284807, 29)</span></span><br><span class="line"><span class="string">(284807, 1)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">number_recored_fraud = <span class="built_in">len</span>(data[data.Class == <span class="number">1</span>])</span><br><span class="line">fraud_indicies = np.array(data[data.Class == <span class="number">1</span>].index)</span><br><span class="line"><span class="built_in">print</span>(number_recored_fraud)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(fraud_indicies))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">492</span></span><br><span class="line"><span class="string">492</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">normal_indices = data[data.Class == <span class="number">0</span>].index</span><br><span class="line">random_normal_indices = np.random.choice(normal_indices, number_recored_fraud, replace=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(random_normal_indices)</span><br><span class="line">random_normal_indices = np.array(random_normal_indices)</span><br><span class="line"><span class="built_in">print</span>(random_normal_indices)</span><br><span class="line"></span><br><span class="line">under_sample_indices = np.concatenate([fraud_indicies, random_normal_indices])</span><br><span class="line">under_sample_data = data.iloc[under_sample_indices,:]</span><br><span class="line">x_undersample = under_sample_data.iloc[:,under_sample_data.columns != <span class="string">&#x27;Class&#x27;</span>]</span><br><span class="line">y_undersample = under_sample_data.iloc[:,under_sample_data.columns == <span class="string">&#x27;Class&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(x_undersample),<span class="built_in">len</span>(y_undersample)) </span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">984 984</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择模型</span></span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> svm</span><br><span class="line">model = svm.SVC()</span><br><span class="line">model</span><br><span class="line"></span><br><span class="line"><span class="comment"># 训练模型</span></span><br><span class="line">model.fit(train_x, train_y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 预测模型</span></span><br><span class="line">pred_y = model.predict(test_x)</span><br><span class="line">pred_y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模型评估</span></span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> metrics <span class="keyword">as</span> sm</span><br><span class="line">sm.f1_score(test_y, pred_y)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0.9236363636363637</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(sm.classification_report(test_y, pred_y))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">              precision    recall  f1-score   support</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">           0       0.88      0.99      0.93       149</span></span><br><span class="line"><span class="string">           1       0.99      0.86      0.92       147</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    accuracy                           0.93       296</span></span><br><span class="line"><span class="string">   macro avg       0.94      0.93      0.93       296</span></span><br><span class="line"><span class="string">weighted avg       0.94      0.93      0.93       296</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>python项目开发</title>
      <link href="/2023/07/02/Python%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/"/>
      <url>/2023/07/02/Python%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/</url>
      
        <content type="html"><![CDATA[<h1 id="Python项目开发"><a href="#Python项目开发" class="headerlink" title="Python项目开发"></a>Python项目开发</h1><p>一、环境配置</p><p>1.安装包</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install keras==2.4.3 -i https://pypi.mirrors.ustc.edu.cn/simple/</span><br><span class="line"></span><br><span class="line">pip install TensorFlow==2.3.1 https://pypi.mirrors.ustc.edu.cn/simple/</span><br></pre></td></tr></table></figure><p>2.删除包</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip uninstall xxx</span><br></pre></td></tr></table></figure><p>3.列出包</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip list</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Malplotlib</title>
      <link href="/2023/06/11/%E4%B8%89%E5%89%91%E5%AE%A2-matplotlib/"/>
      <url>/2023/06/11/%E4%B8%89%E5%89%91%E5%AE%A2-matplotlib/</url>
      
        <content type="html"><![CDATA[<p>今天下午跟着chatgpt把matplotlib的各种图画了一遍，就是一个套路</p><ol><li>先需要进行数据的分类，X轴，Y轴；或者有的就比如饼图这种就不需要x,y灵活运用吧</li><li>创建画布，如果只有一张图没有子图的话可以不设置</li><li>对图形进行调参，颜色，线宽，透明度…</li></ol><h1 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h1><blockquote><p><code>Matplotlib</code> 是一个功能强大的 Python 可视化库，可以绘制各种类型的图形。下面是 <code>Matplotlib</code> 可以绘制的一些常见图形类型：</p><ol><li>折线图（Line Plot）：用于显示数据随时间或有序变量而变化的趋势。</li><li>散点图（Scatter Plot）：用于显示两个变量之间的关系，每个数据点用一个点表示。</li><li>条形图（Bar Plot）：用于比较不同类别或组之间的数据。</li><li>直方图（Histogram）：用于显示连续变量的分布情况。</li><li>饼图（Pie Chart）：用于显示不同类别在总体中的占比情况。</li><li>箱线图（Box Plot）：用于显示数据的分散程度和异常值情况。</li><li>热力图（<code>Heatmap</code>）：用于显示两个离散变量之间的关系，通过颜色来表示关联程度。</li><li><code>3D</code> 图（<code>3D</code> Plot）：用于显示三维数据的可视化效果。</li><li>柱状图（Histogram）：用于显示多个连续变量之间的对比情况。</li><li>面积图（Area Plot）：用于显示多个变量随时间变化的总体趋势和相对大小。</li><li>简单地图（Simple Map）：用于显示地理数据，如国家、州、城市的分布情况。</li></ol></blockquote><h1 id="1-折线图"><a href="#1-折线图" class="headerlink" title="1. 折线图"></a>1. 折线图</h1><h2 id="1-1-创建图形对象和坐标系对象"><a href="#1-1-创建图形对象和坐标系对象" class="headerlink" title="1.1 创建图形对象和坐标系对象"></a>1.1 创建图形对象和坐标系对象</h2><p>创建图形对象和坐标系：使用 plt.figure() 创建一个图形对象，并使用 fig.add_subplot() 创建一个坐标系。坐标系可以理解为一个绘图区域，可以在上面绘制图形。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建图形对象和坐标系</span></span><br><span class="line">fig = plt.figure()</span><br><span class="line">ax = fig.add_subplot(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br></pre></td></tr></table></figure><ul><li>第一个参数 <code>1</code>：表示子图网格的总行数。</li><li>第二个参数 <code>1</code>：表示子图网格的总列数。</li><li>第三个参数 <code>1</code>：表示当前选择的子图在子图网格中的位置。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 准备数据</span></span><br><span class="line">x = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">y = [<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建图形对象和坐标系</span></span><br><span class="line">fig = plt.figure()</span><br><span class="line">ax = fig.add_subplot(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制折线图</span></span><br><span class="line">ax.plot(x, y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加标签和标题</span></span><br><span class="line">ax.set_xlabel(<span class="string">&#x27;X Label&#x27;</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">&#x27;Y Label&#x27;</span>)</span><br><span class="line">ax.set_title(<span class="string">&#x27;Line Chart&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示图形</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="1-2-设置中文"><a href="#1-2-设置中文" class="headerlink" title="1.2 设置中文"></a>1.2 设置中文</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">plt.rcParams[<span class="string">&#x27;font.sans-serif&#x27;</span>] = [<span class="string">&#x27;SimHei&#x27;</span>]</span><br><span class="line">plt.rcParams[<span class="string">&#x27;axes.unicode_minus&#x27;</span>]=<span class="literal">False</span></span><br></pre></td></tr></table></figure><h2 id="1-3-设置线段属性"><a href="#1-3-设置线段属性" class="headerlink" title="1.3 设置线段属性"></a>1.3 设置线段属性</h2><p>下面是一些常用的参数和属性设置：</p><ul><li><code>color</code>：用于设置折线的颜色。可以使用颜色名称（如 <code>&quot;red&quot;</code>、<code>&quot;blue&quot;</code>）、颜色缩写（如 <code>&quot;r&quot;</code>、<code>&quot;b&quot;</code>）或十六进制颜色代码（如 <code>#FF0000</code>、<code>#0000FF</code>）来指定颜色。</li><li><code>linewidth</code> 或 <code>lw</code>：用于设置折线的线宽。可以指定一个数值来设置线宽的大小。</li><li><code>linestyle</code> 或 <code>ls</code>：用于设置折线的线型。常见的线型包括实线（<code>&quot;-&quot;</code>）、虚线（<code>&quot;--&quot;</code>）、点线（<code>&quot;:&quot;</code>）等。</li><li><code>marker</code>：用于设置折线上数据点的标记样式。可以使用各种标记样式，如圆点（<code>&quot;.&quot;</code>）、方形（<code>&quot;s&quot;</code>）、三角形（<code>&quot;^&quot;</code>）等。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.plot(x, y, color=<span class="string">&#x27;red&#x27;</span>, linewidth=<span class="number">2</span>, linestyle=<span class="string">&#x27;--&#x27;</span>, marker=<span class="string">&#x27;o&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="1-4-设置图形"><a href="#1-4-设置图形" class="headerlink" title="1.4 设置图形"></a>1.4 设置图形</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置标题和坐标轴标签</span></span><br><span class="line">plt.title(<span class="string">&#x27;Sine Wave&#x27;</span>)</span><br><span class="line">plt.xlabel(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;y&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="1-5-Live2D"><a href="#1-5-Live2D" class="headerlink" title="1.5 Live2D"></a>1.5 Live2D</h2><p>当需要对多条折线进行属性设置时，使用单个 <code>plot()</code> 函数的参数来设置可能会显得冗长。在这种情况下，可以使用 <code>Line2D</code> 对象来创建折线，并设置其属性。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> matplotlib.lines <span class="keyword">import</span> Line2D</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成数据</span></span><br><span class="line">x = np.linspace(<span class="number">0</span>, <span class="number">10</span>, <span class="number">100</span>)</span><br><span class="line">y1 = np.sin(x)</span><br><span class="line">y2 = np.cos(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建 Line2D 对象并设置属性</span></span><br><span class="line">line1 = Line2D(x, y1, color=<span class="string">&#x27;red&#x27;</span>, linewidth=<span class="number">2</span>, linestyle=<span class="string">&#x27;--&#x27;</span>, marker=<span class="string">&#x27;o&#x27;</span>)</span><br><span class="line">line2 = Line2D(x, y2, color=<span class="string">&#x27;blue&#x27;</span>, linewidth=<span class="number">1</span>, linestyle=<span class="string">&#x27;-&#x27;</span>, marker=<span class="string">&#x27;s&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建图形对象和坐标系</span></span><br><span class="line">fig, ax = plt.subplots()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加 Line2D 对象到坐标系</span></span><br><span class="line">ax.add_line(line1)</span><br><span class="line">ax.add_line(line2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置标题和坐标轴标签</span></span><br><span class="line">ax.set_title(<span class="string">&#x27;Sine and Cosine Waves&#x27;</span>)</span><br><span class="line">ax.set_xlabel(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示图形</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="1-6-子图"><a href="#1-6-子图" class="headerlink" title="1.6 子图"></a>1.6 子图</h2><p>有两种方法</p><ul><li><p>```python<br>fig = plt.figure()<br>ax1 = fig.add_subplot(1, 2, 1)<br>ax2 = fig.add_subplot(1, 2, 2)</p><p>ax1.plot(x,y,color=’red’,linewidth=’2’,marker=’o’,linestyle=’—‘)<br>ax2.plot(x,y,color=’blue’,linewidth=’5’,marker=’s’,linestyle=’:’)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- ```python</span><br><span class="line">  import matplotlib.pyplot as plt</span><br><span class="line">  </span><br><span class="line">  # 创建子图网格</span><br><span class="line">  fig, axs = plt.subplots(2, 3)</span><br><span class="line">  </span><br><span class="line">  # 绘制子图</span><br><span class="line">  axs[0, 0].plot([1, 2, 3], [1, 2, 3])</span><br><span class="line">  axs[0, 1].scatter([1, 2, 3], [1, 2, 3])</span><br><span class="line">  axs[0, 2].bar([1, 2, 3], [1, 2, 3])</span><br><span class="line">  axs[1, 0].hist([1, 2, 2, 3, 3, 3])</span><br><span class="line">  axs[1, 1].pie([1, 2, 3])</span><br><span class="line">  axs[1, 2].imshow([[1, 2, 3], [4, 5, 6]])</span><br><span class="line">  </span><br><span class="line">  # 设置子图标题</span><br><span class="line">  axs[0, 0].set_title(&#x27;Line Chart&#x27;)</span><br><span class="line">  axs[0, 1].set_title(&#x27;Scatter Plot&#x27;)</span><br><span class="line">  axs[0, 2].set_title(&#x27;Bar Chart&#x27;)</span><br><span class="line">  axs[1, 0].set_title(&#x27;Histogram&#x27;)</span><br><span class="line">  axs[1, 1].set_title(&#x27;Pie Chart&#x27;)</span><br><span class="line">  axs[1, 2].set_title(&#x27;Image&#x27;)</span><br><span class="line">  </span><br><span class="line">  # 调整子图间距</span><br><span class="line">  plt.tight_layout()</span><br><span class="line">  </span><br><span class="line">  # 显示图形</span><br><span class="line">  plt.show()</span><br><span class="line">  </span><br></pre></td></tr></table></figure></li></ul><h2 id="1-7-注意事项"><a href="#1-7-注意事项" class="headerlink" title="1.7 注意事项"></a>1.7 注意事项</h2><blockquote><ol><li>数据的排序：折线图通常会按照数据的顺序连接数据点。确保你的数据点按照正确的顺序排列，以确保折线图的连续性和准确性。</li><li>坐标轴的刻度和范围：根据数据的取值范围和特点，选择适当的坐标轴刻度和范围。确保坐标轴刻度能够清晰地显示数据的趋势和变化。</li><li>折线的平滑性：默认情况下，折线图使用直线连接数据点。如果你希望折线图更加平滑，可以考虑使用曲线插值或平滑算法，如样条插值或移动平均。</li><li>多个折线的可区分性：如果你在同一张图中绘制多条折线，确保每条折线具有明显的区分度。可以通过使用不同的颜色、线型、标记样式等来区分不同的折线。</li><li>坐标轴标签和标题：记得为图表添加适当的坐标轴标签和标题，以便更好地说明和解释数据。标签应该清晰地描述坐标轴表示的数据内容。</li><li>数据的准确性和可视化的准确性：确保数据的准确性，并注意可视化的准确性。折线图应该准确地反映数据的趋势和变化，并且不应误导读者。</li><li>添加图例：如果你绘制了多条折线，添加图例可以帮助读者理解每条折线所代表的含义。图例可以说明每条折线对应的数据或变量，以及使用的颜色、线型等。</li></ol></blockquote><h2 id="1-8-实例"><a href="#1-8-实例" class="headerlink" title="1.8 实例"></a>1.8 实例</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">plt.rcParams[<span class="string">&#x27;font.sans-serif&#x27;</span>] = [<span class="string">&#x27;SimHei&#x27;</span>]</span><br><span class="line">plt.rcParams[<span class="string">&#x27;axes.unicode_minus&#x27;</span>]=<span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">x=[<span class="string">&#x27;1月&#x27;</span>,<span class="string">&#x27;2月&#x27;</span>,<span class="string">&#x27;3月&#x27;</span>,<span class="string">&#x27;4月&#x27;</span>,<span class="string">&#x27;5月&#x27;</span>,<span class="string">&#x27;6月&#x27;</span>,<span class="string">&#x27;7月&#x27;</span>,<span class="string">&#x27;8月&#x27;</span>,<span class="string">&#x27;9月&#x27;</span>,<span class="string">&#x27;10月&#x27;</span>,<span class="string">&#x27;11月&#x27;</span>,<span class="string">&#x27;12月&#x27;</span>]</span><br><span class="line">y1=[<span class="number">39</span>,<span class="number">20</span>,<span class="number">40</span>,<span class="number">38</span>,<span class="number">42</span>,<span class="number">43</span>,<span class="number">41</span>,<span class="number">41</span>,<span class="number">45</span>,<span class="number">48</span>,<span class="number">52</span>,<span class="number">50</span>]</span><br><span class="line">y2=[<span class="number">45</span>,<span class="number">28</span>,<span class="number">48</span>,<span class="number">49</span>,<span class="number">50</span>,<span class="number">50</span>,<span class="number">51</span>,<span class="number">52</span>,<span class="number">70</span>,<span class="number">65</span>,<span class="number">50</span>,<span class="number">51</span>]</span><br><span class="line">plt.ylabel(<span class="string">&#x27;业务量(亿件)&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;2018、2019年快递业务量&#x27;</span>)</span><br><span class="line">plt.plot(x,y1,label=<span class="string">&#x27;2018年业务量&#x27;</span>,color=<span class="string">&#x27;#8B0000&#x27;</span>,linewidth=<span class="number">2.0</span>,linestyle=<span class="string">&#x27;--&#x27;</span>,marker=<span class="string">&#x27;s&#x27;</span>)</span><br><span class="line">plt.plot(x,y2,label=<span class="string">&#x27;2019年业务量&#x27;</span>,color=<span class="string">&#x27;#006374&#x27;</span>,linewidth=<span class="number">1.5</span>,linestyle=<span class="string">&#x27;-&#x27;</span>,marker=<span class="string">&#x27;^&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(y1)):</span><br><span class="line">    plt.text(x[i], y1[i], <span class="string">f&#x27;<span class="subst">&#123;x[i]&#125;</span>,<span class="subst">&#123;y1[i]&#125;</span>&#x27;</span>,fontsize=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">plt.xlabel(<span class="string">&#x27;月份&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h1 id="2-散点图"><a href="#2-散点图" class="headerlink" title="2. 散点图"></a>2. 散点图</h1><h2 id="2-1-设置属性"><a href="#2-1-设置属性" class="headerlink" title="2.1 设置属性"></a>2.1 设置属性</h2><ul><li><code>c</code>：用于设置散点的颜色。可以传入单个颜色值（如 <code>&#39;red&#39;</code>、<code>&#39;blue&#39;</code>）、颜色的缩写代码（如 <code>&#39;r&#39;</code>、<code>&#39;b&#39;</code>）或者表示颜色的数字。你还可以传入一个列表或数组，根据数据的值来自动选择颜色。例如，可以使用 <code>c=&#39;red&#39;</code> 设置所有散点的颜色为红色。</li><li><code>marker</code>：用于设置散点的标记样式。可以传入标记名称或符号，如 <code>&#39;o&#39;</code> 表示圆形、<code>&#39;s&#39;</code> 表示方形、<code>&#39;^&#39;</code> 表示三角形等。默认值为 <code>&#39;o&#39;</code>，即圆形标记。</li><li><code>s</code>：用于设置散点的大小。可以传入一个标量值，表示散点的直径或面积。也可以传入一个与数据维度相同的列表或数组，根据数据的值来自动调整散点的大小。例如，可以使用 <code>s=30</code> 设置所有散点的大小为 30 个像素。</li><li><code>alpha</code>：用于设置散点的透明度。取值范围为 0 到 1，其中 0 表示完全透明，1 表示完全不透明。可以使用 <code>alpha=0.5</code> 设置散点的透明度为 0.5，即半透明状态。</li></ul><h2 id="2-2-实例"><a href="#2-2-实例" class="headerlink" title="2.2 实例"></a>2.2 实例</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例数据</span></span><br><span class="line">x = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">y = [<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制散点图</span></span><br><span class="line">plt.scatter(x, y, c=<span class="string">&#x27;red&#x27;</span>, marker=<span class="string">&#x27;o&#x27;</span>, s=<span class="number">50</span>, alpha=<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置图标题和坐标轴标签</span></span><br><span class="line">plt.title(<span class="string">&quot;🌂点图)</span></span><br><span class="line"><span class="string">plt.xlabel(&quot;</span>X<span class="string">&quot;)</span></span><br><span class="line"><span class="string">plt.ylabel(&quot;</span>Y<span class="string">&quot;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 显示图形</span></span><br><span class="line"><span class="string">plt.show()</span></span><br></pre></td></tr></table></figure><h2 id="2-3-添加标签"><a href="#2-3-添加标签" class="headerlink" title="2.3 添加标签"></a>2.3 添加标签</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.text(x, y, text, **kwargs)</span><br></pre></td></tr></table></figure><p>参数说明：</p><ul><li><code>x</code>：文本标签的 x 坐标位置。</li><li><code>y</code>：文本标签的 y 坐标位置。</li><li><code>text</code>：要显示的文本内容。</li><li><code>**kwargs</code>：可选的关键字参数，用于设置文本样式、颜色、字体大小等。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">plt.rcParams[<span class="string">&#x27;font.sans-serif&#x27;</span>] = [<span class="string">&#x27;SimHei&#x27;</span>]</span><br><span class="line">plt.rcParams[<span class="string">&#x27;axes.unicode_minus&#x27;</span>]=<span class="literal">False</span></span><br><span class="line"></span><br><span class="line">x = np.random.randn(<span class="number">100</span>)</span><br><span class="line">y = np.random.randn(<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">plt.scatter(x,y,color=<span class="string">&#x27;blue&#x27;</span>)</span><br><span class="line">plt.xlabel(<span class="string">&quot;这是x轴&quot;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&quot;这是y轴&quot;</span>)</span><br><span class="line">plt.title(<span class="string">&quot;🌂点图&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加文本标签</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(y)):</span><br><span class="line">    plt.text(x[i], y[i], <span class="string">f&#x27;<span class="subst">&#123;x[i]&#125;</span>,<span class="subst">&#123;y[i]&#125;</span>&#x27;</span>,fontsize=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2-4-注意事项"><a href="#2-4-注意事项" class="headerlink" title="2.4 注意事项"></a>2.4 注意事项</h2><blockquote><ol><li>数据格式：散点图的数据可以是一维或二维的。如果只有一个数据序列，那么散点图将在 x 轴上绘制，y 轴上的值将被自动生成。如果有两个数据序列，那么第一个序列将被用作 x 值，第二个序列将被用作 y 值。</li><li>数据点的位置：散点图的数据点的位置是由 x 和 y 值确定的。确保提供正确的数据以获得预期的图形。</li><li>数据尺度：如果 x 和 y 的值具有不同的尺度，可能需要对数据进行归一化或缩放，以确保数据点在图形上以适当的比例显示。</li><li>图例：如果有多个数据序列，可以使用图例来标识每个序列对应的含义。可以使用 <code>plt.legend()</code> 函数创建图例，并通过设置 <code>label</code> 参数来指定每个数据序列的标签。</li><li>坐标轴范围：根据需要，可以使用 <code>plt.xlim()</code> 和 <code>plt.ylim()</code> 函数设置 x 和 y 轴的显示范围。这可以帮助更好地突出数据的变化。</li><li>数据标签：如果希望在散点图中显示每个数据点的具体数值，可以考虑添加数据标签。可以使用 <code>plt.text()</code> 函数在指定位置添加文本标签。</li><li>数据分组：如果要在散点图中显示多个数据组，并且希望为每个数据组使用不同的颜色、标记样式等，可以考虑使用循环或条件语句来逐个绘制每个数据组的散点图，或者使用 pandas 库进行数据分组和可视化。</li><li>颜色映射：如果有一个额外的数值序列，可以使用颜色映射来将数据点的颜色与该数值关联起来。可以使用 <code>c</code> 参数传入数值序列，并设置 <code>cmap</code> 参数来选择合适的颜色映射。</li></ol></blockquote><h1 id="3-条形图"><a href="#3-条形图" class="headerlink" title="3.条形图"></a>3.条形图</h1><h2 id="3-1-属性设置"><a href="#3-1-属性设置" class="headerlink" title="3.1 属性设置"></a>3.1 属性设置</h2><p><code>color</code> 参数设置条形的颜色</p><p><code>width</code> 参数设置条形的宽度。默认值为 <code>0.8</code></p><p><code>edgecolor</code> 和 <code>linewidth</code> 参数设置条形的边框颜色和宽度</p><p><code>alpha</code> 参数设置条形的透明度，取值范围为 <code>0.0</code> 到 <code>1.0</code></p><p><code>plt.text()</code> 函数在条形上方添加标签。可以指定标签的位置、内容和样式</p><p><code>label</code> 是用于标识每个条形的标签，需要有<code>plt.legend()</code>才能显示</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.bar(categories, values,label=<span class="string">&#x27;2018年业务量&#x27;</span>, color=<span class="string">&#x27;blue&#x27;</span>, width=<span class="number">0.5</span>, edgecolor=<span class="string">&#x27;black&#x27;</span>, linewidth=<span class="number">1</span>, alpha=<span class="number">0.5</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">enumerate</span>(values):</span><br><span class="line">    plt.text(i, v, <span class="built_in">str</span>(v), ha=<span class="string">&#x27;center&#x27;</span>, va=<span class="string">&#x27;bottom&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="3-2-实例"><a href="#3-2-实例" class="headerlink" title="3.2 实例"></a>3.2 实例</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">plt.rcParams[<span class="string">&#x27;font.sans-serif&#x27;</span>] = [<span class="string">&#x27;SimHei&#x27;</span>]</span><br><span class="line">plt.rcParams[<span class="string">&#x27;axes.unicode_minus&#x27;</span>] = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">categories = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>]</span><br><span class="line">values = [<span class="number">10</span>, <span class="number">23</span>, <span class="number">15</span>, <span class="number">27</span>]</span><br><span class="line"></span><br><span class="line">plt.bar(categories, values,label=<span class="string">&#x27;2018年业务量&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">plt.xlabel(<span class="string">&#x27;Category&#x27;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;Value&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Bar Chart&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(categories)):</span><br><span class="line">    plt.text(categories[i],values[i],<span class="string">f&#x27;<span class="subst">&#123;categories[i]&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line">plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3-3-注意事项"><a href="#3-3-注意事项" class="headerlink" title="3.3 注意事项"></a>3.3 注意事项</h2><blockquote><ol><li>条形的宽度：条形图中每个条形的宽度默认是相等的，但你可以通过调整 <code>width</code> 参数来修改它们的宽度。较宽的条形可能会使图表显得混乱，因此要注意选择合适的宽度。</li><li>条形的对齐方式：条形图中条形的默认对齐方式是居中对齐，即条形在给定的位置上水平居中显示。你也可以通过设置 <code>align</code> 参数来改变对齐方式，包括 ‘center’（默认）、’edge’、’start’ 等。</li><li>条形的排序：在某些情况下，你可能希望对条形进行排序，例如按照某个属性或值的大小进行排序。你可以使用排序函数（如 <code>sorted()</code>）对数据进行排序，然后再绘制条形图。</li><li>条形的颜色：你可以通过设置 <code>color</code> 参数来为条形指定颜色。可以使用预定义的颜色名称（如 ‘red’、’blue’、’green’ 等），也可以使用十六进制颜色码或 RGB 值来自定义颜色。</li><li>条形的标签：可以通过使用 <code>plt.text()</code> 函数在每个条形上添加文本标签，显示每个条形的具体数值或其他相关信息。</li><li>坐标轴标签和标题：记得为图表添加适当的坐标轴标签和标题，以便更好地说明和解释数据。</li><li>数据的准确性和可视化的准确性：在绘制条形图时，要确保数据的准确性，并注意可视化的准确性。条形图应该准确地反映数据的大小关系，并且不应误导读者。</li></ol></blockquote><h1 id="4-直方图"><a href="#4-直方图" class="headerlink" title="4.直方图"></a>4.直方图</h1><h2 id="4-1-设置属性"><a href="#4-1-设置属性" class="headerlink" title="4.1 设置属性"></a>4.1 设置属性</h2><ul><li><code>bins</code>: 指定直方图的区间数量或划分方式。<ul><li><code>bins=&#39;auto&#39;</code>：自动选择合适的区间数量和划分方式。</li><li><code>bins=&#39;sturges&#39;</code>：使用<code>Sturges</code>公式确定区间数量。</li><li><code>bins=&#39;fd&#39;</code>：使用<code>Freedman-Diaconis</code>准则确定区间数量。</li><li><code>bins=array</code>：传递一个数组来指定每个区间的边界值。</li></ul></li><li><code>range</code>: 指定直方图的数据范围。</li><li><code>density</code>: 设置是否对直方图进行归一化，即将频数转换为频率。</li><li><code>color</code>: 设置直方图的填充颜色。</li><li><code>edgecolor</code>: 设置直方图边缘线的颜色。</li><li><code>alpha</code>: 设置直方图的透明度。</li><li><code>histtype</code>: 设置直方图的类型，如’bar’表示普通直方图，’step’表示阶梯状直方图。</li><li><code>align</code>: 设置直方图的对齐方式，如’left’表示左对齐，’mid’表示居中对齐。</li><li><code>orientation</code>: 设置直方图的方向，如’vertical’表示垂直方向，’horizontal’表示水平方向。</li><li><code>label</code>: 设置直方图的标签，用于图例显示。</li></ul><h2 id="4-2-实例"><a href="#4-2-实例" class="headerlink" title="4.2 实例"></a>4.2 实例</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">plt.rcParams[<span class="string">&#x27;font.sans-serif&#x27;</span>] = [<span class="string">&#x27;SimHei&#x27;</span>]</span><br><span class="line">plt.rcParams[<span class="string">&#x27;axes.unicode_minus&#x27;</span>] = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 准备数据</span></span><br><span class="line">data = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">9</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制直方图</span></span><br><span class="line">plt.hist(data, bins=<span class="number">10</span>, color=<span class="string">&#x27;skyblue&#x27;</span>, edgecolor=<span class="string">&#x27;black&#x27;</span>, alpha=<span class="number">0.8</span>, histtype=<span class="string">&#x27;bar&#x27;</span>, align=<span class="string">&#x27;mid&#x27;</span>, orientation=<span class="string">&#x27;horizontal&#x27;</span>, label=<span class="string">&#x27;Histogram&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加标签和标题</span></span><br><span class="line">plt.xlabel(<span class="string">&#x27;X轴标签&#x27;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;Y轴标签&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;直方图&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示图形</span></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h2 id="4-3-注意事项"><a href="#4-3-注意事项" class="headerlink" title="4.3 注意事项"></a>4.3 注意事项</h2><blockquote><ol><li>数据的合理分组：直方图的可解释性和有效性取决于数据的分组方式。选择合适的区间数量和划分方式是关键。不恰当的分组可能导致信息损失或误导。</li><li>数据的准备和处理：在绘制直方图之前，需要对数据进行适当的准备和处理。这可能包括数据清洗、缺失值处理和数据转换等步骤，以确保直方图能够准确地反映数据的分布情况。</li><li>柱形的宽度和间隔：柱形的宽度和间隔也需要适当设置，以便展示数据的分布特征。过宽或过窄的柱形可能使数据的分布不够清晰或容易产生误解。</li><li>坐标轴的标签和标题：确保直方图的坐标轴具有清晰的标签，以便读者能够理解数据的含义。此外，添加一个有意义的标题可以更好地说明直方图的主题或目的。</li><li>可视化效果的调整：根据需要，可以调整直方图的颜色、透明度、边框样式等可视化效果，以使直方图更具吸引力和易读性。</li><li>数据量的考虑：当数据量较大时，直方图可能会变得密集且难以解读。可以通过调整柱形宽度、使用分组的方式或通过其他图表类型来更好地展示大数据集的分布。</li></ol></blockquote><h1 id="5-饼图"><a href="#5-饼图" class="headerlink" title="5.饼图"></a>5.饼图</h1><h2 id="5-1-设置属性"><a href="#5-1-设置属性" class="headerlink" title="5.1 设置属性"></a>5.1 设置属性</h2><ol><li><p><code>labels</code>：设置饼图每个部分的标签。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">labels = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>]</span><br><span class="line">plt.pie(sizes, labels=labels)</span><br></pre></td></tr></table></figure></li><li><p><code>colors</code>：设置饼图每个部分的颜色。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">colors = [<span class="string">&#x27;red&#x27;</span>, <span class="string">&#x27;blue&#x27;</span>, <span class="string">&#x27;green&#x27;</span>, <span class="string">&#x27;yellow&#x27;</span>]</span><br><span class="line">plt.pie(sizes, labels=labels, colors=colors)</span><br></pre></td></tr></table></figure></li><li><p><code>autopct</code>：设置饼图每个部分的显示格式，通常用于显示百分比。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.pie(sizes, labels=labels, autopct=<span class="string">&#x27;%1.1f%%&#x27;</span>)</span><br></pre></td></tr></table></figure></li><li><p><code>explode</code>：设置饼图中某个部分的偏移量，用于突出显示。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">codeexplode = [<span class="number">0</span>, <span class="number">0.1</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">plt.pie(sizes, labels=labels, explode=explode)</span><br></pre></td></tr></table></figure></li><li><p><code>startangle</code>：设置饼图的起始角度，可以调整饼图的旋转位置。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.pie(sizes, labels=labels, startangle=<span class="number">90</span>)</span><br></pre></td></tr></table></figure></li><li><p><code>shadow</code>：设置是否显示饼图的阴影效果。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.pie(sizes, labels=labels, shadow=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure></li><li><p><code>radius</code>：设置饼图的半径大小。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plt.pie(sizes, labels=labels, radius=<span class="number">0.8</span>)</span><br></pre></td></tr></table></figure></li><li><p><code>wedgeprops</code>：设置饼图每个部分的属性，例如边框颜色、边框宽度等。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wedgeprops = &#123;<span class="string">&#x27;linewidth&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;edgecolor&#x27;</span>: <span class="string">&#x27;black&#x27;</span>&#125;</span><br><span class="line">plt.pie(sizes, labels=labels, wedgeprops=wedgeprops)</span><br></pre></td></tr></table></figure></li></ol><h2 id="5-2-实例"><a href="#5-2-实例" class="headerlink" title="5.2 实例"></a>5.2 实例</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">x=[<span class="string">&#x27;童装&#x27;</span>,<span class="string">&#x27;奶粉辅食&#x27;</span>,<span class="string">&#x27;孕妈专区&#x27;</span>,<span class="string">&#x27;洗护喂养&#x27;</span>,<span class="string">&#x27;宝宝尿裤&#x27;</span>,<span class="string">&#x27;春夏新品&#x27;</span>,<span class="string">&#x27;童车童床&#x27;</span>,<span class="string">&#x27;玩具文娱&#x27;</span>,<span class="string">&#x27;童鞋&#x27;</span>]</span><br><span class="line">y=[<span class="number">29665</span>,<span class="number">3135.4</span>,<span class="number">4292.4</span>,<span class="number">5240.9</span>,<span class="number">5543.4</span>,<span class="number">5633.8</span>,<span class="number">6414.5</span>,<span class="number">9308.1</span>,<span class="number">10353</span>]</span><br><span class="line">plt.pie(y,labels=x,autopct=<span class="string">&#x27;%.1f%%&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;拼多多平台子类目的销售额&#x27;</span>)</span><br><span class="line">plt.legend(x, ncol=<span class="number">2</span>,bbox_to_anchor=(<span class="number">1.1</span>,<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加表格</span></span><br><span class="line">columns = [<span class="string">&#x27;子类目&#x27;</span>, <span class="string">&#x27;销售额&#x27;</span>]</span><br><span class="line">cell_text = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x)):</span><br><span class="line">    cell_text.append([x[i], y[i]])</span><br><span class="line">plt.table(cellText=cell_text, colLabels=columns, loc=<span class="string">&#x27;bottom&#x27;</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h2 id="5-3-注意事项"><a href="#5-3-注意事项" class="headerlink" title="5.3 注意事项"></a>5.3 注意事项</h2><blockquote><ol><li>饼图的数据应该是各个部分的数值或占比，确保数据的正确性和一致性。</li><li>饼图的部分数值或占比应该是非负数，否则可能导致绘制错误。</li><li>饼图的部分数值或占比应该总和为100%，以确保整个饼图代表完整的数据。</li><li>如果饼图的部分数值非常小，可能会导致饼图中的文本重叠或不可读。可以考虑使用<code>autopct</code>属性来显示百分比，并设置合适的格式。</li><li>在绘制饼图时，可以使用<code>explode</code>属性将某个部分偏移，以突出显示。</li><li>可以使用<code>startangle</code>属性调整饼图的起始角度，以更好地展示数据。</li><li>饼图可以添加标题和图例，以增加可读性和理解性。</li><li>可以根据需要自定义饼图的颜色、边框等属性，以使其更符合需求。</li><li>饼图适合用于显示相对比例，但不适合用于比较绝对数值的大小。在需要比较数据的大小时，可以考虑使用其他类型的图表。</li></ol></blockquote><h1 id="6-箱线图"><a href="#6-箱线图" class="headerlink" title="6.箱线图"></a>6.箱线图</h1><h2 id="6-1-设置属性"><a href="#6-1-设置属性" class="headerlink" title="6.1 设置属性"></a>6.1 设置属性</h2><ul><li><code>x</code>: 指定要绘制箱线图的数据，可以是单个列表或数组，或多个列表或数组组成的列表。</li><li><code>labels</code>: 指定每个数据集的标签，用于在图例中显示。</li><li><code>notch</code>: 控制箱线图的缺口效果，默认为False，表示传统的箱线图，True表示绘制缺口箱线图。</li><li><code>sym</code>: 指定异常值的标记符号，默认为’+’。</li><li><code>vert</code>: 控制箱线图的方向，默认为True，表示垂直方向绘制箱线图，False表示水平方向绘制。</li><li><code>patch_artist</code>: 控制是否给箱线图添加颜色填充，默认为False。</li><li><code>widths</code>: 指定箱线图的宽度。</li><li><code>whis</code>: 指定箱线图的边界范围，默认为1.5，表示上下边界分别为上四分位数加1.5倍的四分位距和下四分位数减1.5倍的四分位距。</li><li><code>showfliers</code>: 控制是否显示异常值，默认为True，显示异常值。</li><li><code>meanline</code>: 控制是否绘制均值线，默认为False。</li><li><code>meanprops</code>: 用于设置均值线的属性，如颜色、线型等。</li><li><code>medianprops</code>: 用于设置中位数线的属性。</li><li><code>boxprops</code>: 用于设置箱体的属性。</li><li><code>whiskerprops</code>: 用于设置须线的属性。</li><li><code>capprops</code>: 用于设置边界线的属性。</li></ul><p>这些属性可以根据需要进行设置，以满足绘制箱线图的需求。可以通过传递字典或关键字参数的方式来设置这些属性，例如<code>boxplot(data, patch_artist=True, boxprops=&#123;&#39;facecolor&#39;: &#39;red&#39;&#125;)</code>。</p><p>此外，还可以使用<code>plt.xticks()</code>和<code>plt.yticks()</code>等函数设置刻度标签，使用<code>plt.title()</code>设置标题，使用<code>plt.xlabel()</code>和<code>plt.ylabel()</code>设置轴标签等来进一步美化和定制箱线图。</p><h2 id="6-2-实例"><a href="#6-2-实例" class="headerlink" title="6.2 实例"></a>6.2 实例</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成示例数据</span></span><br><span class="line">data = [np.random.normal(<span class="number">0</span>, std, <span class="number">100</span>) <span class="keyword">for</span> std <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">5</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建图形对象和坐标系</span></span><br><span class="line">fig, ax = plt.subplots()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制箱线图</span></span><br><span class="line">boxplot = ax.boxplot(data, patch_artist=<span class="literal">True</span>, notch=<span class="literal">True</span>, sym=<span class="string">&#x27;rx&#x27;</span>, widths=<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置箱体颜色</span></span><br><span class="line">colors = [<span class="string">&#x27;lightblue&#x27;</span>, <span class="string">&#x27;lightgreen&#x27;</span>, <span class="string">&#x27;lightyellow&#x27;</span>, <span class="string">&#x27;lightpink&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> patch, color <span class="keyword">in</span> <span class="built_in">zip</span>(boxplot[<span class="string">&#x27;boxes&#x27;</span>], colors):</span><br><span class="line">    patch.set_facecolor(color)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置中位数线的颜色和线型</span></span><br><span class="line">boxplot[<span class="string">&#x27;medians&#x27;</span>][<span class="number">0</span>].<span class="built_in">set</span>(color=<span class="string">&#x27;red&#x27;</span>, linestyle=<span class="string">&#x27;--&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置须线和边界线的颜色和线型</span></span><br><span class="line"><span class="keyword">for</span> whisker, cap <span class="keyword">in</span> <span class="built_in">zip</span>(boxplot[<span class="string">&#x27;whiskers&#x27;</span>], boxplot[<span class="string">&#x27;caps&#x27;</span>]):</span><br><span class="line">    whisker.<span class="built_in">set</span>(color=<span class="string">&#x27;black&#x27;</span>, linestyle=<span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">    cap.<span class="built_in">set</span>(color=<span class="string">&#x27;black&#x27;</span>, linestyle=<span class="string">&#x27;-&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置异常值的标记符号和颜色</span></span><br><span class="line">boxplot[<span class="string">&#x27;fliers&#x27;</span>][<span class="number">0</span>].<span class="built_in">set</span>(marker=<span class="string">&#x27;o&#x27;</span>, markerfacecolor=<span class="string">&#x27;red&#x27;</span>, markersize=<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置坐标轴标签和标题</span></span><br><span class="line">ax.set_xlabel(<span class="string">&#x27;Data&#x27;</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">&#x27;Values&#x27;</span>)</span><br><span class="line">ax.set_title(<span class="string">&#x27;Box Plot&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示图形</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="6-3-注意事项"><a href="#6-3-注意事项" class="headerlink" title="6.3 注意事项"></a>6.3 注意事项</h2><blockquote><ol><li>数据的准备：箱线图适用于展示多个数据集的统计特征，因此需要准备多个数据集。确保数据集之间的含义和维度相同，以便进行比较。</li><li>异常值处理：箱线图可以显示异常值，可以考虑在图中标记异常值或选择不显示异常值。根据数据的特点和分析目的，决定如何处理异常值。</li><li>箱体颜色和填充：通过<code>patch_artist=True</code>参数，可以使箱体具有颜色和填充效果。可以选择不同的颜色和填充样式来区分不同的数据集或表示特定的含义。</li><li>线条样式和颜色：可以通过<code>set</code>方法设置中位数线、须线、边界线的样式和颜色。选择适当的线型、线宽和颜色以增强可视化效果。</li><li>标记符号和颜色：对于异常值，可以选择不同的标记符号和颜色来突出显示。这样可以使异常值在图中更加显眼。</li><li>坐标轴标签和标题：为了更好地解释和说明箱线图，应该添加适当的坐标轴标签和标题。这样可以让读者明确图中所展示的数据和含义。</li><li>数据解读和分析：绘制箱线图不仅仅是为了展示数据，还要对数据进行解读和分析。要注意理解箱线图的含义，包括中位数、四分位数、须线等，以便正确地解读图表。</li><li>上下文和目标受众：绘制箱线图时，要考虑上下文和目标受众。选择合适的图表样式、颜色和注释，以便让观众更容易理解和解读图表。</li></ol></blockquote><h1 id="7-热力图"><a href="#7-热力图" class="headerlink" title="7.热力图"></a>7.热力图</h1><h2 id="7-1-设置属性"><a href="#7-1-设置属性" class="headerlink" title="7.1 设置属性"></a>7.1 设置属性</h2><ol><li><code>cmap</code>：指定颜色映射方案，即用于映射数值到颜色的颜色表。常见的选项包括 <code>&#39;hot&#39;</code>、<code>&#39;cool&#39;</code>、<code>&#39;viridis&#39;</code> 等。你可以根据需求选择适合的颜色映射方案。</li><li><code>vmin</code> 和 <code>vmax</code>：用于设置颜色映射的数值范围。可以通过指定这两个参数来调整颜色映射的动态范围，使得图像更加突出或者对比度更高。</li><li><code>interpolation</code>：用于指定插值方法，即确定图像中每个像素值的颜色。常见的选项有 <code>&#39;nearest&#39;</code>、<code>&#39;bilinear&#39;</code>、<code>&#39;bicubic&#39;</code> 等。你可以根据需要选择合适的插值方法。</li><li><code>aspect</code>：用于设置图像的纵横比。可以使用 <code>&#39;auto&#39;</code> 或者一个具体的数值来调整图像的宽高比。</li><li><code>alpha</code>：设置图像的透明度。可以使用一个范围在0到1之间的数值来指定透明度级别。</li><li><code>colorbar</code>：添加颜色标尺。可以使用 <code>colorbar</code> 函数自动添加颜色标尺，并设置相关的标签。</li></ol><h2 id="7-2-实例"><a href="#7-2-实例" class="headerlink" title="7.2 实例"></a>7.2 实例</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成示例数据</span></span><br><span class="line">data = np.random.rand(<span class="number">10</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制热力图</span></span><br><span class="line">plt.imshow(data, cmap=<span class="string">&#x27;cool&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加颜色标尺</span></span><br><span class="line">plt.colorbar()</span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示图形</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="7-3-注意事项"><a href="#7-3-注意事项" class="headerlink" title="7.3 注意事项"></a>7.3 注意事项</h2><blockquote><ol><li>数据格式：热力图通常用于展示二维数据的颜色分布情况，因此要确保你的数据是二维数组或矩阵的形式。</li><li>数据处理：根据数据的特点和需求，你可能需要对数据进行预处理，例如进行归一化、去除异常值或处理缺失值等操作，以确保热力图的结果更加准确和可解释。</li><li>色彩映射：选择合适的颜色映射方案对于热力图的可读性很重要。确保所选的颜色映射能够清晰地展示数据的变化趋势，避免使用过于饱和或不明显的颜色。</li><li>数据范围：根据数据的实际情况，设置合适的数据范围，以确保颜色映射能够充分显示数据的变化。可以使用 <code>vmin</code> 和 <code>vmax</code> 参数来调整颜色映射的数值范围。</li><li>插值方法：选择适当的插值方法可以影响热力图的平滑程度和细节展示。根据数据的稀疏程度和需求，选择合适的插值方法，例如最近邻插值、双线性插值或双立方插值等。</li><li>标签和标题：为热力图添加标签和标题可以提供更好的解读和可视化效果。确保标签和标题清晰、简洁，并能准确传达数据的含义。</li><li>色彩条和注释：添加色彩条可以帮助读者理解热力图的颜色对应关系。此外，对于特定的热力图，你可能需要添加注释或额外的标记来解释图中的特殊区域或值。</li><li>图像尺寸和布局：根据热力图的内容和展示需求，调整图像的尺寸和布局，以确保信息清晰可见，并适应展示平台的要求。</li></ol></blockquote><h1 id="8-3D图"><a href="#8-3D图" class="headerlink" title="8. 3D图"></a>8. 3D图</h1><h2 id="8-1设置属性"><a href="#8-1设置属性" class="headerlink" title="8.1设置属性"></a>8.1设置属性</h2><ol><li>坐标轴范围：可以使用<code>set_xlim()</code>, <code>set_ylim()</code>, <code>set_zlim()</code>方法来设置X、Y、Z轴的范围。</li><li>坐标轴标签：使用<code>set_xlabel()</code>, <code>set_ylabel()</code>, <code>set_zlabel()</code>方法来设置X、Y、Z轴的标签。</li><li>图形标题：使用<code>set_title()</code>方法设置图形的标题。</li><li>颜色映射：可以使用<code>colormap</code>参数来设置颜色映射，常用的颜色映射有<code>viridis</code>、<code>plasma</code>、<code>coolwarm</code>等。</li><li>图形样式：可以设置散点的大小、颜色、透明度等属性来调整图形的样式。</li><li>视角调整：可以使用<code>view_init(elev, azim)</code>方法来设置视角的方位角和仰角。</li><li>网格线：可以使用<code>grid()</code>方法来显示或隐藏网格线。</li><li>光照效果：可以使用<code>lightsource</code>类来调整光照效果，以改变3D图形的阴影和明暗度。</li><li>图例：可以使用<code>legend()</code>方法添加图例，说明不同的数据或图形含义。</li></ol><h2 id="8-2-实例"><a href="#8-2-实例" class="headerlink" title="8.2 实例"></a>8.2 实例</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> mpl_toolkits.mplot3d <span class="keyword">import</span> Axes3D</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建数据</span></span><br><span class="line">x = np.linspace(-<span class="number">5</span>, <span class="number">5</span>, <span class="number">100</span>)</span><br><span class="line">y = np.linspace(-<span class="number">5</span>, <span class="number">5</span>, <span class="number">100</span>)</span><br><span class="line">X, Y = np.meshgrid(x, y)</span><br><span class="line">Z = np.sin(np.sqrt(X**<span class="number">2</span> + Y**<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建图形对象和坐标系</span></span><br><span class="line">fig = plt.figure()</span><br><span class="line">ax = fig.add_subplot(<span class="number">111</span>, projection=<span class="string">&#x27;3d&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制3D图形</span></span><br><span class="line">ax.plot_surface(X, Y, Z, cmap=<span class="string">&#x27;viridis&#x27;</span>, linewidth=<span class="number">0</span>, antialiased=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置坐标轴范围</span></span><br><span class="line">ax.set_xlim(-<span class="number">5</span>, <span class="number">5</span>)</span><br><span class="line">ax.set_ylim(-<span class="number">5</span>, <span class="number">5</span>)</span><br><span class="line">ax.set_zlim(-<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置坐标轴标签</span></span><br><span class="line">ax.set_xlabel(<span class="string">&#x27;X&#x27;</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">&#x27;Y&#x27;</span>)</span><br><span class="line">ax.set_zlabel(<span class="string">&#x27;Z&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置图形标题</span></span><br><span class="line">ax.set_title(<span class="string">&#x27;3D Surface Plot&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置视角</span></span><br><span class="line">ax.view_init(elev=<span class="number">30</span>, azim=<span class="number">45</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示图形</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="8-3-注意事项"><a href="#8-3-注意事项" class="headerlink" title="8.3 注意事项"></a>8.3 注意事项</h2><blockquote><ol><li>数据准备：确保你有正确的数据集来绘制3D图形。通常情况下，你需要一个三维的数据集，包含X、Y和Z轴上的数值。</li><li>坐标系选择：使用<code>projection=&#39;3d&#39;</code>参数创建一个3D坐标系对象，例如<code>ax = fig.add_subplot(111, projection=&#39;3d&#39;)</code>。</li><li>绘制方法：使用适合的方法来绘制3D图形。例如，你可以使用<code>plot_surface()</code>方法来绘制表面图，使用<code>plot_wireframe()</code>方法来绘制线框图，使用<code>scatter()</code>方法来绘制散点图等。</li><li>坐标轴设置：根据你的数据范围来设置坐标轴的刻度和范围，以确保数据适当地显示在图形中。使用<code>set_xlim()</code>、<code>set_ylim()</code>和<code>set_zlim()</code>方法设置各个轴的范围。</li><li>坐标轴标签和标题：使用<code>set_xlabel()</code>、<code>set_ylabel()</code>和<code>set_zlabel()</code>方法设置各个轴的标签，使用<code>set_title()</code>方法设置图形的标题。</li><li>视角调整：使用<code>view_init()</code>方法来调整视角，通过设置<code>elev</code>参数和<code>azim</code>参数来改变观察者的仰角和方位角。</li><li>其他属性设置：根据需要，你还可以设置其他属性，如颜色映射、线宽、透明度等，以获得更好的可视化效果。</li><li>图形显示：最后，使用<code>plt.show()</code>来显示绘制的图形。</li></ol><p>注意：在使用<code>Matplotlib</code>绘制<code>3D</code>图形时，你需要确保已经安装了<code>mpl_toolkits.mplot3d</code>模块。可以通过<code>from mpl_toolkits.mplot3d import Axes3D</code>导入该模块。</p></blockquote><h1 id="9-柱状图"><a href="#9-柱状图" class="headerlink" title="9.柱状图"></a>9.<strong>柱状图</strong></h1><h2 id="9-1设置属性"><a href="#9-1设置属性" class="headerlink" title="9.1设置属性"></a>9.1设置属性</h2><ol><li>颜色：可以使用<code>color</code>参数设置柱状图的颜色，可以是单个颜色值或颜色列表。</li><li>宽度：可以使用<code>width</code>参数设置柱状图的宽度，默认为0.8。</li><li>边缘颜色和线型：可以使用<code>edgecolor</code>参数设置柱状图的边缘颜色，使用<code>linewidth</code>参数设置边缘线的宽度。</li><li>透明度：可以使用<code>alpha</code>参数设置柱状图的透明度，取值范围为0到1之间。</li><li>标签：可以使用<code>label</code>参数为柱状图添加标签，用于图例显示。</li><li>柱状图排列方式：可以使用<code>align</code>参数设置柱状图的排列方式，常见的取值有’center’（居中对齐，默认值）、’edge’（边缘对齐）等。</li><li>边缘线样式：可以使用<code>linestyle</code>参数设置柱状图边缘线的样式，常见的取值有’-‘（实线，默认值）、’—‘（虚线）等。</li></ol><p>这些属性可以在绘制柱状图时通过传递参数进行设置，例如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pythonCopy code</span><br><span class="line">ax.bar(x, y, color=<span class="string">&#x27;blue&#x27;</span>, width=<span class="number">0.5</span>, edgecolor=<span class="string">&#x27;black&#x27;</span>, linew</span><br></pre></td></tr></table></figure><h2 id="9-2-实例"><a href="#9-2-实例" class="headerlink" title="9.2 实例"></a>9.2 实例</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">x = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]  <span class="comment"># 柱状图的x轴坐标</span></span><br><span class="line">y = [<span class="number">10</span>, <span class="number">24</span>, <span class="number">36</span>, <span class="number">40</span>, <span class="number">5</span>]  <span class="comment"># 柱状图的高度值</span></span><br><span class="line"></span><br><span class="line">fig, ax = plt.subplots()</span><br><span class="line">ax.bar(x, y)</span><br><span class="line">ax.set_xlabel(<span class="string">&#x27;X轴标签&#x27;</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">&#x27;Y轴标签&#x27;</span>)</span><br><span class="line">ax.set_title(<span class="string">&#x27;柱状图&#x27;</span>)</span><br><span class="line">ax.set_xticks(x)  <span class="comment"># 设置x轴刻度标签</span></span><br><span class="line">ax.set_xticklabels([<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>])  <span class="comment"># 设置x轴刻度标签的名称</span></span><br><span class="line">plt.show()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="9-3-注意事项"><a href="#9-3-注意事项" class="headerlink" title="9.3 注意事项"></a>9.3 注意事项</h2><blockquote><ol><li>数据的准备：确保你有正确的数据集用于绘制柱状图。通常，柱状图需要提供每个柱子的高度或值。确保数据的准确性和一致性。</li><li>选择合适的柱状图类型：柱状图有多种类型，如垂直柱状图、水平柱状图、堆叠柱状图等。根据你的数据和展示需求，选择合适的柱状图类型。</li><li>坐标轴设置：柱状图通常需要设置合适的坐标轴刻度和标签，确保数据在可视化中能够准确显示。</li><li>柱状图的宽度和间距：柱状图的宽度和间距可以影响可视化效果和数据的解读。根据数据量和展示需求，调整柱状图的宽度和间距，使得柱子之间有合适的间隔和对比。</li><li>添加标签和图例：柱状图中的柱子可以添加标签，用于表示具体的数据值或类别信息。同时，为了解释柱状图中的不同组或不同颜色的柱子，可以添加图例，使得读者能够更好地理解图表含义。</li><li>避免信息重叠：当柱状图中的柱子数量较多或数据值较接近时，要注意避免柱子之间的信息重叠。可以考虑调整柱状图的宽度、间距或旋转柱子标签等方式，以确保数据的清晰可见性。</li><li>注意数据的排序：根据展示需求，可能需要对柱状图中的数据进行排序。确保数据按照适当的顺序排列，以便更好地传达信息。</li></ol></blockquote>]]></content>
      
      
      <categories>
          
          <category> 大数据 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 三剑客 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python数据分析</title>
      <link href="/2023/06/06/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/"/>
      <url>/2023/06/06/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>这个笔记我打算专门用来记录我在数据分析以及数据预处理遇到的知识点</p><h1 id="iloc与loc"><a href="#iloc与loc" class="headerlink" title="iloc与loc"></a>iloc与loc</h1><p>loc和iloc都是pandas工具中定位某一行的函数，loc是location的意思，而iloc中的 i 指的是Integer，二者的区别如下：</p><ul><li>loc：通过行标签名称索引行数据</li><li>iloc：通过行号索引行数据</li></ul><h2 id="示例数据"><a href="#示例数据" class="headerlink" title="示例数据"></a>示例数据</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">data=DataFrame(np.arange(<span class="number">16</span>).reshape(<span class="number">4</span>,<span class="number">4</span>),index=<span class="built_in">list</span>(<span class="string">&quot;ABCD&quot;</span>),columns=<span class="built_in">list</span>(<span class="string">&quot;wxyz&quot;</span>))</span><br><span class="line"><span class="built_in">print</span>(data)</span><br></pre></td></tr></table></figure><p>输出如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    w   x   y   z</span><br><span class="line">A   0   1   2   3</span><br><span class="line">B   4   5   6   7</span><br><span class="line">C   8   9  10  11</span><br><span class="line">D  12  13  14  15</span><br></pre></td></tr></table></figure><h2 id="loc用法"><a href="#loc用法" class="headerlink" title="loc用法"></a>loc用法</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(data.loc[<span class="string">&quot;A&quot;</span>])</span><br><span class="line"><span class="comment">#w    0</span></span><br><span class="line"><span class="comment">#x    1</span></span><br><span class="line"><span class="comment">#y    2</span></span><br><span class="line"><span class="comment">#z    3</span></span><br><span class="line"><span class="built_in">print</span>(data.loc[[<span class="string">&quot;A&quot;</span>]])</span><br><span class="line"><span class="comment">#   w  x  y  z</span></span><br><span class="line"><span class="comment">#A  0  1  2  3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># []返回Series，[[]]返回DataFrame</span></span><br></pre></td></tr></table></figure><h2 id="iloc用法"><a href="#iloc用法" class="headerlink" title="iloc用法"></a>iloc用法</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(data.iloc[<span class="number">0</span>])</span><br><span class="line"><span class="comment">#w    0</span></span><br><span class="line"><span class="comment">#x    1</span></span><br><span class="line"><span class="comment">#y    2</span></span><br><span class="line"><span class="comment">#z    3</span></span><br><span class="line"><span class="comment">#print(data.iloc[&quot;A&quot;])报错</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(data.loc[[<span class="string">&quot;A&quot;</span>]])</span><br><span class="line"><span class="comment">#   w  x  y  z</span></span><br><span class="line"><span class="comment">#A  0  1  2  3</span></span><br><span class="line"><span class="comment">#print(data.loc[0])报错</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#方式1</span></span><br><span class="line">df.loc[:,<span class="number">0</span>:<span class="number">2</span>]<span class="comment">#可把loc理解为遍历字符串类型，0:2则表示标签为0,1,2三列</span></span><br><span class="line"><span class="comment">#方式2</span></span><br><span class="line">df.iloc[:,<span class="number">0</span>:<span class="number">3</span>]<span class="comment">#iloc遍历的数数字，python中0:3对应0,1,和2</span></span><br></pre></td></tr></table></figure><h1 id="pd-query"><a href="#pd-query" class="headerlink" title="pd.query"></a>pd.query</h1><p>可以指定范围，这样更加方便为机器学习选择数据量</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data = data.query(<span class="string">&quot;x &lt; 2.5 &amp; x &gt; 2 &amp; y &lt; 1.5 &amp; y &gt; 1.0&quot;</span>)</span><br></pre></td></tr></table></figure><h1 id="时间"><a href="#时间" class="headerlink" title="时间"></a>时间</h1><ol><li><p>将时间戳转成自己指定的时间格式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pd.to_datetime(data[<span class="string">&quot;time&quot;</span>],unit=<span class="string">&quot;s&quot;</span>)</span><br><span class="line"><span class="comment">#1970-01-08 05:06:14</span></span><br></pre></td></tr></table></figure></li><li><p>获取年月日，时分秒,周</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">先获取时间索引</span><br><span class="line">date = pd.DatetimeIndex(time_value)</span><br><span class="line"></span><br><span class="line">再获取自己想要的</span><br><span class="line">date.year</span><br><span class="line">date.month</span><br><span class="line">hour</span><br><span class="line">    weekday</span><br></pre></td></tr></table></figure></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">data[<span class="string">&#x27;day&#x27;</span>] = pd.to_datetime(data[<span class="string">&#x27;time&#x27;</span>]).dt.day</span><br><span class="line">data[<span class="string">&#x27;weekday&#x27;</span>] = pd.to_datetime(data[<span class="string">&#x27;time&#x27;</span>]).dt.weekday</span><br><span class="line">data[<span class="string">&#x27;hour&#x27;</span>] = pd.to_datetime(data[<span class="string">&#x27;time&#x27;</span>]).dt.hour</span><br></pre></td></tr></table></figure><h1 id="agg和apply"><a href="#agg和apply" class="headerlink" title="agg和apply"></a>agg和apply</h1><p><code>agg()</code>函数（Aggregate）用于对数据进行聚合操作，例如计算均值、求和、最大值、最小值等统计指标。它可以应用于DataFrame或Series对象，并接受一个或多个聚合函数作为参数。以下是<code>agg()</code>函数的常见用法：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对DataFrame应用聚合函数</span></span><br><span class="line">df.agg(func)</span><br><span class="line">df.agg(&#123;column: func&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对Series应用聚合函数</span></span><br><span class="line">s.agg(func)</span><br></pre></td></tr></table></figure><p>其中，<code>df</code>表示DataFrame对象，<code>s</code>表示Series对象，<code>func</code>表示聚合函数，可以是内置函数（如<code>mean()</code>、<code>sum()</code>、<code>max()</code>、<code>min()</code>等），也可以是自定义函数。</p><p>使用<code>agg()</code>函数时，可以将多个聚合函数传递给它，并通过列表或字典的方式指定应用每个函数的列。例如，可以使用以下方式计算DataFrame的均值和总和：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.agg([<span class="string">&#x27;mean&#x27;</span>, <span class="string">&#x27;sum&#x27;</span>])</span><br></pre></td></tr></table></figure><p>还可以通过字典的方式指定每个列应用的聚合函数：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pythonCopy code</span><br><span class="line">df.agg(&#123;&#x27;列1&#x27;: &#x27;mean&#x27;, &#x27;列2&#x27;: &#x27;sum&#x27;&#125;)</span><br></pre></td></tr></table></figure><p><code>apply()</code>函数用于对DataFrame或Series的每个元素应用自定义函数，以实现数据的转换、映射或其他操作。它可以应用于DataFrame的整个行或列，或者应用于Series的每个元素。以下是<code>apply()</code>函数的常见用法：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对DataFrame的行或列应用函数</span></span><br><span class="line">df.apply(func, axis=<span class="number">0</span>)  <span class="comment"># 对列应用函数</span></span><br><span class="line">df.apply(func, axis=<span class="number">1</span>)  <span class="comment"># 对行应用函数</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对Series的每个元素应用函数</span></span><br><span class="line">s.apply(func)</span><br></pre></td></tr></table></figure><p>其中，<code>df</code>表示DataFrame对象，<code>s</code>表示Series对象，<code>func</code>表示自定义函数。</p><p>使用<code>apply()</code>函数时，需要传递一个函数作为参数，该函数将应用于每个元素。可以使用lambda表达式定义匿名函数，也可以使用普通函数进行操作。</p><p>在<code>apply()</code>函数中，通过<code>axis</code>参数可以指定应用函数的方向，<code>axis=0</code>表示按列应用函数，<code>axis=1</code>表示按行应用函数。</p><p>需要注意的是，<code>apply()</code>函数在处理大规模数据时可能会较慢，因为它是逐个元素地进行操作。在某些情况下，可以考虑使用向量化操作或其他优化技术来提高性能。</p><p>综上所述，<code>agg()</code>函数用于对数据进行聚合操作，而<code>apply()</code>函数用于对每个元素应用自定义函数。它们在数据分析和转换中都有广泛的应用。</p><h1 id="表合并"><a href="#表合并" class="headerlink" title="表合并"></a>表合并</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data1.merge(data2,how=<span class="string">&#x27;left&#x27;</span>, left_on=<span class="string">&#x27;id&#x27;</span>, right_on=<span class="string">&#x27;movie_id&#x27;</span>)</span><br></pre></td></tr></table></figure><blockquote><p><code>merge()</code>函数还有其他一些参数可以进行更灵活的合并操作，例如<code>how</code>参数用于指定合并方式（inner、outer、left、right），<code>left_on</code>和<code>right_on</code>参数用于指定不同的列名进行连接等。</p></blockquote><h1 id="索引设置"><a href="#索引设置" class="headerlink" title="索引设置"></a>索引设置</h1><p><a href="https://blog.csdn.net/weixin_43593330/article/details/91863692">(77条消息) pandas 中读取和写入csv文件时候出现Unnamed:0的解决方案<em>unnamed: 0</em>我是天才很好的博客-CSDN博客</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data = data.reset_index(drop=<span class="literal">True</span>)</span><br><span class="line">data.index += <span class="number">1</span></span><br></pre></td></tr></table></figure><h1 id="列重命名"><a href="#列重命名" class="headerlink" title="列重命名"></a>列重命名</h1><ol><li>```python<br>df = df.rename(columns={‘旧列名1’: ‘新列名1’, ‘旧列名2’: ‘新列名2’}, inplace=True)<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. ```python</span><br><span class="line">   df.columns = [&#x27;新列名1&#x27;, &#x27;新列名2&#x27;, &#x27;新列名3&#x27;]</span><br></pre></td></tr></table></figure></li></ol><h1 id="保存到csv…"><a href="#保存到csv…" class="headerlink" title="保存到csv…"></a>保存到csv…</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.to_excel(<span class="string">&#x27;filename.xlsx&#x27;</span>, index=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><h1 id="缺失值处理"><a href="#缺失值处理" class="headerlink" title="缺失值处理"></a>缺失值处理</h1><ul><li><p>查看缺失值：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data[data[<span class="string">&#x27;runtime&#x27;</span>].isnull()]</span><br><span class="line">data.isna().<span class="built_in">sum</span>()</span><br></pre></td></tr></table></figure></li><li><p>删除缺失值：</p><ul><li>使用<code>dropna()</code>函数删除包含缺失值的行或列。</li><li>可以使用<code>df.dropna(axis=0)</code>删除包含缺失值的行，或使用<code>df.dropna(axis=1)</code>删除包含缺失值的列。</li><li>注意，删除缺失值可能会导致数据丢失，只在缺失值对分析结果影响较小或可以忽略的情况下使用。</li></ul></li><li><p>插值：</p><ul><li>使用插值方法来根据已知数据点的值推断缺失值。</li><li>常见的插值方法包括线性插值、多项式插值、样条插值等。</li><li><code>pandas</code>中的<code>interpolate()</code>函数可以根据一定的插值算法填充缺失值。</li></ul></li><li><p>填充常量值：</p><ul><li><p>使用固定的常量值填充缺失值。</p></li><li><p>可以使用<code>fillna()</code>函数将缺失值填充为指定的常量值，例如0、-1等。</p></li><li><p>如果 <code>fillna()</code> 函数的 <code>inplace=True</code> 参数未生效，可能存在以下原因：</p><ol><li><p>使用了链式索引：在使用链式索引（chained indexing）时，<code>inplace=True</code> 可能不会生效。链式索引是指多次对同一数据进行索引操作，例如使用 <code>data.loc[...]</code>，然后再使用 <code>.fillna()</code>。这种操作可能会导致修改无法正确应用到原始数据上。</p><p>解决方法：避免使用链式索引，而是使用单一索引操作，或者使用 <code>.loc</code> 来完成索引和填充操作。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.loc[data[&#x27;id&#x27;] == 370980, &#x27;runtime&#x27;] = data.loc[data[&#x27;id&#x27;] == 370980, &#x27;runtime&#x27;].fillna(98)</span><br></pre></td></tr></table></figure></li></ol></li></ul><ol><li><p>列数据类型不是数值型：如果 <code>runtime</code> 列的数据类型不是数值型（如整数或浮点数），<code>fillna()</code> 函数可能无法正确填充值。</p><p>解决方法：使用 <code>astype()</code> 函数将数据类型转换为数值型。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pythonCopy codedata[&#x27;runtime&#x27;] = data[&#x27;runtime&#x27;].astype(float)</span><br><span class="line">data.loc[data[&#x27;id&#x27;] == 370980, &#x27;runtime&#x27;].fillna(98, inplace=True)</span><br></pre></td></tr></table></figure></li><li><p>数据被赋值给其他变量：在操作中，可能将数据赋值给其他变量，并对其进行修改，而不是直接修改原始数据。</p><p>解决方法：确保对原始数据直接进行操作，而不是对变量进行操作。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pythonCopy code</span><br><span class="line">data.loc[data[&#x27;id&#x27;] == 370980, &#x27;runtime&#x27;].fillna(98, inplace=True)</span><br></pre></td></tr></table></figure></li></ol><p>请注意，在填充操作中，要么使用 <code>inplace=True</code> 进行原地修改，要么将结果重新赋值给原始数据。如果以上方法仍然无法解决问题，请提供更多关于数据和操作的详细信息，以便更准确地找到问题的原因和解决方法。</p></li><li><p>填充统计值：</p><ul><li>使用均值、中位数、众数等统计值来填充缺失值。</li><li>可以使用<code>fillna()</code>函数将缺失值填充为对应列的均值、中位数、众数等。</li></ul></li><li><p>使用机器学习算法填充：</p><ul><li>使用机器学习算法，如回归模型、K近邻算法等，根据已知的特征值预测缺失值。</li></ul></li></ul><h1 id="explode"><a href="#explode" class="headerlink" title="explode"></a>explode</h1><p><a href="https://blog.csdn.net/yuxiaosmd/article/details/114647974">(74条消息) pandas100个骚操作五：使用 explode 实现 pandas 列转行的 2 个常用技巧_pandas explode_Python数据科学的博客-CSDN博客</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">film_production = data[<span class="string">&#x27;production_countries&#x27;</span>].<span class="built_in">str</span>.split(<span class="string">&#x27;|&#x27;</span>).explode().value_counts()</span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.get_dummies(<span class="string">&#x27;|&#x27;</span>).<span class="built_in">sum</span>().nlargest(<span class="number">5</span>)</span><br></pre></td></tr></table></figure><h1 id="isin及其逆函数"><a href="#isin及其逆函数" class="headerlink" title="isin及其逆函数"></a>isin及其逆函数</h1><blockquote><p>如果想要获取或者删除想要特指的数，可以用isin</p><p>其反函数是 <code>~</code> 大波浪</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">country_counts_others = country_counts[~country_counts.index.isin(top_countries)]</span><br></pre></td></tr></table></figure><h1 id="flatten函数"><a href="#flatten函数" class="headerlink" title="flatten函数"></a>flatten函数</h1><blockquote><p>降维</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">y = director_top10.values.flatten()</span><br><span class="line"></span><br><span class="line">原始:</span><br><span class="line">[[<span class="number">28442552025</span>]</span><br><span class="line">[<span class="number">26807330936</span>]</span><br><span class="line">[<span class="number">25930141996</span>]</span><br><span class="line">[<span class="number">23086609676</span>]</span><br><span class="line">[<span class="number">23026826230</span>]</span><br><span class="line">[<span class="number">20078688142</span>]</span><br><span class="line">[<span class="number">19652943043</span>]</span><br><span class="line">[<span class="number">18464690132</span>]</span><br><span class="line">[<span class="number">18343111015</span>]</span><br><span class="line">[<span class="number">17415920425</span>]]</span><br><span class="line"></span><br><span class="line">结果:</span><br><span class="line">[<span class="number">28442552025</span> <span class="number">26807330936</span> <span class="number">25930141996</span> <span class="number">23086609676</span> <span class="number">23026826230</span> <span class="number">20078688142</span></span><br><span class="line"> <span class="number">19652943043</span> <span class="number">18464690132</span> <span class="number">18343111015</span> <span class="number">17415920425</span>]</span><br></pre></td></tr></table></figure><h1 id="删除列"><a href="#删除列" class="headerlink" title="删除列"></a>删除列</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df.drop(columns = [<span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>], axis=<span class="number">1</span>)</span><br><span class="line">df= df.drop(columns = <span class="string">&#x27;column_name&#x27;</span>, <span class="number">1</span>)</span><br></pre></td></tr></table></figure><h1 id="get-dummies函数"><a href="#get-dummies函数" class="headerlink" title="get_dummies函数"></a>get_dummies函数</h1><p>参考链接：<a href="https://blog.csdn.net/weixin_44852067/article/details/122242856?ops_request_misc=%7B%22request%5Fid%22%3A%22168871879516800197027943%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&amp;request_id=168871879516800197027943&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_click~default-2-122242856-null-null.142^v88^control_2,239^v2^insert_chatgpt&amp;utm_term=get_dummies&amp;spm=1018.2226.3001.4187">(74条消息) pandas get<em>dummies用法及代码示例_pandas.get_dummies</em>独影月下酌酒的博客-CSDN博客</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">就是one hot编码，将文本特征提取</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data[data[<span class="string">&#x27;year&#x27;</span>].astype(<span class="built_in">int</span>) &gt;= <span class="number">1980</span>][<span class="string">&#x27;genres&#x27;</span>].<span class="built_in">str</span>.get_dummies(<span class="string">&#x27;|&#x27;</span>).<span class="built_in">sum</span>().nlargest(<span class="number">5</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data[data[<span class="string">&#x27;year&#x27;</span>].astype(<span class="built_in">int</span>) &gt;= <span class="number">1980</span>].groupby(<span class="string">&#x27;year&#x27;</span>)[<span class="string">&#x27;genres&#x27;</span>].apply(<span class="keyword">lambda</span> x:x.<span class="built_in">str</span>.get_dummies(<span class="string">&#x27;|&#x27;</span>).<span class="built_in">sum</span>())</span><br></pre></td></tr></table></figure><h1 id="最值查找"><a href="#最值查找" class="headerlink" title="最值查找"></a>最值查找</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">max</span>(),<span class="built_in">min</span>(),nlargest(),nsmallest()</span><br></pre></td></tr></table></figure><p>统计电影风格（genres）数量前五（Top5）的风格随时间（1980年至今）的变化趋势，用折线图的顺滑模式表示，然后x轴为年份，y轴为数量，并且电影风格genres列的格式大致为:Action|Adventure|Fantasy|Science Fiction</p><h1 id="cat函数"><a href="#cat函数" class="headerlink" title="cat函数"></a>cat函数</h1><p>在series中，做合并通常可以使用cat函数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = pd.Series([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="number">0</span>    a</span><br><span class="line"><span class="number">1</span>    b</span><br><span class="line"><span class="number">2</span>    c</span><br><span class="line"><span class="number">3</span>    d</span><br><span class="line">dtype: <span class="built_in">object</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.<span class="built_in">str</span>.cat(sep=<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;a,b,c,d&#x27;</span></span><br><span class="line"><span class="comment"># 如果中间有nan，不特殊说明，通常直接忽略掉</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = pd.Series([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, np.nan, <span class="string">&#x27;d&#x27;</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t.<span class="built_in">str</span>.cat(sep=<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;a,b,d&#x27;</span></span><br><span class="line"><span class="comment"># 通过指定na_rep参数，做连接时，nan被替换</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t.<span class="built_in">str</span>.cat(sep=<span class="string">&#x27;,&#x27;</span>, na_rep=<span class="string">&#x27;-&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;a,b,-,d&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>u = pd.Series([<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>], index=[<span class="number">1</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">2</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="number">0</span>    a</span><br><span class="line"><span class="number">1</span>    b</span><br><span class="line"><span class="number">2</span>    c</span><br><span class="line"><span class="number">3</span>    d</span><br><span class="line">dtype: <span class="built_in">object</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>u</span><br><span class="line"><span class="number">1</span>    b</span><br><span class="line"><span class="number">3</span>    d</span><br><span class="line"><span class="number">0</span>    a</span><br><span class="line"><span class="number">2</span>    c</span><br><span class="line">dtype: <span class="built_in">object</span></span><br><span class="line"><span class="comment"># 如果不指定join参数，则还是会按照list列表中的</span></span><br><span class="line"><span class="comment"># 顺序依次做连接</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.<span class="built_in">str</span>.cat(u)</span><br><span class="line"><span class="number">0</span>    ab</span><br><span class="line"><span class="number">1</span>    bd</span><br><span class="line"><span class="number">2</span>    ca</span><br><span class="line"><span class="number">3</span>    dc</span><br><span class="line">dtype: <span class="built_in">object</span></span><br><span class="line"><span class="comment"># 通过指定连接方式，join有left,right,inner,outer四种</span></span><br><span class="line"><span class="comment"># 连接方式，分别安装index对号连接</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.<span class="built_in">str</span>.cat(u, join=<span class="string">&#x27;left&#x27;</span>)</span><br><span class="line"><span class="number">0</span>    aa</span><br><span class="line"><span class="number">1</span>    bb</span><br><span class="line"><span class="number">2</span>    cc</span><br><span class="line"><span class="number">3</span>    dd</span><br><span class="line">dtype: <span class="built_in">object</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="重复值"><a href="#重复值" class="headerlink" title="重复值"></a>重复值</h1><p><a href="https://www.jianshu.com/p/23c93e0f369a">https://www.jianshu.com/p/23c93e0f369a</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python中有一个快速删除重复值的函数</span></span><br><span class="line">data.drop_duplicate()</span><br></pre></td></tr></table></figure><h1 id="plt-legend"><a href="#plt-legend" class="headerlink" title="plt.legend()"></a>plt.legend()</h1><p><code>plt.legend()</code> 是 matplotlib 库中用于创建图例的函数。图例是一个说明性的标记，用于标识图中不同元素的含义，比如线条、点或其他图形的含义。它通常用于帮助读者理解图中的各个组成部分，并提供关键信息。</p><p><code>plt.legend()</code> 函数用于显示图例，并可以在图中的不同位置放置图例。它有多种用法，下面是一些常见的用法：</p><ol><li><p>基本用法：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plt.plot(x, y, label=<span class="string">&#x27;Line 1&#x27;</span>)</span><br><span class="line">plt.plot(x, z, label=<span class="string">&#x27;Line 2&#x27;</span>)</span><br><span class="line">plt.legend()</span><br></pre></td></tr></table></figure><p>在每个 <code>plt.plot()</code> 函数中，使用 <code>label</code> 参数为每条线条添加标签。然后调用 <code>plt.legend()</code> 函数，它会根据标签自动生成图例并将其显示在默认位置。</p></li><li><p>自定义图例位置：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plt.plot(x, y, label=<span class="string">&#x27;Line 1&#x27;</span>)</span><br><span class="line">plt.plot(x, z, label=<span class="string">&#x27;Line 2&#x27;</span>)</span><br><span class="line">plt.legend(loc=<span class="string">&#x27;upper right&#x27;</span>)</span><br></pre></td></tr></table></figure><p>在 <code>plt.legend()</code> 函数中使用 <code>loc</code> 参数可以指定图例的位置。常见的位置参数包括 <code>&#39;upper right&#39;</code>、<code>&#39;upper left&#39;</code>、<code>&#39;lower right&#39;</code>、<code>&#39;lower left&#39;</code> 和 <code>&#39;center&#39;</code> 等。</p></li><li><p>自定义图例样式：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plt.plot(x, y, label=<span class="string">&#x27;Line 1&#x27;</span>)</span><br><span class="line">plt.plot(x, z, label=<span class="string">&#x27;Line 2&#x27;</span>)</span><br><span class="line">plt.legend(loc=<span class="string">&#x27;upper right&#x27;</span>, fontsize=<span class="string">&#x27;small&#x27;</span>, fancybox=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>你可以使用其他参数来自定义图例的样式。例如，可以使用 <code>fontsize</code> 参数设置字体大小，使用 <code>fancybox</code> 参数创建一个带有圆角边框的图例框。</p></li></ol><p>请注意，<code>plt.legend()</code> 函数通常在绘制完所有需要显示在图例中的元素后调用，以确保所有标签都被包含在图例中。</p><h1 id="plt-figure"><a href="#plt-figure" class="headerlink" title="plt.figure()"></a>plt.figure()</h1><p><code>plt.figure()</code> 是 Matplotlib 库中用于创建新图形的函数。它返回一个 Figure 对象，代表了整个图形窗口或画布。</p><p><code>plt.figure()</code> 函数中可以设置一些参数来调整图形的属性，例如：</p><ul><li><code>figsize</code>：指定图形的大小，是一个元组，包含宽度和高度的值。例如，<code>figsize=(10, 6)</code> 表示图形宽度为 10，高度为 6。</li><li><code>dpi</code>：指定图形的分辨率，即每英寸包含的像素数。默认值为 100。</li><li><code>facecolor</code>：指定图形的背景颜色。</li><li><code>edgecolor</code>：指定图形的边框颜色。</li></ul><p>除了上述属性，<code>plt.figure()</code> 还可以接受其他参数，用于进一步定制图形的外观和行为。例如：</p><ul><li><code>num</code>：指定图形的编号，可以用于在多个图形之间进行切换。</li><li><code>clear</code>：如果设置为 True，则在创建图形之前清除当前图形窗口中的所有内容。</li></ul><p>在创建图形后，可以使用其他 Matplotlib 函数来绘制图形、设置标题、添加标签、调整轴等。最后，使用 <code>plt.show()</code> 函数将图形显示出来。</p><p>需要注意的是，<code>plt.figure()</code> 只是创建一个图形对象，并不会自动在图形窗口中显示图形。需要使用其他绘图函数（如 <code>plt.plot()</code>、<code>plt.bar()</code> 等）来绘制图形，并通过 <code>plt.show()</code> 来显示图形。</p><h1 id="plt-xticks"><a href="#plt-xticks" class="headerlink" title="plt.xticks()"></a>plt.xticks()</h1><p><code>plt.xticks()</code> 是 Matplotlib 库中用于设置 x 轴刻度的函数。它可以用于自定义 x 轴上的刻度位置和标签。</p><p><code>plt.xticks()</code> 函数的常用参数包括：</p><ul><li><code>ticks</code>：指定 x 轴刻度的位置，可以是一个包含刻度位置的列表或数组。</li><li><code>labels</code>：指定 x 轴刻度的标签，可以是一个包含刻度标签的列表或数组。</li><li><code>rotation</code>：指定刻度标签的旋转角度，用于调整标签的方向。例如，<code>rotation=90</code> 表示将标签逆时针旋转 90 度。</li><li><code>fontsize</code>：指定刻度标签的字体大小。</li><li><code>fontweight</code>：指定刻度标签的字体粗细。</li><li><code>ha</code>：指定刻度标签的水平对齐方式，可选值包括 <code>&#39;center&#39;</code>、<code>&#39;right&#39;</code>、<code>&#39;left&#39;</code>，用于调整标签在刻度位置上的对齐方式。</li></ul><p>使用 <code>plt.xticks()</code> 可以根据需要灵活地设置 x 轴刻度的位置和标签，以满足不同的绘图需求。例如，可以将刻度位置设置为一组特定的数值，然后将刻度标签设置为对应的文本，或者根据数据动态生成刻度标签等。</p><p>需要注意的是，<code>plt.xticks()</code> 只是设置 x 轴刻度的显示方式，并不会自动调整轴的范围。如果需要调整轴的范围，可以使用 <code>plt.xlim()</code> 函数。</p><h1 id="最值"><a href="#最值" class="headerlink" title="最值"></a>最值</h1><p>除了<code>nlargest</code>函数外，还有以下几个与之类似的函数：</p><ol><li><code>head(n)</code>: 返回DataFrame或Series中的前n行（或元素），按索引顺序排列。用法示例：<code>df.head(5)</code> 或 <code>series.head(10)</code>。</li><li><code>nsmallest(n, column)</code>: 返回DataFrame或Series中指定列(column)最小的n行（或元素），按升序排列。用法示例：<code>df.nsmallest(3, &#39;column_name&#39;)</code> 或 <code>series.nsmallest(5)</code>。</li><li><code>tail(n)</code>: 返回DataFrame或Series中的后n行（或元素），按索引逆序排列。用法示例：<code>df.tail(5)</code> 或 <code>series.tail(10)</code>。</li><li><code>nlargest(n, column)</code>: 返回DataFrame或Series中指定列(column)最大的n行（或元素），按降序排列。用法示例：<code>df.nlargest(3, &#39;column_name&#39;)</code> 或 <code>series.nlargest(5)</code>。</li></ol><p>这些函数可以根据指定的条件或列，返回DataFrame或Series中最大或最小的n个行（或元素），方便进行数据的筛选和排序。</p><h1 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h1><p>在Python中，与<code>&amp;</code>类似的位运算符和逻辑运算符有以下几种：</p><ol><li><code>|</code> (按位或)：执行按位或操作，将两个操作数的对应位进行或运算，并返回结果。对于每一位，只要两个操作数的对应位中有一个为1，结果位就为1，否则为0。</li><li><code>^</code> (按位异或)：执行按位异或操作，将两个操作数的对应位进行异或运算，并返回结果。对于每一位，只有当两个操作数的对应位不相同时，结果位才为1，否则为0。</li><li><code>~</code> (按位取反)：执行按位取反操作，将操作数的每一位取反，并返回结果。对于每一位，0变为1，1变为0。</li><li><code>&amp;&amp;</code> (逻辑与)：执行短路逻辑与操作，当左侧的表达式为True时，才会计算并返回右侧的表达式的值；否则，直接返回False。</li><li><code>||</code> (逻辑或)：执行短路逻辑或操作，当左侧的表达式为False时，才会计算并返回右侧的表达式的值；否则，直接返回True。</li><li>作为逻辑运算符，<code>&amp;</code>执行逻辑与操作。它将两个布尔表达式进行与运算，并返回结果。只有当两个表达式都为True时，结果为True；否则，结果为False。</li></ol><h1 id="groupby函数"><a href="#groupby函数" class="headerlink" title="groupby函数"></a>groupby函数</h1><p>在 Pandas 中，<code>groupby()</code> 方法之后可以使用多种方法对分组后的数据进行操作和计算。一些常用的方法包括：</p><ul><li>聚合函数：例如 <code>sum()</code>、<code>mean()</code>、<code>count()</code>、<code>max()</code>、<code>min()</code> 等，用于对分组后的数据进行统计计算。</li><li>过滤函数：例如 <code>filter()</code>，用于基于某些条件筛选分组。</li><li>变换函数：例如 <code>transform()</code>，用于对每个分组应用转换操作并返回与原始数据相同形状的新数据。</li><li>应用函数：例如 <code>apply()</code>，允许自定义函数应用于每个分组。</li></ul><p>除了上述方法，还可以使用 <code>agg()</code> 方法对不同的列应用不同的聚合函数，使用 <code>size()</code> 方法计算每个分组的大小，使用 <code>first()</code>、<code>last()</code> 方法获取每个分组的第一个或最后一个值等。</p><h1 id="透视表"><a href="#透视表" class="headerlink" title="透视表"></a>透视表</h1><p>在 Python 中，可以使用 Pandas 库的 <code>pivot_table()</code> 函数来创建透视表。透视表是一种数据汇总和分析的工具，它可以根据给定的行和列索引对数据进行聚合和统计。</p><p><code>pivot_table()</code> 函数的基本语法如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pivot_table(data, values=<span class="literal">None</span>, index=<span class="literal">None</span>, columns=<span class="literal">None</span>, aggfunc=<span class="string">&#x27;mean&#x27;</span>, fill_value=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><p>其中，参数的含义如下：</p><ul><li><code>data</code>：要进行透视的原始数据集，通常是一个 DataFrame。</li><li><code>values</code>：要聚合的数值列，可以是单个列名或包含多个列名的列表。</li><li><code>index</code>：透视表的行索引，可以是单个列名或包含多个列名的列表。</li><li><code>columns</code>：透视表的列索引，可以是单个列名或包含多个列名的列表。</li><li><code>aggfunc</code>：聚合函数，用于指定对数值列进行聚合的方法，默认为 <code>&#39;mean&#39;</code>（平均值）。其他常用的聚合函数包括 <code>&#39;sum&#39;</code>（求和）、<code>&#39;count&#39;</code>（计数）、<code>&#39;max&#39;</code>（最大值）、<code>&#39;min&#39;</code>（最小值）等。</li><li><code>fill_value</code>：用于填充缺失值的默认值。</li></ul><p>通过指定 <code>index</code>、<code>columns</code> 和 <code>values</code>，可以根据这些列进行分组和聚合，生成透视表。聚合函数会对指定的数值列进行计算，最终生成汇总的结果。</p>]]></content>
      
      
      <categories>
          
          <category> 大数据 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>机器学习</title>
      <link href="/2023/06/03/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
      <url>/2023/06/03/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h2 id="离散化"><a href="#离散化" class="headerlink" title="离散化"></a>离散化</h2><h3 id="1-cut"><a href="#1-cut" class="headerlink" title="1. cut"></a>1. cut</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">labels = <span class="built_in">list</span>(<span class="string">&#x27;ABCD&#x27;</span>)</span><br><span class="line">height = np.array([<span class="number">173</span>,<span class="number">192</span>,<span class="number">186</span>,<span class="number">167</span>,<span class="number">159</span>,<span class="number">159</span>,<span class="number">176</span>,<span class="number">160</span>,<span class="number">162</span>,<span class="number">167</span>])</span><br><span class="line">height = pd.cut(height,<span class="number">4</span>,labels=labels)</span><br><span class="line"><span class="built_in">print</span>(height)</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">[<span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;A&#x27;</span>]</span><br><span class="line">Categories (<span class="number">4</span>, <span class="built_in">object</span>): [<span class="string">&#x27;A&#x27;</span> &lt; <span class="string">&#x27;B&#x27;</span> &lt; <span class="string">&#x27;C&#x27;</span> &lt; <span class="string">&#x27;D&#x27;</span>]</span><br><span class="line">*/</span><br></pre></td></tr></table></figure><h3 id="2-qcut"><a href="#2-qcut" class="headerlink" title="2. qcut"></a>2. qcut</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#每一段都是均分             </span></span><br><span class="line">height = np.array([<span class="number">173</span>,<span class="number">192</span>,<span class="number">186</span>,<span class="number">167</span>,<span class="number">159</span>,<span class="number">159</span>,<span class="number">176</span>,<span class="number">160</span>,<span class="number">162</span>,<span class="number">167</span>])</span><br><span class="line">height = pd.qcut(height,<span class="number">4</span>)</span><br><span class="line"><span class="built_in">print</span>(height)</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">[(<span class="number">167.0</span>, <span class="number">175.25</span>], (<span class="number">175.25</span>, <span class="number">192.0</span>], (<span class="number">175.25</span>, <span class="number">192.0</span>], (<span class="number">160.5</span>, <span class="number">167.0</span>], (<span class="number">158.999</span>, <span class="number">160.5</span>], (<span class="number">158.999</span>, <span class="number">160.5</span>], (<span class="number">175.25</span>, <span class="number">192.0</span>], (<span class="number">158.999</span>, <span class="number">160.5</span>], (<span class="number">160.5</span>, <span class="number">167.0</span>], (<span class="number">160.5</span>, <span class="number">167.0</span>]]</span><br><span class="line">Categories (<span class="number">4</span>, interval[float64, right]): [(<span class="number">158.999</span>, <span class="number">160.5</span>] &lt; (<span class="number">160.5</span>, <span class="number">167.0</span>] &lt; (<span class="number">167.0</span>, <span class="number">175.25</span>] &lt;</span><br><span class="line">                                           (<span class="number">175.25</span>, <span class="number">192.0</span>]]</span><br><span class="line">*/</span><br></pre></td></tr></table></figure><h2 id="哑变量编码"><a href="#哑变量编码" class="headerlink" title="哑变量编码"></a>哑变量编码</h2><p>对于需要分类的变量进行哑变量编码或者one hot编码以方便距离或相似度的计算</p><p>eg, 性别/星期/颜色等分类变量的度量</p><p>pandas库中的get_dummies()函数可以实现分类变量的哑变量编码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">gender = np.array([<span class="string">&#x27;M&#x27;</span>,<span class="string">&#x27;F&#x27;</span>,<span class="string">&#x27;M&#x27;</span>,<span class="string">&#x27;F&#x27;</span>,<span class="literal">None</span>,<span class="string">&#x27;M&#x27;</span>,<span class="string">&#x27;F&#x27;</span>,<span class="string">&#x27;M&#x27;</span>,<span class="string">&#x27;F&#x27;</span>],prefix=<span class="string">&#x27;Gender&#x27;</span>)</span><br><span class="line">ybl = pd.get_dummies(gender)</span><br><span class="line"><span class="built_in">print</span>(ybl)</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">   Gender_F  Gender_M</span><br><span class="line"><span class="number">0</span>         <span class="number">0</span>         <span class="number">1</span></span><br><span class="line"><span class="number">1</span>         <span class="number">1</span>         <span class="number">0</span></span><br><span class="line"><span class="number">2</span>         <span class="number">0</span>         <span class="number">1</span></span><br><span class="line"><span class="number">3</span>         <span class="number">1</span>         <span class="number">0</span></span><br><span class="line"><span class="number">4</span>         <span class="number">0</span>         <span class="number">0</span></span><br><span class="line"><span class="number">5</span>         <span class="number">0</span>         <span class="number">1</span></span><br><span class="line"><span class="number">6</span>         <span class="number">1</span>         <span class="number">0</span></span><br><span class="line"><span class="number">7</span>         <span class="number">0</span>         <span class="number">1</span></span><br><span class="line"><span class="number">8</span>         <span class="number">1</span>         <span class="number">0</span></span><br><span class="line"></span><br><span class="line">*/</span><br></pre></td></tr></table></figure><h1 id="什么是机器学习"><a href="#什么是机器学习" class="headerlink" title="什么是机器学习"></a>什么是机器学习</h1><ol><li>从数据中学习            特征值 + 目标值</li><li>学习结果为模型             </li><li>预测、识别….</li></ol><h1 id="机器学习开发流程"><a href="#机器学习开发流程" class="headerlink" title="机器学习开发流程"></a>机器学习开发流程</h1><ol><li>获取数据</li><li>数据处理</li><li>特征工程</li><li>机器学习算法训练 + 模型</li><li>模型评估</li><li>应用</li></ol><h1 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h1><h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">比如有🚚和🚗，我怎么让机器去识别？</span><br></pre></td></tr></table></figure><p><img src="E:\Hexo-Blog\piccode\PicCode\img\Machine\machine_base_01.webp" alt="image-20230601190609584" style="zoom:33%;" /></p><ul><li><p>特征（维度）    Feature</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">车长   车宽   车高</span><br></pre></td></tr></table></figure><p>这样就是判别是否为卡车还是轿车，so 我们也称它有三个维度</p><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230601190246118.png" alt="image-20230601190246118" style="zoom:33%;" /></p></li><li><p>算法</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">我现在知道了车宽和车高去判断卡车还是轿车，只需要根据已有的样本空间去判断距离他们的远近即可</span><br></pre></td></tr></table></figure><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230601190530813.png" alt="image-20230601190530813" style="zoom:33%;" /></p></li><li><p>标签     Label</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">就是卡车和货车</span><br></pre></td></tr></table></figure></li><li><p>预测    Prediction</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">未知的标签，从已知的特征中预测出来</span><br></pre></td></tr></table></figure></li></ul><h1 id="监督学习与非监督学习"><a href="#监督学习与非监督学习" class="headerlink" title="监督学习与非监督学习"></a>监督学习与非监督学习</h1><h2 id="监督学习-有目标值"><a href="#监督学习-有目标值" class="headerlink" title="监督学习(有目标值)"></a>监督学习(有目标值)</h2><p>监督学习是以任务为驱动的方法</p><p>这里任务 ——-&gt; 就是标签（判断是否为🚚, 判断百公里油耗为多少）</p><p>这里就可以看出来，非监督学习就是没有标签</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">预测股票</span><br><span class="line">预测某人50岁得某病的可能</span><br><span class="line">判断物体是什么</span><br></pre></td></tr></table></figure><h3 id="分类任务（离散）"><a href="#分类任务（离散）" class="headerlink" title="分类任务（离散）"></a>分类任务（离散）</h3><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230601191124148.png" alt="image-20230601191124148" style="zoom: 50%;" /></p><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230601191318163.png" alt="image-20230601191318163" style="zoom:50%;" /></p><h3 id="回归任务（连续）"><a href="#回归任务（连续）" class="headerlink" title="回归任务（连续）"></a>回归任务（连续）</h3><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230601191218514.png" alt="image-20230601191218514" style="zoom:50%;" /></p><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230601191450551.png" alt="image-20230601191450551" style="zoom:50%;" /></p><h2 id="非监督学习-无目标值"><a href="#非监督学习-无目标值" class="headerlink" title="非监督学习(无目标值)"></a>非监督学习(无目标值)</h2><p>就是没有标签，让你胡乱推测</p><ul><li>比如你去百度搜索某个东西，他会预测你是不是想买，或者想要了解，就会给你推送链接</li><li>分析用户行为，游戏氪金，大佬就被割韭菜，大数据杀熟</li><li>基因组，判断每一串基因对人类的影响</li></ul><h3 id="聚类"><a href="#聚类" class="headerlink" title="聚类"></a>聚类</h3><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230601192117920.png" alt="image-20230601192117920"></p><h1 id="训练，验证，测试与评估"><a href="#训练，验证，测试与评估" class="headerlink" title="训练，验证，测试与评估"></a>训练，验证，测试与评估</h1><p>有点乱七八糟的不好理解  多写写代码就懂了</p><h2 id="1-训练"><a href="#1-训练" class="headerlink" title="1.训练"></a>1.训练</h2><p>总结数据的信息，从中学习有用的规律</p><h2 id="2-验证"><a href="#2-验证" class="headerlink" title="2.验证"></a>2.验证</h2><p>不参与模型参数的求解 但是 参与模型的学习过程</p><p>更多的是属于训练过程</p><p><strong><em>我理解的就是一个做课后作业的过程，查缺补漏</em></strong></p><h2 id="3-测试"><a href="#3-测试" class="headerlink" title="3.测试"></a>3.测试</h2><p>与训练过程和模型绝缘用来评估模型的最终效果</p><p>属于测试过程</p><p><strong><em>我理解就是期末考试</em></strong></p><h2 id="4-评估"><a href="#4-评估" class="headerlink" title="4.评估"></a>4.评估</h2><p>根据指标来判断模型是好是坏</p><ul><li><p>腾讯医疗-癌症预测100000</p><ol><li><p>训练集80000</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">用于 训练和验证</span><br></pre></td></tr></table></figure></li><li><p>测试集20000</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">用于 评估</span><br></pre></td></tr></table></figure></li></ol></li></ul><h1 id="Sklearn"><a href="#Sklearn" class="headerlink" title="Sklearn"></a>Sklearn</h1><h2 id="1-Sklearn数据集"><a href="#1-Sklearn数据集" class="headerlink" title="1. Sklearn数据集"></a>1. Sklearn数据集</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sklearn.databasets</span><br><span class="line">load_*获取小规模数据集</span><br><span class="line">fetch_*获取大规模数据集</span><br></pre></td></tr></table></figure><h3 id="1-1-sklearn小数据集"><a href="#1-1-sklearn小数据集" class="headerlink" title="1.1 sklearn小数据集"></a>1.1 sklearn小数据集</h3><p>例如我要引用鸢尾花的小规模的数据集就可以使用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sklearn.databasets.load_iris()</span><br></pre></td></tr></table></figure><p>波士顿房价数据集</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sklearn.databasets.load_boston()</span><br></pre></td></tr></table></figure><h3 id="1-2-sklearn大数据集"><a href="#1-2-sklearn大数据集" class="headerlink" title="1.2 sklearn大数据集"></a>1.2 sklearn大数据集</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sklearn.databasets.fetch_20newsgroups(data_home=None,subset=&#x27;train&#x27;)</span><br></pre></td></tr></table></figure><ul><li>subset: ‘train’或者’test’，’all‘</li><li>训练集的训练，测试，全部</li></ul><h3 id="1-3-数据集的返回值"><a href="#1-3-数据集的返回值" class="headerlink" title="1.3 数据集的返回值"></a>1.3 数据集的返回值</h3><ul><li><pre><code>databasets.base.Bunch  (字典)dict[&#39;key&#39;] = values<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- data：特征值</span><br><span class="line"></span><br><span class="line">  - ```</span><br><span class="line">    iris[&#x27;data&#x27;]</span><br></pre></td></tr></table></figure>- target：标签值  - ```python    iris.target    <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- DESCR：数据描述</span><br><span class="line"></span><br><span class="line">  - ```</span><br><span class="line">    iris.DESCR</span><br></pre></td></tr></table></figure>- feature_name：特征名  -</code></pre><pre><code>iris.feature_names<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- target_name：标签名</span><br><span class="line"></span><br><span class="line">  - ```</span><br><span class="line">    iris.target_names</span><br></pre></td></tr></table></figure></code></pre></li></ul><h3 id="1-4-数据集的划分"><a href="#1-4-数据集的划分" class="headerlink" title="1.4 数据集的划分"></a>1.4 数据集的划分</h3><ul><li>训练集：70% 80% 75%</li><li>测试集：30% 20% 25%</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="comment"># 数据集划分</span></span><br><span class="line">    x_train,x_test,y_train,y_test = train_test_split(iris.data,iris.target,test_size=<span class="number">0.2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;训练集的特征值:\n&quot;</span>,x_train,x_train.shape)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;测试集的特征值:\n&quot;</span>,x_test,x_test.shape)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;训练集的目标值:\n&quot;</span>,y_train,y_train.shape)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;测试集的目标值:\n&quot;</span>,y_test,y_test.shape)</span><br></pre></td></tr></table></figure><h1 id="特征工程"><a href="#特征工程" class="headerlink" title="特征工程"></a>特征工程</h1><p>数据和特征决定了机器学习的上线，模型和算法知识在逼近这个上限</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">就是处理数据</span><br></pre></td></tr></table></figure><h2 id="特征工程内容"><a href="#特征工程内容" class="headerlink" title="特征工程内容"></a>特征工程内容</h2><ul><li>特征提取<ul><li>机器学习算法 - 统计方法 - 数学公式</li><li>例如：文本类型 -&gt; 数值</li><li>类型 -&gt; 数值<ul><li>这里可以用One-hot编码或者哑变量</li></ul></li></ul></li><li>特征预处理<br>- </li><li>特征降维</li></ul><h2 id="特征提取"><a href="#特征提取" class="headerlink" title="特征提取"></a>特征提取</h2><h4 id="1-将数据转换为可用于机器学习的数字特征"><a href="#1-将数据转换为可用于机器学习的数字特征" class="headerlink" title="1. 将数据转换为可用于机器学习的数字特征"></a>1. 将数据转换为可用于机器学习的数字特征</h4><blockquote><p>就是为了计算机更好的理解数据</p></blockquote><ul><li>字典特征提取(特征离散化)</li><li>文本特征提取</li><li>图像特征提取</li></ul><h4 id="2-特征提取API"><a href="#2-特征提取API" class="headerlink" title="2. 特征提取API"></a>2. 特征提取API</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sklearn.feature.extraction</span><br></pre></td></tr></table></figure><h3 id="字典特征提取"><a href="#字典特征提取" class="headerlink" title="字典特征提取"></a>字典特征提取</h3><p>作用: 对字典数据进行特征值化</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_extraction <span class="keyword">import</span> DictVectorizer</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sklearn.feature_extraction <span class="keyword">import</span> DictVectorizer</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">字典特征抽取</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dict_demo</span>():</span><br><span class="line">    <span class="built_in">dict</span> = [&#123;<span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;上海&#x27;</span>, <span class="string">&#x27;temperature&#x27;</span>: <span class="number">100</span>&#125;,</span><br><span class="line">            &#123;<span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;temperature&#x27;</span>: <span class="number">60</span>&#125;,</span><br><span class="line">            &#123;<span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;深圳&#x27;</span>, <span class="string">&#x27;temperature&#x27;</span>: <span class="number">30</span>&#125;]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1.实例化一个转换器类</span></span><br><span class="line">    transfer = DictVectorizer()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.调用fit_transform</span></span><br><span class="line">    <span class="comment"># 返回了sparse稀疏矩阵 将非零值 按位置表示 可以节省内存 提高加载效率</span></span><br><span class="line">    data = transfer.fit_transform(<span class="built_in">dict</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;data_dict:\n&quot;</span>, data)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;特征名字:\n&quot;</span>, transfer.feature_names_)</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    data_dict:</span></span><br><span class="line"><span class="string">      (0, 0)1.0</span></span><br><span class="line"><span class="string">      (0, 3)100.0</span></span><br><span class="line"><span class="string">      (1, 1)1.0</span></span><br><span class="line"><span class="string">      (1, 3)60.0</span></span><br><span class="line"><span class="string">      (2, 2)1.0</span></span><br><span class="line"><span class="string">      (2, 3)30.0</span></span><br><span class="line"><span class="string">    特征名字:</span></span><br><span class="line"><span class="string">    [&#x27;city=上海&#x27;, &#x27;city=北京&#x27;, &#x27;city=深圳&#x27;, &#x27;temperature&#x27;]</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    dict_demo()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h4><ul><li><p>当数据集中类别特征比较多的情况下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.将数据集中的特征=》字典类型</span><br><span class="line">2.DictVectorizer转换</span><br></pre></td></tr></table></figure></li><li><p>当本身拿到的数据就是字典类型就可以用字典特征提取</p></li></ul><h3 id="文本特征提取"><a href="#文本特征提取" class="headerlink" title="文本特征提取"></a>文本特征提取</h3><p>单词 作为 特征</p><p>句子、短语、单词、字母</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">特征：特征词</span><br></pre></td></tr></table></figure><h4 id="英文文本"><a href="#英文文本" class="headerlink" title="英文文本"></a>英文文本</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> CountVectorizer</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">count_demo</span>():</span><br><span class="line">    data = [<span class="string">&quot;Life is short,i like python&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Lift is too long,i dislike python&quot;</span>]</span><br><span class="line">    text = CountVectorizer()</span><br><span class="line"></span><br><span class="line">    sparse = text.fit_transform(data)</span><br><span class="line">    <span class="built_in">print</span>(sparse)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;特征名字:\n&quot;</span>, text.get_feature_names_out())</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">      (0, 2)1</span></span><br><span class="line"><span class="string">      (0, 1)1</span></span><br><span class="line"><span class="string">      (0, 7)1</span></span><br><span class="line"><span class="string">      (0, 4)1</span></span><br><span class="line"><span class="string">      (0, 6)1</span></span><br><span class="line"><span class="string">      (1, 1)1</span></span><br><span class="line"><span class="string">      (1, 6)1</span></span><br><span class="line"><span class="string">      (1, 3)1</span></span><br><span class="line"><span class="string">      (1, 8)1</span></span><br><span class="line"><span class="string">      (1, 5)1</span></span><br><span class="line"><span class="string">      (1, 0)1</span></span><br><span class="line"><span class="string">      特征名字:</span></span><br><span class="line"><span class="string">        [&#x27;dislike&#x27; &#x27;is&#x27; &#x27;life&#x27; &#x27;lift&#x27; &#x27;like&#x27; &#x27;long&#x27; &#x27;python&#x27; &#x27;short&#x27; &#x27;too&#x27;]</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    count_demo()</span><br></pre></td></tr></table></figure><h4 id="中文文本"><a href="#中文文本" class="headerlink" title="中文文本"></a>中文文本</h4><p>由于英文每个单词之间默认就是按照空格隔开，但是中文”你好”这种就没有空格</p><p>所以要借助一些分词工具   例如jieba分词….</p><blockquote><p>这里引出一个概念：停用词 stop_words</p><p>不止是中文这种，比如想一些未知的文本不容易进行分词的就可以使用停用词不将其进入</p><p>停用词表</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> CountVectorizer</span><br><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chinescount_demo</span>():</span><br><span class="line">    data = [<span class="string">&quot;引力，电磁力，强与弱相互作用力——四大基本力是我掌控的权能，是我永恒的冠冕，是我不朽的王座 。&quot;</span>,</span><br><span class="line">            <span class="string">&quot;无知愚昧之物称我为暴君，但是智者，以我为王。&quot;</span>,</span><br><span class="line">            <span class="string">&quot;有人对我闻风丧胆，有人对我顶礼膜拜，他们，都同样臣服于我。&quot;</span>]</span><br><span class="line">    data_new = []</span><br><span class="line">    <span class="keyword">for</span> sent <span class="keyword">in</span> data:</span><br><span class="line">        data_new.append(cut_word(sent))</span><br><span class="line"></span><br><span class="line">    trans = CountVectorizer()</span><br><span class="line">    res = trans.fit_transform(data_new)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;转换结果:\n&quot;</span>,res.toarray())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;特征名字:\n&quot;</span>, trans.get_feature_names_out())</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    转换结果:</span></span><br><span class="line"><span class="string">     [[1 0 0 0 1 1 0 1 1 1 0 1 0 0 0 0 1 1 1 1 1 0 0 0]</span></span><br><span class="line"><span class="string">     [0 1 0 1 0 0 0 0 0 0 1 0 1 1 1 0 0 0 0 0 0 0 0 0]</span></span><br><span class="line"><span class="string">     [0 0 1 0 0 0 1 0 0 0 0 0 0 0 0 2 0 0 0 0 0 1 1 1]]</span></span><br><span class="line"><span class="string">    特征名字:</span></span><br><span class="line"><span class="string">     [&#x27;不朽&#x27; &#x27;之物&#x27; &#x27;他们&#x27; &#x27;但是&#x27; &#x27;冠冕&#x27; &#x27;力是&#x27; &#x27;同样&#x27; &#x27;四大&#x27; &#x27;基本&#x27; &#x27;引力&#x27; &#x27;愚昧&#x27; &#x27;掌控&#x27; &#x27;无知&#x27; &#x27;智者&#x27;</span></span><br><span class="line"><span class="string">     &#x27;暴君&#x27; &#x27;有人&#x27; &#x27;权能&#x27; &#x27;永恒&#x27; &#x27;王座&#x27; &#x27;电磁力&#x27; &#x27;相互作用&#x27; &#x27;臣服于&#x27; &#x27;闻风丧胆&#x27; &#x27;顶礼膜拜&#x27;]</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cut_word</span>(<span class="params">text</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    进行中文分词</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot; &quot;</span>.join(<span class="built_in">list</span>(jieba.cut(text)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    chinescount_demo()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>但是按照这种分类会有一个弊病，比如说文章中有很多  因为  、所以 、…这样的词，在别的文章中同样也有很多，这样就会导致特征值的抽取中存在错误</p><h4 id="Tf-idf文本特征提取"><a href="#Tf-idf文本特征提取" class="headerlink" title="Tf-idf文本特征提取"></a>Tf-idf文本特征提取</h4><blockquote><p>如果某个词或者短语，在一篇文章中出现的概率高，并且在其它文章中很少出现，则认为这个词或者短语具有很好的类别区分能力，适合用来分类</p></blockquote><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230603201325407.png" alt="image-20230603201325407"></p><p>总结：</p><p>TF-IDF就是衡量一个词或短语的重要程度</p><ul><li><p>TF - 词频</p></li><li><p>IDF - 逆向文档频率 是一个词语普遍重要性的度量</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">比如现在</span><br><span class="line">1000篇文章 - 语料库</span><br><span class="line">100篇文章 - ”非常“</span><br><span class="line">10篇文章 - ”经济</span><br><span class="line"></span><br><span class="line">两篇文章</span><br><span class="line">文章A（100词）：10次“经济” TF-IDF = TF x IDF = 0.1 X 2 = 0.2</span><br><span class="line">tf: 10/100 = 0.1</span><br><span class="line">idf: lg 1000/10 = 2</span><br></pre></td></tr></table></figure></li></ul><p>实用</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> TfidfVectorizer</span><br><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chinescount_demo</span>():</span><br><span class="line">    data = [<span class="string">&quot;引力，电磁力，强与弱相互作用力——四大基本力是我掌控的权能，是我永恒的冠冕，是我不朽的王座 。&quot;</span>,</span><br><span class="line">            <span class="string">&quot;无知愚昧之物称我为暴君，但是智者，以我为王。&quot;</span>,</span><br><span class="line">            <span class="string">&quot;有人对我闻风丧胆，有人对我顶礼膜拜，他们，都同样臣服于我。&quot;</span>]</span><br><span class="line">    data_new = []</span><br><span class="line">    <span class="keyword">for</span> sent <span class="keyword">in</span> data:</span><br><span class="line">        data_new.append(cut_word(sent))</span><br><span class="line"></span><br><span class="line">    trans = TfidfVectorizer()</span><br><span class="line">    res = trans.fit_transform(data_new)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;转换结果:\n&quot;</span>,res.toarray())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;特征名字:\n&quot;</span>, trans.get_feature_names_out())</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        转换结果:</span></span><br><span class="line"><span class="string">         [[0.28867513 0.         0.         0.         0.28867513 0.28867513</span></span><br><span class="line"><span class="string">          0.         0.28867513 0.28867513 0.28867513 0.         0.28867513</span></span><br><span class="line"><span class="string">          0.         0.         0.         0.         0.28867513 0.28867513</span></span><br><span class="line"><span class="string">          0.28867513 0.28867513 0.28867513 0.         0.         0.        ]</span></span><br><span class="line"><span class="string">         [0.         0.40824829 0.         0.40824829 0.         0.</span></span><br><span class="line"><span class="string">          0.         0.         0.         0.         0.40824829 0.</span></span><br><span class="line"><span class="string">          0.40824829 0.40824829 0.40824829 0.         0.         0.</span></span><br><span class="line"><span class="string">          0.         0.         0.         0.         0.         0.        ]</span></span><br><span class="line"><span class="string">         [0.         0.         0.33333333 0.         0.         0.</span></span><br><span class="line"><span class="string">          0.33333333 0.         0.         0.         0.         0.</span></span><br><span class="line"><span class="string">          0.         0.         0.         0.66666667 0.         0.</span></span><br><span class="line"><span class="string">          0.         0.         0.         0.33333333 0.33333333 0.33333333]]</span></span><br><span class="line"><span class="string">        特征名字:</span></span><br><span class="line"><span class="string">         [&#x27;不朽&#x27; &#x27;之物&#x27; &#x27;他们&#x27; &#x27;但是&#x27; &#x27;冠冕&#x27; &#x27;力是&#x27; &#x27;同样&#x27; &#x27;四大&#x27; &#x27;基本&#x27; &#x27;引力&#x27; &#x27;愚昧&#x27; &#x27;掌控&#x27; &#x27;无知&#x27; &#x27;智者&#x27;</span></span><br><span class="line"><span class="string">         &#x27;暴君&#x27; &#x27;有人&#x27; &#x27;权能&#x27; &#x27;永恒&#x27; &#x27;王座&#x27; &#x27;电磁力&#x27; &#x27;相互作用&#x27; &#x27;臣服于&#x27; &#x27;闻风丧胆&#x27; &#x27;顶礼膜拜&#x27;]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cut_word</span>(<span class="params">text</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    进行中文分词</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot; &quot;</span>.join(<span class="built_in">list</span>(jieba.cut(text)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    chinescount_demo()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="特征提取总结"><a href="#特征提取总结" class="headerlink" title="特征提取总结"></a>特征提取总结</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_extraction <span class="keyword">import</span> DictVectorizer</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> CountVectorizer</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> TfidfVectorizer</span><br><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">字典特征提取</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dict_count</span>():</span><br><span class="line">    <span class="built_in">dict</span> = [&#123;<span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;上海&#x27;</span>, <span class="string">&#x27;temperature&#x27;</span>: <span class="number">100</span>&#125;,</span><br><span class="line">            &#123;<span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;temperature&#x27;</span>: <span class="number">60</span>&#125;,</span><br><span class="line">            &#123;<span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;深圳&#x27;</span>, <span class="string">&#x27;temperature&#x27;</span>: <span class="number">30</span>&#125;]</span><br><span class="line">    transfer = DictVectorizer()</span><br><span class="line">    data = transfer.fit_transform(<span class="built_in">dict</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;字典特征提取:\n&quot;</span>,data.toarray())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">english_count</span>():</span><br><span class="line">    data = [<span class="string">&quot;Life is short,i like like like python&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Life is too long,i dislike python&quot;</span>]</span><br><span class="line">    transfer = CountVectorizer()</span><br><span class="line">    data = transfer.fit_transform(data)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;英文文本提取:\n&quot;</span>,data.toarray())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chinese_count</span>():</span><br><span class="line">    chinese_data = [<span class="string">&quot;蒸汽与机械的浪潮中，谁能触及非凡？历史和黑暗的迷雾里，又是谁在耳语？我从诡秘中醒来，睁眼看见这个世界：&quot;</span>,</span><br><span class="line">            <span class="string">&quot;枪械，大炮，巨舰，飞空艇，差分机；魔药，占卜，诅咒，倒吊人，封印物……光明依旧照耀，神秘从未远离，这是一段“愚者”的传说。  &quot;</span>,</span><br><span class="line">            <span class="string">&quot;然而一句，半睡半醒之时，意志总是飘忽如同烟雾，难以控制，难以收束，他再怎么努力，依旧忍不住思维发散，杂念浮现。&quot;</span>,</span><br><span class="line">            <span class="string">&quot;　　看来我还没有真醒，还在梦里……等下说不定还会出现自以为已经醒了，实际依然在睡的情况……对类似遭遇不算陌生的周明瑞竭力集中意志，以彻底摆脱黑暗和迷幻的桎梏。&quot;</span>,</span><br><span class="line">            <span class="string">&quot;　　照耀视线先是模糊，继而蒙上了淡淡的绯红，目光所及绯红，周明瑞看见面前是一张原木色泽的书桌，正中央放着一本摊开的笔记，纸张粗糙而泛黄，抬头用奇怪的字母文字书写着一句话语，墨迹深黑，醒目欲滴。&quot;</span>]</span><br><span class="line">    transfer = CountVectorizer()</span><br><span class="line">    data = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> chinese_data:</span><br><span class="line">        data.append(<span class="string">&quot; &quot;</span>.join(jieba.cut(i)))</span><br><span class="line">    datas = transfer.fit_transform(data)</span><br><span class="line">    <span class="built_in">print</span>(datas)</span><br><span class="line">    <span class="built_in">print</span>(transfer.get_feature_names_out())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">TF_IDF</span>():</span><br><span class="line">    chinese_data = [<span class="string">&quot;蒸汽与机械的浪潮中，谁能触及非凡？历史和黑暗的迷雾里，又是谁在耳语？我从诡秘中醒来，睁眼看见这个世界：&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;枪械，大炮，巨舰，飞空艇，差分机；魔药，占卜，诅咒，倒吊人，封印物……光明依旧照耀，神秘从未远离，这是一段“愚者”的传说。  &quot;</span>,</span><br><span class="line">                    <span class="string">&quot;然而一句，半睡半醒之时，意志总是飘忽如同烟雾，难以控制，难以收束，他再怎么努力，依旧忍不住思维发散，杂念浮现。&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;　　然而看来我还没有真醒，还在梦里……等下说不定还会出现自以为已经醒了，实际依然在睡的情况……对类似遭遇不算陌生的周明瑞竭力集中意志，以彻底摆脱黑暗和迷幻的桎梏。&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;　　照耀视线先是模糊，继而蒙上了淡淡的绯红，目光所及绯红，周明瑞看见面前是一张原木色泽的书桌，正中央放着一本摊开的笔记，纸张粗糙而泛黄，抬头用奇怪的字母文字书写着一句话语，墨迹深黑，醒目欲滴。&quot;</span>]</span><br><span class="line">    transfer = TfidfVectorizer()</span><br><span class="line">    data = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> chinese_data:</span><br><span class="line">        data.append(<span class="string">&quot; &quot;</span>.join(jieba.cut(i)))</span><br><span class="line">    datas = transfer.fit_transform(data)</span><br><span class="line">    <span class="built_in">print</span>(datas)</span><br><span class="line">    <span class="built_in">print</span>(transfer.get_feature_names_out())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    dict_count()</span><br><span class="line">    english_count()</span><br><span class="line">    chinese_count()</span><br><span class="line">    TF_IDF()</span><br></pre></td></tr></table></figure><h2 id="特征预处理"><a href="#特征预处理" class="headerlink" title="特征预处理"></a>特征预处理</h2><p>就是通过一些转换函数将特征数据转换成更加适合算法模型的特征数据的过程</p><h4 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h4><ul><li>数值型数据的无量纲化：<ul><li>归一化</li><li>标准化</li></ul></li></ul><h4 id="API"><a href="#API" class="headerlink" title="API"></a>API</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sklearn.preprocessing</span><br></pre></td></tr></table></figure><h4 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h4><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230604112108821.png" alt="image-20230604112108821"></p><ul><li>为什么要进行归一化/标准化<ul><li>特征的单位或者大小相差较大，或者某特征的方差相比其他的特征要大出来几个数量级，容易影响分配</li></ul></li></ul><p>就比如对于这样一种数据，如果你用KNN算法，那么误差会极大，因为消耗时间百分比 与 里程数之间相差太大这样就会直接把消耗时间百分比当作一个无用数据</p><p>而归一化 就是将这些数据规划成同等重要，即为无量纲化</p><h4 id="归一化"><a href="#归一化" class="headerlink" title="归一化"></a>归一化</h4><h5 id="1-定义"><a href="#1-定义" class="headerlink" title="1.定义"></a>1.定义</h5><p>通过对原始数据进行变换把数据映射到（默认[0，1]）之间</p><p><a href="https://baike.baidu.com/item/%E5%BD%92%E4%B8%80%E5%8C%96/2215161?fr=aladdin">百度</a></p><h5 id="2-公式"><a href="#2-公式" class="headerlink" title="2.公式"></a>2.公式</h5><script type="math/tex; mode=display">归一化            X' = x - min/max-min                  X'' = X' * (mx - mi) + mi</script><blockquote><p>作用与每一列，max为每一列的最大值，min为一列的最小值，那么X’’为最终结果，</p><p>mx,mi分别为指定区间默认mx为1，mi为0</p></blockquote><h5 id="3-API"><a href="#3-API" class="headerlink" title="3.API"></a>3.API</h5><h6 id="3-1MinMaxScaler"><a href="#3-1MinMaxScaler" class="headerlink" title="3.1MinMaxScaler"></a>3.1MinMaxScaler</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> MinMaxScaler</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">归一化</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">minmax_demo</span>():</span><br><span class="line">    <span class="comment"># 1. 获取数据</span></span><br><span class="line">    data = pd.read_csv(<span class="string">&quot;E:\Code\Pywork\Machine\data\dating.txt&quot;</span>)</span><br><span class="line">    <span class="comment"># 每一行都要只要前三列</span></span><br><span class="line">    data = data.iloc[:, :<span class="number">3</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;data:\n&quot;</span>, data)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. 实例化一个转换器类</span></span><br><span class="line">    transfer = MinMaxScaler()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3.调用</span></span><br><span class="line">    data_new = transfer.fit_transform(data)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;data_new:\n&quot;</span>,data_new)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">data:</span></span><br><span class="line"><span class="string">      milage     Liters  Consumtime</span></span><br><span class="line"><span class="string">0     40920   8.326976    0.953952</span></span><br><span class="line"><span class="string">1     14488   7.153469    1.673904</span></span><br><span class="line"><span class="string">2     26052   1.441871    0.805124</span></span><br><span class="line"><span class="string">3     75136  13.147394    0.428964</span></span><br><span class="line"><span class="string">4     38344   1.669788    0.134296</span></span><br><span class="line"><span class="string">..      ...        ...         ...</span></span><br><span class="line"><span class="string">995   11145   3.410627    0.631838</span></span><br><span class="line"><span class="string">996   68846   9.974715    0.669787</span></span><br><span class="line"><span class="string">997   26575  10.650102    0.866627</span></span><br><span class="line"><span class="string">998   48111   9.134528    0.728045</span></span><br><span class="line"><span class="string">999   43757   7.882601    1.332446</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[1000 rows x 3 columns]</span></span><br><span class="line"><span class="string">data_new:</span></span><br><span class="line"><span class="string"> [[0.44832535 0.39805139 0.56233353]</span></span><br><span class="line"><span class="string"> [0.15873259 0.34195467 0.98724416]</span></span><br><span class="line"><span class="string"> [0.28542943 0.06892523 0.47449629]</span></span><br><span class="line"><span class="string"> ...</span></span><br><span class="line"><span class="string"> [0.29115949 0.50910294 0.51079493]</span></span><br><span class="line"><span class="string"> [0.52711097 0.43665451 0.4290048 ]</span></span><br><span class="line"><span class="string"> [0.47940793 0.3768091  0.78571804]]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    minmax_demo()</span><br></pre></td></tr></table></figure><h5 id="4-缺陷"><a href="#4-缺陷" class="headerlink" title="4.缺陷"></a>4.缺陷</h5><p>异常值：最大值、最小值</p><h4 id="标准化"><a href="#标准化" class="headerlink" title="标准化"></a>标准化</h4><h5 id="1-定义-1"><a href="#1-定义-1" class="headerlink" title="1.定义"></a>1.定义</h5><blockquote><p>通过对原始数据进行变换把数据变换到均值为0，标准差为1范围内</p></blockquote><h5 id="2-公式-1"><a href="#2-公式-1" class="headerlink" title="2.公式"></a>2.公式</h5><script type="math/tex; mode=display">标准化        X' = (x - mean) / 标准差</script><blockquote><p>作用于每一列，mean为平均值</p><p>标准差: 集中程度</p></blockquote><h5 id="3-API-1"><a href="#3-API-1" class="headerlink" title="3.API"></a>3.API</h5><h6 id="3-1StandardScaler"><a href="#3-1StandardScaler" class="headerlink" title="3.1StandardScaler"></a>3.1StandardScaler</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">from sklearn.preprocessing import StandardScaler</span><br><span class="line">import pandas as pd</span><br><span class="line"></span><br><span class="line">def stand_demo():</span><br><span class="line">    # 1. 获取数据</span><br><span class="line">    data = pd.read_csv(&quot;E:\Code\Pywork\Machine\data\dating.txt&quot;)</span><br><span class="line">    # 每一行都要只要前三列</span><br><span class="line">    data = data.iloc[:, :3]</span><br><span class="line">    print(&quot;data:\n&quot;, data)</span><br><span class="line"></span><br><span class="line">    # 2. 实例化一个转换器类</span><br><span class="line">    transfer = StandardScaler()</span><br><span class="line"></span><br><span class="line">    # 3.调用</span><br><span class="line">    data_new = transfer.fit_transform(data)</span><br><span class="line">    print(&quot;data_new:\n&quot;,data_new)</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    data_new:</span><br><span class="line"> [[ 0.33193158  0.41660188  0.24523407]</span><br><span class="line"> [-0.87247784  0.13992897  1.69385734]</span><br><span class="line"> [-0.34554872 -1.20667094 -0.05422437]</span><br><span class="line"> ...</span><br><span class="line"> [-0.32171752  0.96431572  0.06952649]</span><br><span class="line"> [ 0.65959911  0.60699509 -0.20931587]</span><br><span class="line"> [ 0.46120328  0.31183342  1.00680598]]</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    return None</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    stand_demo()</span><br></pre></td></tr></table></figure><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>标准化更适合用于大数据</p><h2 id="特征降维"><a href="#特征降维" class="headerlink" title="特征降维"></a>特征降维</h2><ul><li>处理对象二维数组<ul><li>降低（随机变量）特征的个数<ul><li>得到一组不相关的主变量的过程</li></ul></li></ul></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">比如有一组数据相对湿度与降雨量之间的相关</span><br><span class="line">我们要将这两组数据之间搞成不不相关管，否则会导致数据冗余，计算量太大</span><br><span class="line">会对算法学习的预测影响较大</span><br></pre></td></tr></table></figure><h3 id="降维方式"><a href="#降维方式" class="headerlink" title="降维方式"></a>降维方式</h3><ul><li>特征选择</li><li>主成分分析（可以理解一种特征提取的方式）</li></ul><h4 id="特征选择"><a href="#特征选择" class="headerlink" title="特征选择"></a>特征选择</h4><h5 id="Filter过滤式"><a href="#Filter过滤式" class="headerlink" title="Filter过滤式"></a>Filter过滤式</h5><ul><li>方差选择法：地方查特征过滤</li><li>相关系数<ul><li>衡量特征与特征之间的相关性</li></ul></li></ul><h5 id="Embeded嵌入式"><a href="#Embeded嵌入式" class="headerlink" title="Embeded嵌入式"></a>Embeded嵌入式</h5><ul><li>决策树</li><li>正则化</li><li>深度学习</li></ul><h3 id="过滤式"><a href="#过滤式" class="headerlink" title="过滤式"></a>过滤式</h3><h4 id="1-方差选择法"><a href="#1-方差选择法" class="headerlink" title="1.方差选择法"></a>1.方差选择法</h4><p>有小鸟🐦 判断它的品种，你不能看它是否有爪子，因为所有的鸟都有爪子</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_selection <span class="keyword">import</span> VarianceThreshold</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">variance_demo</span>():</span><br><span class="line">    data = pd.read_csv(<span class="string">r&quot;E:\Code\Pywork\Machine\data\factor_returns.csv&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;data:\n&quot;</span>,data)</span><br><span class="line">    data = data.iloc[:, <span class="number">1</span>:-<span class="number">2</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;data:\n&quot;</span>,data)</span><br><span class="line">    <span class="comment"># 这里的threshold是阈值大于它的就会被删去</span></span><br><span class="line">    transfer = VarianceThreshold(threshold=<span class="number">5</span>)</span><br><span class="line">    data_new = transfer.fit_transform(data)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;data_new:\n&quot;</span>, data_new, data_new.shape)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">D:\Programming\anaconda3\python.exe E:/Code/Pywork/Machine/机器学习/特征工程/特征降维/Filter过滤式/低方差过滤/低方差过滤.py</span></span><br><span class="line"><span class="string">data:</span></span><br><span class="line"><span class="string">             index  pe_ratio  pb_ratio  ...  total_expense        date    return</span></span><br><span class="line"><span class="string">0     000001.XSHE    5.9572    1.1818  ...   1.088254e+10  2012-01-31  0.027657</span></span><br><span class="line"><span class="string">1     000002.XSHE    7.0289    1.5880  ...   2.378348e+10  2012-01-31  0.082352</span></span><br><span class="line"><span class="string">2     000008.XSHE -262.7461    7.0003  ...   1.203008e+07  2012-01-31  0.099789</span></span><br><span class="line"><span class="string">3     000060.XSHE   16.4760    3.7146  ...   7.935543e+09  2012-01-31  0.121595</span></span><br><span class="line"><span class="string">4     000069.XSHE   12.5878    2.5616  ...   7.091398e+09  2012-01-31 -0.002681</span></span><br><span class="line"><span class="string"><span class="meta">... </span>          ...       ...       ...  ...            ...         ...       ...</span></span><br><span class="line"><span class="string">2313  601888.XSHG   25.0848    4.2323  ...   1.041419e+10  2012-11-30  0.060727</span></span><br><span class="line"><span class="string">2314  601901.XSHG   59.4849    1.6392  ...   1.089783e+09  2012-11-30  0.179148</span></span><br><span class="line"><span class="string">2315  601933.XSHG   39.5523    4.0052  ...   1.749295e+10  2012-11-30  0.137134</span></span><br><span class="line"><span class="string">2316  601958.XSHG   52.5408    2.4646  ...   6.009007e+09  2012-11-30  0.149167</span></span><br><span class="line"><span class="string">2317  601989.XSHG   14.2203    1.4103  ...   4.132842e+10  2012-11-30  0.183629</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[2318 rows x 12 columns]</span></span><br><span class="line"><span class="string">data:</span></span><br><span class="line"><span class="string">       pe_ratio  pb_ratio  ...       revenue  total_expense</span></span><br><span class="line"><span class="string">0       5.9572    1.1818  ...  2.070140e+10   1.088254e+10</span></span><br><span class="line"><span class="string">1       7.0289    1.5880  ...  2.930837e+10   2.378348e+10</span></span><br><span class="line"><span class="string">2    -262.7461    7.0003  ...  1.167983e+07   1.203008e+07</span></span><br><span class="line"><span class="string">3      16.4760    3.7146  ...  9.189387e+09   7.935543e+09</span></span><br><span class="line"><span class="string">4      12.5878    2.5616  ...  8.951453e+09   7.091398e+09</span></span><br><span class="line"><span class="string"><span class="meta">... </span>       ...       ...  ...           ...            ...</span></span><br><span class="line"><span class="string">2313   25.0848    4.2323  ...  1.148170e+10   1.041419e+10</span></span><br><span class="line"><span class="string">2314   59.4849    1.6392  ...  1.731713e+09   1.089783e+09</span></span><br><span class="line"><span class="string">2315   39.5523    4.0052  ...  1.789082e+10   1.749295e+10</span></span><br><span class="line"><span class="string">2316   52.5408    2.4646  ...  6.465392e+09   6.009007e+09</span></span><br><span class="line"><span class="string">2317   14.2203    1.4103  ...  4.509872e+10   4.132842e+10</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[2318 rows x 9 columns]</span></span><br><span class="line"><span class="string">data_new:</span></span><br><span class="line"><span class="string"> [[ 5.95720000e+00  1.18180000e+00  8.52525509e+10 ...  1.21144486e+12</span></span><br><span class="line"><span class="string">   2.07014010e+10  1.08825400e+10]</span></span><br><span class="line"><span class="string"> [ 7.02890000e+00  1.58800000e+00  8.41133582e+10 ...  3.00252062e+11</span></span><br><span class="line"><span class="string">   2.93083692e+10  2.37834769e+10]</span></span><br><span class="line"><span class="string"> [-2.62746100e+02  7.00030000e+00  5.17045520e+08 ...  7.70517753e+08</span></span><br><span class="line"><span class="string">   1.16798290e+07  1.20300800e+07]</span></span><br><span class="line"><span class="string"> ...</span></span><br><span class="line"><span class="string"> [ 3.95523000e+01  4.00520000e+00  1.70243430e+10 ...  2.42081699e+10</span></span><br><span class="line"><span class="string">   1.78908166e+10  1.74929478e+10]</span></span><br><span class="line"><span class="string"> [ 5.25408000e+01  2.46460000e+00  3.28790988e+10 ...  3.88380258e+10</span></span><br><span class="line"><span class="string">   6.46539204e+09  6.00900728e+09]</span></span><br><span class="line"><span class="string"> [ 1.42203000e+01  1.41030000e+00  5.91108572e+10 ...  2.02066110e+11</span></span><br><span class="line"><span class="string">   4.50987171e+10  4.13284212e+10]] (2318, 8)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Process finished with exit code 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    variance_demo()</span><br></pre></td></tr></table></figure><h4 id="2-相关系数"><a href="#2-相关系数" class="headerlink" title="2.相关系数"></a>2.相关系数</h4><ul><li>皮尔逊相关系数<ul><li>反应变量之间相关关系密切程度的统计指标</li></ul></li></ul><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230604153425798.png" alt="image-20230604153425798"></p><p>看最终r的值</p><ul><li><blockquote><p>大于 0 正相关          小于 0 负相关</p></blockquote></li><li><blockquote><p>r = 1 完全相关          r = 0 毫无关系</p></blockquote></li><li><blockquote><p>0&lt;|r|&lt;1时，存在相关   r ~ 1线性关系密切  r ~ 0 相关变弱</p></blockquote></li><li><blockquote><p>一般分为三级 </p><p>|r| &lt; 0.4低相关</p><p>0.4&lt;|r|&lt;0.7显著相关</p><p>0.7&lt;=|r|&lt;=1高度相关</p></blockquote></li></ul><h4 id="3-API-2"><a href="#3-API-2" class="headerlink" title="3.API"></a>3.API</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> scipy.stats <span class="keyword">import</span> pearsone</span><br></pre></td></tr></table></figure><h4 id="4-计算"><a href="#4-计算" class="headerlink" title="4.计算"></a>4.计算</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_selection <span class="keyword">import</span> VarianceThreshold</span><br><span class="line"><span class="keyword">from</span> scipy.stats <span class="keyword">import</span> pearsonr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">variance_demo</span>():</span><br><span class="line">    data = pd.read_csv(<span class="string">r&quot;E:\Code\Pywork\Machine\data\factor_returns.csv&quot;</span>)</span><br><span class="line">    data = data.iloc[:, <span class="number">1</span>:-<span class="number">2</span>]</span><br><span class="line">    r = pearsonr(data[<span class="string">&#x27;pe_ratio&#x27;</span>],data[<span class="string">&#x27;pb_ratio&#x27;</span>])</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;相关系数:&quot;</span>,r)</span><br><span class="line"><span class="comment">#     相关系数: PearsonRResult(statistic=-0.004389322779936274, pvalue=0.8327205496564927)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    variance_demo()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>如果特征与特征之间相关性很高</p><ol><li>选取其中一个</li><li>加权求和</li><li>主成分分析</li></ol><h3 id="主成分分析"><a href="#主成分分析" class="headerlink" title="主成分分析"></a>主成分分析</h3><p>多维转成二维能看出来是什么的</p><blockquote><p>做降维尽可能的保留原有的特征</p></blockquote><h5 id="API-1"><a href="#API-1" class="headerlink" title="API"></a>API</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sklean.decomposition.PCA(n_components=None)</span><br></pre></td></tr></table></figure><ul><li>将数据降维</li><li>n_components:<ul><li>小数：保留百分之多少的信息</li><li>整数：减少到多少特征</li></ul></li></ul><h2 id="instacart降维案例"><a href="#instacart降维案例" class="headerlink" title="instacart降维案例"></a>instacart降维案例</h2><p>先了解几个概念</p><ul><li><p>联表(交叉表): <a href="http://www.zzvips.com/article/188950.html">http://www.zzvips.com/article/188950.html</a></p></li><li><p>透视表: </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- 数据透视表是一种对大量数据快速汇总分析的交互式动态表格，它能够帮助用户统计分析数据。简单来说，数据透视表也就是对原始表进行分组聚合，压缩数据信息，把不必要的信息从原始数据中剔除，而只将我们想看到的数据信息展示到我们面前！</span><br></pre></td></tr></table></figure></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、获取数据</span></span><br><span class="line"><span class="comment"># 2、合并表</span></span><br><span class="line"><span class="comment"># 3、找到user_id和aisle之间的关系</span></span><br><span class="line"><span class="comment"># 4、PCA降维</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1、获取数据</span></span><br><span class="line">products = pd.read_csv(<span class="string">r&quot;C:\Users\beihai\Desktop\competition\数据\instacart\products.csv&quot;</span>)</span><br><span class="line">order_products = pd.read_csv(<span class="string">r&quot;C:\Users\beihai\Desktop\competition\数据\instacart\order_products__prior.csv&quot;</span>)</span><br><span class="line">orders = pd.read_csv(<span class="string">r&quot;C:\Users\beihai\Desktop\competition\数据\instacart\orders.csv&quot;</span>)</span><br><span class="line">aisles = pd.read_csv(<span class="string">r&quot;C:\Users\beihai\Desktop\competition\数据\instacart\aisles.csv&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、合并表</span></span><br><span class="line"><span class="comment"># order_products_prior.csv: 订单与商品信息</span></span><br><span class="line"><span class="comment"># 字段: order_idproduct_idadd_to_cart_orderreordered</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># products.csv: 商品信息</span></span><br><span class="line"><span class="comment"># 字段：product_idproduct_nameaisle_iddepartment_id</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># orders.csv 用户的订单信息</span></span><br><span class="line"><span class="comment"># 字段: order_iduser_ideval_setorder_numberorder_doworder_hour_of_daydays_since_prior_order</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># aisles.csv: 商品所属具体物品类别</span></span><br><span class="line"><span class="comment"># 字段: aisle_idaisle</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 合并aisles和products</span></span><br><span class="line">table1 = pd.merge(aisles,products, on=[<span class="string">&quot;aisle_id&quot;</span>,<span class="string">&quot;aisle_id&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 合并table1和order_products</span></span><br><span class="line">table2 = pd.merge(table1, order_products, on=[<span class="string">&#x27;product_id&#x27;</span>,<span class="string">&#x27;product_id&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 合并table2和orders</span></span><br><span class="line">table3 = pd.merge(table2,orders, on=[<span class="string">&#x27;order_id&#x27;</span>,<span class="string">&#x27;order_id&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 找到user_id和aisle之间的关系</span></span><br><span class="line"><span class="comment"># 交叉表</span></span><br><span class="line">table = pd.crosstab(table3[<span class="string">&#x27;user_id&#x27;</span>],table3[<span class="string">&#x27;aisle&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据量太大先选取前10000条数据</span></span><br><span class="line">data = table[:<span class="number">10000</span>]</span><br><span class="line"><span class="comment"># 特征值太多需要降维</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># PCA 降维</span></span><br><span class="line"><span class="keyword">from</span> sklearn.decomposition <span class="keyword">import</span> PCA</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1)实例化一个转换器类</span></span><br><span class="line">transfer = PCA(n_components=<span class="number">0.95</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2)调用fit_transform</span></span><br><span class="line">data_new = transfer.fit_transform(data)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(data_new,data_new.shape)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">(array([[-2.36456828e+01,  2.30028678e+00, -2.71706275e+00, ...,</span></span><br><span class="line"><span class="string">          8.24685231e-01, -5.20365905e-01,  2.99847178e+00],</span></span><br><span class="line"><span class="string">        [ 6.95477119e+00,  3.54966052e+01,  2.52655545e+00, ...,</span></span><br><span class="line"><span class="string">         -1.15326520e+00, -1.37969318e+00, -1.07115466e-02],</span></span><br><span class="line"><span class="string">        [-7.47792843e+00,  2.83147785e+00, -1.07306519e+01, ...,</span></span><br><span class="line"><span class="string">         -3.55104796e-01,  3.85595697e-02,  1.92318882e+00],</span></span><br><span class="line"><span class="string">        ...,</span></span><br><span class="line"><span class="string">        [-2.86664024e+01, -1.26446961e+00, -1.14908062e+00, ...,</span></span><br><span class="line"><span class="string">          1.13859569e-03,  4.14189764e-01,  4.46163585e-01],</span></span><br><span class="line"><span class="string">        [-2.88378748e+01, -1.70490822e+00, -1.47059942e+00, ...,</span></span><br><span class="line"><span class="string">         -1.62743887e-01,  6.72795951e-01,  9.64403654e-02],</span></span><br><span class="line"><span class="string">        [ 2.10412407e+02, -3.51935647e+01,  1.33671987e+01, ...,</span></span><br><span class="line"><span class="string">          1.46544596e+01,  1.56764794e+01,  1.67432890e+01]]),</span></span><br><span class="line"><span class="string"> (10000, 42))</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>第一节课总结：跟着黑马口说一遍</p><p><a href="https://www.bilibili.com/video/BV1nt411r7tj/?p=19&amp;spm_id_from=pageDriver&amp;vd_source=bed2588951fb9fd0821dd2ef0191e48b">https://www.bilibili.com/video/BV1nt411r7tj/?p=19&amp;spm_id_from=pageDriver&amp;vd_source=bed2588951fb9fd0821dd2ef0191e48b</a></p><h1 id="3-分类算法"><a href="#3-分类算法" class="headerlink" title="3.分类算法"></a>3.分类算法</h1><p>目标值: 类别 连续</p><p>1、sklearn：转换器和预估器</p><p>2、KNN算法</p><p>3、模型选择与调优</p><p>4、朴素贝叶斯算法</p><p>5、决策树</p><p>6、随机森林</p><h2 id="3-1sklearn转换器和预估器"><a href="#3-1sklearn转换器和预估器" class="headerlink" title="3.1sklearn转换器和预估器"></a>3.1sklearn转换器和预估器</h2><h3 id="3-1-1转换器"><a href="#3-1-1转换器" class="headerlink" title="3.1.1转换器"></a>3.1.1转换器</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">特征工程的-&gt;父类</span><br><span class="line">这里就是相当与之前我在做特征工程的使用用到的东西：</span><br><span class="line">1.先实例化</span><br><span class="line">2.调用fit_transform()</span><br><span class="line">fit()计算</span><br><span class="line">transform()最终转换</span><br></pre></td></tr></table></figure><h3 id="3-1-2估计器（esimator）"><a href="#3-1-2估计器（esimator）" class="headerlink" title="3.1.2估计器（esimator）"></a>3.1.2估计器（esimator）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sklearn机器学习算法的实现</span><br><span class="line"><span class="number">1.</span>实例化一个esimator</span><br><span class="line"><span class="number">2.</span>esimator.fit(x_train,y_train) 计算</span><br><span class="line">-调用完毕，模型生成</span><br><span class="line"><span class="number">3.</span>模型评估</span><br><span class="line">(<span class="number">1</span>)对比真实值，测试值</span><br><span class="line">y_predict = esimator.predict(x_test)</span><br><span class="line">y_test == y.predict</span><br><span class="line">    (<span class="number">2</span>)计算准确率</span><br><span class="line">    accuracy = esimator.score(x_test,y_test)</span><br></pre></td></tr></table></figure><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230606161951864.png" alt="image-20230606161951864" style="zoom:67%;" /></p><p>可以看出来它们都被完整的封装，所以机器学习有一套固定的流程</p><h2 id="3-2-K-近邻算法"><a href="#3-2-K-近邻算法" class="headerlink" title="3.2 K-近邻算法"></a>3.2 K-近邻算法</h2><h3 id="KNN算法"><a href="#KNN算法" class="headerlink" title="KNN算法"></a>KNN算法</h3><p>根据邻居来判断类别</p><p>近朱者赤，近墨者黑</p><h3 id="3-2-1-KNN简述与距离度量"><a href="#3-2-1-KNN简述与距离度量" class="headerlink" title="3.2.1 KNN简述与距离度量"></a>3.2.1 KNN简述与距离度量</h3><p>KNN（K-Nearest Neighbors,K近临算法）， 机器学习中最简单的算法</p><p>​                                    <strong><em>”离谁进，就是谁“</em></strong></p><p>用人眼看就知道这个绿色三角形就是轿车</p><p>但是机器没眼，只能靠精密的计算所以这里就引出来了距离度量的算法</p><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230601195802325.png" alt="image-20230601195802325"></p><h4 id="3-2-1-1-距离度量"><a href="#3-2-1-1-距离度量" class="headerlink" title="3.2.1.1 距离度量"></a>3.2.1.1 距离度量</h4><script type="math/tex; mode=display">欧式距离(L2)=sqrt((x1-x2)^2 + (y1-y2)^2)</script><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230601200248895.png" alt="image-20230601200248895"></p><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230601200653325.png" alt="image-20230601200653325" style="zoom: 80%;" /></p><h5 id="1-欧式距离"><a href="#1-欧式距离" class="headerlink" title="1.欧式距离"></a>1.欧式距离</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">空间之中 两点之间的直线距离</span><br></pre></td></tr></table></figure><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230601200820970.png" alt="image-20230601200820970" style="zoom: 67%;" /></p><h5 id="2-曼哈顿距离"><a href="#2-曼哈顿距离" class="headerlink" title="2.曼哈顿距离"></a>2.曼哈顿距离</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">就是我走路，不可能沿着直线走，所以我会拐着弯走</span><br><span class="line">这种方式就像在曼哈顿的街区里面去行走，最终到达目的地的距离</span><br></pre></td></tr></table></figure><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230601201204108.png" alt="image-20230601201204108"></p><h5 id="欧式距离和曼哈顿距离的使用"><a href="#欧式距离和曼哈顿距离的使用" class="headerlink" title="欧式距离和曼哈顿距离的使用"></a>欧式距离和曼哈顿距离的使用</h5><ul><li><p>欧式距离都比较可以适用</p></li><li><p>曼哈顿距离</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">适用于：</span><br><span class="line">求解过程中使得离群点的影响更小</span><br><span class="line">维度极高的数据 ---&gt;   特征的数量</span><br><span class="line">更适合数据维度没有归一化/不平衡</span><br></pre></td></tr></table></figure></li></ul><h5 id="3-明氏距离"><a href="#3-明氏距离" class="headerlink" title="3.明氏距离"></a>3.明氏距离</h5><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230601201711733.png" alt="image-20230601201711733"></p><h5 id="代码初体验"><a href="#代码初体验" class="headerlink" title="代码初体验"></a>代码初体验</h5><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230601202516052.png" alt="image-20230601202516052"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据集</span></span><br><span class="line">A = np.array([<span class="number">4.8</span>, <span class="number">2.2</span>])</span><br><span class="line">B = np.array([<span class="number">4.7</span>, <span class="number">2.1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 欧式距离</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cal_dist_L2</span>(<span class="params">A, B</span>):</span><br><span class="line">    distance_L2 = np.sqrt(np.<span class="built_in">sum</span>((A-B) ** <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> distance_L2</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(cal_dist_L2(A, B))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 曼哈顿距离</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">manhattan_distance</span>(<span class="params">A, B</span>):</span><br><span class="line">    distance = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(A)):</span><br><span class="line">        distance += <span class="built_in">abs</span>(A[i] - B[i])</span><br><span class="line">    <span class="keyword">return</span> distance</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(manhattan_distance(A, B))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 明氏距离</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">minkowski_distance</span>(<span class="params">A, B, p</span>):</span><br><span class="line">    distance = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(A)):</span><br><span class="line">        distance += np.sqrt(<span class="built_in">abs</span>(A[i] - B[i]) ** p) ** p</span><br><span class="line">    <span class="keyword">return</span> distance</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(minkowski_distance(A, B, <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#0.1414213562373093</span></span><br><span class="line"><span class="comment">#0.19999999999999973</span></span><br><span class="line"><span class="comment">#0.01999999999999995</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可以看出来算法不同相差的结果很大</p><p>所以看那些比赛中的排名就是对数据的处理和算法的选择不同而导致得分相差</p><h4 id="3-2-2-KNN算法实现步骤"><a href="#3-2-2-KNN算法实现步骤" class="headerlink" title="3.2.2 KNN算法实现步骤"></a>3.2.2 KNN算法实现步骤</h4><h5 id="2-1-算法基本思路"><a href="#2-1-算法基本思路" class="headerlink" title="2.1 算法基本思路"></a>2.1 算法基本思路</h5><ol><li>计算距离</li><li>排序</li><li>取前K个样本 ——&gt; 超参数：K值，调参和优化</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">这玩意就是</span><br><span class="line">1.首先我先用距离度量公式去计算每个样本空间中与样本之间的距离</span><br><span class="line">2.其次我对这些距离进行排序，从小到大，然后取前K个样本</span><br><span class="line">3.然后我看这些里面有多少个🚚多少个🚗，然后计算占比</span><br><span class="line">  最终根据这个占比就可以得出谁的概率大</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">我就感觉这里有些不对劲  那如果我选的样本中🚗本来就少，那我取前K个样本，肯定🚗占比就少了，所以合理选择这个K有点说法，这算法有待提高</span><br></pre></td></tr></table></figure><p>这里对于优化超参数</p><p>通常就是取若干个超参数：K值  —-&gt;  取得若干个结果 ——&gt; 若干个评估</p><p>最后这个评估最优的就选这个K值作为超参数</p><h5 id="k值选取策略"><a href="#k值选取策略" class="headerlink" title="k值选取策略"></a>k值选取策略</h5><ul><li>奇数</li><li>k &lt; 一个值 通常是 20 </li></ul><h4 id="3-2-3-KNN算法的优缺点及改进"><a href="#3-2-3-KNN算法的优缺点及改进" class="headerlink" title="3.2.3 KNN算法的优缺点及改进"></a>3.2.3 KNN算法的优缺点及改进</h4><h5 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h5><ul><li><p>易于理解</p></li><li><p>不需要庞大的样本数量</p></li><li><p>对于异常值不敏感</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">对离它近的敏感，太远的不鸟它</span><br></pre></td></tr></table></figure></li><li><p>是天然的多分类器</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">只需要关注距离它的几个</span><br></pre></td></tr></table></figure></li><li><p>不需要训练，求解参数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">有些鸡肋</span><br></pre></td></tr></table></figure></li></ul><h5 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h5><ul><li><p>数据量大时计算量太大</p></li><li><p>不平衡样本处理能力差</p><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230601212555814.png" alt="image-20230601212555814" style="zoom: 50%;" /></p></li><li><p>并不“学习”</p></li><li><p>速度慢、准确率低</p></li></ul><h4 id="改进"><a href="#改进" class="headerlink" title="改进"></a>改进</h4><h5 id="加权平均KNN"><a href="#加权平均KNN" class="headerlink" title="加权平均KNN"></a>加权平均KNN</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">正常情况下是只看投票结果</span><br><span class="line">加权，就是把所带的类型也算上通过一定的计算方法</span><br></pre></td></tr></table></figure><p>权重算法：</p><p>就是距离离得远的权重就低，距离离的近的权重就高</p><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230602000608822.png" alt="image-20230602000608822"></p><h4 id="3-2-4-KNN机器学习应用"><a href="#3-2-4-KNN机器学习应用" class="headerlink" title="3.2.4 KNN机器学习应用"></a>3.2.4 KNN机器学习应用</h4><h5 id="3-2-4-1-徒手写"><a href="#3-2-4-1-徒手写" class="headerlink" title="3.2.4.1 徒手写"></a>3.2.4.1 徒手写</h5><p>麻烦，正常不会使用</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pylab <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">data = pd.read_csv(<span class="string">&quot;vehicle.csv&quot;</span>)</span><br><span class="line"></span><br><span class="line">plt.scatter(data[<span class="string">&#x27;length&#x27;</span>][data[<span class="string">&#x27;label&#x27;</span>]==<span class="string">&#x27;car&#x27;</span>],data[<span class="string">&#x27;width&#x27;</span>][data[<span class="string">&#x27;label&#x27;</span>]==<span class="string">&#x27;car&#x27;</span>],edgecolors=<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">plt.scatter(data[<span class="string">&#x27;length&#x27;</span>][data[<span class="string">&#x27;label&#x27;</span>]==<span class="string">&#x27;truck&#x27;</span>],data[<span class="string">&#x27;width&#x27;</span>][data[<span class="string">&#x27;label&#x27;</span>]==<span class="string">&#x27;truck&#x27;</span>],edgecolors=<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line">feature = np.array(data.iloc[:,<span class="number">0</span>:<span class="number">2</span>])</span><br><span class="line">labels = data[<span class="string">&#x27;label&#x27;</span>].tolist()</span><br><span class="line"><span class="built_in">print</span>(feature)</span><br><span class="line"><span class="built_in">print</span>(labels)</span><br><span class="line"></span><br><span class="line">test=[<span class="number">4.7</span>, <span class="number">2.1</span>]</span><br><span class="line">numSamples = data.shape[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 距离</span></span><br><span class="line">diff = np.tile(test, (numSamples, <span class="number">1</span>)) - feature</span><br><span class="line">squreDiff = diff ** <span class="number">2</span></span><br><span class="line">squreDiff = np.<span class="built_in">sum</span>(squreDiff, axis = <span class="number">1</span>)</span><br><span class="line">distance = squreDiff ** <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 排序</span></span><br><span class="line">sorteDisIndices = np.argsort(distance)</span><br><span class="line">k = <span class="number">9</span></span><br><span class="line">classCount = &#123;&#125;</span><br><span class="line">label_count = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">    voteLabel = labels[sorteDisIndices[i]]</span><br><span class="line">    classCount[voteLabel] = classCount.get(voteLabel, <span class="number">0</span>) + <span class="number">1</span></span><br><span class="line">    label_count.append(voteLabel)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line">word_counts = Counter(label_count)</span><br><span class="line">top = word_counts.most_common(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># [(&#x27;truck&#x27;, 5)]</span></span><br></pre></td></tr></table></figure><h5 id="3-2-4-2-Sklearn-Scikit-learn-框架"><a href="#3-2-4-2-Sklearn-Scikit-learn-框架" class="headerlink" title="3.2.4.2 Sklearn(Scikit-learn)框架"></a>3.2.4.2 Sklearn(Scikit-learn)框架</h5><h6 id="鸢尾花种类预测"><a href="#鸢尾花种类预测" class="headerlink" title="鸢尾花种类预测"></a>鸢尾花种类预测</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">获取数据</span></span><br><span class="line"><span class="string">数据集划分</span></span><br><span class="line"><span class="string">特征工程：</span></span><br><span class="line"><span class="string">        标准化     降维</span></span><br><span class="line"><span class="string">KNN预估器</span></span><br><span class="line"><span class="string">模型评估</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_iris</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line"><span class="keyword">from</span> sklearn.neighbors <span class="keyword">import</span> KNeighborsClassifier</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">knn_iris</span>():</span><br><span class="line">    <span class="comment"># 获取数据</span></span><br><span class="line">    iris = load_iris()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 划分数据集</span></span><br><span class="line">    x_train, x_test, y_train, y_test = train_test_split(iris.data,iris.target,random_state=<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 实例化对象</span></span><br><span class="line">    transfer = StandardScaler()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#特征工程       无量纲化</span></span><br><span class="line">    x_train = transfer.fit_transform(x_train)</span><br><span class="line">    <span class="comment"># 只标准化 不计算</span></span><br><span class="line">    x_test = transfer.transform(x_test)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#实现算法                           K值设置</span></span><br><span class="line">    estimator = KNeighborsClassifier(n_neighbors=<span class="number">3</span>)</span><br><span class="line">    <span class="comment"># 算法计算      训练集特征值  训练集目标值</span></span><br><span class="line">    estimator.fit(x_train,y_train)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#  KNN预估器                   训练集特征值</span></span><br><span class="line">    y_predict = estimator.predict(x_test)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;y_predict:\n&quot;</span>, y_predict)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;直接比对真实值和预测值:\n&quot;</span>, y_test == y_predict)</span><br><span class="line"></span><br><span class="line">    score = estimator.score(x_test, y_test)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;准确率为: \n&quot;</span>, score)</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    knn_iris()</span><br></pre></td></tr></table></figure><h4 id="3-2-5-案例：预测facebook签到位置"><a href="#3-2-5-案例：预测facebook签到位置" class="headerlink" title="3.2.5 案例：预测facebook签到位置"></a>3.2.5 案例：预测facebook签到位置</h4><p>流程分析:</p><ol><li><p>获取数据</p></li><li><p>数据处理</p><p>目的：</p><p>​    特征值 x</p><p>​    目标值 y</p><p>​    a. 缩小数据范围</p><p>​        2 &lt; x &lt; 2.5</p><p>​        1.0 &lt; y &lt; 1.5</p><p>​    b.time  -&gt; 年月日时分秒</p><p>​    c.过滤签到次数少的地点</p></li><li><p>特征工程：标准化</p></li><li><p>KNN算法预估流程</p></li><li><p>模型选择与调优</p></li><li><p>模型评估</p></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3-3-模型选择与调优"><a href="#3-3-模型选择与调优" class="headerlink" title="3.3 模型选择与调优"></a>3.3 模型选择与调优</h2><h3 id="3-3-1-交叉验证"><a href="#3-3-1-交叉验证" class="headerlink" title="3.3.1 交叉验证"></a>3.3.1 交叉验证</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">就是将训练集再分为 训练集和验证集，</span><br><span class="line">例如分为四份，分别测试训练，得到准确率，最终平均值作为最优的</span><br></pre></td></tr></table></figure><h3 id="3-3-2-超参数搜索-网格搜索-Grid-Search"><a href="#3-3-2-超参数搜索-网格搜索-Grid-Search" class="headerlink" title="3.3.2 超参数搜索-网格搜索(Grid Search)"></a>3.3.2 超参数搜索-网格搜索(Grid Search)</h3><h4 id="API-2"><a href="#API-2" class="headerlink" title="API"></a>API</h4><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230607100157679.png" alt="image-20230607100157679" style="zoom:67%;" /></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">获取数据</span></span><br><span class="line"><span class="string">数据集划分</span></span><br><span class="line"><span class="string">特征工程：</span></span><br><span class="line"><span class="string">        标准化     降维</span></span><br><span class="line"><span class="string">KNN预估器</span></span><br><span class="line"><span class="string">模型评估</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_iris</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line"><span class="keyword">from</span> sklearn.neighbors <span class="keyword">import</span> KNeighborsClassifier</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> GridSearchCV</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">knn_iris</span>():</span><br><span class="line">    <span class="comment"># 获取数据</span></span><br><span class="line">    iris = load_iris()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 划分数据集</span></span><br><span class="line">    x_train, x_test, y_train, y_test = train_test_split(iris.data, iris.target, random_state=<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 实例化对象</span></span><br><span class="line">    transfer = StandardScaler()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 特征工程       无量纲化</span></span><br><span class="line">    x_train = transfer.fit_transform(x_train)</span><br><span class="line">    <span class="comment"># 只标准化 不计算</span></span><br><span class="line">    x_test = transfer.transform(x_test)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 实现算法                           K值设置</span></span><br><span class="line">    estimator = KNeighborsClassifier(n_neighbors=<span class="number">3</span>)</span><br><span class="line">    <span class="comment"># 算法计算      训练集特征值  训练集目标值</span></span><br><span class="line">    estimator.fit(x_train, y_train)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#  KNN预估器                   测试集特征值</span></span><br><span class="line">    y_predict = estimator.predict(x_test)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;y_predict:\n&quot;</span>, y_predict)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;直接比对真实值和预测值:\n&quot;</span>, y_test == y_predict)</span><br><span class="line"></span><br><span class="line">    score = estimator.score(x_test, y_test)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;准确率为: \n&quot;</span>, score)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">knn_iris_gscv</span>():</span><br><span class="line">    <span class="comment"># 获取数据</span></span><br><span class="line">    iris = load_iris()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 划分数据集</span></span><br><span class="line">    x_train, x_test, y_train, y_test = train_test_split(iris.data, iris.target, random_state=<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 实例化对象</span></span><br><span class="line">    transfer = StandardScaler()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 特征工程       无量纲化</span></span><br><span class="line">    x_train = transfer.fit_transform(x_train)</span><br><span class="line">    <span class="comment"># 只标准化 不计算</span></span><br><span class="line">    x_test = transfer.transform(x_test)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 实现算法</span></span><br><span class="line">    estimator = KNeighborsClassifier()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 网格搜索</span></span><br><span class="line">    param_dict = &#123;<span class="string">&quot;n_neighbors&quot;</span>: [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>]&#125;</span><br><span class="line">    estimator = GridSearchCV(estimator, param_grid=param_dict, cv=<span class="number">10</span>)</span><br><span class="line">    <span class="comment"># 算法计算      训练集特征值  训练集目标值</span></span><br><span class="line">    estimator.fit(x_train, y_train)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#  KNN预估器                   测试集特征值</span></span><br><span class="line">    y_predict = estimator.predict(x_test)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;y_predict:\n&quot;</span>, y_predict)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;直接比对真实值和预测值:\n&quot;</span>, y_test == y_predict)</span><br><span class="line"></span><br><span class="line">    score = estimator.score(x_test, y_test)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;准确率为: \n&quot;</span>, score)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;最佳参数:\n&quot;</span>, estimator.best_params_)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;最佳结果:\n&quot;</span>, estimator.best_score_)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;最佳估计器:\n&quot;</span>, estimator.best_estimator_)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;交叉验证结果:\n&quot;</span>, estimator.cv_results_)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># knn_iris()</span></span><br><span class="line">    knn_iris_gscv()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3-4-朴素贝叶斯"><a href="#3-4-朴素贝叶斯" class="headerlink" title="3.4 朴素贝叶斯"></a>3.4 朴素贝叶斯</h2><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230607145322451.png" alt="image-20230607145322451"></p><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230611085809644.png" alt="image-20230611085809644"></p>]]></content>
      
      
      <categories>
          
          <category> 大数据 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 人工智能 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>机器学习数学公式</title>
      <link href="/2023/06/03/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F/"/>
      <url>/2023/06/03/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="机器学习数学公式"><a href="#机器学习数学公式" class="headerlink" title="机器学习数学公式"></a>机器学习数学公式</h1><h2 id="三差公式"><a href="#三差公式" class="headerlink" title="三差公式"></a>三差公式</h2><h3 id="偏差"><a href="#偏差" class="headerlink" title="偏差"></a>偏差</h3><p>一组数据中每一项的值减去平均值之和</p><h4 id="偏差平方和"><a href="#偏差平方和" class="headerlink" title="偏差平方和"></a>偏差平方和</h4><p>一组数据中(每一项的值 - 平均值)^2之和</p><h3 id="方差"><a href="#方差" class="headerlink" title="方差"></a>方差</h3><p><a href="https://baike.baidu.com/item/%E6%A0%87%E5%87%86%E5%B7%AE%E5%85%AC%E5%BC%8F/7238847?fr=ge_ala">https://baike.baidu.com/item/%E6%A0%87%E5%87%86%E5%B7%AE%E5%85%AC%E5%BC%8F/7238847?fr=ge_ala</a></p><p>用各偏差平方和的平均数来衡量数据的稳定性</p><p>一般，各数据与它们的平均数的差的平方的平均数叫做这组 数据的方差</p><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230710091645210.png" alt="image-20230710091645210"></p><p>==<strong>计算步骤</strong>==</p><ol><li>利用平均数公式计算这组数据的平均数</li><li>利用方差公式计算这组数据的方差</li></ol><h3 id="标准差"><a href="#标准差" class="headerlink" title="标准差"></a>标准差</h3><ul><li><p>数据的单位与方差的单位不一定一致</p></li><li><p>为了使单位一致，可以用方差的算数平方根 -</p></li></ul><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230710092241608.png" alt="image-20230710092241608"></p><h3 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h3><p><a href="https://blog.csdn.net/bitcarmanlee/article/details/110471328">https://blog.csdn.net/bitcarmanlee/article/details/110471328</a></p>]]></content>
      
      
      <categories>
          
          <category> 大数据 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 人工智能 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSM框架</title>
      <link href="/2023/05/23/SSM%E6%A1%86%E6%9E%B6/"/>
      <url>/2023/05/23/SSM%E6%A1%86%E6%9E%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="一、MyBatis"><a href="#一、MyBatis" class="headerlink" title="一、MyBatis"></a>一、MyBatis</h1><h2 id="1-MyBatis入门案例"><a href="#1-MyBatis入门案例" class="headerlink" title="1. MyBatis入门案例"></a>1. MyBatis入门案例</h2><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230524091416943.png" alt="image-20230524091416943"></p><h3 id="查询所有用户信息-selectAll"><a href="#查询所有用户信息-selectAll" class="headerlink" title="查询所有用户信息-selectAll"></a>查询所有用户信息-selectAll</h3><p>1.导入mybatis.sql文件，初始化mybatis数据库</p><p>2.创建空工程MyBatisProject,创建模块mybatis-intro，导入POM坐标,在项目的 resources 目录下复制logback的配置文件</p><p>POM坐标依赖项，请补全</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- mybatis --&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- mysql 驱动 --&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- junit 驱动 --&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 添加slf4j日志api --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 添加logback-classic依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 添加logback-core依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3.创建实体层com.itbbj.domain，创建实体类User,参考数据库字典编码。</p><p>参考代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itbbj.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>4.创建数据库映射层com.itbbj.mapper,创建接口UserMapper,编码selectAll。</p><p>参考代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itbbj.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itbbj.domain.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    List&lt;User&gt; <span class="title function_">selectAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>5.在模块的 resources 目录下创建映射配置文件 UserMapper.xml，注意创建文件夹路径com/itbbj/mapper</p><p>参考代码</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;org.mybatis.example.BlogMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectBlog&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span></span><br><span class="line">        select * from Blog where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>6.在模块的 resources 目录下创建mybatis的配置文件 mybatis-config.xml</p><p>参考代码</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql:///mybatis?useSSL=false&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/example/BlogMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>7.在模块的 test目录java下创建com.itbbj.test层，创建UserTest类，编码。</p><p>参考代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itbbj.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itbbj.domain.User;</span><br><span class="line"><span class="keyword">import</span> com.itbbj.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSeleteAll</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//1.读取配置文件--在resources文件夹下可以直接读到</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line">        <span class="comment">//2.创建SqlSessionFactory工厂</span></span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line">        <span class="comment">//3.使用工厂生产SqlSession对象</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">        <span class="comment">//4.使用SqlSession创建Dao接口的代理对象</span></span><br><span class="line">        <span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">        <span class="comment">//5.使用代理对象执行方法</span></span><br><span class="line">        List&lt;User&gt; users = userMapper.selectAll();</span><br><span class="line">        System.out.println(users);</span><br><span class="line">        <span class="comment">//6.释放资源</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line">        inputStream.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="1-1-根据Id查询用户信息-selectById"><a href="#1-1-根据Id查询用户信息-selectById" class="headerlink" title="1.1 根据Id查询用户信息-selectById"></a>1.1 根据Id查询用户信息-selectById</h3><p>1.重构UserMapper接口，加入selectById方法。</p><p>实现代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    List&lt;User&gt; <span class="title function_">selectAll</span><span class="params">()</span>;</span><br><span class="line">    User <span class="title function_">selectById</span><span class="params">(Integer id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.重构UserMapper.xml，加入selectById节点</p><p>实现代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;selectById&quot;</span> resultType=<span class="string">&quot;com.itbbj.domain.User&quot;</span>&gt;</span><br><span class="line">    select * from user <span class="type">where</span> <span class="variable">id</span> <span class="operator">=</span> #&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure><p>3.重构UserTest</p><p>实现代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">teseById</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">//1.读取配置文件--在resources文件夹下可以直接读到</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;</span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line">    <span class="comment">//2.创建SqlSessionFactory工厂</span></span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line">    <span class="comment">//3.使用工厂生产SqlSession对象</span></span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">    <span class="comment">//4.使用SqlSession创建Dao接口的代理对象</span></span><br><span class="line">    <span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">    <span class="comment">//5.使用代理对象执行方法</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectById(<span class="number">42</span>);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">    <span class="comment">//6.释放资源</span></span><br><span class="line">    sqlSession.close();</span><br><span class="line">    inputStream.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-2-优化Test测试类"><a href="#1-2-优化Test测试类" class="headerlink" title="1.2 优化Test测试类"></a>1.2 优化Test测试类</h3><p>添加了Before和After，</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itbbj.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itbbj.domain.User;</span><br><span class="line"><span class="keyword">import</span> com.itbbj.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserTest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> InputStream inputStream;</span><br><span class="line">    <span class="keyword">private</span> SqlSession sqlSession;</span><br><span class="line">    <span class="keyword">private</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Before*********************************&quot;</span>);</span><br><span class="line">        <span class="comment">//1.读取配置文件--在resources文件夹下可以直接读到</span></span><br><span class="line">        inputStream = Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//2.创建SqlSessionFactory工厂</span></span><br><span class="line">        sqlSessionFactory = <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line">        <span class="comment">//3.使用工厂生产SqlSession对象</span></span><br><span class="line">        sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">        <span class="comment">//4.使用SqlSession创建Dao接口的代理对象</span></span><br><span class="line">        userMapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destory</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        sqlSession.close();</span><br><span class="line">        inputStream.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSeleteAll</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        List&lt;User&gt; users = userMapper.selectAll();</span><br><span class="line">        System.out.println(users);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">teseById</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectById(<span class="number">42</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2-核心配置文件"><a href="#2-核心配置文件" class="headerlink" title="2. 核心配置文件"></a>2. 核心配置文件</h2><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230524110144826.png" alt="image-20230524110144826"></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Mysql知识点</title>
      <link href="/2023/05/21/Mysql%E7%9F%A5%E8%AF%86%E7%82%B9/"/>
      <url>/2023/05/21/Mysql%E7%9F%A5%E8%AF%86%E7%82%B9/</url>
      
        <content type="html"><![CDATA[<p>z</p><ol><li><p>创建数据库</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database yyh <span class="type">character</span> <span class="keyword">set</span> utf8mb4 <span class="keyword">collate</span> utf8mb4_unicode_ci</span><br></pre></td></tr></table></figure></li><li><p>创建表</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create table mytable (</span><br><span class="line">id int auto_increment primary key,</span><br><span class="line">name varchar(15)</span><br><span class="line">) engine =innoDB DEFAULT charset=utf8 row_format=DYNAMIC;</span><br></pre></td></tr></table></figure></li><li><p>列分隔符</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Mysql中，建表不支持列分隔符，列分隔符通常用于导入或导出数据时的配置选项</span><br><span class="line">LOAD DATA INFILE <span class="string">&#x27;data.txt&#x27;</span></span><br><span class="line"><span class="keyword">INTO</span> <span class="keyword">TABLE</span> mytable</span><br><span class="line">FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;,&#x27;</span> <span class="comment">-- 这里指定逗号为列分隔符</span></span><br><span class="line">LINES TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;\n&#x27;</span> <span class="comment">-- 这里指定换行符为行分隔符</span></span><br><span class="line">(col1, col2, col3); <span class="comment">-- 指定要导入的列</span></span><br></pre></td></tr></table></figure></li><li><p>行分隔符</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">在MySQL中，ROW_FORMAT是用于指定表的行存储格式的选项。它定义了MySQL存储引擎在磁盘上如何组织和存储表的行数据。</span><br><span class="line"></span><br><span class="line">以下是关于不同取值的解释：</span><br><span class="line"></span><br><span class="line"><span class="keyword">DYNAMIC</span>：动态行格式。它是InnoDB存储引擎的默认行格式。它允许行的长度可变，并且对于较短的行使用较少的存储空间。这种格式对于表中包含大量可变长度的列（例如<span class="type">VARCHAR</span>列）或包含较少列的宽表非常适用。</span><br><span class="line"></span><br><span class="line">COMPACT：紧凑行格式。它是InnoDB存储引擎的另一种行格式。它以固定长度存储每行数据，这对于行比较短且没有大量可变长度的列的表非常适用。这种格式的行通常占用更少的存储空间，并且可以提高查询性能。</span><br><span class="line"></span><br><span class="line">REDUNDANT：冗余行格式。这是InnoDB存储引擎的一种旧的行格式，现已不推荐使用。它以固定长度存储每行数据，并在每个索引键列中存储重复数据，导致存储空间占用更大。</span><br></pre></td></tr></table></figure></li><li></li></ol><ol><li><p>查询学生信息表中的张姓同学</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> 学生信息表 <span class="keyword">where</span> 姓名 <span class="keyword">like</span> <span class="string">&#x27;张%&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p>查询学生信息表中的名字只有一个字符的学生情况</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> 学生信息表 <span class="keyword">where</span> 姓名 <span class="keyword">like</span> <span class="string">&#x27;张_&#x27;</span></span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>网络编程</title>
      <link href="/2023/05/21/Request&amp;Response/"/>
      <url>/2023/05/21/Request&amp;Response/</url>
      
        <content type="html"><![CDATA[<h2 id="Request-amp-Response"><a href="#Request-amp-Response" class="headerlink" title="Request&amp;Response"></a>Request&amp;Response</h2><p><strong>今日目标</strong></p><blockquote><ul><li>掌握Request对象的概念与使用</li><li>掌握Response对象的概念与使用</li><li>能够完成用户登录注册案例的实现</li><li>能够完成SqlSessionFactory工具类的抽取</li></ul></blockquote><h2 id="1，Request和Response的概述"><a href="#1，Request和Response的概述" class="headerlink" title="1，Request和Response的概述"></a>1，Request和Response的概述</h2><p>==Request是请求对象，Response是响应对象。==这两个对象在我们使用Servlet的时候有看到：<img src="assets/1628735216156.png" alt="1628735216156"></p><p>此时，我们就需要思考一个问题request和response这两个参数的作用是什么?</p><p><img src="assets/1628735746602.png" alt="1628735746602"></p><ul><li>request:==获取==请求数据<ul><li>浏览器会发送HTTP请求到后台服务器[Tomcat]</li><li>HTTP的请求中会包含很多请求数据[请求行+请求头+请求体]</li><li>后台服务器[Tomcat]会对HTTP请求中的数据进行解析并把解析结果存入到一个对象中</li><li>所存入的对象即为request对象，所以我们可以从request对象中获取请求的相关参数</li><li>获取到数据后就可以继续后续的业务，比如获取用户名和密码就可以实现登录操作的相关业务</li></ul></li><li>response:==设置==响应数据<ul><li>业务处理完后，后台就需要给前端返回业务处理的结果即响应数据</li><li>把响应数据封装到response对象中</li><li>后台服务器[Tomcat]会解析response对象,按照[响应行+响应头+响应体]格式拼接结果</li><li>浏览器最终解析结果，把内容展示在浏览器给用户浏览</li></ul></li></ul><p>对于上述所讲的内容，我们通过一个案例来初步体验下request和response对象的使用。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo3&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletDemo3</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//使用request对象 获取请求数据</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;name&quot;</span>);<span class="comment">//url?name=zhangsan</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//使用response对象 设置响应数据</span></span><br><span class="line">        response.setHeader(<span class="string">&quot;content-type&quot;</span>,<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">        response.getWriter().write(<span class="string">&quot;&lt;h1&gt;&quot;</span>+name+<span class="string">&quot;,欢迎您！&lt;/h1&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Post...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>启动成功后就可以通过浏览器来访问，并且根据传入参数的不同就可以在页面上展示不同的内容:</p><p><img src="assets/1628738273049.png" alt="1628738273049"></p><p><strong>小结</strong></p><p>在这节中，我们主要认识了下request对象和reponse对象:</p><ul><li>request对象是用来封装请求数据的对象</li><li>response对象是用来封装响应数据的对象</li></ul><p>目前我们只知道这两个对象是用来干什么的，那么它们具体是如何实现的，就需要我们继续深入的学习。接下来，就先从Request对象来学习,主要学习下面这些内容:</p><ul><li><p>request继承体系</p></li><li><p>request获取请求参数</p></li><li>request请求转发</li></ul><h2 id="2，Request对象"><a href="#2，Request对象" class="headerlink" title="2，Request对象"></a>2，Request对象</h2><h3 id="2-1-Request继承体系"><a href="#2-1-Request继承体系" class="headerlink" title="2.1 Request继承体系"></a>2.1 Request继承体系</h3><p>在学习这节内容之前，我们先思考一个问题，前面在介绍Request和Reponse对象的时候，比较细心的同学可能已经发现：</p><ul><li>当我们的Servlet类实现的是Servlet接口的时候，service方法中的参数是ServletRequest和ServletResponse</li><li>当我们的Servlet类继承的是HttpServlet类的时候，doGet和doPost方法中的参数就变成HttpServletRequest和HttpServletReponse</li></ul><p>那么，</p><ul><li>ServletRequest和HttpServletRequest的关系是什么?</li><li>request对象是有谁来创建的?</li><li>request提供了哪些API,这些API从哪里查?</li></ul><p>首先，我们先来看下Request的继承体系:</p><p><img src="assets/1628740441008.png" alt="1628740441008"></p><p>从上图中可以看出，ServletRequest和HttpServletRequest都是Java提供的，所以我们可以打开JavaEE提供的API文档[参考: 资料/JavaEE7-api.chm],打开后可以看到:</p><p><img src="assets/1628741839475.png" alt="1628741839475"></p><p>所以ServletRequest和HttpServletRequest是继承关系，并且两个都是接口，接口是无法创建对象，这个时候就引发了下面这个问题:</p><p><img src="assets/1628742224589.png" alt="1628742224589"></p><p>这个时候，我们就需要用到Request继承体系中的<code>RequestFacade</code>:</p><ul><li>该类实现了HttpServletRequest接口，也间接实现了ServletRequest接口。</li><li>Servlet类中的service方法、doGet方法或者是doPost方法最终都是由Web服务器[Tomcat]来调用的，所以Tomcat提供了方法参数接口的具体实现类，并完成了对象的创建</li><li>要想了解RequestFacade中都提供了哪些方法，我们可以直接查看JavaEE的API文档中关于ServletRequest和HttpServletRequest的接口文档，因为RequestFacade实现了其接口就需要重写接口中的方法</li></ul><p>对于上述结论，要想验证，可以编写一个Servlet，在方法中把request对象打印下，就能看到最终的对象是不是RequestFacade,代码如下:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletDemo2</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>启动服务器，运行访问<code>http://localhost:8080/request-demo/demo2</code>,得到运行结果:</p><p><img src="assets/1628743040046.png" alt="1628743040046"></p><p><strong>小结</strong></p><ul><li>Request的继承体系为ServletRequest—&gt;HttpServletRequest—&gt;RequestFacade</li><li>Tomcat需要解析请求数据，封装为request对象,并且创建request对象传递到service方法</li><li>使用request对象，可以查阅JavaEE API文档的HttpServletRequest接口中方法说明</li></ul><h3 id="2-2-Request获取请求数据"><a href="#2-2-Request获取请求数据" class="headerlink" title="2.2 Request获取请求数据"></a>2.2 Request获取请求数据</h3><p>HTTP请求数据总共分为三部分内容，分别是==请求行、请求头、请求体==，对于这三部分内容的数据，分别该如何获取，首先我们先来学习请求行数据如何获取?</p><h4 id="2-2-1-获取请求行数据"><a href="#2-2-1-获取请求行数据" class="headerlink" title="2.2.1 获取请求行数据"></a>2.2.1 获取请求行数据</h4><p>请求行包含三块内容，分别是<code>请求方式</code>、<code>请求资源路径</code>、<code>HTTP协议及版本</code></p><p><img src="assets/1628748240075.png" alt="1628748240075"></p><p>对于这三部分内容，request对象都提供了对应的API方法来获取，具体如下:</p><ul><li>获取请求方式: <code>GET</code></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String getMethod()</span><br></pre></td></tr></table></figure><ul><li>获取虚拟目录(项目访问路径): <code>/request-demo</code></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String getContextPath()</span><br></pre></td></tr></table></figure><ul><li>获取URL(统一资源定位符): <code>http://localhost:8080/request-demo/req1</code></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">StringBuffer getRequestURL()</span><br></pre></td></tr></table></figure><ul><li>获取URI(统一资源标识符): <code>/request-demo/req1</code></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String getRequestURI()</span><br></pre></td></tr></table></figure><ul><li>获取请求参数(GET方式): <code>username=zhangsan&amp;password=123</code></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String getQueryString()</span><br></pre></td></tr></table></figure><p>介绍完上述方法后，咱们通过代码把上述方法都使用下:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * request 获取请求数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/req1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestDemo1</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// String getMethod()：获取请求方式： GET</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> req.getMethod();</span><br><span class="line">        System.out.println(method);<span class="comment">//GET</span></span><br><span class="line">        <span class="comment">// String getContextPath()：获取虚拟目录(项目访问路径)：/request-demo</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">contextPath</span> <span class="operator">=</span> req.getContextPath();</span><br><span class="line">        System.out.println(contextPath);</span><br><span class="line">        <span class="comment">// StringBuffer getRequestURL(): 获取URL(统一资源定位符)：http://localhost:8080/request-demo/req1</span></span><br><span class="line">        <span class="type">StringBuffer</span> <span class="variable">url</span> <span class="operator">=</span> req.getRequestURL();</span><br><span class="line">        System.out.println(url.toString());</span><br><span class="line">        <span class="comment">// String getRequestURI()：获取URI(统一资源标识符)： /request-demo/req1</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">uri</span> <span class="operator">=</span> req.getRequestURI();</span><br><span class="line">        System.out.println(uri);</span><br><span class="line">        <span class="comment">// String getQueryString()：获取请求参数（GET方式）： username=zhangsan</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">queryString</span> <span class="operator">=</span> req.getQueryString();</span><br><span class="line">        System.out.println(queryString);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>启动服务器，访问<code>http://localhost:8080/request-demo/req1?username=zhangsan&amp;passwrod=123</code>，获取的结果如下:</p><p><img src="assets/1628762794935.png" alt="1628762794935"></p><h4 id="2-2-2-获取请求头数据"><a href="#2-2-2-获取请求头数据" class="headerlink" title="2.2.2 获取请求头数据"></a>2.2.2 获取请求头数据</h4><p>对于请求头的数据，格式为<code>key: value</code>如下:</p><p><img src="assets/1628768652535.png" alt="1628768652535"></p><p>所以根据请求头名称获取对应值的方法为:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String getHeader(String name)</span><br></pre></td></tr></table></figure><p>接下来，在代码中如果想要获取客户端浏览器的版本信息，则可以使用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * request 获取请求数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/req1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestDemo1</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//获取请求头: user-agent: 浏览器的版本信息</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">agent</span> <span class="operator">=</span> req.getHeader(<span class="string">&quot;user-agent&quot;</span>);</span><br><span class="line">System.out.println(agent);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>重新启动服务器后，<code>http://localhost:8080/request-demo/req1?username=zhangsan&amp;passwrod=123</code>，获取的结果如下:</p><p><img src="assets/1628769145524.png" alt="1628769145524"></p><h4 id="2-2-3-获取请求体数据"><a href="#2-2-3-获取请求体数据" class="headerlink" title="2.2.3 获取请求体数据"></a>2.2.3 获取请求体数据</h4><p>浏览器在发送GET请求的时候是没有请求体的，所以需要把请求方式变更为POST，请求体中的数据格式如下:</p><p><img src="assets/1628768665185.png" alt="1628768665185"></p><p>对于请求体中的数据，Request对象提供了如下两种方式来获取其中的数据，分别是:</p><ul><li>获取字节输入流，如果前端发送的是字节数据，比如传递的是文件数据，则使用该方法</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ServletInputStream getInputStream()</span><br><span class="line">该方法可以获取字节</span><br></pre></td></tr></table></figure><ul><li>获取字符输入流，如果前端发送的是纯文本数据，则使用该方法</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BufferedReader getReader()</span><br></pre></td></tr></table></figure><p>接下来，大家需要思考，要想获取到请求体的内容该如何实现?</p><blockquote><p>具体实现的步骤如下:</p><p>1.准备一个页面，在页面中添加form表单,用来发送post请求</p><p>2.在Servlet的doPost方法中获取请求体数据</p><p>3.在doPost方法中使用request的getReader()或者getInputStream()来获取</p><p>4.访问测试</p></blockquote><ol><li>在项目的webapp目录下添加一个html页面，名称为：<code>req.html</code></li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">    action:form表单提交的请求地址</span></span><br><span class="line"><span class="comment">    method:请求方式，指定为post</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/request-demo/req1&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>在Servlet的doPost方法中获取数据</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * request 获取请求数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/req1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestDemo1</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//在此处获取请求体中的数据</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>调用getReader()或者getInputStream()方法，因为目前前端传递的是纯文本数据，所以我们采用getReader()方法来获取</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * request 获取请求数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/req1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestDemo1</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">         <span class="comment">//获取post 请求体：请求参数</span></span><br><span class="line">        <span class="comment">//1. 获取字符输入流</span></span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> req.getReader();</span><br><span class="line">        <span class="comment">//2. 读取数据</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> br.readLine();</span><br><span class="line">        System.out.println(line);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>==注意==</p><p>BufferedReader流是通过request对象来获取的，当请求完成后request对象就会被销毁，request对象被销毁后，BufferedReader流就会自动关闭，所以此处就不需要手动关闭流了。</p><ol><li>启动服务器，通过浏览器访问<code>http://localhost:8080/request-demo/req.html</code></li></ol><p><img src="assets/1628770516387.png" alt="1628770516387"></p><p>点击<code>提交</code>按钮后，就可以在控制台看到前端所发送的请求数据</p><p><img src="assets/1628770585480.png" alt="1628770585480"></p><p><strong>小结</strong></p><p>HTTP请求数据中包含了<code>请求行</code>、<code>请求头</code>和<code>请求体</code>，针对这三部分内容，Request对象都提供了对应的API方法来获取对应的值:</p><ul><li>请求行<ul><li>getMethod()获取请求方式</li><li>getContextPath()获取项目访问路径</li><li>getRequestURL()获取请求URL</li><li>getRequestURI()获取请求URI</li><li>getQueryString()获取GET请求方式的请求参数</li></ul></li><li>请求头<ul><li>getHeader(String name)根据请求头名称获取其对应的值</li></ul></li><li>请求体<ul><li>注意: ==浏览器发送的POST请求才有请求体==</li><li>如果是纯文本数据:getReader()</li><li>如果是字节数据如文件数据:getInputStream()</li></ul></li></ul><h4 id="2-2-4-获取请求参数的通用方式"><a href="#2-2-4-获取请求参数的通用方式" class="headerlink" title="2.2.4 获取请求参数的通用方式"></a>2.2.4 获取请求参数的通用方式</h4><p>在学习下面内容之前，我们先提出两个问题:</p><ul><li>什么是请求参数?</li><li>请求参数和请求数据的关系是什么?</li></ul><p>1.什么是请求参数?</p><p>为了能更好的回答上述两个问题，我们拿用户登录的例子来说明</p><p>1.1 想要登录网址，需要进入登录页面</p><p>1.2 在登录页面输入用户名和密码</p><p>1.3 将用户名和密码提交到后台</p><p>1.4 后台校验用户名和密码是否正确</p><p>1.5 如果正确，则正常登录，如果不正确，则提示用户名或密码错误</p><p>上述例子中，用户名和密码其实就是我们所说的请求参数。</p><p>2.什么是请求数据?</p><p>请求数据则是包含请求行、请求头和请求体的所有数据</p><p>3.请求参数和请求数据的关系是什么?</p><p>3.1 请求参数是请求数据中的部分内容</p><p>3.2 如果是GET请求，请求参数在请求行中</p><p>3.3 如果是POST请求，请求参数一般在请求体中</p><p>对于请求参数的获取,常用的有以下两种:</p><ul><li>GET方式:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String getQueryString()</span><br></pre></td></tr></table></figure><ul><li>POST方式:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BufferedReader getReader();</span><br></pre></td></tr></table></figure><p>有了上述的知识储备，我们来实现一个案例需求:</p><p>（1）发送一个GET请求并携带用户名，后台接收后打印到控制台</p><p>（2）发送一个POST请求并携带用户名，后台接收后打印到控制台</p><p>此处大家需要注意的是GET请求和POST请求接收参数的方式不一样，具体实现的代码如下:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/req1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestDemo1</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> req.getQueryString();</span><br><span class="line">        System.out.println(result);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> req.getReader();</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> br.readLine();</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>对于上述的代码，会存在什么问题呢?</li></ul><p><img src="assets/1628776252445.png" alt="1628776252445"></p><ul><li>如何解决上述重复代码的问题呢?</li></ul><p><img src="assets/1628776433318.png" alt="1628776433318"></p><p>当然，也可以在doGet中调用doPost,在doPost中完成参数的获取和打印,另外需要注意的是，doGet和doPost方法都必须存在，不能删除任意一个。</p><p>==GET请求和POST请求获取请求参数的方式不一样，在获取请求参数这块该如何实现呢?==</p><p>要想实现，我们就需要==思考==:</p><p>GET请求方式和POST请求方式区别主要在于获取请求参数的方式不一样，是否可以提供一种==统一==获取请求参数的方式，从而==统一==doGet和doPost方法内的代码?</p><p>解决方案一:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/req1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestDemo1</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//获取请求方式</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> req.getMethod();</span><br><span class="line">        <span class="comment">//获取请求参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">params</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;GET&quot;</span>.equals(method))&#123;</span><br><span class="line">            params = req.getQueryString();</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;POST&quot;</span>.equals(method))&#123;</span><br><span class="line">            <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> req.getReader();</span><br><span class="line">            params = reader.readLine();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//将请求参数进行打印控制台</span></span><br><span class="line">        System.out.println(params);</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用request的getMethod()来获取请求方式，根据请求方式的不同分别获取请求参数值，这样就可以解决上述问题，但是以后每个Servlet都需要这样写代码，实现起来比较麻烦，这种方案我们不采用</p><p>解决方案二:</p><p>request对象已经将上述获取请求参数的方法进行了封装，并且request提供的方法实现的功能更强大，以后只需要调用request提供的方法即可，在request的方法中都实现了哪些操作?</p><p>(1)根据不同的请求方式获取请求参数，获取的内容如下:</p><p><img src="assets/1628778931277.png" alt="1628778931277"></p><p>(2)把获取到的内容进行分割，内容如下:</p><p><img src="assets/1628779067793.png" alt="1628779067793"></p><p>(3)把分割后端数据，存入到一个Map集合中:</p><p><img src="assets/1628779368501.png" alt="1628779368501"></p><p><strong>注意</strong>:因为参数的值可能是一个，也可能有多个，所以Map的值的类型为String数组。</p><p>基于上述理论，request对象为我们提供了如下方法:</p><ul><li>获取所有参数Map集合</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String,String[]&gt; getParameterMap()</span><br></pre></td></tr></table></figure><ul><li>根据名称获取参数值（数组）</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String[] getParameterValues(String name)</span><br></pre></td></tr></table></figure><ul><li>根据名称获取参数值(单个值)</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String getParameter(String name)</span><br></pre></td></tr></table></figure><p>接下来，我们通过案例来把上述的三个方法进行实例演示:</p><p>1.修改req.html页面，添加爱好选项，爱好可以同时选多个</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/request-demo/req2&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hobby&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span> 游泳</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hobby&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span> 爬山 <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="assets/1628780937599.png" alt="1628780937599"></p><p>2.在Servlet代码中获取页面传递GET请求的参数值</p><p> 2.1获取GET方式的所有请求参数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * request 通用方式获取请求参数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/req2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestDemo2</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//GET请求逻辑</span></span><br><span class="line">        System.out.println(<span class="string">&quot;get....&quot;</span>);</span><br><span class="line">        <span class="comment">//1. 获取所有参数的Map集合</span></span><br><span class="line">        Map&lt;String, String[]&gt; map = req.getParameterMap();</span><br><span class="line">        <span class="keyword">for</span> (String key : map.keySet()) &#123;</span><br><span class="line">            <span class="comment">// username:zhangsan lisi</span></span><br><span class="line">            System.out.print(key+<span class="string">&quot;:&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//获取值</span></span><br><span class="line">            String[] values = map.get(key);</span><br><span class="line">            <span class="keyword">for</span> (String value : values) &#123;</span><br><span class="line">                System.out.print(value + <span class="string">&quot; &quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>获取的结果为:</p><p><img src="assets/1628780965283.png" alt="1628780965283"></p><p> 2.2获取GET请求参数中的爱好，结果是数组值</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * request 通用方式获取请求参数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/req2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestDemo2</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//GET请求逻辑</span></span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        System.out.println(<span class="string">&quot;------------&quot;</span>);</span><br><span class="line">        String[] hobbies = req.getParameterValues(<span class="string">&quot;hobby&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String hobby : hobbies) &#123;</span><br><span class="line">            System.out.println(hobby);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>获取的结果为:</p><p><img src="assets/1628781031437.png" alt="1628781031437"></p><p> 2.3获取GET请求参数中的用户名和密码，结果是单个值</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * request 通用方式获取请求参数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/req2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestDemo2</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//GET请求逻辑</span></span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        System.out.println(username);</span><br><span class="line">        System.out.println(password);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>获取的结果为:</p><p><img src="assets/1628781176434.png" alt="1628781176434"></p><p>3.在Servlet代码中获取页面传递POST请求的参数值</p><p> 3.1将req.html页面form表单的提交方式改成post</p><p> 3.2将doGet方法中的内容复制到doPost方法中即可</p><p><strong>小结</strong></p><ul><li><p>req.getParameter()方法使用的频率会比较高</p></li><li><p>以后我们再写代码的时候，就只需要按照如下格式来编写:</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class RequestDemo1 extends HttpServlet &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;</span><br><span class="line">       //采用request提供的获取请求参数的通用方式来获取请求参数</span><br><span class="line">       //编写其他的业务代码...</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;</span><br><span class="line">        this.doGet(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-IDEA快速创建Servlet"><a href="#2-3-IDEA快速创建Servlet" class="headerlink" title="2.3 IDEA快速创建Servlet"></a>2.3 IDEA快速创建Servlet</h3><p>使用通用方式获取请求参数后，屏蔽了GET和POST的请求方式代码的不同，则代码可以定义如下格式:</p><p><img src="assets/1628781419752.png" alt="1628781419752"></p><p>由于格式固定，所以我们可以使用IDEA提供的模板来制作一个Servlet的模板，这样我们后期在创建Servlet的时候就会更高效，具体如何实现:</p><p>(1)按照自己的需求，修改Servlet创建的模板内容</p><p><img src="assets/1628781545912.png" alt="1628781545912"></p><p>（2）使用servlet模板创建Servlet类</p><p><img src="assets/1628782117420.png" alt="1628782117420"></p><h3 id="2-4-请求参数中文乱码问题"><a href="#2-4-请求参数中文乱码问题" class="headerlink" title="2.4 请求参数中文乱码问题"></a>2.4 请求参数中文乱码问题</h3><p>问题展示:</p><p>(1)将req.html页面的请求方式修改为get</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=&quot;/request-demo/req2&quot; method=&quot;get&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;&lt;br&gt;</span><br><span class="line">    &lt;input type=&quot;password&quot; name=&quot;password&quot;&gt;&lt;br&gt;</span><br><span class="line">    &lt;input type=&quot;checkbox&quot; name=&quot;hobby&quot; value=&quot;1&quot;&gt; 游泳</span><br><span class="line">    &lt;input type=&quot;checkbox&quot; name=&quot;hobby&quot; value=&quot;2&quot;&gt; 爬山 &lt;br&gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>(2)在Servlet方法中获取参数，并打印</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 中文乱码问题解决方案</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/req4&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestDemo4</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">       <span class="comment">//1. 获取username</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">       System.out.println(username);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>（3）启动服务器，页面上输入中文参数</p><p><img src="assets/1628784323297.png" alt="1628784323297"></p><p>（4）查看控制台打印内容</p><p><img src="assets/1628784356157.png" alt="1628784356157"></p><p>（5）把req.html页面的请求方式改成post,再次发送请求和中文参数</p><p><img src="assets/1628784425182.png" alt="1628784425182"></p><p>（6）查看控制台打印内容，依然为乱码</p><p><img src="assets/1628784356157.png" alt="1628784356157"></p><p>通过上面的案例，会发现，不管是GET还是POST请求，在发送的请求参数中如果有中文，在后台接收的时候，都会出现中文乱码的问题。具体该如何解决呢？</p><h4 id="2-4-1-POST请求解决方案"><a href="#2-4-1-POST请求解决方案" class="headerlink" title="2.4.1 POST请求解决方案"></a>2.4.1 POST请求解决方案</h4><ul><li>分析出现中文乱码的原因：<ul><li>POST的请求参数是通过request的getReader()来获取流中的数据</li><li>TOMCAT在获取流的时候采用的编码是ISO-8859-1</li><li>ISO-8859-1编码是不支持中文的，所以会出现乱码</li></ul></li><li>解决方案：<ul><li>页面设置的编码格式为UTF-8</li><li>把TOMCAT在获取流数据之前的编码设置为UTF-8</li><li>通过request.setCharacterEncoding(“UTF-8”)设置编码,UTF-8也可以写成小写</li></ul></li></ul><p>修改后的代码为:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 中文乱码问题解决方案</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/req4&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestDemo4</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1. 解决乱码: POST getReader()</span></span><br><span class="line">        <span class="comment">//设置字符输入流的编码，设置的字符集要和页面保持一致</span></span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">       <span class="comment">//2. 获取username</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">       System.out.println(username);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>重新发送POST请求，就会在控制台看到正常展示的中文结果。</p><p>至此POST请求中文乱码的问题就已经解决，但是这种方案不适用于GET请求，这个原因是什么呢，咱们下面再分析。</p><h4 id="2-4-2-GET请求解决方案"><a href="#2-4-2-GET请求解决方案" class="headerlink" title="2.4.2 GET请求解决方案"></a>2.4.2 GET请求解决方案</h4><p>刚才提到一个问题是<code>POST请求的中文乱码解决方案为什么不适用GET请求？</code></p><ul><li>GET请求获取请求参数的方式是<code>request.getQueryString()</code></li><li>POST请求获取请求参数的方式是<code>request.getReader()</code></li><li>request.setCharacterEncoding(“utf-8”)是设置request处理流的编码</li><li>getQueryString方法并没有通过流的方式获取数据</li></ul><p>所以GET请求不能用设置编码的方式来解决中文乱码问题，那问题又来了，如何解决GET请求的中文乱码呢? </p><ol><li><p>首先我们需要先分析下GET请求出现乱码的原因:</p><p><img src="assets/1628829610823.png" alt="1628829610823"></p></li></ol><p>(1)浏览器通过HTTP协议发送请求和数据给后台服务器（Tomcat)</p><p>(2)浏览器在发送HTTP的过程中会对中文数据进行URL==编码==</p><p>(3)在进行URL编码的时候会采用页面<code>&lt;meta&gt;</code>标签指定的UTF-8的方式进行编码，<code>张三</code>编码后的结果为<code>%E5%BC%A0%E4%B8%89</code></p><p>(4)后台服务器(Tomcat)接收到<code>%E5%BC%A0%E4%B8%89</code>后会默认按照<code>ISO-8859-1</code>进行URL==解码==</p><p>(5)由于前后编码与解码采用的格式不一样，就会导致后台获取到的数据为乱码。</p><p>思考: 如果把<code>req.html</code>页面的<code>&lt;meta&gt;</code>标签的charset属性改成<code>ISO-8859-1</code>,后台不做操作，能解决中文乱码问题么?</p><p>答案是否定的，因为<code>ISO-8859-1</code>本身是不支持中文展示的，所以改了<meta>标签的charset属性后，会导致页面上的中文内容都无法正常展示。</p><p>分析完上面的问题后，我们会发现，其中有两个我们不熟悉的内容就是==URL编码==和==URL解码==，什么是URL编码，什么又是URL解码呢?</p><p><strong>URL编码</strong></p><p>这块知识我们只需要了解下即可,具体编码过程分两步，分别是:</p><p>(1)将字符串按照编码方式转为二进制</p><p>(2)每个字节转为2个16进制数并在前边加上%</p><p><code>张三</code>按照UTF-8的方式转换成二进制的结果为:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1110 0101 1011 1100 1010 0000 1110 0100 1011 1000 1000 1001</span><br></pre></td></tr></table></figure><p>这个结果是如何计算的?</p><p>使用<code>http://www.mytju.com/classcode/tools/encode_utf8.asp</code>，输入<code>张三</code></p><p><img src="assets/1628833310473.png" alt="1628833310473"></p><p>就可以获取张和三分别对应的10进制，然后在使用计算器，选择程序员模式，计算出对应的二进制数据结果:</p><p><img src="assets/1628833496171.png" alt="1628833496171"></p><p>在计算的十六进制结果中，每两位前面加一个%,就可以获取到<code>%E5%BC%A0%E4%B8%89</code>。</p><p>当然你从上面所提供的网站中就已经能看到编码16进制的结果了:</p><p><img src="assets/1628833310474.png" alt="1628833310473"></p><p>但是对于上面的计算过程，如果没有工具，纯手工计算的话，相对来说还是比较复杂的，我们也不需要进行手动计算，在Java中已经为我们提供了编码和解码的API工具类可以让我们更快速的进行编码和解码:</p><p>编码:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.net.URLEncoder.encode(<span class="string">&quot;需要被编码的内容&quot;</span>,<span class="string">&quot;字符集(UTF-8)&quot;</span>)</span><br></pre></td></tr></table></figure><p>解码:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.net.URLDecoder.decode(<span class="string">&quot;需要被解码的内容&quot;</span>,<span class="string">&quot;字符集(UTF-8)&quot;</span>)</span><br></pre></td></tr></table></figure><p>接下来咱们对<code>张三</code>来进行编码和解码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class URLDemo &#123;</span><br><span class="line"></span><br><span class="line">  public static void main(String[] args) throws UnsupportedEncodingException &#123;</span><br><span class="line">        String username = &quot;张三&quot;;</span><br><span class="line">        //1. URL编码</span><br><span class="line">        String encode = URLEncoder.encode(username, &quot;utf-8&quot;);</span><br><span class="line">        System.out.println(encode); //打印:%E5%BC%A0%E4%B8%89</span><br><span class="line"></span><br><span class="line">       //2. URL解码</span><br><span class="line">       //String decode = URLDecoder.decode(encode, &quot;utf-8&quot;);//打印:张三</span><br><span class="line">       String decode = URLDecoder.decode(encode, &quot;ISO-8859-1&quot;);//打印:`å¼ ä¸ `</span><br><span class="line">       System.out.println(decode);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>到这，我们就可以分析出GET请求中文参数出现乱码的原因了，</p><ul><li>浏览器把中文参数按照<code>UTF-8</code>进行URL编码</li><li>Tomcat对获取到的内容进行了<code>ISO-8859-1</code>的URL解码</li><li>在控制台就会出现类上<code>å¼ ä¸</code>的乱码，最后一位是个空格</li></ul><ol><li>清楚了出现乱码的原因，接下来我们就需要想办法进行解决</li></ol><p><img src="assets/1628846824194.png" alt="1628846824194"></p><p>从上图可以看住，</p><ul><li><p>在进行编码和解码的时候，不管使用的是哪个字符集，他们对应的<code>%E5%BC%A0%E4%B8%89</code>是一致的</p></li><li><p>那他们对应的二进制值也是一样的，为:</p><ul><li>```<br>1110 0101 1011 1100 1010 0000 1110 0100 1011 1000 1000 1001<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 为所以我们可以考虑把`å¼ ä¸`转换成字节，在把字节转换成`张三`，在转换的过程中是它们的编码一致，就可以解决中文乱码问题。</span><br><span class="line"></span><br><span class="line">具体的实现步骤为:</span><br><span class="line"></span><br><span class="line">&gt;1.按照ISO-8859-1编码获取乱码`å¼ ä¸`对应的字节数组</span><br><span class="line">&gt;</span><br><span class="line">&gt;2.按照UTF-8编码获取字节数组对应的字符串</span><br><span class="line"></span><br><span class="line">实现代码如下:</span><br><span class="line"></span><br></pre></td></tr></table></figure>public class URLDemo {</li></ul><p>public static void main(String[] args) throws UnsupportedEncodingException {</p><pre><code>  String username = &quot;张三&quot;;  //1. URL编码  String encode = URLEncoder.encode(username, &quot;utf-8&quot;);  System.out.println(encode);  //2. URL解码  String decode = URLDecoder.decode(encode, &quot;ISO-8859-1&quot;);  System.out.println(decode); //此处打印的是对应的乱码数据  //3. 转换为字节数据,编码  byte[] bytes = decode.getBytes(&quot;ISO-8859-1&quot;);  for (byte b : bytes) &#123;      System.out.print(b + &quot; &quot;);  &#125;  //此处打印的是:-27 -68 -96 -28 -72 -119  //4. 将字节数组转为字符串，解码  String s = new String(bytes, &quot;utf-8&quot;);  System.out.println(s); //此处打印的是张三</code></pre><p>  }<br>}</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**说明**:在第18行中打印的数据是`-27 -68 -96 -28 -72 -119`和`张三`转换成的二进制数据`1110 0101 1011 1100 1010 0000 1110 0100 1011 1000 1000 1001`为什么不一样呢？</span><br><span class="line"></span><br><span class="line">其实打印出来的是十进制数据，我们只需要使用计算机换算下就能得到他们的对应关系，如下图:</span><br><span class="line"></span><br><span class="line">![1628849231208](assets/1628849231208.png)</span><br><span class="line"></span><br><span class="line">至此对于GET请求中文乱码的解决方案，我们就已经分析完了，最后在代码中去实现下:</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">/**</span><br><span class="line"> * 中文乱码问题解决方案</span><br><span class="line"> */</span><br><span class="line">@WebServlet(&quot;/req4&quot;)</span><br><span class="line">public class RequestDemo4 extends HttpServlet &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class="line">        //1. 解决乱码：POST，getReader()</span><br><span class="line">        //request.setCharacterEncoding(&quot;UTF-8&quot;);//设置字符输入流的编码</span><br><span class="line"></span><br><span class="line">        //2. 获取username</span><br><span class="line">        String username = request.getParameter(&quot;username&quot;);</span><br><span class="line">        System.out.println(&quot;解决乱码前：&quot;+username);</span><br><span class="line"></span><br><span class="line">        //3. GET,获取参数的方式：getQueryString</span><br><span class="line">        // 乱码原因：tomcat进行URL解码，默认的字符集ISO-8859-1</span><br><span class="line">       /* //3.1 先对乱码数据进行编码：转为字节数组</span><br><span class="line">        byte[] bytes = username.getBytes(StandardCharsets.ISO_8859_1);</span><br><span class="line">        //3.2 字节数组解码</span><br><span class="line">        username = new String(bytes, StandardCharsets.UTF_8);*/</span><br><span class="line"></span><br><span class="line">        username  = new String(username.getBytes(StandardCharsets.ISO_8859_1),StandardCharsets.UTF_8);</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;解决乱码后：&quot;+username);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class="line">        this.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><strong>注意</strong></p><ul><li>把<code>request.setCharacterEncoding(&quot;UTF-8&quot;)</code>代码注释掉后，会发现GET请求参数乱码解决方案同时也可也把POST请求参数乱码的问题也解决了</li><li>只不过对于POST请求参数一般都会比较多，采用这种方式解决乱码起来比较麻烦，所以对于POST请求还是建议使用设置编码的方式进行。</li></ul><p>另外需要说明一点的是==Tomcat8.0之后，已将GET请求乱码问题解决，设置默认的解码方式为UTF-8==</p><p><strong>小结</strong></p><ol><li>中文乱码解决方案</li></ol><ul><li><p>POST请求和GET请求的参数中如果有中文，后台接收数据就会出现中文乱码问题</p><p>GET请求在Tomcat8.0以后的版本就不会出现了</p></li><li><p>POST请求解决方案是:设置输入流的编码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">request.setCharacterEncoding(&quot;UTF-8&quot;);</span><br><span class="line">注意:设置的字符集要和页面保持一致</span><br></pre></td></tr></table></figure></li><li><p>通用方式（GET/POST）：需要先解码，再编码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new String(username.getBytes(&quot;ISO-8859-1&quot;),&quot;UTF-8&quot;);</span><br></pre></td></tr></table></figure></li></ul><ol><li>URL编码实现方式:</li></ol><ul><li><p>编码:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">URLEncoder.encode(str,&quot;UTF-8&quot;);</span><br></pre></td></tr></table></figure></li><li><p>解码:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">URLDecoder.decode(s,&quot;ISO-8859-1&quot;);</span><br></pre></td></tr></table></figure></li></ul><h3 id="2-5-Request请求转发"><a href="#2-5-Request请求转发" class="headerlink" title="2.5 Request请求转发"></a>2.5 Request请求转发</h3><ol><li>==请求转发(forward):一种在服务器内部的资源跳转方式。==</li></ol><p><img src="assets/1628851404283.png" alt="1628851404283"></p><p>(1)浏览器发送请求给服务器，服务器中对应的资源A接收到请求</p><p>(2)资源A处理完请求后将请求发给资源B</p><p>(3)资源B处理完后将结果响应给浏览器</p><p>(4)请求从资源A到资源B的过程就叫==请求转发==</p><ol><li>请求转发的实现方式:</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">req.getRequestDispatcher(&quot;资源B路径&quot;).forward(req,resp);</span><br></pre></td></tr></table></figure><p>具体如何来使用，我们先来看下需求:</p><p><img src="assets/1628854783523.png" alt="1628854783523"></p><p>针对上述需求，具体的实现步骤为:</p><blockquote><p>1.创建一个RequestDemo5类，接收/req5的请求，在doGet方法中打印<code>demo5</code></p><p>2.创建一个RequestDemo6类，接收/req6的请求，在doGet方法中打印<code>demo6</code></p><p>3.在RequestDemo5的方法中使用</p><p>​    req.getRequestDispatcher(“/req6”).forward(req,resp)进行请求转发</p><p>4.启动测试</p></blockquote><p>(1)创建RequestDemo5类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 请求转发</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/req5&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestDemo5</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;demo5...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(2)创建RequestDemo6类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 请求转发</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/req6&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestDemo6</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;demo6...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(3)在RequestDemo5的doGet方法中进行请求转发</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 请求转发</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/req5&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestDemo5</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;demo5...&quot;</span>);</span><br><span class="line">        <span class="comment">//请求转发</span></span><br><span class="line">        request.getRequestDispatcher(<span class="string">&quot;/req6&quot;</span>).forward(request,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(4)启动测试</p><p>访问<code>http://localhost:8080/request-demo/req5</code>,就可以在控制台看到如下内容:</p><p><img src="assets/1628855192876.png" alt="1628855192876"></p><p>说明请求已经转发到了<code>/req6</code></p><ol><li>请求转发资源间共享数据:使用Request对象</li></ol><p>此处主要解决的问题是把请求从<code>/req5</code>转发到<code>/req6</code>的时候，如何传递数据给<code>/req6</code>。</p><p>需要使用request对象提供的三个方法:</p><ul><li>存储数据到request域[范围,数据是存储在request对象]中</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void setAttribute(String name,Object o);</span><br></pre></td></tr></table></figure><ul><li>根据key获取值</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Object getAttribute(String name);</span><br></pre></td></tr></table></figure><ul><li>根据key删除该键值对</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void removeAttribute(String name);</span><br></pre></td></tr></table></figure><p>接着上个需求来:</p><p><img src="assets/1628856995417.png" alt="1628856995417"></p><blockquote><p>1.在RequestDemo5的doGet方法中转发请求之前，将数据存入request域对象中</p><p>2.在RequestDemo6的doGet方法从request域对象中获取数据，并将数据打印到控制台</p><p>3.启动访问测试</p></blockquote><p>(1)修改RequestDemo5中的方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/req5&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestDemo5</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;demo5...&quot;</span>);</span><br><span class="line">        <span class="comment">//存储数据</span></span><br><span class="line">        request.setAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        <span class="comment">//请求转发</span></span><br><span class="line">        request.getRequestDispatcher(<span class="string">&quot;/req6&quot;</span>).forward(request,response);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(2)修改RequestDemo6中的方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 请求转发</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/req6&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestDemo6</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;demo6...&quot;</span>);</span><br><span class="line">        <span class="comment">//获取数据</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">msg</span> <span class="operator">=</span> request.getAttribute(<span class="string">&quot;msg&quot;</span>);</span><br><span class="line">        System.out.println(msg);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(3)启动测试</p><p>访问<code>http://localhost:8080/request-demo/req5</code>,就可以在控制台看到如下内容:</p><p><img src="assets/1628857213364.png" alt="1628857213364"></p><p>此时就可以实现在转发多个资源之间共享数据。</p><ol><li>请求转发的特点</li></ol><ul><li><p>浏览器地址栏路径不发生变化</p><p>虽然后台从<code>/req5</code>转发到<code>/req6</code>,但是浏览器的地址一直是<code>/req5</code>,未发生变化</p><p><img src="assets/1628857365153.png" alt="1628857365153"></p></li><li><p>只能转发到当前服务器的内部资源</p><p>不能从一个服务器通过转发访问另一台服务器</p></li><li><p>一次请求，可以在转发资源间使用request共享数据</p><p>虽然后台从<code>/req5</code>转发到<code>/req6</code>，但是这个==只有一次请求==</p></li></ul><h2 id="3，Response对象"><a href="#3，Response对象" class="headerlink" title="3，Response对象"></a>3，Response对象</h2><p>前面讲解完Request对象，接下来我们回到刚开始的那张图:</p><p><img src="assets/1628857632899.png" alt="1628857632899"></p><ul><li>Request:使用request对象来==获取==请求数据</li><li>Response:使用response对象来==设置==响应数据</li></ul><p>Reponse的继承体系和Request的继承体系也非常相似:</p><p><img src="assets/1628857761317.png" alt="1628857761317"></p><p> 介绍完Response的相关体系结构后，接下来对于Response我们需要学习如下内容:</p><ul><li>Response设置响应数据的功能介绍</li><li>Response完成重定向</li><li>Response响应字符数据</li><li>Response响应字节数据</li></ul><h3 id="3-1-Response设置响应数据功能介绍"><a href="#3-1-Response设置响应数据功能介绍" class="headerlink" title="3.1 Response设置响应数据功能介绍"></a>3.1 Response设置响应数据功能介绍</h3><p>HTTP响应数据总共分为三部分内容，分别是==响应行、响应头、响应体==，对于这三部分内容的数据，respone对象都提供了哪些方法来进行设置?</p><ol><li>响应行</li></ol><p><img src="assets/1628858926498.png" alt="1628858926498"></p><p>对于响应头，比较常用的就是设置响应状态码:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void setStatus(int sc);</span><br></pre></td></tr></table></figure><ol><li>响应头</li></ol><p><img src="assets/1628859051368.png" alt="1628859051368"></p><p>设置响应头键值对：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void setHeader(String name,String value);</span><br></pre></td></tr></table></figure><ol><li>响应体</li></ol><p><img src="assets/1628859268095.png" alt="1628859268095"></p><p>对于响应体，是通过字符、字节输出流的方式往浏览器写，</p><p>获取字符输出流:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PrintWriter getWriter();</span><br></pre></td></tr></table></figure><p>获取字节输出流</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ServletOutputStream getOutputStream();</span><br></pre></td></tr></table></figure><p>介绍完这些方法后，后面我们会通过案例把这些方法都用一用，首先先来完成下重定向的功能开发。</p><h3 id="3-2-Respones请求重定向"><a href="#3-2-Respones请求重定向" class="headerlink" title="3.2 Respones请求重定向"></a>3.2 Respones请求重定向</h3><ol><li>==Response重定向(redirect):一种资源跳转方式。==</li></ol><p><img src="assets/1628859860279.png" alt="1628859860279"></p><p>(1)浏览器发送请求给服务器，服务器中对应的资源A接收到请求</p><p>(2)资源A现在无法处理该请求，就会给浏览器响应一个302的状态码+location的一个访问资源B的路径</p><p>(3)浏览器接收到响应状态码为302就会重新发送请求到location对应的访问地址去访问资源B</p><p>(4)资源B接收到请求后进行处理并最终给浏览器响应结果，这整个过程就叫==重定向==</p><ol><li>重定向的实现方式:</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">resp.setStatus(302);</span><br><span class="line">resp.setHeader(&quot;location&quot;,&quot;资源B的访问路径&quot;);</span><br></pre></td></tr></table></figure><p>具体如何来使用，我们先来看下需求:</p><p><img src="assets/1628861030429.png" alt="1628861030429"></p><p>针对上述需求，具体的实现步骤为:</p><blockquote><p>1.创建一个ResponseDemo1类，接收/resp1的请求，在doGet方法中打印<code>resp1....</code></p><p>2.创建一个ResponseDemo2类，接收/resp2的请求，在doGet方法中打印<code>resp2....</code></p><p>3.在ResponseDemo1的方法中使用</p><p>​    response.setStatus(302);</p><p>​    response.setHeader(“Location”,”/request-demo/resp2”) 来给前端响应结果数据</p><p>4.启动测试</p></blockquote><p>(1)创建ResponseDemo1类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/resp1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResponseDemo1</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;resp1....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(2)创建ResponseDemo2类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/resp2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResponseDemo2</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;resp2....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(3)在ResponseDemo1的doGet方法中给前端响应数据</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/resp1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResponseDemo1</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;resp1....&quot;</span>);</span><br><span class="line">        <span class="comment">//重定向</span></span><br><span class="line">        <span class="comment">//1.设置响应状态码 302</span></span><br><span class="line">        response.setStatus(<span class="number">302</span>);</span><br><span class="line">        <span class="comment">//2. 设置响应头 Location</span></span><br><span class="line">        response.setHeader(<span class="string">&quot;Location&quot;</span>,<span class="string">&quot;/request-demo/resp2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(4)启动测试</p><p>访问<code>http://localhost:8080/request-demo/resp1</code>,就可以在控制台看到如下内容:</p><p><img src="assets/1628861404699.png" alt="1628861404699"></p><p>说明<code>/resp1</code>和<code>/resp2</code>都被访问到了。到这重定向就已经完成了。</p><p>虽然功能已经实现，但是从设置重定向的两行代码来看，会发现除了重定向的地址不一样，其他的内容都是一模一样，所以request对象给我们提供了简化的编写方式为:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resposne.sendRedirect(&quot;/request-demo/resp2&quot;)</span><br></pre></td></tr></table></figure><p>所以第3步中的代码就可以简化为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/resp1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResponseDemo1</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;resp1....&quot;</span>);</span><br><span class="line">        <span class="comment">//重定向</span></span><br><span class="line">        resposne.sendRedirect(<span class="string">&quot;/request-demo/resp2&quot;</span>)；</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>重定向的特点</li></ol><ul><li><p>浏览器地址栏路径发送变化</p><p>当进行重定向访问的时候，由于是由浏览器发送的两次请求，所以地址会发生变化</p><p><img src="assets/1628861893130.png" alt="1628861893130"></p></li><li><p>可以重定向到任何位置的资源(服务内容、外部均可)</p><p>因为第一次响应结果中包含了浏览器下次要跳转的路径，所以这个路径是可以任意位置资源。</p></li><li><p>两次请求，不能在多个资源使用request共享数据</p><p>因为浏览器发送了两次请求，是两个不同的request对象，就无法通过request对象进行共享数据</p></li></ul><p>介绍完==请求重定向==和==请求转发==以后，接下来需要把这两个放在一块对比下:</p><p><img src="assets/1628862170296.png" alt="1628862170296"></p><p>以后到底用哪个，还是需要根据具体的业务来决定。</p><h3 id="3-3-路径问题"><a href="#3-3-路径问题" class="headerlink" title="3.3 路径问题"></a>3.3 路径问题</h3><ol><li>问题1：转发的时候路径上没有加<code>/request-demo</code>而重定向加了，那么到底什么时候需要加，什么时候不需要加呢?</li></ol><p><img src="assets/1628862652700.png" alt="1628862652700"></p><p>其实判断的依据很简单，只需要记住下面的规则即可:</p><ul><li>浏览器使用:需要加虚拟目录(项目访问路径)</li><li>服务端使用:不需要加虚拟目录</li></ul><p>对于转发来说，因为是在服务端进行的，所以不需要加虚拟目录</p><p>对于重定向来说，路径最终是由浏览器来发送请求，就需要添加虚拟目录。</p><p>掌握了这个规则，接下来就通过一些练习来强化下知识的学习:</p><ul><li><code>&lt;a href=&#39;路劲&#39;&gt;</code></li><li><code>&lt;form action=&#39;路径&#39;&gt;</code></li><li>req.getRequestDispatcher(“路径”)</li><li>resp.sendRedirect(“路径”)</li></ul><p>答案:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.超链接，从浏览器发送，需要加</span><br><span class="line">2.表单，从浏览器发送，需要加</span><br><span class="line">3.转发，是从服务器内部跳转，不需要加</span><br><span class="line">4.重定向，是由浏览器进行跳转，需要加。</span><br></pre></td></tr></table></figure><ol><li>问题2：在重定向的代码中，<code>/request-demo</code>是固定编码的，如果后期通过Tomcat插件配置了项目的访问路径，那么所有需要重定向的地方都需要重新修改，该如何优化?</li></ol><p><img src="assets/1628863270545.png" alt="1628863270545"></p><p>答案也比较简单，我们可以在代码中动态去获取项目访问的虚拟目录，具体如何获取，我们可以借助前面咱们所学习的request对象中的getContextPath()方法，修改后的代码如下:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/resp1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResponseDemo1</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;resp1....&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//简化方式完成重定向</span></span><br><span class="line">        <span class="comment">//动态获取虚拟目录</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">contextPath</span> <span class="operator">=</span> request.getContextPath();</span><br><span class="line">        response.sendRedirect(contextPath+<span class="string">&quot;/resp2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>重新启动访问测试，功能依然能够实现，此时就可以动态获取项目访问的虚拟路径，从而降低代码的耦合度。</p><h3 id="3-4-Response响应字符数据"><a href="#3-4-Response响应字符数据" class="headerlink" title="3.4 Response响应字符数据"></a>3.4 Response响应字符数据</h3><p>要想将字符数据写回到浏览器，我们需要两个步骤:</p><ul><li><p>通过Response对象获取字符输出流： PrintWriter writer = resp.getWriter();</p></li><li><p>通过字符输出流写数据: writer.write(“aaa”);</p></li></ul><p>接下来，我们实现通过些案例把响应字符数据给实际应用下:</p><ol><li>返回一个简单的字符串<code>aaa</code></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 响应字符数据：设置字符数据的响应体</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/resp3&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResponseDemo3</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">        <span class="comment">//1. 获取字符输出流</span></span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line"> writer.write(<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="assets/1628863905362.png" alt="1628863905362"></p><ol><li>返回一串html字符串，并且能被浏览器解析</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PrintWriter writer = response.getWriter();</span><br><span class="line">//content-type，告诉浏览器返回的数据类型是HTML类型数据，这样浏览器才会解析HTML标签</span><br><span class="line">response.setHeader(&quot;content-type&quot;,&quot;text/html&quot;);</span><br><span class="line">writer.write(&quot;&lt;h1&gt;aaa&lt;/h1&gt;&quot;);</span><br></pre></td></tr></table></figure><p><img src="assets/1628864140820.png" alt="1628864140820"></p><p>==注意:==一次请求响应结束后，response对象就会被销毁掉，所以不要手动关闭流。</p><ol><li>返回一个中文的字符串<code>你好</code>，需要注意设置响应数据的编码为<code>utf-8</code></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//设置响应的数据格式及数据的编码</span><br><span class="line">response.setContentType(&quot;text/html;charset=utf-8&quot;);</span><br><span class="line">writer.write(&quot;你好&quot;);</span><br></pre></td></tr></table></figure><p><img src="assets/1628864390263.png" alt="1628864390263"></p><h3 id="3-3-Response响应字节数据"><a href="#3-3-Response响应字节数据" class="headerlink" title="3.3 Response响应字节数据"></a>3.3 Response响应字节数据</h3><p>要想将字节数据写回到浏览器，我们需要两个步骤:</p><ul><li><p>通过Response对象获取字节输出流：ServletOutputStream outputStream = resp.getOutputStream();</p></li><li><p>通过字节输出流写数据: outputStream.write(字节数据);</p></li></ul><p>接下来，我们实现通过些案例把响应字符数据给实际应用下:</p><ol><li>返回一个图片文件到浏览器</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 响应字节数据：设置字节数据的响应体</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/resp4&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResponseDemo4</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1. 读取文件</span></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;d://a.jpg&quot;</span>);</span><br><span class="line">        <span class="comment">//2. 获取response字节输出流</span></span><br><span class="line">        <span class="type">ServletOutputStream</span> <span class="variable">os</span> <span class="operator">=</span> response.getOutputStream();</span><br><span class="line">        <span class="comment">//3. 完成流的copy</span></span><br><span class="line">        <span class="type">byte</span>[] buff = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> ((len = fis.read(buff))!= -<span class="number">1</span>)&#123;</span><br><span class="line">            os.write(buff,<span class="number">0</span>,len);</span><br><span class="line">        &#125;</span><br><span class="line">        fis.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="assets/1628864883564.png" alt="1628864883564"></p><p>上述代码中，对于流的copy的代码还是比较复杂的，所以我们可以使用别人提供好的方法来简化代码的开发，具体的步骤是:</p><p>(1)pom.xml添加依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>(2)调用工具类方法</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//fis:输入流</span><br><span class="line">//os:输出流</span><br><span class="line">IOUtils.copy(fis,os);</span><br></pre></td></tr></table></figure><p>优化后的代码:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 响应字节数据：设置字节数据的响应体</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebServlet(&quot;/resp4&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResponseDemo4</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1. 读取文件</span></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;d://a.jpg&quot;</span>);</span><br><span class="line">        <span class="comment">//2. 获取response字节输出流</span></span><br><span class="line">        <span class="type">ServletOutputStream</span> <span class="variable">os</span> <span class="operator">=</span> response.getOutputStream();</span><br><span class="line">        <span class="comment">//3. 完成流的copy</span></span><br><span class="line">      IOUtils.copy(fis,os);</span><br><span class="line">        fis.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4，用户注册登录案例"><a href="#4，用户注册登录案例" class="headerlink" title="4，用户注册登录案例"></a>4，用户注册登录案例</h2><p>接下来我们通过两个比较常见的案例，一个是==注册==，一个是==登录==来对今天学习的内容进行一个实战演练，首先来实现用户登录。</p><h3 id="4-1-用户登录"><a href="#4-1-用户登录" class="headerlink" title="4.1 用户登录"></a>4.1 用户登录</h3><h4 id="4-1-1-需求分析"><a href="#4-1-1-需求分析" class="headerlink" title="4.1.1 需求分析"></a>4.1.1 需求分析</h4><p><img src="assets/1628865728305.png" alt="1628865728305"></p><ol><li>用户在登录页面输入用户名和密码，提交请求给LoginServlet</li><li>在LoginServlet中接收请求和数据[用户名和密码]</li><li>在LoginServlt中通过Mybatis实现调用UserMapper来根据用户名和密码查询数据库表</li><li>将查询的结果封装到User对象中进行返回</li><li>在LoginServlet中判断返回的User对象是否为null</li><li>如果为nul，说明根据用户名和密码没有查询到用户，则登录失败，返回”登录失败”数据给前端</li><li>如果不为null,则说明用户存在并且密码正确，则登录成功，返回”登录成功”数据给前端</li></ol><h4 id="4-1-2-环境准备"><a href="#4-1-2-环境准备" class="headerlink" title="4.1.2 环境准备"></a>4.1.2 环境准备</h4><ol><li>复制资料中的静态页面到项目的webapp目录下</li></ol><p>参考<code>资料\1. 登陆注册案例\1. 静态页面</code>,拷贝完效果如下:</p><p><img src="assets/1628866248169.png" alt="1628866248169"></p><ol><li>创建db1数据库，创建tb_user表，创建User实体类</li></ol><p>2.1 将<code>资料\1. 登陆注册案例\2. MyBatis环境\tb_user.sql</code>中的sql语句执行下:</p><p><img src="assets/1628866403891.png" alt="1628866403891"></p><p> 2.2 将<code>资料\1. 登陆注册案例\2. MyBatis环境\User.java</code>拷贝到com.itheima.pojo</p><p><img src="assets/1628866560738.png" alt="1628866560738"></p><ol><li>在项目的pom.xml导入Mybatis和Mysql驱动坐标</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.34<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>创建mybatis-config.xml核心配置文件，UserMapper.xml映射文件,UserMapper接口</li></ol><p>4.1  将<code>资料\1. 登陆注册案例\2. MyBatis环境\mybatis-config.xml</code>拷贝到resources目录下</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--起别名--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.itheima.pojo&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">                    useSSL:关闭SSL安全连接 性能更高</span></span><br><span class="line"><span class="comment">                    useServerPrepStmts:开启预编译功能</span></span><br><span class="line"><span class="comment">                    &amp;amp; 等同于 &amp; ,xml配置文件中不能直接写 &amp;符号</span></span><br><span class="line"><span class="comment">                --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql:///db1?useSSL=false<span class="symbol">&amp;amp;</span>useServerPrepStmts=true&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1234&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--扫描mapper--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.itheima.mapper&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>4.2 在com.itheima.mapper包下创建UserMapper接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.3 将<code>资料\1. 登陆注册案例\2. MyBatis环境\UserMapper.xml</code>拷贝到resources目录下</p><p>==注意：在resources下创建UserMapper.xml的目录时，要使用/分割==</p><p><img src="assets/1628867237329.png" alt="1628867237329"></p><p>至此我们所需要的环境就都已经准备好了，具体该如何实现?</p><h4 id="4-1-3-代码实现"><a href="#4-1-3-代码实现" class="headerlink" title="4.1.3 代码实现"></a>4.1.3 代码实现</h4><ol><li>在UserMapper接口中提供一个根据用户名和密码查询用户对象的方法</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户名和密码查询用户对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from tb_user where username = #&#123;username&#125; and password = #&#123;password&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">select</span><span class="params">(<span class="meta">@Param(&quot;username&quot;)</span> String username,<span class="meta">@Param(&quot;password&quot;)</span>  String password)</span>;</span><br></pre></td></tr></table></figure><p><strong>说明</strong></p><p>@Param注解的作用:用于传递参数,是方法的参数可以与SQL中的字段名相对应。</p><ol><li>修改loign.html</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>login<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;css/login.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;loginDiv&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/request-demo/loginServlet&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">id</span>=<span class="string">&quot;form&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">&quot;loginMsg&quot;</span>&gt;</span>LOGIN IN<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>Username:<span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>Password:<span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;subDiv&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;login up&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;reset&quot;</span> <span class="attr">class</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;reset&quot;</span>&gt;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;register.html&quot;</span>&gt;</span>没有账号？点击注册<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>编写LoginServlet</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/loginServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1. 接收用户名和密码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 调用MyBatis完成查询</span></span><br><span class="line">        <span class="comment">//2.1 获取SqlSessionFactory对象</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line">        <span class="comment">//2.2 获取SqlSession对象</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">        <span class="comment">//2.3 获取Mapper</span></span><br><span class="line">        <span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">        <span class="comment">//2.4 调用方法</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.select(username, password);</span><br><span class="line">        <span class="comment">//2.5 释放资源</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取字符输出流，并设置content type</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">        <span class="comment">//3. 判断user释放为null</span></span><br><span class="line">        <span class="keyword">if</span>(user != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">// 登陆成功</span></span><br><span class="line">            writer.write(<span class="string">&quot;登陆成功&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 登陆失败</span></span><br><span class="line">            writer.write(<span class="string">&quot;登陆失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>启动服务器测试</li></ol><p>4.1 如果用户名和密码输入错误，则</p><p><img src="assets/1628867761245.png" alt="1628867761245"></p><p>4.2 如果用户名和密码输入正确，则</p><p><img src="assets/1628867801708.png" alt="1628867801708"></p><p>至此用户的登录功能就已经完成了~</p><h3 id="4-2-用户注册"><a href="#4-2-用户注册" class="headerlink" title="4.2 用户注册"></a>4.2 用户注册</h3><h4 id="4-2-1-需求分析"><a href="#4-2-1-需求分析" class="headerlink" title="4.2.1 需求分析"></a>4.2.1 需求分析</h4><p><img src="assets/1628867904783.png" alt="1628867904783"></p><ol><li>用户在注册页面输入用户名和密码，提交请求给RegisterServlet</li><li>在RegisterServlet中接收请求和数据[用户名和密码]</li><li>在RegisterServlet中通过Mybatis实现调用UserMapper来根据用户名查询数据库表</li><li>将查询的结果封装到User对象中进行返回</li><li>在RegisterServlet中判断返回的User对象是否为null</li><li>如果为nul，说明根据用户名可用，则调用UserMapper来实现添加用户</li><li>如果不为null,则说明用户不可以，返回”用户名已存在”数据给前端</li></ol><h4 id="4-2-2-代码编写"><a href="#4-2-2-代码编写" class="headerlink" title="4.2.2 代码编写"></a>4.2.2 代码编写</h4><ol><li>编写UserMapper提供根据用户名查询用户数据方法和添加用户方法</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 根据用户名查询用户对象</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Select(&quot;select * from tb_user where username = #&#123;username&#125;&quot;)</span></span><br><span class="line">User <span class="title function_">selectByUsername</span><span class="params">(String username)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 添加用户</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Insert(&quot;insert into tb_user values(null,#&#123;username&#125;,#&#123;password&#125;)&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">add</span><span class="params">(User user)</span>;</span><br></pre></td></tr></table></figure><ol><li>修改register.html</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>欢迎注册<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;css/register.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-div&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;reg-content&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎注册<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>已有帐号？<span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;login.html&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;reg-form&quot;</span> <span class="attr">action</span>=<span class="string">&quot;/request-demo/registerServlet&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;inputs&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;username_err&quot;</span> <span class="attr">class</span>=<span class="string">&quot;err_msg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none&quot;</span>&gt;</span>用户名不太受欢迎<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;inputs&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;password_err&quot;</span> <span class="attr">class</span>=<span class="string">&quot;err_msg&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none&quot;</span>&gt;</span>密码格式有误<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;buttons&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&quot;注 册&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">id</span>=<span class="string">&quot;reg_btn&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span> <span class="attr">class</span>=<span class="string">&quot;clear&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>创建RegisterServlet类</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/registerServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RegisterServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">//1. 接收用户数据</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//封装用户对象</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setUsername(username);</span><br><span class="line">        user.setPassword(password);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 调用mapper 根据用户名查询用户对象</span></span><br><span class="line">        <span class="comment">//2.1 获取SqlSessionFactory对象</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line">        <span class="comment">//2.2 获取SqlSession对象</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">        <span class="comment">//2.3 获取Mapper</span></span><br><span class="line">        <span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.4 调用方法</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">u</span> <span class="operator">=</span> userMapper.selectByUsername(username);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 判断用户对象释放为null</span></span><br><span class="line">        <span class="keyword">if</span>( u == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">// 用户名不存在，添加用户</span></span><br><span class="line">            userMapper.add(user);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 提交事务</span></span><br><span class="line">            sqlSession.commit();</span><br><span class="line">            <span class="comment">// 释放资源</span></span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 用户名存在，给出提示信息</span></span><br><span class="line">            response.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">            response.getWriter().write(<span class="string">&quot;用户名已存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>启动服务器进行测试</li></ol><p>4.1 如果测试成功，则在数据库中就能查看到新注册的数据</p><p>4.2 如果用户已经存在，则在页面上展示 <code>用户名已存在</code> 的提示信息</p><h3 id="4-3-SqlSessionFactory工具类抽取"><a href="#4-3-SqlSessionFactory工具类抽取" class="headerlink" title="4.3 SqlSessionFactory工具类抽取"></a>4.3 SqlSessionFactory工具类抽取</h3><p>上面两个功能已经实现，但是在写Servlet的时候，因为需要使用Mybatis来完成数据库的操作，所以对于Mybatis的基础操作就出现了些重复代码，如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;</span><br><span class="line"><span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> </span><br><span class="line"><span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br></pre></td></tr></table></figure><p>有了这些重复代码就会造成一些问题:</p><ul><li>重复代码不利于后期的维护</li><li>SqlSessionFactory工厂类进行重复创建<ul><li>就相当于每次买手机都需要重新创建一个手机生产工厂来给你制造一个手机一样，资源消耗非常大但性能却非常低。所以这么做是不允许的。</li></ul></li></ul><p>那如何来优化呢？</p><ul><li>代码重复可以抽取工具类</li><li>对指定代码只需要执行一次可以使用静态代码块</li></ul><p>有了这两个方向后，代码具体该如何编写?</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SqlSessionFactoryUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">//静态代码块会随着类的加载而自动执行，且只执行一次</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line">            sqlSessionFactory = <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SqlSessionFactory <span class="title function_">getSqlSessionFactory</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactory;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>工具类抽取以后，以后在对Mybatis的SqlSession进行操作的时候，就可以直接使用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span>SqlSessionFactoryUtils.getSqlSessionFactory();</span><br></pre></td></tr></table></figure><p>这样就可以很好的解决上面所说的代码重复和重复创建工厂导致性能低的问题了。</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>三层架构</title>
      <link href="/2023/05/21/%E4%B8%89%E5%B1%82%E6%9E%B6%E6%9E%84/"/>
      <url>/2023/05/21/%E4%B8%89%E5%B1%82%E6%9E%B6%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<h1 id="两层架构案例"><a href="#两层架构案例" class="headerlink" title="两层架构案例"></a>两层架构案例</h1><h2 id="一、实现登录功能"><a href="#一、实现登录功能" class="headerlink" title="一、实现登录功能"></a>一、实现登录功能</h2><ul><li>步骤1:创建项目工程，工程名称:CO8_Structrue，进行web项目初始化配置</li><li>步骤2:复制CO7项目资料及web资料，并测试项目运行。</li><li>步骤3:创建com.itbbj.edu.servlet包，并创建UserLoginServlet步骤4:重构login.jsp与userList.jsp页面</li></ul><h3 id="1-1-UserLogin-Servlet"><a href="#1-1-UserLogin-Servlet" class="headerlink" title="1.1 UserLogin-Servlet"></a>1.1 UserLogin-Servlet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itbbj.edu.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itbbj.edu.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.itbbj.edu.dao.impl.UserDaoImpl;</span><br><span class="line"><span class="keyword">import</span> com.itbbj.edu.domain.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.*;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/Login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserLoginServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doPost(request,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">contextPath</span> <span class="operator">=</span> request.getContextPath();</span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">userName</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userDao.login(userName, password);</span><br><span class="line">        <span class="keyword">if</span> (user != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">Cookie</span> <span class="variable">cookieUserName</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;userName&quot;</span>, userName);</span><br><span class="line">            cookieUserName.setMaxAge(<span class="number">60</span> * <span class="number">10</span>);</span><br><span class="line">            response.addCookie(cookieUserName);</span><br><span class="line">            response.sendRedirect(contextPath + <span class="string">&quot;/userList.jsp&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">            session.setAttribute(<span class="string">&quot;mes&quot;</span>,<span class="string">&quot;账号或者密码不正确&quot;</span>);</span><br><span class="line">            response.sendRedirect(contextPath+<span class="string">&quot;/login.jsp&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="1-2-UserDao-interface"><a href="#1-2-UserDao-interface" class="headerlink" title="1.2 UserDao-interface"></a>1.2 UserDao-interface</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itbbj.edu.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itbbj.edu.domain.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">update</span><span class="params">(User user)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">insert</span><span class="params">(User user)</span>;</span><br><span class="line">    List&lt;User&gt; <span class="title function_">getUserList</span><span class="params">()</span>;</span><br><span class="line">    User <span class="title function_">login</span><span class="params">(String paramUserName,String paramPwd)</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">existUserName</span><span class="params">(String userName)</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">existEmail</span><span class="params">(String email)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="1-3-UserDaoImpl-impl"><a href="#1-3-UserDaoImpl-impl" class="headerlink" title="1.3 UserDaoImpl-impl"></a>1.3 UserDaoImpl-impl</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itbbj.edu.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itbbj.edu.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.itbbj.edu.domain.User;</span><br><span class="line"><span class="keyword">import</span> com.itbbj.edu.util.DbUtil;</span><br><span class="line"><span class="keyword">import</span> com.itbbj.edu.util.DsUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="type">DbUtil</span> <span class="variable">dbUtil</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DbUtil</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    DsUtil dbUtil = new DsUtil();</span></span><br><span class="line">    <span class="comment">//异常处理---&gt;直接抛出</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update user set password = ? where id = ?&quot;</span>;</span><br><span class="line">        Object[] params = &#123;user.getPassword(), user.getId()&#125;;</span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> dbUtil.executeUpdate(sql, params);</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insert</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into user(userName,password,email,userType) values (?,?,?,?)&quot;</span>;</span><br><span class="line">        Object[] params = &#123;user.getUserName(), user.getPassword(), user.getEmail(), user.getUserType()&#125;;</span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> dbUtil.executeUpdate(sql, params);</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">getUserList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> dbUtil.getConnection();</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        List&lt;User&gt; userList = <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from user&quot;</span>;</span><br><span class="line">            preparedStatement = connection.prepareStatement(sql);</span><br><span class="line">            rs = preparedStatement.executeQuery();</span><br><span class="line">            <span class="comment">//实例化用户集合</span></span><br><span class="line">            userList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">userName</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">email</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;email&quot;</span>);</span><br><span class="line">                <span class="type">int</span> <span class="variable">userType</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;userType&quot;</span>);</span><br><span class="line">                user = <span class="keyword">new</span> <span class="title class_">User</span>(id, userName, password, email, userType);</span><br><span class="line">                userList.add(user);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">            throwables.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            dbUtil.closeAll(connection, preparedStatement, rs);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> userList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">login</span><span class="params">(String paramUserName, String paramPwd)</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> dbUtil.getConnection();</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from user where userName = ? and password = ?&quot;</span>;</span><br><span class="line">            preparedStatement = connection.prepareStatement(sql);</span><br><span class="line">            preparedStatement.setString(<span class="number">1</span>, paramUserName);</span><br><span class="line">            preparedStatement.setString(<span class="number">2</span>, paramPwd);</span><br><span class="line">            rs = preparedStatement.executeQuery();</span><br><span class="line">            user = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">userName</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">email</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;email&quot;</span>);</span><br><span class="line">                <span class="type">int</span> <span class="variable">userType</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;userType&quot;</span>);</span><br><span class="line">                user = <span class="keyword">new</span> <span class="title class_">User</span>(id, userName, password, email, userType);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">            throwables.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            dbUtil.closeAll(connection, preparedStatement, rs);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">existUserName</span><span class="params">(String userName)</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> dbUtil.getConnection();</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isExit</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from user where userName = ?&quot;</span>;</span><br><span class="line">            preparedStatement = connection.prepareStatement(sql);</span><br><span class="line">            preparedStatement.setString(<span class="number">1</span>, userName);</span><br><span class="line">            rs = preparedStatement.executeQuery();</span><br><span class="line">            isExit = rs.next();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">            throwables.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            dbUtil.closeAll(connection, preparedStatement, rs);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> isExit;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">existEmail</span><span class="params">(String email)</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> dbUtil.getConnection();</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isExit</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from user where email = ?&quot;</span>;</span><br><span class="line">            preparedStatement = connection.prepareStatement(sql);</span><br><span class="line">            preparedStatement.setString(<span class="number">1</span>, email);</span><br><span class="line">            rs = preparedStatement.executeQuery();</span><br><span class="line">            isExit = rs.next();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">            throwables.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            dbUtil.closeAll(connection, preparedStatement, rs);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> isExit;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="1-4-Util"><a href="#1-4-Util" class="headerlink" title="1.4 Util"></a>1.4 Util</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itbbj.edu.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itbbj.edu.domain.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DbUtil</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String driver;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String url;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String user;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String password;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> DbUtil.class.getClassLoader().getResourceAsStream(<span class="string">&quot;database.properties&quot;</span>);</span><br><span class="line">            properties.load(inputStream);</span><br><span class="line">            driver = properties.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">            url = properties.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">            user = properties.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">            password = properties.getProperty(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Connection <span class="title function_">getConnection</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//1.获取链接对象</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">            connection = DriverManager.getConnection(url, user, password);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.connection;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">closeAll</span><span class="params">(Connection connection, Statement statement,ResultSet resultSet)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (resultSet != <span class="literal">null</span>) &#123;</span><br><span class="line">                resultSet.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (statement != <span class="literal">null</span>) &#123;</span><br><span class="line">                statement.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (connection != <span class="literal">null</span>) &#123;</span><br><span class="line">                connection.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">            throwables.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">executeUpdate</span><span class="params">(String sql,Object[] params)</span> &#123;</span><br><span class="line">        connection = getConnection();</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            preparedStatement = connection.prepareStatement(sql);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; params.length; i++) &#123;</span><br><span class="line">                preparedStatement.setObject(i+<span class="number">1</span>,params[i]);</span><br><span class="line">            &#125;</span><br><span class="line">            num = preparedStatement.executeUpdate();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">            throwables.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        closeAll(connection,preparedStatement,<span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update user set userName = ?,password = ?,email = ?,userType = ? where id = ?&quot;</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        Object[] params = &#123;user.getUserName(),user.getPassword(),user.getEmail(),user.getUserType(),user.getId()&#125;;</span><br><span class="line">        <span class="type">DbUtil</span> <span class="variable">dbUtil</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DbUtil</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> dbUtil.executeUpdate(sql,params);</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="1-5-login-jsp"><a href="#1-5-login-jsp" class="headerlink" title="1.5 login.jsp"></a>1.5 login.jsp</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;zh-CN&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>/&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;IE=edge&quot;</span>/&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span>/&gt;</span><br><span class="line">    &lt;title&gt;管理员登录&lt;/title&gt;</span><br><span class="line">    &lt;!-- <span class="number">1.</span> 导入CSS的全局样式 --&gt;</span><br><span class="line">    &lt;link href=<span class="string">&quot;css/bootstrap.min.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">    &lt;!-- <span class="number">2.</span> jQuery导入，建议使用<span class="number">1.9</span>以上的版本 --&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;js/jquery-2.1.0.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;!-- <span class="number">3.</span> 导入bootstrap的js文件 --&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;js/bootstrap.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div class=<span class="string">&quot;container&quot;</span> style=<span class="string">&quot;width: 400px;&quot;</span>&gt;</span><br><span class="line">    &lt;h3 style=<span class="string">&quot;text-align: center;&quot;</span>&gt;管理员登录&lt;/h3&gt;</span><br><span class="line">    &lt;form action=<span class="string">&quot;&lt;%=request.getContextPath()%&gt;/Login&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">        &lt;div class=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">            &lt;label <span class="keyword">for</span>=<span class="string">&quot;user&quot;</span>&gt;用户名：&lt;/label&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;userName&quot;</span> class=<span class="string">&quot;form-control&quot;</span> id=<span class="string">&quot;user&quot;</span> placeholder=<span class="string">&quot;请输入用户名&quot;</span>/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div class=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">            &lt;label <span class="keyword">for</span>=<span class="string">&quot;password&quot;</span>&gt;密码：&lt;/label&gt;</span><br><span class="line">            &lt;input type=<span class="string">&quot;password&quot;</span> name=<span class="string">&quot;password&quot;</span> class=<span class="string">&quot;form-control&quot;</span> id=<span class="string">&quot;password&quot;</span> placeholder=<span class="string">&quot;请输入密码&quot;</span>/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;hr/&gt;</span><br><span class="line">        &lt;div class=<span class="string">&quot;form-group&quot;</span> style=<span class="string">&quot;text-align: center; padding: 0 20px&quot;</span>&gt;</span><br><span class="line">            &lt;input class=<span class="string">&quot;btn btn btn-primary&quot;</span> type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;登录&quot;</span>&gt; &lt;a class=<span class="string">&quot;btn btn-primary&quot;</span> href=<span class="string">&quot;userAdd.jsp&quot;</span>&gt;注册&lt;/a&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">    &lt;!-- 出错显示的信息框 --&gt;</span><br><span class="line">    &lt;div class=<span class="string">&quot;alert alert-warning alert-dismissible&quot;</span>  role=<span class="string">&quot;alert&quot;</span>&gt;</span><br><span class="line">        &lt;button type=<span class="string">&quot;button&quot;</span> class=<span class="string">&quot;close&quot;</span> data-dismiss=<span class="string">&quot;alert&quot;</span> &gt;</span><br><span class="line">            &lt;span&gt;&amp;times;&lt;/span&gt;</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">        &lt;strong&gt;&lt;%=session.getAttribute(<span class="string">&quot;mes&quot;</span>)%&gt;&gt;&lt;/strong&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="二、实现注册功能"><a href="#二、实现注册功能" class="headerlink" title="二、实现注册功能"></a>二、实现注册功能</h2><h3 id="UserAdd-Servlet"><a href="#UserAdd-Servlet" class="headerlink" title="UserAdd-Servlet"></a>UserAdd-Servlet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itbbj.edu.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itbbj.edu.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.itbbj.edu.dao.impl.UserDaoImpl;</span><br><span class="line"><span class="keyword">import</span> com.itbbj.edu.domain.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.*;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/userAdd&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserAddServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doPost(request,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">contextPath</span> <span class="operator">=</span> request.getContextPath();</span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">userName</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">email</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;email&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">userType</span> <span class="operator">=</span> Integer.parseInt(request.getParameter(<span class="string">&quot;userType&quot;</span>));</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(userName, password, email, userType);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isExistUserName</span> <span class="operator">=</span> userDao.existUserName(userName);</span><br><span class="line">        <span class="type">boolean</span> isExistEmail= userDao.existEmail(email);</span><br><span class="line">        <span class="keyword">if</span> (isExistUserName) &#123;</span><br><span class="line">            request.setAttribute(<span class="string">&quot;info&quot;</span>,<span class="string">&quot;账号已存在，注册失败&quot;</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;userAdd.jsp&quot;</span>).forward(request,response);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (isExistEmail) &#123;</span><br><span class="line">            request.setAttribute(<span class="string">&quot;info&quot;</span>,<span class="string">&quot;电子邮箱已存在，注册失败&quot;</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;userAdd.jsp&quot;</span>).forward(request,response);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> userDao.insert(user);</span><br><span class="line">            <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">            session.setAttribute(<span class="string">&quot;mes&quot;</span>,<span class="string">&quot;新用户注册成功，请登录&quot;</span>);</span><br><span class="line">            response.sendRedirect(contextPath+<span class="string">&quot;/login.jsp&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="三、实现注销功能"><a href="#三、实现注销功能" class="headerlink" title="三、实现注销功能"></a>三、实现注销功能</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itbbj.edu.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itbbj.edu.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.itbbj.edu.dao.impl.UserDaoImpl;</span><br><span class="line"><span class="keyword">import</span> com.itbbj.edu.domain.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.*;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/Logout&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserLogoutServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doPost(request,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">contextPath</span> <span class="operator">=</span> request.getContextPath();</span><br><span class="line">        Cookie[] cookies = request.getCookies();</span><br><span class="line">        <span class="keyword">if</span> (cookies != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Cookie cookie : cookies) &#123;</span><br><span class="line">              cookie.setMaxAge(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        response.sendRedirect(contextPath+<span class="string">&quot;/login.jsp&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="三层架构"><a href="#三层架构" class="headerlink" title="三层架构"></a>三层架构</h1><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230522160938580.png" alt="image-20230522160938580"></p><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230522161151749.png" alt="image-20230522161151749"></p><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230522161311282.png" alt="image-20230522161311282"></p><h3 id="1-服务层"><a href="#1-服务层" class="headerlink" title="1. 服务层"></a>1. 服务层</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itbbj.edu.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itbbj.edu.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.itbbj.edu.dao.impl.UserDaoImpl;</span><br><span class="line"><span class="keyword">import</span> com.itbbj.edu.domain.User;</span><br><span class="line"><span class="keyword">import</span> com.itbbj.edu.service.UserService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userDao.update(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">register</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">userName</span> <span class="operator">=</span> user.getUserName();</span><br><span class="line">        <span class="type">String</span> <span class="variable">email</span> <span class="operator">=</span> user.getEmail();</span><br><span class="line">        <span class="keyword">if</span> (userDao.existUserName(userName))&#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(userDao.existEmail(email))&#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> userDao.insert(user);</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">getUserList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userDao.getUserList();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">login</span><span class="params">(String paramUserName, String paramPwd)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userDao.login(paramUserName,paramPwd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">existUserName</span><span class="params">(String userName)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">existEmail</span><span class="params">(String email)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-Servlet层"><a href="#2-Servlet层" class="headerlink" title="2. Servlet层"></a>2. Servlet层</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itbbj.edu.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itbbj.edu.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.itbbj.edu.dao.impl.UserDaoImpl;</span><br><span class="line"><span class="keyword">import</span> com.itbbj.edu.domain.User;</span><br><span class="line"><span class="keyword">import</span> com.itbbj.edu.service.UserService;</span><br><span class="line"><span class="keyword">import</span> com.itbbj.edu.service.impl.UserServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.*;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/userAdd&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserAddServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doPost(request,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"><span class="comment">//        UserDao userDao = new UserDaoImpl();</span></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserServiceImpl</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">contextPath</span> <span class="operator">=</span> request.getContextPath();</span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">userName</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">email</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;email&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">userType</span> <span class="operator">=</span> Integer.parseInt(request.getParameter(<span class="string">&quot;userType&quot;</span>));</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(userName, password, email, userType);</span><br><span class="line"><span class="comment">//        boolean isExistUserName = userDao.existUserName(userName);</span></span><br><span class="line"><span class="comment">//        boolean isExistEmail= userDao.existEmail(email);</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">registerNum</span> <span class="operator">=</span> userService.register(user);</span><br><span class="line">        <span class="keyword">if</span> (registerNum == -<span class="number">1</span>) &#123;</span><br><span class="line">            request.setAttribute(<span class="string">&quot;info&quot;</span>,<span class="string">&quot;账号已存在，注册失败&quot;</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;userAdd.jsp&quot;</span>).forward(request,response);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (registerNum == -<span class="number">2</span>) &#123;</span><br><span class="line">            request.setAttribute(<span class="string">&quot;info&quot;</span>,<span class="string">&quot;电子邮箱已存在，注册失败&quot;</span>);</span><br><span class="line">            request.getRequestDispatcher(<span class="string">&quot;userAdd.jsp&quot;</span>).forward(request,response);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">            session.setAttribute(<span class="string">&quot;mes&quot;</span>,<span class="string">&quot;新用户注册成功，请登录&quot;</span>);</span><br><span class="line">            response.sendRedirect(contextPath+<span class="string">&quot;/login.jsp&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>JSP动态网页开发</title>
      <link href="/2023/05/19/JSP%E5%8A%A8%E6%80%81%E7%BD%91%E9%A1%B5%E5%BC%80%E5%8F%91/"/>
      <url>/2023/05/19/JSP%E5%8A%A8%E6%80%81%E7%BD%91%E9%A1%B5%E5%BC%80%E5%8F%91/</url>
      
        <content type="html"><![CDATA[<h1 id="JSP"><a href="#JSP" class="headerlink" title="JSP"></a>JSP</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">可以理解为一个网页既可以写html代码，又可以写java代码</span><br></pre></td></tr></table></figure><p>修改注释</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--</span><br><span class="line">  Created by IntelliJ IDEA.</span><br><span class="line">  User: $&#123;USER&#125;</span><br><span class="line">  Date: $&#123;DATE&#125;</span><br><span class="line">  Time: $&#123;TIME&#125;</span><br><span class="line">  To change <span class="built_in">this</span> template use File | Settings | File Templates.</span><br><span class="line">--%&gt;</span><br></pre></td></tr></table></figure><h2 id="1-语法"><a href="#1-语法" class="headerlink" title="1.语法"></a>1.语法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//所有的Java代码都需要在</span></span><br><span class="line">&lt;%</span><br><span class="line"></span><br><span class="line">%&gt;</span><br><span class="line">中写入,只写入</span><br></pre></td></tr></table></figure><h3 id="1-1-page指令"><a href="#1-1-page指令" class="headerlink" title="1.1 page指令"></a>1.1 page指令</h3><p>定义整个页面的属性</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br></pre></td></tr></table></figure><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230520204550112.png" alt="image-20230520204550112"></p><h3 id="1-2-链式编程"><a href="#1-2-链式编程" class="headerlink" title="1.2 链式编程"></a>1.2 链式编程</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//多使用匿名变量</span></span><br><span class="line">System.out.println(<span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyy-MM-dd&quot;</span>).format(<span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br></pre></td></tr></table></figure><h3 id="1-3-include指令"><a href="#1-3-include指令" class="headerlink" title="1.3 include指令"></a>1.3 include指令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">就是在一个jsp页面再嵌入一个jsp页面</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.text.SimpleDateFormat&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.Date&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;$Title$&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">  &lt;%<span class="meta">@include</span> file=<span class="string">&quot;topheader.jsp&quot;</span>%&gt;</span><br><span class="line">  &lt;h1&gt;内容部分&lt;/h1&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230520205813553.png" alt="image-20230520205813553"></p><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230520205835126.png" alt="image-20230520205835126"></p><h2 id="2-脚本应用"><a href="#2-脚本应用" class="headerlink" title="2. 脚本应用"></a>2. 脚本应用</h2><ul><li><p>1-相当于再SRC下写的Java代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;% JAVA代码 %&gt;</span><br></pre></td></tr></table></figure></li><li><p>2-在HTML页面上显示变量的数据</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= JAVA变量 %&gt;</span><br></pre></td></tr></table></figure></li><li><p>3-声明方法或全局变量</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%! 声明方法及全局变量 %&gt;</span><br></pre></td></tr></table></figure></li></ul><p>举例：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.text.SimpleDateFormat&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.Date&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;$Title$&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">  &lt;%</span><br><span class="line">    <span class="type">SimpleDateFormat</span> <span class="variable">simpleDateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">systemDate</span> <span class="operator">=</span> simpleDateFormat.format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">  %&gt;</span><br><span class="line">  &lt;%!</span><br><span class="line">    <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> num1,<span class="type">int</span> num2)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> num1 + num2;</span><br><span class="line">    &#125;</span><br><span class="line">  %&gt;</span><br><span class="line">  &lt;%= systemDate%&gt;&lt;br&gt;</span><br><span class="line">  &lt;h1&gt;调用方法:&lt;%= add(<span class="number">55</span>,<span class="number">66</span>)%&gt;&lt;/h1&gt;</span><br><span class="line">  &lt;h1&gt;num=&lt;%=num%&gt;&lt;/h1&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230520211135277.png" alt="image-20230520211135277"></p><h2 id="3-案例"><a href="#3-案例" class="headerlink" title="3. 案例"></a>3. 案例</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.text.SimpleDateFormat&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.Date&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;$Title$&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">  &lt;%!</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">findYear</span><span class="params">(<span class="type">int</span> year)</span> &#123;</span><br><span class="line">      <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">if</span>((year %<span class="number">4</span> ==<span class="number">0</span> &amp;&amp; year %<span class="number">100</span> != <span class="number">0</span>) || year %<span class="number">400</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        flag = <span class="literal">true</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> flag = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">return</span> flag;</span><br><span class="line">    &#125;</span><br><span class="line">  %&gt;</span><br><span class="line">  &lt;%</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2000</span>; i &lt;= <span class="number">2023</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (findYear(i)) &#123;</span><br><span class="line">        out.println(i);</span><br><span class="line">        count++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  %&gt;</span><br><span class="line">  &lt;br&gt;</span><br><span class="line">  从<span class="number">2000</span>年到<span class="number">2023</span>年共有&lt;%=count%&gt;个闰年</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这里有个点要注意，out方法需要导入tomcat的依赖包</span><br></pre></td></tr></table></figure><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230520212013053.png" alt="image-20230520212013053"></p><h2 id="4-注释"><a href="#4-注释" class="headerlink" title="4. 注释"></a>4. 注释</h2><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230520212618180.png" alt="image-20230520212618180"></p><h1 id="Tomact"><a href="#Tomact" class="headerlink" title="Tomact"></a>Tomact</h1><h2 id="1-部署"><a href="#1-部署" class="headerlink" title="1.部署"></a>1.部署</h2><h4 id="1-1-1-先搞清楚目录文件"><a href="#1-1-1-先搞清楚目录文件" class="headerlink" title="1.1.1 先搞清楚目录文件"></a>1.1.1 先搞清楚目录文件</h4><ul><li>bin: 环境变量</li><li>conf: 配置文件</li><li>lib: 第三方的jar包</li><li>logs: 日志文件</li><li>temp: 临时缓存文件</li><li>webapps: 存放项目——&gt; 网站</li><li>work: 运行程序产生不重要</li></ul><p>搞清楚这些，就对部署有了个大概的了解, 重要的地方还是webapps文件夹</p><p>只需要将项目文件放在webapps目录下</p><p><img src="https://beihaibei.eu.org/img/JSP/jsp1.webp" alt=""></p><h4 id="1-1-2-运行项目"><a href="#1-1-2-运行项目" class="headerlink" title="1.1.2 运行项目"></a>1.1.2 运行项目</h4><ol><li>运行tomcat服务器</li><li>在浏览器输入地址，例如：<a href="http://localhost:8080/onOpen/">http://localhost:8080/onOpen/</a></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这里比较重要的点是，tomcat服务会自动查询目录下的index.html文件</span><br></pre></td></tr></table></figure><h2 id="2-war包应用"><a href="#2-war包应用" class="headerlink" title="2. war包应用"></a>2. war包应用</h2><p>在项目目录下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jar -cvf beihai.war *</span><br></pre></td></tr></table></figure><ol><li>如果将war包放在上面1.1.2所讲的webapps目录下，然后开启tomcat，这个war包会自动解压</li><li>如果将war包在webapps目录下删去会直接删去刚才解压的目录</li></ol><h2 id="3-IDEA中配置Tomcat"><a href="#3-IDEA中配置Tomcat" class="headerlink" title="3.IDEA中配置Tomcat"></a>3.IDEA中配置Tomcat</h2><p>idea版本: 2021.1.3</p><p><img src="https://picco.eu.org/img/JSP/jsp2.webp" alt="image-20230519213030172"></p><p><img src="https://picco.eu.org/img/JSP/jsp3.webp" alt="image-20230519213046942"></p><p><img src="https://beihaibei.eu.org/img/JSP/jsp4.webp" alt="image-20230519213104202"></p><p><img src="https://picco.eu.org/img/JSP/jsp5.webp" alt="image-20230519213122303"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">这里的Deployment有点混淆</span><br><span class="line">第一种是war exploded</span><br><span class="line">第二种是war</span><br></pre></td></tr></table></figure><h3 id="Tomcat部署时war和war-exploded区别"><a href="#Tomcat部署时war和war-exploded区别" class="headerlink" title="Tomcat部署时war和war exploded区别"></a>Tomcat部署时war和war exploded区别</h3><p><a href="https://baijiahao.baidu.com/s?id=1597444322591083981&amp;wfr=spider&amp;for=pc">https://baijiahao.baidu.com/s?id=1597444322591083981&amp;wfr=spider&amp;for=pc</a></p><h2 id="4-Tomcat内置函数"><a href="#4-Tomcat内置函数" class="headerlink" title="4. Tomcat内置函数"></a>4. Tomcat内置函数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">首先需要导入tomcat依赖</span><br><span class="line">File-&gt;Project Structure-&gt;Module-&gt;Dependencies</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> request.getMethod();</span><br><span class="line">    <span class="type">String</span> <span class="variable">userName</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">    out.println(<span class="string">&quot;请求方式：&quot;</span>+method+<span class="string">&quot;&lt;br&gt;&quot;</span>+<span class="string">&quot;传递参数值:&quot;</span>+userName);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p>就记住一些常用的就够了</p><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230521145313321.png" alt="image-20230521145313321"></p><h2 id="5-常见问题"><a href="#5-常见问题" class="headerlink" title="5. 常见问题"></a>5. 常见问题</h2><ol><li><p>有时候会遇到JSP文件中无法使用request方法（idea）</p><p><a href="https://blog.csdn.net/qq_45953233/article/details/114445607">https://blog.csdn.net/qq_45953233/article/details/114445607</a></p></li></ol><h1 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h1><h2 id="1-部署-1"><a href="#1-部署-1" class="headerlink" title="1.部署"></a>1.部署</h2><ol><li><p>在java中新建类实现Servlet接口</p><p><img src="https://beihaibei.eu.org/img/JSP/jsp6.webp" alt="image-20230519215227970"></p></li></ol><p>​    </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tutu.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">//实现了接口Servlet</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletDemo01</span> <span class="keyword">implements</span> <span class="title class_">Servlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//重写抽象方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(ServletConfig servletConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ServletConfig <span class="title function_">getServletConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;service方法被触发&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getServletInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li><p>在webapp目录下的WEB-INF中的web.xml引入Servlet</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>demo1<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.tutu.web.servlet.ServletDemo01<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  servlet的映射  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>demo1<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 通过localhost:8080/web/demo01就会被访问--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/demo1<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>实现链接</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/web/demo1</span><br></pre></td></tr></table></figure><p><img src="https://beihaibei.eu.org/img/JSP/jsp7.webp" alt="image-20230519215618672"></p></li></ol><h2 id="2-原理"><a href="#2-原理" class="headerlink" title="2.原理"></a>2.原理</h2><p><img src="E:\Hexo-Blog\piccode\PicCode\img\JSP\jsp8.webp" alt="image-20230519220133801" style="zoom: 67%;" /></p><h2 id="3-生命周期"><a href="#3-生命周期" class="headerlink" title="3. 生命周期"></a>3. 生命周期</h2><h3 id="3-1-1-init"><a href="#3-1-1-init" class="headerlink" title="3.1.1 init"></a>3.1.1 init</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--ServletDemo1--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>demo1<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.tutu.web.servlet.ServletDemo1<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--init--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--默认值是-1,负数: 第一次访问servlet资源时被触发--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--0或者正整数: 当服务器启动的时候被触发--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--servlet的映射--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>demo1<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--通过localhost:8080/web/demo01就会被访问--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/demo1<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://beihaibei.eu.org/img/JSP/jsp9.webp" alt="image-20230519221349866"></p><h3 id="3-1-2-destroy"><a href="#3-1-2-destroy" class="headerlink" title="3.1.2 destroy"></a>3.1.2 destroy</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">当服务器正常关闭时,触发</span><br></pre></td></tr></table></figure><h2 id="4-Servlet注解"><a href="#4-Servlet注解" class="headerlink" title="4. Servlet注解"></a>4. Servlet注解</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">每次加入一个java的Servlet都要在web.xml中写入一些东西，这是就可以用注释来简化</span><br></pre></td></tr></table></figure><p>这里就用@WebServlet注解来简化映射的链接</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo1/haha&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletDemo1</span> <span class="keyword">implements</span> <span class="title class_">Servlet</span></span><br></pre></td></tr></table></figure><p>这里看一下WebServlet的底层源码就可以知道value的元素可以直接简化</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> WebServlet &#123;</span><br><span class="line">    String <span class="title function_">name</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    String[] value() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    String[] urlPatterns() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">loadOnStartup</span><span class="params">()</span> <span class="keyword">default</span> -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    WebInitParam[] initParams() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">asyncSupported</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">smallIcon</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">largeIcon</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">description</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">displayName</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>如果为映射多个地址</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/demo1&quot;,&quot;/hehe&quot;)</span></span><br></pre></td></tr></table></figure><p>随便映射</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/*&quot;)</span></span><br><span class="line"><span class="comment">//不管localhost:8080/web2/后面带的什么都会映射出来</span></span><br></pre></td></tr></table></figure><p>限制性映射</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;*.do&quot;)</span></span><br><span class="line"><span class="comment">//不管前面写的什么后面必须是.do</span></span><br></pre></td></tr></table></figure><h2 id="5-Servlet继承体系"><a href="#5-Servlet继承体系" class="headerlink" title="5.Servlet继承体系"></a>5.Servlet继承体系</h2><p><img src="https://beihaibei.eu.org/img/JSP/jsp10.webp" alt=""></p><p>这里就不需要实现Servlet的接口方法，而只需要继承抽象类</p><ol><li><p>GenericServlet抽象类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tutu.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.GenericServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/demo2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletDemo2</span> <span class="keyword">extends</span> <span class="title class_">GenericServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Demo2的service被触发&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><ol><li><p>HttpServlet抽象类</p><p>这里如果想要实现抽象类需要在表单中进行提交</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tutu.web.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/demo3&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletDemo3</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;我是post请求&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;我是get请求&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>login.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>登录窗口<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/web2/demo3&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><h2 id="6-使用"><a href="#6-使用" class="headerlink" title="6.使用"></a>6.使用</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">将jsp页面变成了代码</span><br></pre></td></tr></table></figure><p>在jsp页面中</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">action=<span class="string">&quot;&lt;%= requests.getContextPath()%&gt;/login&quot;</span>&gt;</span><br></pre></td></tr></table></figure><p>在servlet中</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/login&quot;)</span></span><br></pre></td></tr></table></figure><h1 id="热部署"><a href="#热部署" class="headerlink" title="热部署"></a>热部署</h1><p>举个例子：</p><ol><li>我先新建了一个login.html的文件为登录页面</li><li>开启classes and resources</li></ol><p><img src="https://beihaibei.eu.org/img/JSP/jsp11.webp" alt="image-20230519230212086"></p><ol><li><p>这样就能同步更新，不需要重新开启服务器，类似于vscode的一个插件Live Server</p></li><li><p>注意一点如果java的Servlet也需要实时更新那么需要Debug方式开启，而不是Run</p></li></ol><h1 id="HTTP数据传输"><a href="#HTTP数据传输" class="headerlink" title="HTTP数据传输"></a>HTTP数据传输</h1><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230521145234136.png" alt="image-20230521145234136"></p><h2 id="1-请求数据格式"><a href="#1-请求数据格式" class="headerlink" title="1.请求数据格式"></a>1.请求数据格式</h2><h3 id="1-1-请求行"><a href="#1-1-请求行" class="headerlink" title="1.1.请求行"></a>1.1.请求行</h3><h4 id="1-1-1-Get请求"><a href="#1-1-1-Get请求" class="headerlink" title="1.1.1 Get请求"></a>1.1.1 Get请求</h4><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230520184157667.png" alt="image-20230520184157667"></p><h4 id="1-1-2-Post请求"><a href="#1-1-2-Post请求" class="headerlink" title="1.1.2 Post请求"></a>1.1.2 Post请求</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">表单提交</span><br><span class="line">&lt;form action=<span class="string">&quot;/LoginServlet&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span>&gt;&lt;br/&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;password&quot;</span> name=<span class="string">&quot;password&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;提交&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230520184524979.png" alt="image-20230520184524979"></p><h3 id="1-2-请求头"><a href="#1-2-请求头" class="headerlink" title="1.2 请求头"></a>1.2 请求头</h3><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230520184839729.png" alt="image-20230520184839729"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这里有个refer：意思就是我在localhost/login.html中放置了一个超链接转到淘宝，那么淘宝的refer处就会显示我们的地址</span><br></pre></td></tr></table></figure><h2 id="2-Requests对象"><a href="#2-Requests对象" class="headerlink" title="2.Requests对象"></a>2.Requests对象</h2><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230520190930557.png" alt="image-20230520190930557"></p><h3 id="2-1-获取请求行数据"><a href="#2-1-获取请求行数据" class="headerlink" title="2.1 获取请求行数据"></a>2.1 获取请求行数据</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tutu.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.*;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(name = &quot;LoginServlet&quot;, value = &quot;/LoginServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doPost(request,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> request.getMethod();</span><br><span class="line">        System.out.println(<span class="string">&quot;请求方式:&quot;</span> + method);</span><br><span class="line">        <span class="type">String</span> <span class="variable">contextPath</span> <span class="operator">=</span> request.getContextPath();</span><br><span class="line">        System.out.println(<span class="string">&quot;虚拟路径:&quot;</span> + contextPath);</span><br><span class="line">        <span class="type">String</span> <span class="variable">servletPath</span> <span class="operator">=</span> request.getServletPath();</span><br><span class="line">        System.out.println(<span class="string">&quot;资源路径:&quot;</span> + servletPath);</span><br><span class="line">        <span class="type">String</span> <span class="variable">queryString</span> <span class="operator">=</span> request.getQueryString();</span><br><span class="line">        System.out.println(<span class="string">&quot;get参数:&quot;</span> + servletPath);</span><br><span class="line">        <span class="type">String</span> <span class="variable">requestURI</span> <span class="operator">=</span> request.getRequestURI();</span><br><span class="line">        System.out.println(<span class="string">&quot;虚拟路径 + 资源路径:&quot;</span> + requestURI);</span><br><span class="line">        <span class="type">String</span> <span class="variable">protocol</span> <span class="operator">=</span> request.getProtocol();</span><br><span class="line">        System.out.println(<span class="string">&quot;HTTP版本:&quot;</span> + protocol);</span><br><span class="line">        <span class="type">String</span> <span class="variable">remoteAddr</span> <span class="operator">=</span> request.getRemoteAddr();</span><br><span class="line">        System.out.println(<span class="string">&quot;IP地址&quot;</span> + remoteAddr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-2-获取请求头数据"><a href="#2-2-获取请求头数据" class="headerlink" title="2.2 获取请求头数据"></a>2.2 获取请求头数据</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">   <span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">       <span class="type">String</span> <span class="variable">agent</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;user-agent&quot;</span>);</span><br><span class="line">       System.out.println(<span class="string">&quot;获取user-agent&quot;</span> + agent);</span><br><span class="line">       Enumeration&lt;String&gt; headerNames = request.getHeaderNames();</span><br><span class="line">       <span class="keyword">while</span> (headerNames.hasMoreElements()) &#123;</span><br><span class="line">           <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> headerNames.nextElement();</span><br><span class="line">           <span class="type">String</span> <span class="variable">header</span> <span class="operator">=</span> request.getHeader(name);</span><br><span class="line">           System.out.println(name + <span class="string">&quot;:&quot;</span> + header);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-获取请求体数据"><a href="#2-3-获取请求体数据" class="headerlink" title="2.3 获取请求体数据"></a>2.3 获取请求体数据</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> request.getReader();</span><br><span class="line">    <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">while</span> ((line = br.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">        System.out.println(line);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//username=1604252677%40qq.com&amp;password=cascac</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-4-获取输入参数值"><a href="#2-4-获取输入参数值" class="headerlink" title="2.4 获取输入参数值"></a>2.4 获取输入参数值</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;username&quot;</span> + username + <span class="string">&#x27;\t&#x27;</span> + <span class="string">&quot;password&quot;</span> + password);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//username1604252677@qq.compasswordluiluilui</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        Map&lt;String, String[]&gt; map = request.getParameterMap();</span><br><span class="line">        Set&lt;String&gt; keySet = map.keySet();</span><br><span class="line">        <span class="keyword">for</span> (String name : keySet) &#123;</span><br><span class="line">            String[] values = map.get(name);</span><br><span class="line">            System.out.println(<span class="string">&quot;name&quot;</span>+name+<span class="string">&quot; values:&quot;</span>+ Arrays.toString(values));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">nameusername values:[1604252677@qq.com]</span></span><br><span class="line"><span class="comment">namepassword values:[123456]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h2 id="3-Response对象"><a href="#3-Response对象" class="headerlink" title="3. Response对象"></a>3. Response对象</h2><h4 id="3-1-中文乱码"><a href="#3-1-中文乱码" class="headerlink" title="3.1.中文乱码"></a>3.1.中文乱码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br></pre></td></tr></table></figure><h4 id="3-2-重定向"><a href="#3-2-重定向" class="headerlink" title="3.2 重定向"></a>3.2 重定向</h4><h5 id="3-2-1-登录界面"><a href="#3-2-1-登录界面" class="headerlink" title="3.2.1 登录界面"></a>3.2.1 登录界面</h5><p>login.jsp</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;info.jsp&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">&quot;0&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>用户名：<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;userName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span>  <span class="attr">name</span>=<span class="string">&quot;pwd&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sub&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="3-2-2-重定向代码区—-gt-后台密码验证中转站"><a href="#3-2-2-重定向代码区—-gt-后台密码验证中转站" class="headerlink" title="3.2.2 重定向代码区—-&gt;后台密码验证中转站"></a>3.2.2 重定向代码区—-&gt;后台密码验证中转站</h5><p>do_login.jsp</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    request.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> request.getMethod();</span><br><span class="line">    out.print(method);</span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">    out.print(username);</span><br><span class="line">    <span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;pwd&quot;</span>);</span><br><span class="line">    out.print(pwd);</span><br><span class="line">    <span class="keyword">if</span>(<span class="string">&quot;beihai&quot;</span>.equals(username) &amp;&amp; <span class="string">&quot;beihai&quot;</span>.equals(pwd)) &#123;</span><br><span class="line">        response.sendRedirect(<span class="string">&quot;welcome.jsp&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        response.sendRedirect(<span class="string">&quot;input.jsp&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="3-2-3-成功登录界面"><a href="#3-2-3-成功登录界面" class="headerlink" title="3.2.3 成功登录界面"></a>3.2.3 成功登录界面</h5><p>welcome.jsp</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;欢迎进入后台&lt;/h1&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-3-转发"><a href="#3-3-转发" class="headerlink" title="3.3 转发"></a>3.3 转发</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">解决重定向导致的requests丢失</span><br></pre></td></tr></table></figure><p>在重定向代码改版一下</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    request.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> request.getMethod();</span><br><span class="line">    out.print(method);</span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">    out.print(username);</span><br><span class="line">    <span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;pwd&quot;</span>);</span><br><span class="line">    out.print(pwd);</span><br><span class="line">    <span class="keyword">if</span>(<span class="string">&quot;beihai&quot;</span>.equals(username) &amp;&amp; <span class="string">&quot;beihai&quot;</span>.equals(pwd)) &#123;</span><br><span class="line">        <span class="comment">// ！！！！！！！！！！！！！！！！</span></span><br><span class="line">        request.getRequestDispatcher(<span class="string">&quot;welcome.jsp&quot;</span>).forward(request,response);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        response.sendRedirect(<span class="string">&quot;input.jsp&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="4-Session"><a href="#4-Session" class="headerlink" title="4. Session"></a>4. Session</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">绘画期间，换一个浏览器就不可以了</span><br></pre></td></tr></table></figure><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230521142403387.png" alt="image-20230521142403387"></p><h3 id="1-示例"><a href="#1-示例" class="headerlink" title="1. 示例"></a>1. 示例</h3><p>session.jsp</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    session.setAttribute(<span class="string">&quot;userName&quot;</span>,<span class="string">&quot;jack&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> session.getId();</span><br><span class="line">    <span class="type">String</span> <span class="variable">userName</span> <span class="operator">=</span> (String) session.getAttribute(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">    out.print(<span class="string">&quot;sessionId:&quot;</span> + id + <span class="string">&quot;&lt;br&gt;&quot;</span>);</span><br><span class="line">    out.print(<span class="string">&quot;userName:&quot;</span> + userName + <span class="string">&quot;&lt;br&gt;&quot;</span>);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;form method=<span class="string">&quot;post&quot;</span> action=<span class="string">&quot;session2.jsp&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;POST提交&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure><p>session2.jsp</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> session.getId();</span><br><span class="line">    <span class="type">String</span> <span class="variable">userName</span> <span class="operator">=</span> (String) session.getAttribute(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">    out.print(<span class="string">&quot;sessionId:&quot;</span> + id + <span class="string">&quot;&lt;br&gt;&quot;</span>);</span><br><span class="line">    out.print(<span class="string">&quot;userName:&quot;</span> + userName + <span class="string">&quot;&lt;br&gt;&quot;</span>);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;a href=<span class="string">&quot;session3.jsp&quot;</span>&gt;跳转到session页面&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure><p>session3.jsp</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> session.getId();</span><br><span class="line">    <span class="type">String</span> <span class="variable">userName</span> <span class="operator">=</span> (String) session.getAttribute(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">    out.print(<span class="string">&quot;sessionId:&quot;</span> + id + <span class="string">&quot;&lt;br&gt;&quot;</span>);</span><br><span class="line">    out.print(<span class="string">&quot;userName:&quot;</span> + userName + <span class="string">&quot;&lt;br&gt;&quot;</span>);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure><h3 id="2-Session重构登录案例"><a href="#2-Session重构登录案例" class="headerlink" title="2. Session重构登录案例"></a>2. Session重构登录案例</h3><p>login.jsp</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form method=<span class="string">&quot;post&quot;</span> action=<span class="string">&quot;do_login.jsp&quot;</span>&gt;</span><br><span class="line">  &lt;table border=<span class="string">&quot;0&quot;</span> align=<span class="string">&quot;center&quot;</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">      &lt;td&gt;用户名：&lt;/td&gt;</span><br><span class="line">      &lt;td&gt;&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;userName&quot;</span>&gt;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">      &lt;td colspan=<span class="string">&quot;2&quot;</span> align=<span class="string">&quot;center&quot;</span>&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;password&quot;</span>  name=<span class="string">&quot;pwd&quot;</span>&gt;</span><br><span class="line">      &lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">      &lt;td align=<span class="string">&quot;center&quot;</span>&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;sub&quot;</span>&gt;</span><br><span class="line">      &lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">  &lt;/table&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>do_login.jsp</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    request.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> request.getMethod();</span><br><span class="line">    out.print(method);</span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">    out.print(username);</span><br><span class="line">    <span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;pwd&quot;</span>);</span><br><span class="line">    out.print(pwd);</span><br><span class="line">    <span class="keyword">if</span>(<span class="string">&quot;beihai&quot;</span>.equals(username) &amp;&amp; <span class="string">&quot;beihai&quot;</span>.equals(pwd)) &#123;</span><br><span class="line">        session.setAttribute(<span class="string">&quot;userName&quot;</span>,<span class="string">&quot;beihai&quot;</span>);</span><br><span class="line">        response.sendRedirect(<span class="string">&quot;welcome.jsp&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        response.sendRedirect(<span class="string">&quot;input.jsp&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>welcome.jsp</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    <span class="type">String</span> <span class="variable">userName</span> <span class="operator">=</span> (String) session.getAttribute(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;&lt;%=userName%&gt;欢迎进入后台&lt;/h1&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-Session对象超时失效设置"><a href="#3-Session对象超时失效设置" class="headerlink" title="3. Session对象超时失效设置"></a>3. Session对象超时失效设置</h3><h4 id="3-1-优先级最高"><a href="#3-1-优先级最高" class="headerlink" title="3.1 优先级最高"></a>3.1 优先级最高</h4><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//单位是秒，例如:60秒</span></span><br><span class="line">session.setMaxInactiveInterval(<span class="number">60</span>);</span><br></pre></td></tr></table></figure><h4 id="3-2-在WEB-INF下web-xml文件配置"><a href="#3-2-在WEB-INF下web-xml文件配置" class="headerlink" title="3.2 在WEB-INF下web.xml文件配置"></a>3.2 在WEB-INF下web.xml文件配置</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">单位分钟，例如:10分钟</span><br><span class="line"><span class="tag">&lt;<span class="name">session-config</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">session-timeout</span>&gt;</span>10<span class="tag">&lt;/<span class="name">session-timeout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">session-config</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3-3-Tomcat目录下-conf-web-xml"><a href="#3-3-Tomcat目录下-conf-web-xml" class="headerlink" title="3.3 Tomcat目录下/conf/web.xml"></a>3.3 Tomcat目录下/conf/web.xml</h4><p>默认30分钟</p><h3 id="4-application对象"><a href="#4-application对象" class="headerlink" title="4. application对象"></a>4. application对象</h3><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230521144454883.png" alt="image-20230521144454883"></p><p>就是说我有一个持久性的窗口，你访问我浏览器多少次会有记录，换个浏览器，会在之前的浏览器上面继续累加，而不像Session对象那样绘画短</p><p>简单说就是：在一个应用服务器范围内有效</p><h1 id="作用域与Cookie"><a href="#作用域与Cookie" class="headerlink" title="作用域与Cookie"></a>作用域与Cookie</h1><h2 id="1-各对象作用域范围"><a href="#1-各对象作用域范围" class="headerlink" title="1. 各对象作用域范围"></a>1. 各对象作用域范围</h2><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230521145552646.png" alt="image-20230521145552646"></p><h2 id="2-Cookie介绍"><a href="#2-Cookie介绍" class="headerlink" title="2. Cookie介绍"></a>2. Cookie介绍</h2><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230521151512887.png" alt="image-20230521151512887"></p><h2 id="3-Cookie对象的创建与获取"><a href="#3-Cookie对象的创建与获取" class="headerlink" title="3. Cookie对象的创建与获取"></a>3. Cookie对象的创建与获取</h2><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230521151854496.png" alt="image-20230521151854496"></p><p>addCookie.jsp</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    <span class="type">Cookie</span> <span class="variable">cookie1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;userName&quot;</span>, <span class="string">&quot;jack&quot;</span>);</span><br><span class="line">    <span class="type">Cookie</span> <span class="variable">cookie2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">    response.addCookie(cookie1);</span><br><span class="line">    response.addCookie(cookie2);</span><br><span class="line">    response.sendRedirect(<span class="string">&quot;getCookie.jsp&quot;</span>);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>getCookie.jsp</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    Cookie[] cookies = request.getCookies();</span><br><span class="line">    <span class="keyword">if</span>(cookies != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (Cookie cookie : cookies) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">&quot;password&quot;</span>.equals(cookie.getName()))&#123;</span><br><span class="line">                cookie.setValue(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            out.print(cookie.getName()+<span class="string">&quot;:&quot;</span>+cookie.getValue()+<span class="string">&quot;&lt;br&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="4-Cookie有效期设置"><a href="#4-Cookie有效期设置" class="headerlink" title="4. Cookie有效期设置"></a>4. Cookie有效期设置</h2><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230521153122344.png" alt="image-20230521153122344"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">时间为秒</span><br><span class="line">cookie1.setMaxAge(60);</span><br></pre></td></tr></table></figure><h1 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h1><h2 id="1-入门案例"><a href="#1-入门案例" class="headerlink" title="1. 入门案例"></a>1. 入门案例</h2><h3 id="1-1-修改密码"><a href="#1-1-修改密码" class="headerlink" title="1.1 修改密码"></a>1.1 修改密码</h3><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230521203833777.png" alt="image-20230521203833777"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itbbj.edu.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="comment">//异常处理---&gt;直接抛出</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1.注册驱动</span></span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        <span class="comment">//2.获取数据库连接对象 Connection.</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://localhost:3306/edudb&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        <span class="comment">//3.定义sql</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update user set password = &#x27;123456&#x27; where id = 3&quot;</span>;</span><br><span class="line">        <span class="comment">//4.获取执行sql语句的对象 Statment</span></span><br><span class="line">        <span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> connection.createStatement();</span><br><span class="line">        <span class="comment">//5.执行sql，接收返回结果，输出结果（数据库影响的行数）</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> statement.executeUpdate(sql);</span><br><span class="line">        <span class="comment">//6.释放资源</span></span><br><span class="line">        statement.close();</span><br><span class="line">        connection.close();</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itbbj.edu.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itbbj.edu.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testupdate</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDao</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> userDao.update();</span><br><span class="line">        System.out.println(<span class="string">&quot;数据库受影响的行数：&quot;</span> + num);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="1-2-新增用户"><a href="#1-2-新增用户" class="headerlink" title="1.2 新增用户"></a>1.2 新增用户</h3><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230521211911350.png" alt="image-20230521211911350"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insert</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://localhost:3306/edudb&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into user(userName,password,email,userType) values (&#x27;jack&#x27;,&#x27;123456&#x27;,&#x27;jack@163.com&#x27;,1)&quot;</span>;</span><br><span class="line">    <span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> connection.createStatement();</span><br><span class="line">    <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> statement.executeUpdate(sql);</span><br><span class="line">    statement.close();</span><br><span class="line">    connection.close();</span><br><span class="line">    <span class="keyword">return</span> num;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-3-查询用户信息"><a href="#1-3-查询用户信息" class="headerlink" title="1.3 查询用户信息"></a>1.3 查询用户信息</h3><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230521212946560.png" alt="image-20230521212946560"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getUserList</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://localhost:3306/edudb&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from user&quot;</span>;</span><br><span class="line">    <span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> connection.createStatement();</span><br><span class="line">    <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> statement.executeQuery(sql);</span><br><span class="line">    <span class="keyword">while</span>(rs.next()) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">userName</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">email</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;email&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">userType</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;userType&quot;</span>);</span><br><span class="line">        System.out.println(id+<span class="string">&quot; &quot;</span>+password+<span class="string">&quot; &quot;</span>+email+<span class="string">&quot; &quot;</span>+userType);</span><br><span class="line">    &#125;</span><br><span class="line">    statement.close();</span><br><span class="line">    connection.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-4-登录"><a href="#1-4-登录" class="headerlink" title="1.4 登录"></a>1.4 登录</h3><p>userdao</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> User <span class="title function_">login</span><span class="params">(String paramUserName,String paramPwd)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://localhost:3306/edudb&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from user where userName = &#x27;&quot;</span>+paramUserName+<span class="string">&quot;&#x27;and password = &#x27;&quot;</span>+paramPwd+<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">    <span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> connection.createStatement();</span><br><span class="line">    <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> statement.executeQuery(sql);</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(rs.next()) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">userName</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">email</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;email&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">userType</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;userType&quot;</span>);</span><br><span class="line">        user = <span class="keyword">new</span> <span class="title class_">User</span>(id,userName,password,email,userType);</span><br><span class="line">    &#125;</span><br><span class="line">    statement.close();</span><br><span class="line">    connection.close();</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>usertest</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testLogin</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userDao.login(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (user !=<span class="literal">null</span>)&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;登录成功&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;登录失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-JDBC对象"><a href="#2-JDBC对象" class="headerlink" title="2. JDBC对象"></a>2. JDBC对象</h2><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230521214441483.png" alt="image-20230521214441483"></p><h2 id="3-JavaBean数据封装"><a href="#3-JavaBean数据封装" class="headerlink" title="3. JavaBean数据封装"></a>3. JavaBean数据封装</h2><ol><li>User类</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itbbj.edu.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> userType;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUserName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserName</span><span class="params">(String userName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userName = userName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPassword</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPassword</span><span class="params">(String password)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getEmail</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setEmail</span><span class="params">(String email)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getUserType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserType</span><span class="params">(<span class="type">int</span> userType)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userType = userType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String userName, String password, String email, <span class="type">int</span> userType)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userName = userName;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">        <span class="built_in">this</span>.email = email;</span><br><span class="line">        <span class="built_in">this</span>.userType = userType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(<span class="type">int</span> id, String userName, String password, String email, <span class="type">int</span> userType)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.userName = userName;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">        <span class="built_in">this</span>.email = email;</span><br><span class="line">        <span class="built_in">this</span>.userType = userType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, userName=&#x27;&quot;</span> + userName + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, password=&#x27;&quot;</span> + password + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, email=&#x27;&quot;</span> + email + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, userType=&quot;</span> + userType +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li>UserDao</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">getUserList</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://localhost:3306/edudb&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from user&quot;</span>;</span><br><span class="line">        <span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> connection.createStatement();</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> statement.executeQuery(sql);</span><br><span class="line">        <span class="comment">//实例化用户集合</span></span><br><span class="line">        List&lt;User&gt; userList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(rs.next()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">userName</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">email</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;email&quot;</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">userType</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;userType&quot;</span>);</span><br><span class="line"><span class="comment">//            System.out.println(id+&quot; &quot;+password+&quot; &quot;+email+&quot; &quot;+userType);</span></span><br><span class="line">            user = <span class="keyword">new</span> <span class="title class_">User</span>(id,userName,password,email,userType);</span><br><span class="line">            userList.add(user);</span><br><span class="line">        &#125;</span><br><span class="line">        statement.close();</span><br><span class="line">        connection.close();</span><br><span class="line">        <span class="keyword">return</span> userList;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ol><li>UserTest</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testquery</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    List&lt;User&gt; userList = userDao.getUserList();</span><br><span class="line">    <span class="keyword">for</span> (User user : userList) &#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-SQL注入"><a href="#4-SQL注入" class="headerlink" title="4. SQL注入"></a>4. SQL注入</h2><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230522082007209.png" alt="image-20230522082007209"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from user where userName = &#x27;&quot;</span>+paramUserName+<span class="string">&quot;&#x27;and password = &#x27;&quot;</span>+paramPwd+<span class="string">&quot;&#x27; or &#x27;1&#x27; = &#x27;1&#x27;&quot;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userDao.login(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;admin&#x27; or &#x27;1&#x27; = &#x27;1&quot;</span>);</span><br></pre></td></tr></table></figure><h2 id="5-防止SQL注入"><a href="#5-防止SQL注入" class="headerlink" title="5. 防止SQL注入"></a>5. 防止SQL注入</h2><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230522082621741.png" alt="image-20230522082621741"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> User <span class="title function_">login</span><span class="params">(String paramUserName,String paramPwd)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://localhost:3306/edudb&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from user where userName = ? and password = ?&quot;</span>;</span><br><span class="line">    <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> connection.prepareStatement(sql);</span><br><span class="line">    preparedStatement.setString(<span class="number">1</span>,paramUserName);</span><br><span class="line">    preparedStatement.setString(<span class="number">2</span>,paramPwd);</span><br><span class="line">    <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> preparedStatement.executeQuery();</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(rs.next()) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">userName</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">email</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;email&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">userType</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;userType&quot;</span>);</span><br><span class="line">        user = <span class="keyword">new</span> <span class="title class_">User</span>(id,userName,password,email,userType);</span><br><span class="line">    &#125;</span><br><span class="line">    preparedStatement.close();</span><br><span class="line">    connection.close();</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-1-插入案例"><a href="#5-1-插入案例" class="headerlink" title="5.1 插入案例"></a>5.1 插入案例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insert</span><span class="params">(User user)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://localhost:3306/edudb&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into user(userName,password,email,userType) values (?,?,?,?)&quot;</span>;</span><br><span class="line">    <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> connection.prepareStatement(sql);</span><br><span class="line">    preparedStatement.setObject(<span class="number">1</span>,user.getUserName());</span><br><span class="line">    preparedStatement.setObject(<span class="number">2</span>,user.getPassword());</span><br><span class="line">    preparedStatement.setObject(<span class="number">3</span>,user.getEmail());</span><br><span class="line">    preparedStatement.setObject(<span class="number">4</span>,user.getUserType());</span><br><span class="line">    <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> preparedStatement.executeUpdate();</span><br><span class="line">    preparedStatement.close();</span><br><span class="line">    connection.close();</span><br><span class="line">    <span class="keyword">return</span> num;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testinsert</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;beihai&quot;</span>, <span class="string">&quot;woaini&quot;</span>, <span class="string">&quot;1604252677@qq.com&quot;</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> userDao.insert(user);</span><br><span class="line">    System.out.println(<span class="string">&quot;数据库受影响的行数：&quot;</span> + num);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-DbUtil工具类"><a href="#6-DbUtil工具类" class="headerlink" title="6. DbUtil工具类"></a>6. DbUtil工具类</h2><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230522085700967.png" alt="image-20230522085700967"></p><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230522091003146.png" alt="image-20230522091003146"></p><p>我下面举例一个不用Dbutils一个用可以看出来Dbutils非常方便</p><ol><li>封装Dbutils工具类</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itbbj.edu.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itbbj.edu.domain.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DbUtil</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost:3306/edudb&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Connection <span class="title function_">getConnection</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//1.获取链接对象</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">            connection = DriverManager.getConnection(url, user, password);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">            throwables.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.connection;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">closeAll</span><span class="params">(Connection connection, Statement statement,ResultSet resultSet)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (resultSet != <span class="literal">null</span>) &#123;</span><br><span class="line">                resultSet.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (statement != <span class="literal">null</span>) &#123;</span><br><span class="line">                statement.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (connection != <span class="literal">null</span>) &#123;</span><br><span class="line">                connection.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">            throwables.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">executeUpdate</span><span class="params">(String sql,Object[] params)</span> &#123;</span><br><span class="line">        connection = getConnection();</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            preparedStatement = connection.prepareStatement(sql);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; params.length; i++) &#123;</span><br><span class="line">                preparedStatement.setObject(i+<span class="number">1</span>,params[i]);</span><br><span class="line">            &#125;</span><br><span class="line">            num = preparedStatement.executeUpdate();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">            throwables.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        closeAll(connection,preparedStatement,<span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update user set userName = ?,password = ?,email = ?,userType = ? where id = ?&quot;</span>;</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        Object[] params = &#123;user.getUserName(),user.getPassword(),user.getEmail(),user.getUserType(),user.getId()&#125;;</span><br><span class="line">        <span class="type">DbUtil</span> <span class="variable">dbUtil</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DbUtil</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> dbUtil.executeUpdate(sql,params);</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li>使用Dbutils</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itbbj.edu.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itbbj.edu.domain.User;</span><br><span class="line"><span class="keyword">import</span> com.itbbj.edu.util.DbUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="type">DbUtil</span> <span class="variable">dbUtil</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DbUtil</span>();</span><br><span class="line">    <span class="comment">//异常处理---&gt;直接抛出</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update user set password = ? where id = ?&quot;</span>;</span><br><span class="line">        Object[] params = &#123;user.getPassword(),user.getId()&#125;;</span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> dbUtil.executeUpdate(sql, params);</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insert</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into user(userName,password,email,userType) values (?,?,?,?)&quot;</span>;</span><br><span class="line">        Object[] params = &#123;user.getUserName(),user.getPassword(),user.getEmail(),user.getUserType()&#125;;</span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> dbUtil.executeUpdate(sql, params);</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">getUserList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> dbUtil.getConnection();</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        List&lt;User&gt; userList = <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from user&quot;</span>;</span><br><span class="line">            preparedStatement = connection.prepareStatement(sql);</span><br><span class="line">            rs = preparedStatement.executeQuery();</span><br><span class="line">            <span class="comment">//实例化用户集合</span></span><br><span class="line">            userList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">userName</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">email</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;email&quot;</span>);</span><br><span class="line">                <span class="type">int</span> <span class="variable">userType</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;userType&quot;</span>);</span><br><span class="line">                user = <span class="keyword">new</span> <span class="title class_">User</span>(id, userName, password, email, userType);</span><br><span class="line">                userList.add(user);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">            throwables.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            dbUtil.closeAll(connection, preparedStatement, rs);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> userList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">login</span><span class="params">(String paramUserName,String paramPwd)</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> dbUtil.getConnection();</span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from user where userName = ? and password = ?&quot;</span>;</span><br><span class="line">            preparedStatement = connection.prepareStatement(sql);</span><br><span class="line">            preparedStatement.setString(<span class="number">1</span>,paramUserName);</span><br><span class="line">            preparedStatement.setString(<span class="number">2</span>,paramPwd);</span><br><span class="line">            rs = preparedStatement.executeQuery();</span><br><span class="line">            user = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(rs.next()) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">userName</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;userName&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">email</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;email&quot;</span>);</span><br><span class="line">                <span class="type">int</span> <span class="variable">userType</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;userType&quot;</span>);</span><br><span class="line">                user = <span class="keyword">new</span> <span class="title class_">User</span>(id,userName,password,email,userType);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException throwables) &#123;</span><br><span class="line">            throwables.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            dbUtil.closeAll(connection,preparedStatement,rs);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="6-1-使用配置文件"><a href="#6-1-使用配置文件" class="headerlink" title="6.1 使用配置文件"></a>6.1 使用配置文件</h3><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230522125419856.png" alt="image-20230522125419856"></p><h2 id="7-数据库连接池"><a href="#7-数据库连接池" class="headerlink" title="7. 数据库连接池"></a>7. 数据库连接池</h2><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230522092414729.png" alt="image-20230522092414729"></p><h2 id="8-Dao接口编程"><a href="#8-Dao接口编程" class="headerlink" title="8. Dao接口编程"></a>8. Dao接口编程</h2><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230522092645385.png" alt="image-20230522092645385"></p><p>接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itbbj.edu.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itbbj.edu.domain.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">update</span><span class="params">(User user)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">insert</span><span class="params">(User user)</span>;</span><br><span class="line">    List&lt;User&gt; <span class="title function_">getUserList</span><span class="params">()</span>;</span><br><span class="line">    User <span class="title function_">login</span><span class="params">(String paramUserName,String paramPwd)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="EL表达式"><a href="#EL表达式" class="headerlink" title="EL表达式"></a>EL表达式</h1>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>数据库编程篇</title>
      <link href="/2023/05/19/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BC%96%E7%A8%8B%E7%AF%87-1%E5%B0%8F%E6%97%B6%E6%90%9E%E5%AE%9A/"/>
      <url>/2023/05/19/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BC%96%E7%A8%8B%E7%AF%87-1%E5%B0%8F%E6%97%B6%E6%90%9E%E5%AE%9A/</url>
      
        <content type="html"><![CDATA[<h1 id="1-编程基础"><a href="#1-编程基础" class="headerlink" title="1 编程基础"></a>1 编程基础</h1><h2 id="1-1-用户变量"><a href="#1-1-用户变量" class="headerlink" title="1-1 用户变量"></a>1-1 用户变量</h2><p>SQL代码</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#创建用户变量name并赋值为“王林”。</span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@NAME</span><span class="operator">=</span><span class="string">&#x27;王林&#x27;</span>;   </span><br><span class="line"></span><br><span class="line">#创建用户变量user1并赋值为<span class="number">1</span>，user2赋值为<span class="number">2</span>，user3赋值为<span class="number">3</span>。</span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@user1</span><span class="operator">=</span><span class="number">1</span>, <span class="variable">@user2</span><span class="operator">=</span><span class="number">2</span>, <span class="variable">@user3</span><span class="operator">=</span><span class="number">3</span>; </span><br><span class="line">   </span><br><span class="line">#创建用户变量user4，它的值为user3的值加<span class="number">1</span>。</span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@user4</span><span class="operator">=</span><span class="variable">@user3</span><span class="operator">+</span><span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">#在一个用户变量被创建后，它可以以一种特殊形式的表达式用于其他<span class="keyword">SQL</span>语句中。变量名前面也必须加上符号@。</span><br><span class="line">#创建并查询用户变量name的值。</span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@NAME</span><span class="operator">=</span><span class="string">&#x27;王林&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@NAME</span>;</span><br><span class="line"></span><br><span class="line">#变量应用</span><br><span class="line">#查询Book表中图书编号为TP302<span class="operator">/</span><span class="number">057</span>的书名，并存储在变量b_name中。</span><br><span class="line"> <span class="keyword">SET</span> <span class="variable">@b</span>_name<span class="operator">=</span></span><br><span class="line">(<span class="keyword">SELECT</span> bookname <span class="keyword">FROM</span> book <span class="keyword">WHERE</span> bookcode <span class="operator">=</span> <span class="string">&#x27;TP302/057&#x27;</span>); </span><br><span class="line"></span><br><span class="line">#查询Book表中名字等于中b_name值的图书信息。</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Book  <span class="keyword">WHERE</span> bookname<span class="operator">=</span><span class="variable">@b</span>_name;</span><br></pre></td></tr></table></figure><h2 id="1-2-系统变量"><a href="#1-2-系统变量" class="headerlink" title="1-2 系统变量"></a>1-2 系统变量</h2><p>SQL参考</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 获得现在使用的MySQL版本。</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@VERSION</span> ;</span><br><span class="line"></span><br><span class="line">#获得系统当前时间。</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CURRENT_TIME</span>;</span><br><span class="line">     </span><br></pre></td></tr></table></figure><h1 id="2-内置函数"><a href="#2-内置函数" class="headerlink" title="2 内置函数"></a>2 内置函数</h1><h2 id="2-1-数学函数"><a href="#2-1-数学函数" class="headerlink" title="2-1 数学函数"></a>2-1 数学函数</h2><p>SQL参考</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#数学函数</span><br><span class="line">#最大值与最小值函数</span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@max</span>_num<span class="operator">=</span>GREATEST(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@max</span>_num;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@min</span>_num<span class="operator">=</span>LEAST(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@min</span>_num;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#随机函数</span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@num1</span> <span class="operator">=</span> RAND()<span class="operator">*</span><span class="number">100</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@num1</span> ;</span><br><span class="line"></span><br><span class="line">#圆周率</span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@num2</span> <span class="operator">=</span> PI();</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@num2</span> ;</span><br><span class="line"></span><br><span class="line">#绝对值</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">ABS</span>(<span class="number">-1</span>) <span class="keyword">AS</span> NUM </span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2-2-字符串函数"><a href="#2-2-字符串函数" class="headerlink" title="2-2 字符串函数"></a>2-2 字符串函数</h2><p>SQL代码</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#字符串函数</span><br><span class="line">#字符串拼接</span><br><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="string">&#x27;中国&#x27;</span>,<span class="string">&#x27;必胜&#x27;</span>) <span class="keyword">AS</span> str </span><br><span class="line">#字符串截取</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LEFT</span>(<span class="string">&#x27;hello&#x27;</span>,<span class="number">2</span>) <span class="keyword">AS</span> str</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">RIGHT</span>(<span class="string">&#x27;hello&#x27;</span>,<span class="number">2</span>) <span class="keyword">AS</span> str</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUBSTRING</span>(<span class="string">&#x27;hello&#x27;</span>,<span class="number">2</span>) <span class="keyword">AS</span> str</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUBSTRING</span>(<span class="string">&#x27;hello&#x27;</span>,<span class="number">2</span>,<span class="number">2</span>) <span class="keyword">AS</span> str</span><br><span class="line">#案例</span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@STR</span><span class="operator">=</span><span class="string">&#x27;ABCDEFG&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LEFT</span>(<span class="variable">@STR</span>,<span class="number">2</span>),<span class="keyword">RIGHT</span>(<span class="variable">@STR</span>,<span class="number">3</span>),<span class="built_in">SUBSTRING</span>(<span class="variable">@STR</span>,<span class="number">2</span>,<span class="number">4</span>);</span><br><span class="line">#字符串格式化</span><br><span class="line"><span class="keyword">SELECT</span> FORMAT(RAND()<span class="operator">*</span><span class="number">100</span>,<span class="number">2</span>) <span class="keyword">AS</span> num</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2-3-日期函数"><a href="#2-3-日期函数" class="headerlink" title="2-3 日期函数"></a>2-3 日期函数</h2><p>SQL代码</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#日期函数</span><br><span class="line">#当前时间</span><br><span class="line"><span class="keyword">SELECT</span> NOW() <span class="keyword">AS</span> str </span><br><span class="line"></span><br><span class="line">#获取当前天数，小时等</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DAY</span>(NOW()),DAYOFMONTH(NOW()),<span class="keyword">HOUR</span>(NOW())</span><br><span class="line"></span><br><span class="line">#时间相加</span><br><span class="line"><span class="keyword">SELECT</span> ADDTIME(NOW(),<span class="string">&#x27;2:00:00&#x27;</span>) <span class="keyword">AS</span> str </span><br></pre></td></tr></table></figure><h1 id="3-存储过程"><a href="#3-存储过程" class="headerlink" title="3 存储过程"></a>3 存储过程</h1><h2 id="3-1-简单存储过程"><a href="#3-1-简单存储过程" class="headerlink" title="3-1 简单存储过程"></a>3-1 简单存储过程</h2><p>创建存储过程</p><p>SQL代码</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#编写一个存储过程，实现的功能是删除一个指定用户姓名的用户信息。</span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span>  sp_del_member(<span class="keyword">IN</span> xm  <span class="type">CHAR</span>(<span class="number">10</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">   <span class="keyword">DELETE</span> <span class="keyword">FROM</span> Members <span class="keyword">WHERE</span> 姓名<span class="operator">=</span>xm;</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line">$$</span><br><span class="line">DELIMITER ;  </span><br></pre></td></tr></table></figure><p>关于结束符</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span>  sp_del_member(<span class="keyword">IN</span> xm  <span class="type">CHAR</span>(<span class="number">10</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">   <span class="keyword">DELETE</span> <span class="keyword">FROM</span> Members <span class="keyword">WHERE</span> 姓名<span class="operator">=</span>xm;</span><br><span class="line"><span class="keyword">END</span> </span><br><span class="line"><span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER ;  </span><br></pre></td></tr></table></figure><p>查看存储过程</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#查看所有的存储过程状态</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">PROCEDURE</span> STATUS</span><br><span class="line">#查看某个存储过程的详细信息</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> sp_del_member</span><br></pre></td></tr></table></figure><p>调用存储过程</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#调用sp_del_member存储过程，删除“李强”的用户信息。</span><br><span class="line"><span class="keyword">CALL</span> sp_del_member(<span class="string">&#x27;李强&#x27;</span>);</span><br></pre></td></tr></table></figure><p>删除存储过程</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#删除存储过程sp_del_member</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> sp_del_member;</span><br></pre></td></tr></table></figure><h2 id="3-2-复杂存储过程"><a href="#3-2-复杂存储过程" class="headerlink" title="3-2 复杂存储过程"></a>3-2 复杂存储过程</h2><h3 id="3-2-1-局部变量"><a href="#3-2-1-局部变量" class="headerlink" title="3-2-1 局部变量"></a>3-2-1 局部变量</h3><p>SQL代码</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#声明一个整型变量和两个字符变量。</span><br><span class="line">#局部变量只能在<span class="keyword">BEGIN</span>…<span class="keyword">END</span>语句块中声明</span><br><span class="line"><span class="keyword">DECLARE</span> num <span class="type">INT</span>(<span class="number">4</span>);</span><br><span class="line"><span class="keyword">DECLARE</span> str1, str2 <span class="type">VARCHAR</span>(<span class="number">6</span>);</span><br><span class="line">#局部变量赋值</span><br><span class="line"><span class="keyword">SET</span> num<span class="operator">=</span><span class="number">1</span>, str1<span class="operator">=</span> <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>案例</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#在存储过程体中将Book表中的书名为“计算机应用基础”的作者姓名和出版社的值</span><br><span class="line">#分别赋给变量name和publish,并输出出版社变量值</span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> sp_vtest (<span class="keyword">OUT</span> p <span class="type">VARCHAR</span>(<span class="number">20</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> v_name,v_publish <span class="type">VARCHAR</span>(<span class="number">20</span>);</span><br><span class="line">    <span class="keyword">SELECT</span> author,publisher <span class="keyword">INTO</span> v_name, v_publish <span class="keyword">FROM</span> Book  <span class="keyword">WHERE</span> bookname<span class="operator">=</span> <span class="string">&#x27;计算机应用基础&#x27;</span>;    </span><br><span class="line">    <span class="keyword">SET</span> p <span class="operator">=</span> v_publish;</span><br><span class="line"><span class="keyword">END</span> </span><br><span class="line">$$</span><br><span class="line">DELIMITER ; </span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> sp_vtest(<span class="variable">@p</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@p</span>;</span><br></pre></td></tr></table></figure><h3 id="3-2-2-语句结构"><a href="#3-2-2-语句结构" class="headerlink" title="3-2-2 语句结构"></a>3-2-2 语句结构</h3><h4 id="3-2-2-1-判断结构赏析"><a href="#3-2-2-1-判断结构赏析" class="headerlink" title="3-2-2-1 判断结构赏析"></a>3-2-2-1 判断结构赏析</h4><p>案例1-两数相比</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> sp_compare</span><br><span class="line">(<span class="keyword">IN</span> K1 <span class="type">INTEGER</span>, <span class="keyword">IN</span> K2 <span class="type">INTEGER</span>, <span class="keyword">OUT</span> K3 <span class="type">CHAR</span>(<span class="number">6</span>) )</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">IF K1<span class="operator">&gt;</span>K2 <span class="keyword">THEN</span></span><br><span class="line"><span class="keyword">SET</span> K3<span class="operator">=</span> <span class="string">&#x27;大于&#x27;</span>;</span><br><span class="line">ELSEIF K1<span class="operator">=</span>K2 <span class="keyword">THEN</span></span><br><span class="line"><span class="keyword">SET</span> K3<span class="operator">=</span> <span class="string">&#x27;等于&#x27;</span>;</span><br><span class="line"><span class="keyword">ELSE</span> </span><br><span class="line"><span class="keyword">SET</span> K3<span class="operator">=</span> <span class="string">&#x27;小于&#x27;</span>;</span><br><span class="line"><span class="keyword">END</span> IF;</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line">$$</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> sp_compare(<span class="number">3</span>, <span class="number">6</span>, <span class="variable">@K</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@K</span>;</span><br></pre></td></tr></table></figure><p>案例2-</p><p>形态1</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> sp_updown1(<span class="keyword">IN</span> str <span class="type">VARCHAR</span>(<span class="number">1</span>), <span class="keyword">OUT</span> direct <span class="type">VARCHAR</span>(<span class="number">4</span>) )</span><br><span class="line">   <span class="keyword">BEGIN</span></span><br><span class="line">     <span class="keyword">CASE</span> str</span><br><span class="line"> <span class="keyword">WHEN</span> <span class="string">&#x27;U&#x27;</span> <span class="keyword">THEN</span> <span class="keyword">SET</span> direct <span class="operator">=</span><span class="string">&#x27;上升&#x27;</span>;</span><br><span class="line"> <span class="keyword">WHEN</span> <span class="string">&#x27;D&#x27;</span> <span class="keyword">THEN</span> <span class="keyword">SET</span> direct <span class="operator">=</span><span class="string">&#x27;下降&#x27;</span>;</span><br><span class="line"> <span class="keyword">ELSE</span>  <span class="keyword">SET</span> direct <span class="operator">=</span><span class="string">&#x27;不变&#x27;</span>;</span><br><span class="line">     <span class="keyword">END</span> <span class="keyword">CASE</span>;</span><br><span class="line">   <span class="keyword">END</span></span><br><span class="line">$$</span><br><span class="line">DELIMITER; </span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> sp_updown1(<span class="string">&#x27;s&#x27;</span>,<span class="variable">@d</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@d</span>;</span><br></pre></td></tr></table></figure><p>形态2</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> sp_updown2(<span class="keyword">IN</span> str <span class="type">VARCHAR</span>(<span class="number">1</span>), <span class="keyword">OUT</span> direct <span class="type">VARCHAR</span>(<span class="number">4</span>) )</span><br><span class="line">   <span class="keyword">BEGIN</span></span><br><span class="line">     <span class="keyword">CASE</span> </span><br><span class="line"> <span class="keyword">WHEN</span> str <span class="operator">=</span> <span class="string">&#x27;U&#x27;</span> <span class="keyword">THEN</span> <span class="keyword">SET</span> direct <span class="operator">=</span><span class="string">&#x27;上升&#x27;</span>;</span><br><span class="line"> <span class="keyword">WHEN</span> str <span class="operator">=</span> <span class="string">&#x27;D&#x27;</span> <span class="keyword">THEN</span> <span class="keyword">SET</span> direct <span class="operator">=</span><span class="string">&#x27;下降&#x27;</span>;</span><br><span class="line"> <span class="keyword">ELSE</span>  <span class="keyword">SET</span> direct <span class="operator">=</span><span class="string">&#x27;不变&#x27;</span>;</span><br><span class="line">     <span class="keyword">END</span> <span class="keyword">CASE</span>;</span><br><span class="line">   <span class="keyword">END</span></span><br><span class="line">$$</span><br><span class="line">DELIMITER; </span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> sp_updown2(<span class="string">&#x27;s&#x27;</span>,<span class="variable">@d</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@d</span>;</span><br></pre></td></tr></table></figure><h4 id="3-2-2-2-循环结构"><a href="#3-2-2-2-循环结构" class="headerlink" title="3-2-2-2 循环结构"></a>3-2-2-2 循环结构</h4><p>案例1-  WHILE …DO</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#WHILE ...DO循环结构</span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> sp_while()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">   <span class="keyword">DECLARE</span> v1 <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">5</span>;</span><br><span class="line">   WHILE  v1 <span class="operator">&gt;</span> <span class="number">0</span>  DO</span><br><span class="line">         <span class="keyword">SET</span> v1 <span class="operator">=</span> v1<span class="number">-1</span>;</span><br><span class="line">         <span class="keyword">SELECT</span> v1;</span><br><span class="line">   <span class="keyword">END</span> WHILE;</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line">$$</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> sp_while()</span><br></pre></td></tr></table></figure><p>案例2-REPEAT…UNTIL - 类似do…while结构</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#REPEAT...UNTIL <span class="operator">-</span> 类似do...while结构</span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> sp_repeat()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">   <span class="keyword">DECLARE</span> v1 <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">5</span>;</span><br><span class="line">   REPEAT</span><br><span class="line">      <span class="keyword">SET</span> v1<span class="operator">=</span>v1<span class="number">-1</span>;</span><br><span class="line">      <span class="keyword">SELECT</span> v1;      </span><br><span class="line">   UNTIL v1<span class="operator">&lt;</span><span class="number">1</span></span><br><span class="line">   <span class="keyword">END</span> REPEAT;</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line">$$</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> sp_repeat();</span><br></pre></td></tr></table></figure><p>案例3 数据库存储结构独特结构：LOOP…LEAVE 类似 for…break…continue</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#数据库存储结构独特结构：LOOP...LEAVE 类似 for...break...continue</span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> sp_sum(<span class="keyword">IN</span> n <span class="type">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">DECLARE</span> v_sum <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">  #label是做一个标识，写法是必须在后面带冒号“label:”方便后面写leave，iterate;</span><br><span class="line">  label:LOOP</span><br><span class="line">    IF n <span class="operator">&lt;=</span> <span class="number">0</span> <span class="keyword">THEN</span></span><br><span class="line">      LEAVE label;</span><br><span class="line">    <span class="keyword">END</span> IF;    </span><br><span class="line">    <span class="keyword">SET</span> v_sum <span class="operator">=</span> v_sum <span class="operator">+</span> n;</span><br><span class="line">    <span class="keyword">SET</span> n <span class="operator">=</span> n <span class="operator">-</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">END</span> LOOP label;</span><br><span class="line">  <span class="keyword">SELECT</span> v_sum;</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line">$$</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> sp_sum(<span class="number">100</span>)</span><br></pre></td></tr></table></figure><p>iterate 可以当做continue来使用</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#数据库存储结构独特结构：LOOP...LEAVE 类似 for...break...continue</span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> sp_sum(<span class="keyword">IN</span> n <span class="type">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">DECLARE</span> v_sum <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">  #label是做一个标识，写法是必须在后面带冒号“label:”方便后面写leave，iterate;</span><br><span class="line">  label:LOOP</span><br><span class="line">    IF n <span class="operator">&lt;=</span> <span class="number">0</span> <span class="keyword">THEN</span></span><br><span class="line">       LEAVE label;</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line">    IF n<span class="operator">%</span><span class="number">2</span><span class="operator">=</span><span class="number">1</span> <span class="keyword">THEN</span></span><br><span class="line">  <span class="keyword">SET</span> n <span class="operator">=</span> n<span class="number">-1</span>;</span><br><span class="line">  ITERATE label;</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line">    <span class="keyword">SET</span> v_sum <span class="operator">=</span> v_sum <span class="operator">+</span> n;</span><br><span class="line">    <span class="keyword">SET</span> n <span class="operator">=</span> n <span class="operator">-</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">END</span> LOOP label;</span><br><span class="line">  <span class="keyword">SELECT</span> v_sum;</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line">$$</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure><h3 id="3-2-3-业务案例赏析"><a href="#3-2-3-业务案例赏析" class="headerlink" title="3-2-3 业务案例赏析"></a>3-2-3 业务案例赏析</h3><p>案例1-修改销售价格</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#根据用户姓名和书名查询订单，如果订购册数小于<span class="number">5</span>本不打折，</span><br><span class="line">#订购册数在<span class="number">5</span><span class="number">-10</span>本之间，订购单价打九折，订购册数大于<span class="number">10</span>本，订购单价打八折。</span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> </span><br><span class="line">sp_updateSellPrice(<span class="keyword">IN</span> m_name  <span class="type">CHAR</span>(<span class="number">10</span>), <span class="keyword">IN</span> b_name <span class="type">VARCHAR</span>(<span class="number">40</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span>  v_bookcode <span class="type">CHAR</span>(<span class="number">20</span>);</span><br><span class="line"><span class="keyword">DECLARE</span>  v_mcode <span class="type">CHAR</span>(<span class="number">10</span>);</span><br><span class="line"><span class="keyword">DECLARE</span>  v_amount TINYINT;</span><br><span class="line"><span class="keyword">SELECT</span> mcode <span class="keyword">INTO</span> v_mcode  <span class="keyword">FROM</span> <span class="keyword">member</span></span><br><span class="line"><span class="keyword">WHERE</span>  NAME<span class="operator">=</span>m_name;</span><br><span class="line"><span class="keyword">SELECT</span> bookcode <span class="keyword">INTO</span> v_bookcode  <span class="keyword">FROM</span> Book <span class="keyword">WHERE</span>  bookname<span class="operator">=</span>b_name;</span><br><span class="line"><span class="keyword">SELECT</span> amount <span class="keyword">INTO</span> v_amount <span class="keyword">FROM</span> sell </span><br><span class="line"><span class="keyword">WHERE</span> mcode<span class="operator">=</span>v_mcode <span class="keyword">AND</span> bookcode<span class="operator">=</span>v_bookcode;</span><br><span class="line"><span class="keyword">SELECT</span> v_bookcode,v_mcode,v_amount;</span><br><span class="line"></span><br><span class="line">IF v_amount<span class="operator">&gt;=</span><span class="number">5</span> <span class="keyword">AND</span> v_amount<span class="operator">&lt;=</span><span class="number">10</span> <span class="keyword">THEN</span></span><br><span class="line"><span class="keyword">UPDATE</span> sell <span class="keyword">SET</span> price<span class="operator">=</span>price<span class="operator">*</span><span class="number">0.9</span> </span><br><span class="line"><span class="keyword">WHERE</span> mcode<span class="operator">=</span>v_mcode <span class="keyword">AND</span> bookcode<span class="operator">=</span>v_bookcode;</span><br><span class="line">ELSEIF v_amount<span class="operator">&gt;</span><span class="number">10</span> <span class="keyword">THEN</span></span><br><span class="line"><span class="keyword">UPDATE</span> sell <span class="keyword">SET</span> price<span class="operator">=</span>price<span class="operator">*</span><span class="number">0.8</span>    </span><br><span class="line"><span class="keyword">WHERE</span> mcode<span class="operator">=</span>v_mcode <span class="keyword">AND</span> bookcode<span class="operator">=</span>v_bookcode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span> IF;</span><br><span class="line"><span class="keyword">END</span>$$</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-2-4-中级考试案例"><a href="#3-2-4-中级考试案例" class="headerlink" title="3-2-4 中级考试案例"></a>3-2-4 中级考试案例</h3><p>案例1：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> insertProc(<span class="keyword">IN</span> p <span class="type">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span> </span><br><span class="line"><span class="keyword">DECLARE</span> var <span class="type">INT</span>;</span><br><span class="line"><span class="keyword">SET</span> var <span class="operator">=</span> p<span class="operator">+</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">CASE</span> var</span><br><span class="line"><span class="keyword">WHEN</span> <span class="number">0</span> <span class="keyword">THEN</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> B <span class="keyword">VALUES</span>(<span class="number">20</span>);</span><br><span class="line"><span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span> </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> B <span class="keyword">VALUES</span>(<span class="number">21</span>);</span><br><span class="line"><span class="keyword">ELSE</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> B <span class="keyword">VALUES</span>(<span class="number">22</span>);</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">CASE</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER;</span><br><span class="line"></span><br><span class="line">#有存储过程创建如上，语句<span class="keyword">CALL</span> insertProc(<span class="number">0</span>)插入B表中的值是？</span><br><span class="line"><span class="keyword">CALL</span> insertProc(<span class="number">0</span>); </span><br></pre></td></tr></table></figure><p>案例2：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> proc()</span><br><span class="line"><span class="keyword">BEGIN</span> </span><br><span class="line"><span class="keyword">DECLARE</span> var <span class="type">INT</span>;</span><br><span class="line"><span class="keyword">SET</span> var <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">WHILE var <span class="operator">&lt;</span> <span class="number">4</span> DO</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> B <span class="keyword">VALUES</span>(var);</span><br><span class="line"><span class="keyword">SET</span> var <span class="operator">=</span> var <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">END</span> WHILE;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span></span><br><span class="line">DELIMITER;</span><br><span class="line">#关于上述存储过程，执行<span class="keyword">insert</span>语句几次？</span><br></pre></td></tr></table></figure><h1 id="4-存储函数"><a href="#4-存储函数" class="headerlink" title="4 存储函数"></a>4 存储函数</h1><h2 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h2><p>参考代码1</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#创建一个存储函数，它返回Book表中图书数目作为结果。</span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> fun_bookCount()</span><br><span class="line"><span class="keyword">RETURNS</span> <span class="type">INTEGER</span></span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">     <span class="keyword">RETURN</span> (<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> Book);</span><br><span class="line">  <span class="keyword">END</span>$$</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure><p>参考代码2</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#创建一个存储函数，返回Book表中某本书的作者姓名。</span><br><span class="line">DELIMITER $$</span><br><span class="line">   <span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> fun_bookAuthor(b_name <span class="type">VARCHAR</span>(<span class="number">40</span>))</span><br><span class="line">   <span class="keyword">RETURNS</span> <span class="type">CHAR</span>(<span class="number">10</span>)</span><br><span class="line">     <span class="keyword">BEGIN</span></span><br><span class="line">        <span class="keyword">DECLARE</span> res_author <span class="type">CHAR</span>(<span class="number">10</span>);</span><br><span class="line">        <span class="keyword">SELECT</span> author <span class="keyword">INTO</span> res_author <span class="keyword">FROM</span> book <span class="keyword">WHERE</span> bookname<span class="operator">=</span> b_name;</span><br><span class="line"><span class="keyword">RETURN</span> res_author;</span><br><span class="line">     <span class="keyword">END</span>$$</span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="查看"><a href="#查看" class="headerlink" title="查看"></a>查看</h2><p>参考代码</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">FUNCTION</span> STATUS;</span><br></pre></td></tr></table></figure><h2 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h2><p>参考代码</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> fun_bookCount();</span><br><span class="line"><span class="keyword">SELECT</span> fun_bookAuthor(<span class="string">&#x27;网页设计&#x27;</span>);</span><br></pre></td></tr></table></figure><h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><p>参考代码</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">FUNCTION</span> fun_bookCount;</span><br></pre></td></tr></table></figure><h1 id="5-触发器"><a href="#5-触发器" class="headerlink" title="5 触发器"></a>5 触发器</h1><h2 id="创建-1"><a href="#创建-1" class="headerlink" title="创建"></a>创建</h2><p>参考代码</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#当删除表book表中某图书的信息时，同时将sell表中与该图书有关的数据全部删除</span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> t_book_del AFTER <span class="keyword">DELETE</span></span><br><span class="line"><span class="keyword">ON</span> Book <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DELETE</span> <span class="keyword">FROM</span> sell <span class="keyword">WHERE</span> bookcode<span class="operator">=</span>old.bookcode;</span><br><span class="line">  <span class="keyword">END</span>$$</span><br><span class="line">DELIMITER ; </span><br><span class="line"></span><br><span class="line">#现在验证一下触发器的功能：</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> book <span class="keyword">WHERE</span> bookcode <span class="operator">=</span> <span class="string">&#x27;TP23/6625&#x27;</span>;</span><br><span class="line"></span><br><span class="line">#使用<span class="keyword">SELECT</span>语句查看Sell表中的情况：</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> sell <span class="keyword">WHERE</span> bookcode <span class="operator">=</span> <span class="string">&#x27;TP23/6625&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="触发"><a href="#触发" class="headerlink" title="触发"></a>触发</h2><ul><li>触发时间:    AFTER BEFORE</li><li>触发事件:    insert update delete</li></ul><h2 id="查看-1"><a href="#查看-1" class="headerlink" title="查看"></a>查看</h2><p>参考代码</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> TRIGGERS</span><br></pre></td></tr></table></figure><h2 id="删除-1"><a href="#删除-1" class="headerlink" title="删除"></a>删除</h2><p>参考代码</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> trigger_name</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Python爬虫</title>
      <link href="/2023/05/16/Python%E7%88%AC%E8%99%AB/"/>
      <url>/2023/05/16/Python%E7%88%AC%E8%99%AB/</url>
      
        <content type="html"><![CDATA[<h1 id="Scrapy爬虫框架"><a href="#Scrapy爬虫框架" class="headerlink" title="Scrapy爬虫框架"></a>Scrapy爬虫框架</h1><h2 id="1-基础"><a href="#1-基础" class="headerlink" title="1. 基础"></a>1. 基础</h2><h3 id="1-1-命令"><a href="#1-1-命令" class="headerlink" title="1.1 命令"></a>1.1 命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">安装：</span><br><span class="line">pip install scrapy</span><br><span class="line"></span><br><span class="line">查看所装依赖清单:</span><br><span class="line">pip list</span><br><span class="line">pip freeze</span><br><span class="line"></span><br><span class="line">输出清单:</span><br><span class="line">pip freeze &gt; requirements.txt</span><br><span class="line"></span><br><span class="line">读取清单下载:</span><br><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure><h4 id="1-1-1-创建Scrapy项目"><a href="#1-1-1-创建Scrapy项目" class="headerlink" title="1.1.1 创建Scrapy项目"></a>1.1.1 创建Scrapy项目</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrapy startproject Spider01</span><br></pre></td></tr></table></figure><h4 id="1-1-2-新建Spider脚本"><a href="#1-1-2-新建Spider脚本" class="headerlink" title="1.1.2 新建Spider脚本"></a>1.1.2 新建Spider脚本</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrapy genspider douban movie.douban.com</span><br></pre></td></tr></table></figure><h4 id="1-1-3-运行"><a href="#1-1-3-运行" class="headerlink" title="1.1.3 运行"></a>1.1.3 运行</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrapy crawl douban -o douban.csv</span><br></pre></td></tr></table></figure><h3 id="1-2-项目结构"><a href="#1-2-项目结构" class="headerlink" title="1.2. 项目结构"></a>1.2. 项目结构</h3><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230527113932509.png" alt="image-20230527113932509"></p><ul><li><p>spiders:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#自定义脚本</span></span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">from</span> scrapy <span class="keyword">import</span> Selector</span><br><span class="line"><span class="keyword">from</span> Spider02.items <span class="keyword">import</span> MovieItem</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DoubanSpider</span>(scrapy.Spider):</span><br><span class="line">    name = <span class="string">&quot;douban&quot;</span></span><br><span class="line">    allowed_domains = [<span class="string">&quot;movie.douban.com&quot;</span>]</span><br><span class="line">    start_urls = [<span class="string">&quot;https://movie.douban.com/top250&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        sel = Selector(response)</span><br><span class="line">        list_items = sel.css(<span class="string">&#x27;#content &gt; div &gt; div.article &gt; ol &gt; li&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> list_item <span class="keyword">in</span> list_items:</span><br><span class="line">            movie_item = MovieItem()</span><br><span class="line">            <span class="comment"># 抽取css选择器之后的第一条数据</span></span><br><span class="line">            movie_item[<span class="string">&#x27;title&#x27;</span>] = list_item.css(<span class="string">&#x27;span.title::text&#x27;</span>).extract_first()</span><br><span class="line">            movie_item[<span class="string">&#x27;rank&#x27;</span>] = list_item.css(<span class="string">&#x27;span.rating_num::text&#x27;</span>).extract_first()</span><br><span class="line">            movie_item[<span class="string">&#x27;subject&#x27;</span>] = list_item.css(<span class="string">&#x27;span.inq::text&#x27;</span>).extract_first()</span><br><span class="line">            <span class="comment"># 生成器---&gt;返回对象</span></span><br><span class="line">            <span class="keyword">yield</span> movie_item</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>items</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#下载器</span></span><br><span class="line"><span class="comment"># Define here the models for your scraped items</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># See documentation in:</span></span><br><span class="line"><span class="comment"># https://docs.scrapy.org/en/latest/topics/items.html</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Spider02Item</span>(scrapy.Item):</span><br><span class="line">    <span class="comment"># define the fields for your item here like:</span></span><br><span class="line">    <span class="comment"># name = scrapy.Field()</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 爬虫获取到的数据组装成Item对象</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MovieItem</span>(scrapy.Item):</span><br><span class="line">    title = scrapy.Field()</span><br><span class="line">    rank = scrapy.Field()</span><br><span class="line">    subject = scrapy.Field()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>settings</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">配置页面</span><br><span class="line">Cookies。。。。</span><br></pre></td></tr></table></figure></li><li><p>pipelines</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">数据管道</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>IDEA常见问题</title>
      <link href="/2023/05/15/IDEA%E5%B0%8F%E6%8A%80%E5%B7%A7/"/>
      <url>/2023/05/15/IDEA%E5%B0%8F%E6%8A%80%E5%B7%A7/</url>
      
        <content type="html"><![CDATA[<h2 id="IDEA常见问题"><a href="#IDEA常见问题" class="headerlink" title="IDEA常见问题"></a>IDEA常见问题</h2><h3 id="1-Loge日志"><a href="#1-Loge日志" class="headerlink" title="1. Loge日志"></a>1. Loge日志</h3><ul><li>当在本地运行 spark任务时，控制台会出现很多红色的INFO信息，严重干扰视觉，如下所示：</li></ul><ul><li>解决办法，点击下载<a href="https://spark.apache.org/downloads.html">https://spark.apache.org/downloads.html</a> spark 或者 <a href="https://archive.apache.org/dist/spark/，选择自己maven中引入的spark版本，Hadoop版本应该可以随便选择（我是本地安装了Hadoop，所以选择了安装的Hadoop版本）">https://archive.apache.org/dist/spark/，选择自己maven中引入的spark版本，Hadoop版本应该可以随便选择（我是本地安装了Hadoop，所以选择了安装的Hadoop版本）</a></li></ul><ul><li>点击进入下载页面，选择HTTP下载安装包：</li></ul><ul><li>解压后，选择 conf 文件夹下的 log4j.properties.template ，将其复制到IDEA项目 resources 目录中，改名为 log4j.properties：</li></ul><ul><li><p>对 log4j.properties 做修改如下（INFO -&gt; ERROR）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log4j.rootCategory=ERROR, console</span><br></pre></td></tr></table></figure></li></ul><h3 id="2-快捷键"><a href="#2-快捷键" class="headerlink" title="2.快捷键"></a>2.快捷键</h3><div class="table-container"><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>ctrl + alt + t</td><td>try catch等一系列</td></tr><tr><td>alt + t</td><td>补全、解决问题</td></tr><tr><td>alt + insert</td><td>快速生成get set方法</td></tr><tr><td>ctrl + p</td><td>提示</td></tr><tr><td></td></tr></tbody></table></div><h3 id="3-运行"><a href="#3-运行" class="headerlink" title="3.运行"></a>3.运行</h3><ul><li><p>Command line is too long. Shorten command line for xxx or also for Application default configurat</p><ul><li><pre><code>1. Run 下的Edit Configur...2. 选择 Modify Options3. 添加Show code over...4. 选择Java 的 JAR</code></pre></li></ul></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>英语修仙之路</title>
      <link href="/2023/05/13/%E8%8B%B1%E8%AF%AD%E4%BF%AE%E4%BB%99%E4%B9%8B%E8%B7%AF/"/>
      <url>/2023/05/13/%E8%8B%B1%E8%AF%AD%E4%BF%AE%E4%BB%99%E4%B9%8B%E8%B7%AF/</url>
      
        <content type="html"><![CDATA[<p>开始:<a href="https://www.bilibili.com/video/BV1XY411J7aG/?p=2&amp;vd_source=bed2588951fb9fd0821dd2ef0191e48b">https://www.bilibili.com/video/BV1XY411J7aG/?p=2&amp;vd_source=bed2588951fb9fd0821dd2ef0191e48b</a></p><h1 id="英语语法综述"><a href="#英语语法综述" class="headerlink" title="英语语法综述"></a>英语语法综述</h1><p>学习语法就是为了———&gt; 造句</p><h1 id="简单句"><a href="#简单句" class="headerlink" title="简单句"></a>简单句</h1><ul><li>将长句子拆成不能再拆的句子，就称为简单句</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">什么 + 怎么样</span><br><span class="line">(主语subject)(谓语predicate)</span><br><span class="line">什么，怎么样对应了两个基本的句子成分</span><br><span class="line"></span><br><span class="line">而这里的谓语包括了： 动作/发生了什么事</span><br></pre></td></tr></table></figure><ul><li><p>动作(动词)</p><ol><li><p>可以独立完成的动作</p><p>主语 + <em>不及物动词</em>     (Papa Rabbit sleeps 兔老爹睡觉)    这里sleep就是不及物动词</p></li><li><p>有1个动作的承受者</p><p>主语 + 单及物动词 + 宾语    (Papa Rabbit likes you 兔老爹喜欢你)</p></li><li><p>有2个动作承受者</p><p>主语 + 双及物动词 + 间接宾语 + 直接宾语    (Papa Rabbit teacher your English)</p></li><li><p>只有1个动作承受者(但需补充)</p><p>主语 + 复杂及物动词 + 宾语 + (宾语)补语    (Papa Rabbit considers you smart)</p></li><li><p>非”动作”</p><p>主语 + 系动词 + (主语)补语/表语</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">比如：</span><br><span class="line">Beihai looks tall</span><br><span class="line">beihai in the room</span><br><span class="line">Papa Rabbit smells nice</span><br><span class="line"></span><br><span class="line">这里我们称之为： 连系动词   ---- &gt; 系动词</span><br></pre></td></tr></table></figure></li></ol></li><li><p>句子成分</p><ol><li>主语</li><li>谓语动词</li><li>宾语</li><li>宾语补语</li><li>主语补语</li><li>定语</li><li>状语</li><li>同位语</li></ol></li><li><p>简单句的转换</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">名词性从句：</span><br><span class="line">简单句作主语-----&gt; 主语从句</span><br><span class="line">简单句作宾语-----&gt; 宾语从句</span><br><span class="line">简单句作表语-----&gt; 表语从句</span><br><span class="line">简单句作同位语-----&gt; 同位语从句</span><br><span class="line"></span><br><span class="line">非名词性从句：</span><br><span class="line">简单句作定语-----&gt; 定语从句</span><br><span class="line">简单句作状语-----&gt; 状语从句</span><br></pre></td></tr></table></figure></li><li><p>词性</p><ol><li>名词</li><li>冠词</li><li>代词</li><li>形容词</li><li>数词</li><li>副词</li><li>介词</li><li>叹词</li><li>连词</li></ol></li><li><p>谓语动词的“三大本领”</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">时体气</span><br><span class="line">1.动作时间</span><br><span class="line">现在过去将来过去将来</span><br><span class="line">2.动作状态</span><br><span class="line">一般完成进行完成进行</span><br><span class="line">3.动作假设，情感</span><br></pre></td></tr></table></figure></li><li><p>助动词</p><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230513160908907.png" alt="image-20230513160908907" style="zoom:50%;" /></p></li><li><p>非谓语动词</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">不充当谓语的动词：</span><br><span class="line">动词不定式</span><br><span class="line">现在分词</span><br><span class="line">动名词</span><br><span class="line">过去分词</span><br></pre></td></tr></table></figure></li></ul><h1 id="动词"><a href="#动词" class="headerlink" title="动词"></a>动词</h1><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230513161552398.png" alt="image-20230513161552398" style="zoom:50%;" /></p><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230513161623757.png" alt="image-20230513161623757"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">实义动词： 不及物动词 + 及物动词</span><br></pre></td></tr></table></figure><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230513162014026.png" alt="image-20230513162014026"></p><h2 id="动词时间"><a href="#动词时间" class="headerlink" title="动词时间"></a>动词时间</h2><p>过去    现在    将来</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>git连接github</title>
      <link href="/2023/05/13/git%E8%BF%9E%E6%8E%A5github/"/>
      <url>/2023/05/13/git%E8%BF%9E%E6%8E%A5github/</url>
      
        <content type="html"><![CDATA[<p>最近hexo三连和git push都不能用了，搞了好长时间发现下面几个问题</p><ul><li><p>现在GitHub有些不支持rsa加密，可以使用ed25519</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t 加密类型 -C &quot;你的邮箱&quot;</span><br><span class="line"></span><br><span class="line">ex:</span><br><span class="line">ssh-keygen -t ed25519 -C &quot;1604252677&quot;</span><br></pre></td></tr></table></figure><p>更改完之后我发现如果你来回更换这个加密类型会导致默认的端口22不能用了</p><p><img src="E:\Hexo-Blog\piccode\PicCode\img\git_1.png" alt="image-20230513100301324"></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 实用小技巧 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>免费图床综合教程</title>
      <link href="/2023/05/11/%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%BB%BC%E5%90%88%E6%95%99%E7%A8%8B/"/>
      <url>/2023/05/11/%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E7%BB%BC%E5%90%88%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h2 id="1-基于Github仓库的图床"><a href="#1-基于Github仓库的图床" class="headerlink" title="1.基于Github仓库的图床"></a>1.基于Github仓库的图床</h2><p><strong>优点：</strong></p><ol><li>很稳定不会跑路，用的是自己的仓库和公共托管平台</li><li>图片可以增量快速更新和跨设备管理</li><li>可以进行版本管理和查看之前的版本</li><li>有公共CDN，速度还是不错的</li><li>资源格式可以任意都行，包括<code>css</code>、<code>js</code>等</li></ol><p><strong>缺点：</strong></p><ol><li>每个仓库限制1G，超过要新建另一个仓库</li><li>git管理可能偶尔会遇到网络和公钥失效问题</li></ol><h3 id="1-1-建立Github仓库"><a href="#1-1-建立Github仓库" class="headerlink" title="1.1 建立Github仓库"></a>1.1 建立Github仓库</h3><ol><li><p>进入<a href="https://github.com/">Github官网</a>注册并登录自己的账号，到自己的个人主页，点击右上角的<code>+</code>，并选择<code>New Repository</code>创建自己的仓库。</p></li><li><p>仓库名字随意，描述也可以自由发挥，可见性最好选<code>public</code>，<code>Readme</code>文件可以创建，然后点击<code>Create Repository</code>创建仓库。</p></li><li><p>让你的计算机与Github建立通信，主要是<code>创建公钥</code>、<code>上传公钥</code>、<code>检查通信</code>这几步，确保计算机有权限访问远程仓库，所述教程是用的<code>RSA公钥</code>，目前更推荐<code>ed25519公钥</code>，该数字签名算法的签名和验证的性能都极⾼，具体教程百度这里不再赘述。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t 加密算法 -C &quot;邮箱&quot;</span><br></pre></td></tr></table></figure><p><img src="https://pic.imgdb.cn/item/638b237216f2c2beb1ce8b7e.jpg" alt="img"></p></li><li><p>先在本地创建一个文件夹，文件夹位置和名字随意就可以，进入该文件夹后右键打开<code>Git Bash</code>，然后输入以下代码把之前创建的仓库拷贝下来，其中<code>git clone</code>后面的东西要替换成自己的仓库信息，可以通过自己仓库的ssh链接来获取。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BASH</span><br><span class="line">git clone git@github.com:Bei-Hai/pic_bed.git</span><br></pre></td></tr></table></figure><p><img src="https://pic.imgdb.cn/item/638b260716f2c2beb1d21741.jpg" alt="img"></p><p>看到上图的信息就代表成功把整个仓库拷贝到当前文件夹了，此时我们可以看见自己的文件夹多了个<code>.git</code>文件夹和<code>Readme.md</code>文件，这就代表成功了。</p><p><img src="https://pic.imgdb.cn/item/638b26f516f2c2beb1d324a9.jpg" alt="img"></p></li><li><p>此时我们最好在这个文件夹里面创建创建一个<code>img</code>文件夹专门存放图片，如果有存放其他类型资源的可以创建别的文件夹，比如现在想往仓库里加两张图，直接就把图片复制到<code>img</code>文件夹里面即可。</p><p><img src="https://pic.imgdb.cn/item/638b277216f2c2beb1d3ba52.jpg" alt="img"></p><p>然后在带有<code>Readme.md</code>文件的那个文件夹内，右键打开<code>Git Bash</code>（注意看清楚是什么文件夹），然后依次输入以下命令把更改推送到远程仓库，最后一步不成功可能要多试几次。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">BASH</span><br><span class="line"># 将更改提交</span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;更新图片&quot;</span><br><span class="line"># 推送至github仓库</span><br><span class="line">git push</span><br></pre></td></tr></table></figure><p>最后看见如下信息就代表推送成功了</p><p><a href="https://pic.imgdb.cn/item/638b28bf16f2c2beb1d5b49b.jpg"><img src="https://pic.imgdb.cn/item/638b28bf16f2c2beb1d5b49b.jpg" alt="img"></a>仓库此时应该也有了刚刚上传的资源了</p><p>下次增删图片或者其他东西，就这样照猫画虎就可以推上来更新仓库！</p></li></ol><h3 id="1-2-Staticaly-CDN加速"><a href="#1-2-Staticaly-CDN加速" class="headerlink" title="1.2 Staticaly CDN加速"></a>1.2 Staticaly CDN加速</h3><p>直接访问Github仓库的资源是非常慢的！因此我们要用一些免费的CDN进行加速，<code>Staticaly CDN</code>是目前免费CDN中比较好用的啦，他的应用规则如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PLAINTEXT</span><br><span class="line"># 格式 其中 user是用户名  repo是仓库名  version代表版本(tag或者分支 默认为main)  flie是文件路径 </span><br><span class="line">https://cdn.staticaly.com/gh/user/repo@version/file</span><br><span class="line"></span><br><span class="line"># 比如我的示例仓库就是加速地址就是这个大家可以参考参考</span><br><span class="line">https://cdn.staticaly.com/gh/BeiHai-Blog/PicCode@main/img/dm14.webp</span><br></pre></td></tr></table></figure><h3 id="1-3-Vercel-部署"><a href="#1-3-Vercel-部署" class="headerlink" title="1.3 Vercel 部署"></a>1.3 Vercel 部署</h3><p>此方法加载速度较快，但是需要域名自定义绑定，其优点也是可以绑定自定义域了，目前Vercel每个月限制流量100GB</p><ol><li><p>进入<a href="https://vercel.com/dashboard">Vercel控制面板</a>新建项目，并<code>通过Github继续</code>，选择导入刚刚创建的仓库，然后直接部署即可</p></li><li><p>进入该项目控制台后，选择右上角的<code>View Domains</code>添加新的域名，添加一个自己域名的二级域名，然后在你对应的域名解析控制台添加对应解析，等待生效。</p></li><li><p>通过<code>自定义域名+资源路径</code>即可访问到对应的资源，例如我这里为<code>https://beihaibei.eu.org/img/dm14.webp</code></p></li><li><p>要更新图片怎么办？只要将资源复制到对应的文件夹，然后再执行一次下面的命令即可：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">BASH</span><br><span class="line"># 将更改提交</span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;更新图片&quot;</span><br><span class="line"># 推送至github仓库</span><br><span class="line">git push</span><br></pre></td></tr></table></figure><p>这个命令默认是更新到仓库的<code>main</code>分支上，Vercel一旦检测到main分支发送变化就会触发新一轮部署，我们稍候片刻即可通过新的路径访问到新的资源。</p></li></ol><h2 id="2-免费图床推荐"><a href="#2-免费图床推荐" class="headerlink" title="2.免费图床推荐"></a>2.免费图床推荐</h2><ol><li>这部分免费图床就太多了，我会把我目前发现的可以免费白嫖一定额度的图床做一个总结列在下面</li><li>这部分图床的搭建门槛较低，所以速度和稳定性良莠不齐，大家自行选择使用哪个</li><li>我这里只给大家演示一种的使用方法，其他图床使用方法也类似</li><li>大家可以看看哪个比较好用的或者自己知道的好用的这里没有，可以留言我会进行补充</li></ol><div class="table-container"><table><thead><tr><th style="text-align:center">🍕</th><th style="text-align:center">🥗</th><th style="text-align:center">🍤</th></tr></thead><tbody><tr><td style="text-align:center"><a href="https://smms.app/">SMMS</a></td><td style="text-align:center"><a href="https://www.superbed.cn/">聚合图床</a></td><td style="text-align:center"><a href="https://www.hualigs.cn/">遇见图床</a></td></tr><tr><td style="text-align:center"><a href="https://postimages.org/">PostImage</a></td><td style="text-align:center"><a href="https://imgse.com/">路过图床</a></td><td style="text-align:center"><a href="https://www.imgurl.org/">imgURL</a></td></tr><tr><td style="text-align:center"><a href="https://imgbox.com/">imgbox</a></td><td style="text-align:center"><a href="https://pic.iqy.ink/upload">Lsky Pro</a></td><td style="text-align:center"><a href="https://upload.cc/">Upload.cc</a></td></tr><tr><td style="text-align:center"><a href="https://imagelol.com/">imagelol</a></td><td style="text-align:center"><a href="https://imgtp.com/">imgtp</a></td><td style="text-align:center"><a href="https://cloudimge.com/">云图床</a></td></tr><tr><td style="text-align:center"><a href="https://mcecy.com/">载涂图床</a></td><td style="text-align:center"><a href="https://tuchuang.voooe.cn/">Sky Chart Bed</a></td><td style="text-align:center"><a href="https://www.imgbed.link/">风筝图床</a></td></tr><tr><td style="text-align:center"><a href="https://pz.al/">喷子图床</a></td><td style="text-align:center"><a href="https://imgkb.com/">imgkb</a></td></tr></tbody></table></div><ul><li>使用方法：直接进入官网，上传图片然后粘贴地址即可，地址的样式有多样，自行选择。</li><li>选择要点：<ol><li>速度：大家可以到<a href="https://ping.cn/">Ping.cn</a>进行测试</li><li>稳定性与安全性：看看图床创建时间，网上评价等</li><li>可适用性：支持的格式越多肯定是越好的，有部分支持<code>webp</code>和其他格式的，可以当资源床</li></ol></li></ul><h2 id="3-PicGo结合Markdown实时上传图片"><a href="#3-PicGo结合Markdown实时上传图片" class="headerlink" title="3.PicGo结合Markdown实时上传图片"></a>3.PicGo结合Markdown实时上传图片</h2><ul><li><p>Picgo究竟是什么？这是一个开源软件，开源地址：<a href="https://github.com/Molunerfinn/PicGo">Molunerfinn/PicGo</a></p></li><li><p>引用项目的介绍：这是一个用于快速上传图片并获取图片 URL 链接的工具，关键是他可以与Typora配套一起使用，在粘贴图片的同时上传图片，十分方便！</p></li><li><p>最新版我这里实测没办法安装一些插件，因此推荐大家安装<a href="https://github.com/Molunerfinn/PicGo/releases/tag/v2.3.1-beta.5">v2.3.1-beta.5</a>这个版本</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="img"></p></li><li><p>下载软件后直接一路安装下去就行，建议装在非C盘的任意一个盘。</p></li></ul><h3 id="3-1-Github图床"><a href="#3-1-Github图床" class="headerlink" title="3.1 Github图床"></a>3.1 Github图床</h3><ol><li><p>进入软件之后，一路到设置里面取消勾选其他图床，只留下Github图床一项，因为我们的现在要弄Github图床。</p></li><li><p>然后到Github新建一个仓库，创建仓库的教程前面有讲，这里就不赘述了，<code>仓库名字</code>和<code>描述</code>随意，最重要的是权限一定要选<code>public</code>，这样你的图片才可以随时随地访问到。在图床设置的Github配置处，按照下图填入对应的信息：</p><p>自定义域名的格式为：<code>https://cdn.staticaly.com/gh/用户名/仓库名@main</code>，比如我的就是<code>https://cdn.staticaly.com/gh/BeiHai-Blog/markdown_pic@main</code>，对应的<code>用户名</code>和<code>仓库名</code>记住要换成自己名字，不能有空格！！！</p><p>Token的获取方式为：<code>右上角头像</code>-&gt;<code>Setting</code>-&gt;<code>左边栏Developer Settings</code>-&gt;<code>左栏Personal access tokens</code>-&gt;<code>左栏tokens(classic)</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="img"></p><p>创建Token时，<code>Note</code>随意；<code>Exporation</code>选<code>No expiration</code>，<code>Select scopes</code>必须把<code>repo</code>这一项勾上，然后点击生成就行</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="img"></p><p>这个时候必须马上复制出现的token，不然后面就看不到了，复制了填进去刚刚的Token选项，随后点击确定保存</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="img"></p></li><li><p>随便拖拽一张图片进来上传区域这里，应该就可以上传成功，随后把生成的链接复制就可以，此时打开仓库可以发现图片上传到了指定的文件夹。注意：每个仓库大小限制是1G！！！</p></li></ol><p><a href="https://tuchuang.voooe.cn/images/2022/12/30/image-6.webp"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="img"></a></p><h3 id="3-2-Vika图床"><a href="#3-2-Vika图床" class="headerlink" title="3.2 Vika图床"></a>3.2 Vika图床</h3><p>Vika图床的服务器在国内，速度是比较快的</p><ol><li><p>首先在Picgo里面安装Vikadata的插件</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="img"></p></li><li><p>我们要填的信息有下面这几项：</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="img"></p></li><li><p>进入<a href="https://vika.cn/">维格表官网</a>，注册自己的账号并登录，新建一个空白的维格表</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="img"></p></li><li><p>随后点击左下角头像的个人设置，绑定自己的邮箱后，获取<code>API Token</code></p><p><img src="https://tuchuang.voooe.cn/images/2022/12/30/1672392200842.webp" alt="img"></p></li><li><p>进入刚刚创建的表格后，点击上边的<code>API</code>，进入API界面后，依次点击<code>显示API Token</code>-&gt;<code>Get 获取</code>，然后图中框起来的就是我们需要的<code>维格表ID</code>和<code>API Token</code></p><p><img src="https://tuchuang.voooe.cn/images/2022/12/30/1672392201560.webp" alt="img"></p><p><img src="https://tuchuang.voooe.cn/images/2022/12/30/1672392249317.webp" alt="img"></p></li><li><p>填进去对应位置后，到上传区域，把图床换成维格表，试试拖拽图片能不能上传！</p></li></ol><h3 id="3-3-Bilibili图床"><a href="#3-3-Bilibili图床" class="headerlink" title="3.3 Bilibili图床"></a>3.3 Bilibili图床</h3><ul><li>由于这个图床用在博客里存在跨域问题，因此不再推荐使用了，开源地址：<a href="https://github.com/xlzy520/typora-plugin-bilibili">typora-plugin-bilibili</a></li></ul><h3 id="3-4-imgtp图床"><a href="#3-4-imgtp图床" class="headerlink" title="3.4 imgtp图床"></a>3.4 imgtp图床</h3><ul><li>开源地址：<a href="https://github.com/Redns/picgo-plugin-imgtp">picgo-plugin-imgtp</a></li></ul><ol><li><p>在Picg插件商店搜索并安装该插件</p><p><img src="https://tuchuang.voooe.cn/images/2022/12/30/image-8.webp" alt="img"></p></li><li><p>进入<a href="https://imgtp.com/">imgtp</a>注册并登录自己的账号，记住账号密码，待会儿要用到</p></li><li><p>进入控制台，然后进入<code>设置</code>，就可以看到右边有<code>Token</code>这一项，这些就是我们要的全部信息</p><p><img src="https://tuchuang.voooe.cn/images/2022/12/30/image-9.webp" alt="img"></p></li><li><p>随后在imgtp的配置信息里面填上<code>账号</code>、<code>密码</code>、<code>Token</code>这几项即可</p></li><li><p>填进去对应位置后，到上传区域，把图床换成维格表，试试拖拽图片能不能上传！</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 博客魔改教程 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>钉钉下载直播回放</title>
      <link href="/2023/05/05/%E9%92%89%E9%92%89/"/>
      <url>/2023/05/05/%E9%92%89%E9%92%89/</url>
      
        <content type="html"><![CDATA[<h2 id="手机抓包-电脑下载"><a href="#手机抓包-电脑下载" class="headerlink" title="手机抓包+电脑下载"></a>手机<a href="https://so.csdn.net/so/search?q=抓包&amp;spm=1001.2101.3001.7020">抓包</a>+电脑下载</h2><h2 id="手机抓包"><a href="#手机抓包" class="headerlink" title="手机抓包"></a>手机抓包</h2><p><a href="https://link.jscdn.cn/1drv/aHR0cHM6Ly8xZHJ2Lm1zL3UvcyFBaFAtdlNZTXZHRUpoUXBjaFdJRVZQdTB5V1h0P2U9V09IdlUz.apk">下载链接</a></p><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><h5 id="一、配置软件"><a href="#一、配置软件" class="headerlink" title="一、配置软件"></a>一、配置软件</h5><ul><li>下载app后安装</li><li>打开软件</li><li>弹出如此界面，点击<strong>界面空白处或者按返回键</strong>关闭对话框</li><li>弹出如此对话框，点击<strong>暂不</strong></li><li>弹出建立请求，点击<strong>确定</strong>（不同手机的界面不一样，我以MIUI为例，道理都差不多，点确定完事了）</li></ul><h5 id="二、开始抓包"><a href="#二、开始抓包" class="headerlink" title="二、开始抓包"></a>二、开始抓包</h5><ul><li>然后返回桌面，<strong>打开钉钉</strong></li><li>打开群中的<strong>直播回放</strong></li><li>点进去你想下载的直播，等到有画面出来了，就可以返回了。（可以重复执行操作，点击多个要下载的直播）<br> PS：你也许可以看到右下角有一个窗口一直蹦着链接，那些就是抓包抓到的地址，不用管它就行</li></ul><h5 id="三、提取出链接，发送给电脑"><a href="#三、提取出链接，发送给电脑" class="headerlink" title="三、提取出链接，发送给电脑"></a>三、提取出链接，发送给电脑</h5><ul><li>然后返回HttpCanary，再次点击右下角的小飞机关闭抓包，小飞机就变成回蓝色了，你说神奇不。（不放图了，我相信你知道是什么）</li><li>然后点击右上角<strong>放大镜</strong>打开搜索</li><li>选择最后一项“<strong>Url关键词</strong>”</li><li>输入<strong>m3u8</strong>，返回，再返回，回到那个<strong>有纸飞机的界面</strong></li><li>列表中就剩一个了（如果你点击了多个回放，就有多个选项，<strong>每个对应一个回放</strong>）</li><li>然后分别点击进入，<strong>长按链接</strong>，提示复制成功</li><li>分别将这些链接<strong>发送给电脑</strong>，可以使用qq、微信等</li></ul><h2 id="电脑下载"><a href="#电脑下载" class="headerlink" title="电脑下载"></a>电脑下载</h2><p><a href="https://link.jscdn.cn/1drv/aHR0cHM6Ly8xZHJ2Lm1zL3UvcyFBaFAtdlNZTXZHRUpoUXZoX2R4YTJQMmNhV2Q2P2U9SWdWR3ZB.zip">下载链接</a></p><p>这个软件是开源的可以在<a href="https://www.gyan.dev/ffmpeg/builds/#tools">ffmpeg</a>下载</p><h4 id="电脑"><a href="#电脑" class="headerlink" title="电脑"></a>电脑</h4><h5 id="一、准备好指令"><a href="#一、准备好指令" class="headerlink" title="一、准备好指令"></a>一、准备好指令</h5><ul><li>解压下载的压缩包</li><li>得到如此文件夹，打开bin文件夹</li><li>你能看到三个exe文件，不用运行她们。先右键，新建一个txt文档，随便起个名字</li><li>输入以下内容<br> <code>ffmpeg -i &quot;从手机上发来的链接&quot; -c copy 保存的文件名.mp4</code><br> 将其中的<code>从手机上发来的链接</code>和<code>保存的文件名</code>这几个汉字，分别替换成你从手机上辛辛苦苦搞到的<strong>链接</strong>，和你要保存这个视频的<strong>文件名</strong>。</li><li>替换好以后，选择全部内容，右键，复制</li></ul><h5 id="二、使用软件下载"><a href="#二、使用软件下载" class="headerlink" title="二、使用软件下载"></a>二、使用软件下载</h5><ul><li>复制完之后，回到文件浏览器，在刚才那个目录下，你应该有了四个文件——三个exe和一个文本文档。接着按住键盘上的Shift（上档）按键，在空白处点击右键。<br> 可以发现有个在此处打开balabala的，有可能你看到的是<code>在此处的打开命令行窗口</code>，都是一样的，点就完事了。</li><li>然后出来一个小黑框，就叫她小黑吧，在小黑的空白处（没有文字的地方）按一下右键。</li><li>然后你刚才复制的东西——啪一下就粘贴上去了，接下来只要按一下回车~<br> duang duang duang duang~一大堆东西往上窜，等待一会后，在刚才那个目录下，就有了一个mp4文件，这就是你的直播了。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 实用小技巧 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Golang笔记</title>
      <link href="/2023/03/12/Go%E7%AC%94%E8%AE%B0/"/>
      <url>/2023/03/12/Go%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="一、入门"><a href="#一、入门" class="headerlink" title="一、入门"></a>一、入门</h2><p>入门容易精通难啊，Golang语法有些严格，相比Python和Java不好学</p><h3 id="编译-运行"><a href="#编译-运行" class="headerlink" title="编译 + 运行"></a>编译 + 运行</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//编译</span></span><br><span class="line"><span class="keyword">go</span> build hello.<span class="keyword">go</span></span><br><span class="line"><span class="comment">//运行</span></span><br><span class="line">hello.exe</span><br><span class="line"><span class="comment">//编译+运行</span></span><br><span class="line"><span class="keyword">go</span> run hello.<span class="keyword">go</span></span><br></pre></td></tr></table></figure><h3 id="入门案例"><a href="#入门案例" class="headerlink" title="入门案例"></a>入门案例</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123; <span class="comment">//func 是一个关键字，表示一个函数，main表示是一个主函数</span></span><br><span class="line">fmt.Println(<span class="string">&quot;hello world!&quot;</span>)</span><br><span class="line">fmt.Println(<span class="string">&quot;hello Java&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> num = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">这里声明了变量num就必须使用否则会报错</span></span><br><span class="line"><span class="comment"># command-line-arguments</span></span><br><span class="line"><span class="comment">.\hello.go:8:6: num declared and not used</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><ol><li>转译字符</li></ol><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">\r ： 会替换前面的字符</span><br><span class="line">ex.</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span> <span class="comment">//fmt包中提供格式化，输出，输入函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;天龙八部\r雪山飞&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出结果：雪山飞部</span></span><br></pre></td></tr></table></figure><p>练习: 输出以下图片</p><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230308230001435.png" alt="image-20230308230001435"></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span> <span class="comment">//fmt包中提供格式化，输出，输入函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;姓名\t年龄\t籍贯\t住址\njohn\t12\t河北\t北京&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//行注释</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">块注释(多行注释)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h3 id="代码风格"><a href="#代码风格" class="headerlink" title="代码风格"></a>代码风格</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">table 整体向右</span><br><span class="line">shift + table 整体向左</span><br><span class="line"></span><br><span class="line">格式化后在命令行显示：(但是实际上代码不会变)</span><br><span class="line">gofmt hello.<span class="keyword">go</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span> <span class="comment">//fmt包中提供格式化，输出，输入函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;姓名\t年龄\t籍贯\t住址\njohn\t12\t河北\t北京&quot;</span>)</span><br><span class="line">        fmt.Println(<span class="string">&quot;姓名\t年龄\t籍贯\t住址\njohn\t12\t河北\t北京&quot;</span>)</span><br><span class="line">        fmt.Println(<span class="string">&quot;姓名\t年龄\t籍贯\t住址\njohn\t12\t河北\t北京&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">一行字符数过多</span><br><span class="line">fmt.Println(<span class="string">&quot;ffffffffffffff&quot;</span>,</span><br><span class="line"><span class="string">&quot;fffasdasascasc&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ffffasxasxa&quot;</span>)</span><br><span class="line"></span><br><span class="line">api: application program <span class="keyword">interface</span>:应用程序编程接口</span><br><span class="line">就是Go的各个包的各个函数</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Golang中，调用一个函数的方式</span><br><span class="line"><span class="keyword">import</span> 包</span><br><span class="line">使用 <span class="string">&#x27;包名.函数名&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="dos命令"><a href="#dos命令" class="headerlink" title="dos命令"></a>dos命令</h3><div class="table-container"><table><thead><tr><th>Dos命令</th><th></th></tr></thead><tbody><tr><td>查看当前目录</td><td>dir</td></tr><tr><td>清屏</td><td>cls(苍老师)</td></tr><tr><td>切换到F盘</td><td>cd /d f: （F:）</td></tr><tr><td>切换到当前盘Gowork目录（绝对路径）</td><td>cd d:\Gowork</td></tr><tr><td>切换到当前盘Gowork目录（相对路径）</td><td>cd Gowrk</td></tr><tr><td>回到顶级目录(D:\Git\Git&gt;cd )</td><td>cd \</td></tr><tr><td>新建目录</td><td>md</td></tr><tr><td>删除目录(remove directory)</td><td>rd</td></tr><tr><td>强制删除目录<q:不询问 s:层级删除></td><td>rd /q/s</td></tr><tr><td>添加文件并创建文件</td><td>echo hello &gt;  hello.txt</td></tr><tr><td>复制文件</td><td>copy abc.txt a.txt</td></tr><tr><td>剪切文件</td><td>move abc.txt</td></tr><tr><td>删除文件</td><td>del abc.txt</td></tr><tr><td>退出</td><td>exit</td></tr></tbody></table></div><h3 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h3><div class="table-container"><table><thead><tr><th>快捷键</th><th></th></tr></thead><tbody><tr><td>alt + shift + 上下键</td><td>类似ctrl + D</td></tr><tr><td>alt + 上下键</td><td>将该行上下移动</td></tr><tr><td>ctrl + shift + “- or +”</td><td>使屏幕缩放</td></tr><tr><td></td><td></td></tr><tr><td></td><td></td></tr><tr><td></td></tr></tbody></table></div><p>作业:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>编写 Hello</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>输出爱心</span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;\t*\t\t\t\t\t*\n*&quot;</span>,<span class="string">&quot;\t\t*\tI love golang\t*\t\t*\n&quot;</span>,<span class="string">&quot;\t*\t\t\t\t\t*\n&quot;</span>,<span class="string">&quot;\t\t*\t\t\t*\n&quot;</span>,<span class="string">&quot;\t\t\t*\t*\n&quot;</span>,<span class="string">&quot;\t\t\t    *&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230309112527724.png" alt="image-20230309112527724"></p><h3 id="本章内容回顾"><a href="#本章内容回顾" class="headerlink" title="本章内容回顾"></a>本章内容回顾</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1.SDK是什么</span><br><span class="line">SDK是软件开发工具包</span><br><span class="line"></span><br><span class="line">2.Golang环境变量配置：</span><br><span class="line">GOROOR:指定 go sdk安装目录。</span><br><span class="line">Path:指定 sdkbin目录:go.exe godoc.exe gofmt.exe</span><br><span class="line">GOPATH:就是golang项目的工作目录: 所有项目的源码都在这里。</span><br><span class="line"></span><br><span class="line">3.规则</span><br><span class="line">go定义的变量 or import包 必须使用 不用会报错</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="二、基础"><a href="#二、基础" class="headerlink" title="二、基础"></a>二、基础</h2><h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><ol><li><p>入门</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">//定义变量/声明变量</span></span><br><span class="line"><span class="keyword">var</span> i <span class="type">int</span></span><br><span class="line"><span class="comment">//赋值</span></span><br><span class="line">i = <span class="number">10</span></span><br><span class="line">fmt.Println(<span class="string">&quot;i=&quot;</span>,i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//int 默认值是0</span></span><br></pre></td></tr></table></figure></li><li><p>使用方式</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="keyword">var</span> i <span class="type">int</span></span><br><span class="line"><span class="number">2.</span> <span class="keyword">var</span> num = <span class="number">10.11</span></span><br><span class="line"><span class="number">3.</span> name := <span class="string">&quot;tom&quot;</span></span><br><span class="line"></span><br><span class="line">ex.</span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">name := <span class="number">100</span></span><br><span class="line">y1, y2 := <span class="number">15</span>, <span class="string">&quot;beihai&quot;</span></span><br><span class="line">fmt.Println(y1,y2)</span><br><span class="line">fmt.Println(name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 还有全局变量</span></span><br><span class="line">ex:</span><br><span class="line"><span class="keyword">var</span>(</span><br><span class="line">n3 = <span class="number">300</span></span><br><span class="line">    n4 = <span class="number">500</span></span><br><span class="line">    name2 = </span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//这里注意定义全局变量的时候不能用 a3 := &quot;521&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//变量在同一个作用域(在一个函数或者在代码块)内不能重名</span></span><br><span class="line"><span class="keyword">var</span> i <span class="type">int</span> = <span class="number">59</span></span><br><span class="line">i := <span class="number">99</span></span><br><span class="line">简单说就是不能重复</span><br><span class="line"><span class="keyword">var</span> d <span class="type">int</span> = <span class="number">20</span></span><br><span class="line"><span class="keyword">var</span> d <span class="type">int</span> = <span class="number">30</span></span><br></pre></td></tr></table></figure></li></ol><ol><li>数据类型</li></ol><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230310085412786.png" alt="image-20230310085412786" style="zoom:67%;" /></p><p>3.1 整数类型：</p><p>​    <img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230310091010550.png" alt="image-20230310091010550" style="zoom: 67%;" /></p><p>整数使用细节</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">查看某个变量的字节大小和数据类型</span><br><span class="line">fmt.Printf(<span class="string">&quot;&quot;</span>) 用于做格式化输出</span><br><span class="line">ex:</span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;unsafe&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> n2 <span class="type">int8</span> = <span class="number">-128</span></span><br><span class="line">fmt.Println(<span class="string">&quot;n2 的 类型 %T n2占用的字节数是 %d &quot;</span>, n2, unsafe.Sizeof(n2))</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.2 小数类型</p><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230310092627191.png" alt="image-20230310092627191" style="zoom:67%;" /></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">这里有一点要注意<span class="type">float64</span>位比<span class="type">float32</span>位更加准确</span><br><span class="line">默认是<span class="type">float64</span></span><br><span class="line"></span><br><span class="line">num1 := <span class="number">2.1234e2</span>  <span class="comment">// 5.1234 * 10的2次方</span></span><br><span class="line">num2 := <span class="number">2.1234e-2</span>  <span class="comment">// 5.1234 / 10的2次方</span></span><br></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/qq_41542894/article/details/104109261">https://blog.csdn.net/qq_41542894/article/details/104109261</a></p><p>字符串定义之后就不可变</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s4 <span class="type">string</span> = <span class="string">`你好抱抱`</span><span class="comment">//可以用反引号</span></span><br></pre></td></tr></table></figure><h3 id="数据类型转换"><a href="#数据类型转换" class="headerlink" title="数据类型转换"></a>数据类型转换</h3><h4 id="基本数据类型转成String"><a href="#基本数据类型转成String" class="headerlink" title="基本数据类型转成String"></a>基本数据类型转成String</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>fmt.Sprintf(<span class="string">&quot;&quot;</span>)</span><br><span class="line">ex:</span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> n1 <span class="type">float32</span> = <span class="number">12.5</span></span><br><span class="line"><span class="keyword">var</span> s1 <span class="type">string</span> = fmt.Sprintf(<span class="string">&quot;%f&quot;</span>,n1)</span><br><span class="line">fmt.Printf(<span class="string">&quot;%q&quot;</span>,s1)</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>strconv.FormatInt(<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="comment">//这里不太好用需要强转成64位</span></span><br><span class="line">ex:</span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;strconv&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> n1 <span class="type">int</span> = <span class="number">19</span></span><br><span class="line"><span class="keyword">var</span> s1 <span class="type">string</span> = strconv.FormatInt(<span class="type">int64</span>(n1),<span class="number">10</span>)</span><br><span class="line">fmt.Printf(<span class="string">&quot;%v&quot;</span>,s1)</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h4 id="String类型转成基本数据类型"><a href="#String类型转成基本数据类型" class="headerlink" title="String类型转成基本数据类型"></a>String类型转成基本数据类型</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">parse 解析</span><br><span class="line">代码：</span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;strconv&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> s1 <span class="type">string</span> = <span class="string">&quot;true&quot;</span></span><br><span class="line"><span class="keyword">var</span> b <span class="type">bool</span></span><br><span class="line"><span class="comment">//ParseBool函数返回值有两个:(value bool, err error)</span></span><br><span class="line"><span class="comment">//value是布尔类型的数据，err是出现的错误</span></span><br><span class="line"><span class="comment">//只需要获取布尔数据，不要err可以用_直接忽略</span></span><br><span class="line">b, _= strconv.ParseBool(s1)</span><br><span class="line">fmt.Printf(<span class="string">&quot;b的数据类型是%T, b = %v\n&quot;</span>,b,b)</span><br><span class="line"></span><br><span class="line"><span class="comment">//string --&gt; int64</span></span><br><span class="line"><span class="keyword">var</span> s2 <span class="type">string</span> = <span class="string">&quot;19&quot;</span></span><br><span class="line"><span class="keyword">var</span> num1 <span class="type">int64</span></span><br><span class="line">num1, _ = strconv.ParseInt(s2,<span class="number">10</span>,<span class="number">64</span>)</span><br><span class="line">fmt.Printf(<span class="string">&quot;num1的数据类型是%T, num1 = %v\n&quot;</span>,num1,num1)</span><br><span class="line"></span><br><span class="line"><span class="comment">//string --&gt; float32/float64</span></span><br><span class="line"><span class="keyword">var</span> s3 <span class="type">string</span> = <span class="string">&quot;3.14&quot;</span></span><br><span class="line"><span class="keyword">var</span> f1 <span class="type">float64</span></span><br><span class="line">f1, _ = strconv.ParseFloat(s3,<span class="number">64</span>)</span><br><span class="line">fmt.Printf(<span class="string">&quot;f1的数据类型是%T, f1 = %v\n&quot;</span>,f1,f1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> s4 <span class="type">string</span> = <span class="string">&quot;3.14&quot;</span></span><br><span class="line"><span class="keyword">var</span> f2 <span class="type">float64</span></span><br><span class="line">f2, _ = strconv.ParseFloat(s4,<span class="number">32</span>)</span><br><span class="line">fmt.Printf(<span class="string">&quot;f2的数据类型是%T, f2 = %v&quot;</span>,f2,f2)</span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">//运行结果</span></span><br><span class="line">b的数据类型是<span class="type">bool</span>, b = <span class="literal">true</span></span><br><span class="line">num1的数据类型是<span class="type">int64</span>, num1 = <span class="number">19</span></span><br><span class="line">f1的数据类型是<span class="type">float64</span>, f1 = <span class="number">3.14</span></span><br><span class="line">f2的数据类型是<span class="type">float64</span>, f2 = <span class="number">3.140000104904175</span></span><br></pre></td></tr></table></figure><h4 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h4><p>就是内存地址</p><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230311085922328.png" alt="image-20230311085922328" style="zoom: 67%;" /></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> age <span class="type">int</span> = <span class="number">10</span></span><br><span class="line"><span class="comment">// &amp;符号 + 变量 可以获取变量内存的地址</span></span><br><span class="line">fmt.Println(&amp;age) <span class="comment">//0xc00000e0a8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个指针变量-&gt; pointer</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">var 代表要声明一个变量</span></span><br><span class="line"><span class="comment">ptr 指针变量的名字</span></span><br><span class="line"><span class="comment">ptr 对应的类型是：*int 是一个指针类型（可以理解为 指向int类型的指针)</span></span><br><span class="line"><span class="comment">&amp;age 就是一个地址：是ptr具体的值</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">var</span> ptr *<span class="type">int</span> = &amp;age</span><br><span class="line">fmt.Println(ptr)</span><br><span class="line">fmt.Println(<span class="string">&quot;ptr本身存储空间的地址:&quot;</span>,&amp;ptr)</span><br><span class="line"></span><br><span class="line"><span class="comment">//想获取ptr本身地址指向的数据</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;ptr指向的数值为:%v&quot;</span>, *ptr)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&amp;取内存地址</span></span><br><span class="line"><span class="comment">*取内存地址所指的值</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h5 id="指针的4个细节"><a href="#指针的4个细节" class="headerlink" title="指针的4个细节"></a>指针的4个细节</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.通过指针改变指向值</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> num <span class="type">int</span> = <span class="number">10</span></span><br><span class="line">fmt.Println(<span class="string">&quot;num = &quot;</span>, num)</span><br><span class="line"><span class="keyword">var</span> ptr *<span class="type">int</span> = &amp;num</span><br><span class="line">fmt.Println(<span class="string">&quot;num的地址ptr = &quot;</span>, ptr)</span><br><span class="line">fmt.Println(<span class="string">&quot;ptr指向的数值为: &quot;</span>, *ptr)</span><br><span class="line"></span><br><span class="line">*ptr = <span class="number">20</span></span><br><span class="line">fmt.Println(<span class="string">&quot;将ptr改变指向数值: &quot;</span>, num)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.指针变量接受的一定是地址值</span></span><br><span class="line"><span class="comment">// 3.指针变量的地址不可以不匹配</span></span><br><span class="line"><span class="comment">// 4.基本数据类型，都有对应的指针类型</span></span><br></pre></td></tr></table></figure><h3 id="标识符"><a href="#标识符" class="headerlink" title="标识符"></a>标识符</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.可以用‘_&#x27;来忽略一些东西</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">_<span class="string">&quot;strconv&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//2. 包名：尽量保持package的名字和目录保持一直，尽量采取有意义的包名</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">main包是一个程序的入口，如果不定义为package main则不能执行</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//3. 如果变量名、函数名、常量名首字母大写，则可以被其他的包访问；</span></span><br><span class="line"><span class="comment">//如果首字母小写，则只能在本包使用</span></span><br></pre></td></tr></table></figure><h3 id="关于导包"><a href="#关于导包" class="headerlink" title="关于导包"></a>关于导包</h3><p><a href="https://zhuanlan.zhihu.com/p/109828249">https://zhuanlan.zhihu.com/p/109828249</a></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">有些问题现在不会</span><br><span class="line">但基本解决办法</span><br><span class="line"><span class="number">1.</span> 配置GOPATH</span><br><span class="line"><span class="comment">//到src上一级目录下</span></span><br><span class="line"><span class="number">2.</span> <span class="keyword">go</span> mod init 目录名字</span><br><span class="line"><span class="comment">//这里目录名字是main.go上一级目录</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">module demo03</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">go 1.20</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="io"><a href="#io" class="headerlink" title="io"></a>io</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.Scanln</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// fmt.Println(&quot;你好请输入你的年龄: &quot;)</span></span><br><span class="line"><span class="comment">// age,_ :=  fmt.ScanIn()</span></span><br><span class="line"><span class="comment">// fmt.Println(&quot;你的年龄为: &quot;, age)</span></span><br><span class="line"><span class="keyword">var</span> age <span class="type">int</span></span><br><span class="line">fmt.Println(<span class="string">&quot;请录入学生的年龄: &quot;</span>)</span><br><span class="line">fmt.Scanln(&amp;age)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> name <span class="type">string</span></span><br><span class="line">fmt.Println(<span class="string">&quot;请录入学生的姓名: &quot;</span>)</span><br><span class="line">fmt.Scanln(&amp;name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> score <span class="type">float32</span></span><br><span class="line">fmt.Println(<span class="string">&quot;请录入学生的成绩: &quot;</span>)</span><br><span class="line">fmt.Scanln(&amp;score)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> isVIP <span class="type">bool</span></span><br><span class="line">fmt.Println(<span class="string">&quot;请录入学生是否为VIP: &quot;</span>)</span><br><span class="line">fmt.Scanln(&amp;isVIP)</span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">&quot;学生的年龄为: %v, 姓名为: %v, 成绩为: %v, 是否为VIP: %v &quot;</span>,age,name,score,isVIP)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//方式2：Scanf</span></span><br><span class="line">fmt.Println(<span class="string">&quot;请录入学生的年龄,姓名,成绩,是否是VIP,使用空格进行分隔&quot;</span>)</span><br><span class="line">fmt.Scanf(<span class="string">&quot;%d %s %f %t&quot;</span>, &amp;age, &amp;name, &amp;score, &amp;isVIP)</span><br><span class="line">fmt.Printf(<span class="string">&quot;学生的年龄为: %v, 姓名为: %v, 成绩为: %v, 是否为VIP: %v &quot;</span>,age,name,score,isVIP)</span><br></pre></td></tr></table></figure><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230311104205536.png" alt="image-20230311104205536"></p><h3 id="分支结构"><a href="#分支结构" class="headerlink" title="分支结构"></a>分支结构</h3><h4 id="if"><a href="#if" class="headerlink" title="if"></a>if</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> count <span class="type">int</span> = <span class="number">30</span></span><br><span class="line"><span class="keyword">if</span> count &lt;= <span class="number">30</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;sorry 口罩存量不足&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">if count := 20;count &lt;= 30 &#123;</span></span><br><span class="line"><span class="comment">fmt.Println(&quot;sorry 口罩存量不足&quot;)</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h4 id="if-else"><a href="#if-else" class="headerlink" title="if else"></a>if else</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> count := <span class="number">20</span>;count &gt;= <span class="number">30</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;sorry 口罩存量不足&quot;</span>)</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;需要加产了&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="if多分支"><a href="#if多分支" class="headerlink" title="if多分支"></a>if多分支</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> score <span class="type">float32</span></span><br><span class="line">fmt.Println(<span class="string">&quot;请输入你的成绩: &quot;</span>)</span><br><span class="line">fmt.Scanln(&amp;score)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> score &gt;= <span class="number">90</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;A&quot;</span>)</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span> score &gt;= <span class="number">80</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;B&quot;</span>)</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span> score &gt;= <span class="number">70</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;C&quot;</span>)</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span> score &gt;= <span class="number">60</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;D&quot;</span>)</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;E&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="switch"><a href="#switch" class="headerlink" title="switch"></a>switch</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> score <span class="type">int</span></span><br><span class="line"><span class="built_in">println</span>(<span class="string">&quot;请输入你的成绩：&quot;</span>)</span><br><span class="line">fmt.Scanln(&amp;score)</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> score/<span class="number">10</span>&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">10</span> :</span><br><span class="line">fmt.Println(<span class="string">&quot;您的等级为A级&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">9</span> :</span><br><span class="line">fmt.Println(<span class="string">&quot;您的等级为A级&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">8</span> :</span><br><span class="line">fmt.Println(<span class="string">&quot;您的等级为B级&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">7</span> :</span><br><span class="line">fmt.Println(<span class="string">&quot;您的等级为C级&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">6</span> :</span><br><span class="line">fmt.Println(<span class="string">&quot;您的等级为D级&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">5</span> :</span><br><span class="line">fmt.Println(<span class="string">&quot;您的等级为E级&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">4</span> :</span><br><span class="line">fmt.Println(<span class="string">&quot;您的等级为E级&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">3</span> :</span><br><span class="line">fmt.Println(<span class="string">&quot;您的等级为E级&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span> :</span><br><span class="line">fmt.Println(<span class="string">&quot;您的等级为E级&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span> :</span><br><span class="line">fmt.Println(<span class="string">&quot;您的等级为E级&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">0</span> :</span><br><span class="line">fmt.Println(<span class="string">&quot;您的等级为E级&quot;</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">fmt.Println(<span class="string">&quot;输入错误&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//default 可以放在&#123;&#125;中任何地方</span></span><br></pre></td></tr></table></figure><h5 id="switch细节"><a href="#switch细节" class="headerlink" title="switch细节"></a>switch细节</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="comment">// 类型必须匹配</span></span><br><span class="line"><span class="number">2.</span> <span class="comment">// switch 后面的条件可以加变量，常量.....</span></span><br><span class="line"><span class="number">3.</span> <span class="comment">// case可以加多个例如：</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>:</span><br><span class="line">fmt.Println(<span class="string">&quot;😄&quot;</span>)</span><br><span class="line"><span class="number">4.</span> <span class="comment">//default不是必须的</span></span><br><span class="line"><span class="number">5.</span> <span class="comment">//switch特有用法：</span></span><br><span class="line">a := <span class="number">2</span></span><br><span class="line"><span class="keyword">switch</span> &#123;</span><br><span class="line"><span class="keyword">case</span> a == <span class="number">1</span> :</span><br><span class="line">fmt.Println(<span class="string">&quot;aaa&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> a == <span class="number">2</span> :</span><br><span class="line">fmt.Println(<span class="string">&quot;bbb&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">6.</span> <span class="comment">// switch后可以直接声明/定义一个变量，但是要以;结束</span></span><br><span class="line"><span class="keyword">switch</span> b := <span class="number">7</span> ; &#123;</span><br><span class="line">    <span class="keyword">case</span> b &gt; <span class="number">6</span> :</span><br><span class="line">    fmt.Println(<span class="string">&quot;大于6&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">7.</span> <span class="comment">// switch穿透，利用fallthrough关键字</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">7</span> :</span><br><span class="line">fmt.Println(<span class="string">&quot;您的等级为C级&quot;</span>)</span><br><span class="line"><span class="keyword">fallthrough</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">6</span> :</span><br><span class="line"></span><br><span class="line"><span class="comment">/*fmt.Println(&quot;您的等级为D级&quot;)</span></span><br><span class="line"><span class="comment">这里如果输入70 则会打印</span></span><br><span class="line"><span class="comment">您的等级为C级</span></span><br><span class="line"><span class="comment">您的等级为D级*/</span></span><br></pre></td></tr></table></figure><h3 id="循环结构"><a href="#循环结构" class="headerlink" title="循环结构"></a>循环结构</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">golang中只有for没有while</span><br></pre></td></tr></table></figure><h4 id="for"><a href="#for" class="headerlink" title="for"></a>for</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> 初始表达式; 布尔表达式; 迭代因子&#123;</span><br><span class="line">循环体;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> sum <span class="type">int</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++ &#123;</span><br><span class="line">sum += i</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(sum)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="for细节"><a href="#for细节" class="headerlink" title="for细节"></a>for细节</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="comment">// 格式灵活</span></span><br><span class="line">i := <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i &lt;= <span class="number">5</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;迭代5次&quot;</span>)</span><br><span class="line">i++</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">2.</span> <span class="comment">// 死循环</span></span><br><span class="line"><span class="keyword">var</span> n <span class="type">int</span> = <span class="number">0</span></span><br><span class="line">i := <span class="literal">true</span></span><br><span class="line"><span class="keyword">for</span> i == <span class="literal">true</span>&#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;迭代第%v次&quot;</span>, n)</span><br><span class="line">n++</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;循环&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ; ; &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;循环&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="for-range-重点"><a href="#for-range-重点" class="headerlink" title="for range    (重点)"></a>for range    (重点)</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> str <span class="type">string</span> = <span class="string">&quot;hello golang你好啊&quot;</span></span><br><span class="line"><span class="comment">// 方式一: 普通for循环: 按照字节进行遍历输出的 （暂时不用中文）</span></span><br><span class="line"><span class="comment">// for i := 0; i &lt; len(str); i++ &#123;</span></span><br><span class="line"><span class="comment">// fmt.Printf(&quot;循环第 %v 次,第 %v 次循环结果为 %c \n&quot;, i, i, str[i])</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式二: for range</span></span><br><span class="line"><span class="keyword">for</span> i , value := <span class="keyword">range</span> str&#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;索引为：%d, 具体的值为：%c\n&quot;</span>, i, value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">索引为：0, 具体的值为：h</span></span><br><span class="line"><span class="comment">索引为：1, 具体的值为：e</span></span><br><span class="line"><span class="comment">索引为：2, 具体的值为：l</span></span><br><span class="line"><span class="comment">索引为：3, 具体的值为：l</span></span><br><span class="line"><span class="comment">索引为：4, 具体的值为：o</span></span><br><span class="line"><span class="comment">索引为：5, 具体的值为：</span></span><br><span class="line"><span class="comment">索引为：6, 具体的值为：g</span></span><br><span class="line"><span class="comment">索引为：7, 具体的值为：o</span></span><br><span class="line"><span class="comment">索引为：8, 具体的值为：l</span></span><br><span class="line"><span class="comment">索引为：9, 具体的值为：a</span></span><br><span class="line"><span class="comment">索引为：10, 具体的值为：n</span></span><br><span class="line"><span class="comment">索引为：11, 具体的值为：g</span></span><br><span class="line"><span class="comment">索引为：12, 具体的值为：你</span></span><br><span class="line"><span class="comment">索引为：15, 具体的值为：好</span></span><br><span class="line"><span class="comment">索引为：18, 具体的值为：啊</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h3 id="break"><a href="#break" class="headerlink" title="break"></a>break</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sum <span class="type">int</span> = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span> ; i &lt;= <span class="number">100</span> ; i++ &#123;</span><br><span class="line">sum += i</span><br><span class="line">fmt.Println(sum)</span><br><span class="line"><span class="keyword">if</span> sum &gt;= <span class="number">300</span> &#123;</span><br><span class="line"><span class="comment">//停止正在执行的循环</span></span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="break细节"><a href="#break细节" class="headerlink" title="break细节"></a>break细节</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="comment">// switch语句可以省略break</span></span><br><span class="line"><span class="number">2.</span> <span class="comment">// break可以结束正在执行的循环</span></span><br><span class="line"><span class="number">3.</span> <span class="comment">// lable标签可以直接停掉</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">labe2:</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++ &#123;</span><br><span class="line"><span class="keyword">for</span> j := <span class="number">2</span>; j &lt;= <span class="number">4</span>; j++ &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;i: %v, j: %v\n&quot;</span>, i, j)</span><br><span class="line"><span class="keyword">if</span> i ==<span class="number">2</span> &amp;&amp; j == <span class="number">2</span> &#123;</span><br><span class="line"><span class="keyword">break</span> labe2</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="continue"><a href="#continue" class="headerlink" title="continue"></a>continue</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span> ; i &lt;= <span class="number">100</span>; i ++ &#123;</span><br><span class="line"><span class="keyword">if</span> i % <span class="number">6</span> == <span class="number">0</span> &#123;</span><br><span class="line">fmt.Println(i)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span> ; i &lt;= <span class="number">100</span>; i ++ &#123;</span><br><span class="line"><span class="keyword">if</span> i % <span class="number">6</span> != <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">continue</span> <span class="comment">// 结束本次循环，继续下一次循环</span></span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="continue细节"><a href="#continue细节" class="headerlink" title="continue细节"></a>continue细节</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">结束离他近的进程</span><br><span class="line">然后继续开始下一个</span><br></pre></td></tr></table></figure><h3 id="goto"><a href="#goto" class="headerlink" title="goto"></a>goto</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;hello g1&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="number">1</span> == <span class="number">1</span>&#123;</span><br><span class="line"><span class="keyword">goto</span> label1<span class="comment">//goto 一般配合label1使用</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">&quot;hello g2&quot;</span>)</span><br><span class="line"></span><br><span class="line">label1:</span><br><span class="line">fmt.Println(<span class="string">&quot;hello g3&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">结果:</span></span><br><span class="line"><span class="comment">hello g1</span></span><br><span class="line"><span class="comment">hello g3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h3 id="return"><a href="#return" class="headerlink" title="return"></a>return</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="number">100</span>; i++ &#123;</span><br><span class="line">fmt.Println(i)</span><br><span class="line"><span class="keyword">if</span> i == <span class="number">14</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">&quot;结束了当前函数&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="三、函数"><a href="#三、函数" class="headerlink" title="三、函数"></a>三、函数</h2><h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> 函数名<span class="params">(形参列表)</span></span>(返回值类型列表)&#123;</span><br><span class="line"><span class="keyword">return</span> + 返回值列表</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="样例定义函数"><a href="#样例定义函数" class="headerlink" title="样例定义函数"></a>样例定义函数</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">cal</span> <span class="params">(num1 <span class="type">int</span>, num2 <span class="type">int</span>)</span></span> (<span class="type">int</span>) &#123; <span class="comment">//如果返回值类型只有一个的话【可以去掉括号</span></span><br><span class="line"><span class="keyword">var</span> sum <span class="type">int</span> = <span class="number">0</span></span><br><span class="line">sum += num1</span><br><span class="line">sum += num2</span><br><span class="line"><span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">sum01 := cal(<span class="number">10</span>,<span class="number">20</span>)</span><br><span class="line">fmt.Println(sum01)</span><br><span class="line"></span><br><span class="line">sum02 := cal(<span class="number">30</span>,<span class="number">50</span>)</span><br><span class="line">fmt.Println(sum02)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="函数细节"><a href="#函数细节" class="headerlink" title="函数细节"></a>函数细节</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 函数名</span><br><span class="line">首字母不为数字</span><br><span class="line">首字母大写可以被本包文件和其他包文件使用（类似public）</span><br><span class="line">首字母小写只能被本包文件使用（类似private）</span><br><span class="line"><span class="number">2.</span> 形参列表</span><br><span class="line">个数：可以是一个参数，可以是n个参数，也可以是<span class="number">0</span>个参数</span><br><span class="line"><span class="number">3.</span> 返回值类型列表</span><br><span class="line">返回<span class="number">0</span>个：</span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">cal</span> <span class="params">(num1 <span class="type">int</span>, num2 <span class="type">int</span>)</span></span> &#123; <span class="comment">//如果返回值类型只有一个的话【可以去掉括号</span></span><br><span class="line"><span class="keyword">var</span> sum <span class="type">int</span> = <span class="number">0</span></span><br><span class="line">sum += num1</span><br><span class="line">sum += num2</span><br><span class="line">fmt.Println(sum)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">cal(<span class="number">50</span>,<span class="number">90</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">返回<span class="number">1</span>个:</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">cal</span> <span class="params">(num1 <span class="type">int</span>, num2 <span class="type">int</span>)</span></span> <span class="type">int</span></span><br><span class="line"></span><br><span class="line">返回多个:</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">cal2</span> <span class="params">(num1 <span class="type">int</span>, num2 <span class="type">int</span>)</span></span> (<span class="type">int</span>, <span class="type">int</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> sum</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="内存分析"><a href="#内存分析" class="headerlink" title="内存分析"></a>内存分析</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">栈(基本数据类型)</span><br><span class="line"></span><br><span class="line">堆(复杂数据类型)</span><br><span class="line"></span><br><span class="line">代码区(代码本身)</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">exchangeNum</span> <span class="params">(num1 <span class="type">int</span>, num2 <span class="type">int</span>)</span></span> (<span class="type">int</span>,<span class="type">int</span>)&#123;</span><br><span class="line"><span class="keyword">var</span> t <span class="type">int</span></span><br><span class="line">t = num1</span><br><span class="line">num1 = num2</span><br><span class="line">num2 = t</span><br><span class="line"><span class="keyword">return</span> num1,num2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">n1 := <span class="number">15</span></span><br><span class="line">n2 := <span class="number">20</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;交换前n1 = %v, n2 = %v\n&quot;</span>,n1,n2)</span><br><span class="line">n1,n2 = exchangeNum(n1,n2)</span><br><span class="line">fmt.Printf(<span class="string">&quot;交换后n1 = %v, n2 = %v\n&quot;</span>,n1,n2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="golang中不支持重载"><a href="#golang中不支持重载" class="headerlink" title="golang中不支持重载"></a>golang中不支持重载</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">重载的含义就是如果有两个函数，这两个函数函数名相同，形参列表不同</span><br><span class="line">ex:</span><br><span class="line">func exchangeNum (num1 int, num2 int) (int,int)&#123;</span><br><span class="line">var t int</span><br><span class="line">t = num1</span><br><span class="line">num1 = num2</span><br><span class="line">num2 = t</span><br><span class="line">return num1,num2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func exchangeNum (num1 int) (int,int)&#123;</span><br><span class="line">var t int</span><br><span class="line">t = num1</span><br><span class="line">num1 = num2</span><br><span class="line">num2 = t</span><br><span class="line">return num1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="函数参数"><a href="#函数参数" class="headerlink" title="函数参数"></a>函数参数</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">可变参数...</span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span> <span class="params">(args...<span class="type">int</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(args); i++ &#123;</span><br><span class="line">fmt.Println(args[i])</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">test()</span><br><span class="line">fmt.Printf(<span class="string">&quot;------------\n&quot;</span>)</span><br><span class="line">test(<span class="number">3</span>)</span><br><span class="line">test(<span class="number">37</span>,<span class="number">57</span>,<span class="number">59</span>,<span class="number">66</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">结果:</span></span><br><span class="line"><span class="comment">------------</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">37</span></span><br><span class="line"><span class="comment">57</span></span><br><span class="line"><span class="comment">59</span></span><br><span class="line"><span class="comment">66</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h5 id="函数可以作为参数"><a href="#函数可以作为参数" class="headerlink" title="函数可以作为参数"></a>函数可以作为参数</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数是一种数据类型</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(num <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">fmt.Println(num)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">a := test</span><br><span class="line"><span class="comment">//a的类型是:func(int),test函数的类型是func(int)</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;a的类型是:%T,test函数的类型是%T\n&quot;</span>,a , test)</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过变量对函数调用</span></span><br><span class="line">a(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//调用test02的函数</span></span><br><span class="line">test02(<span class="number">10</span>,<span class="number">3.19</span>,test)</span><br><span class="line">test02(<span class="number">10</span>,<span class="number">3.19</span>,a)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="自定义数据类型"><a href="#自定义数据类型" class="headerlink" title="自定义数据类型"></a>自定义数据类型</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">利用 <span class="keyword">type</span> 关键字</span><br><span class="line"><span class="keyword">type</span> myInt=<span class="type">int</span> <span class="comment">//起别名</span></span><br><span class="line"><span class="keyword">type</span> myFloat <span class="type">float32</span> <span class="comment">// 自定义数据类型</span></span><br><span class="line"><span class="keyword">var</span> num1 myInt = <span class="number">30</span></span><br><span class="line"><span class="keyword">var</span> num2 myFloat = <span class="number">2.75</span></span><br><span class="line">fmt.Println(num1,num2)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对函数返回值命名</span></span><br><span class="line"><span class="comment">// 特别注意的是这里不要带 :=</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test05</span><span class="params">(num1 <span class="type">int</span>, num2 <span class="type">int</span>)</span></span>(resSum <span class="type">int</span>,resSub <span class="type">int</span>) &#123;</span><br><span class="line">resSum = num1 + num2</span><br><span class="line">resSub = num1 - num2</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="init函数"><a href="#init函数" class="headerlink" title="init函数"></a>init函数</h3><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230312102623383.png" alt="image-20230312102623383"></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// init 函数总是一开始就被执行</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;demo09/testutil&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> <span class="type">int</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;test 函数被执行&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> num <span class="type">int</span> = test()<span class="comment">// 全局变量先被执行</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;main.go 中 init 函数被执行&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;main 函数被执行&quot;</span>)</span><br><span class="line">fmt.Printf(<span class="string">&quot;Age= %v, Sex= %s, Name= %s&quot;</span>, testutil.Age, testutil.Sex, testutil.Name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">testutil.go 中 init 函数被执行</span></span><br><span class="line"><span class="comment">test 函数被执行</span></span><br><span class="line"><span class="comment">main.go 中 init 函数被执行</span></span><br><span class="line"><span class="comment">main 函数被执行</span></span><br><span class="line"><span class="comment">Age= 19, Sex= 女, Name= 小婵</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">在尝试导入一个包的时候会发现</span></span><br><span class="line"><span class="comment">init函数是现在全局变量之后被执行</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h3 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h3><h4 id="基础使用"><a href="#基础使用" class="headerlink" title="基础使用"></a>基础使用</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// 定义匿名函数</span></span><br><span class="line">result := <span class="function"><span class="keyword">func</span> <span class="params">(num1 <span class="type">int</span>, num2 <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;调用了匿名函数&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> num1 + num2</span><br><span class="line">&#125;(<span class="number">10</span>,<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">fmt.Println(result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">&quot;----------------&quot;</span>)</span><br><span class="line"></span><br><span class="line">sub := <span class="function"><span class="keyword">func</span> <span class="params">(num1 <span class="type">int</span>, num2 <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line"><span class="keyword">return</span> num1 - num2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(sub(<span class="number">10</span>,<span class="number">20</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="defer关键字"><a href="#defer关键字" class="headerlink" title="defer关键字"></a>defer关键字</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(add(<span class="number">30</span>,<span class="number">60</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(num1 <span class="type">int</span>, num2 <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line"><span class="comment">// 不会立即执行defer之后的语句，二十将defer压入一个栈中，然后继续执行函数后面的语句</span></span><br><span class="line"><span class="comment">// 栈的特点：先进后出</span></span><br><span class="line"><span class="keyword">defer</span> fmt.Println(<span class="string">&quot;num1=&quot;</span>,num1)</span><br><span class="line"><span class="keyword">defer</span> fmt.Println(<span class="string">&quot;num2=&quot;</span>,num2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sum <span class="type">int</span> = num1 + num2</span><br><span class="line">fmt.Println(<span class="string">&quot;sum=&quot;</span>,sum)</span><br><span class="line"><span class="keyword">return</span> sum</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="defer应用场景"><a href="#defer应用场景" class="headerlink" title="defer应用场景"></a>defer应用场景</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">比如想要关闭某个使用的资源，则在使用的时候直接随手<span class="keyword">defer</span>，因为<span class="keyword">defer</span>有延迟执行机制</span><br><span class="line">(函数执行完毕之后再执行<span class="keyword">defer</span>压入栈的机制)</span><br><span class="line">所以用完随手写个关闭，比较省事</span><br></pre></td></tr></table></figure><h3 id="字符串函数！！！"><a href="#字符串函数！！！" class="headerlink" title="字符串函数！！！"></a>字符串函数！！！</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;strconv&quot;</span></span><br><span class="line"><span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">str := <span class="string">&quot;golang你好&quot;</span></span><br><span class="line"><span class="comment">//方式1：利用 range</span></span><br><span class="line"><span class="keyword">for</span> i ,value := <span class="keyword">range</span> str &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;索引为：%d,具体的值为：%c \n&quot;</span>, i, value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//方式2 ：利用 r := []rune(str)</span></span><br><span class="line">r := []<span class="type">rune</span>(str)</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(r); i++ &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;%c&quot;</span>,r[i])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 字符串转整数</span></span><br><span class="line">num1,_ := strconv.Atoi(<span class="string">&quot;666&quot;</span>)</span><br><span class="line">fmt.Println(num1)<span class="comment">//666</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 整数转字符串</span></span><br><span class="line">str1 := strconv.Itoa(<span class="number">88</span>)</span><br><span class="line">fmt.Printf(<span class="string">&quot;%v&quot;</span>,str1)<span class="comment">// 88</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//统计一个字符串里有几个指定的字串</span></span><br><span class="line">count := strings.Count(<span class="string">&quot;golangbeihaibei.com&quot;</span>,<span class="string">&quot;bei&quot;</span>)</span><br><span class="line">fmt.Println(count)<span class="comment">//2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//查找子串是否在指定的字符串中</span></span><br><span class="line">beiStr := strings.Contains(<span class="string">&quot;golangbeihaiaaaa&quot;</span>,<span class="string">&quot;beihai&quot;</span>)</span><br><span class="line">fmt.Println(beiStr) <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//不区分大小写的字符串比较 ---&gt; 项目中密码，或者用户名的对比</span></span><br><span class="line">userName := strings.EqualFold(<span class="string">&quot;hello&quot;</span>,<span class="string">&quot;HELLO&quot;</span>)</span><br><span class="line">fmt.Println(userName) <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//区分大小写比较</span></span><br><span class="line">fmt.Println(<span class="string">&quot;hello&quot;</span> == <span class="string">&quot;HELLO&quot;</span>) <span class="comment">//false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//返回字串在字符串第一次出现的索引值</span></span><br><span class="line">inDex := strings.Index(<span class="string">&quot;golangbeihaibei&quot;</span>,<span class="string">&quot;bei&quot;</span>)</span><br><span class="line">fmt.Println(inDex)<span class="comment">// 6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//字符串替换</span></span><br><span class="line"><span class="comment">// 这里最后一项 -1:全部替换2:替换两个</span></span><br><span class="line">rePlace := strings.Replace(<span class="string">&quot;golangbeihaibei&quot;</span>,<span class="string">&quot;bei&quot;</span>,<span class="string">&quot;666&quot;</span>, <span class="number">-1</span>)</span><br><span class="line">fmt.Println(rePlace)</span><br><span class="line"></span><br><span class="line"><span class="comment">//切分</span></span><br><span class="line">sPlit := strings.Split(<span class="string">&quot;go-lang-bei-hai-bei&quot;</span>,<span class="string">&quot;-&quot;</span>)</span><br><span class="line">fmt.Println(sPlit)</span><br><span class="line"></span><br><span class="line"><span class="comment">//大小写切换</span></span><br><span class="line">fmt.Println(strings.ToLower(<span class="string">&quot;Go&quot;</span>))</span><br><span class="line">fmt.Println(strings.ToUpper(<span class="string">&quot;go&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">//字符串左右两边的空格去掉</span></span><br><span class="line">fmt.Println(strings.TrimSpace(<span class="string">&quot;go lang &quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">//将字符串左右两边指定的字符去掉</span></span><br><span class="line">fmt.Println(strings.Trim(<span class="string">&quot;~golang~&quot;</span>,<span class="string">&quot;~&quot;</span>))</span><br><span class="line"><span class="comment">//将字符串左边指定的字符去掉</span></span><br><span class="line">fmt.Println(strings.TrimLeft(<span class="string">&quot;~golang~&quot;</span>,<span class="string">&quot;~&quot;</span>))</span><br><span class="line"><span class="comment">//将字符串右边指定的字符去掉</span></span><br><span class="line">fmt.Println(strings.TrimRight(<span class="string">&quot;~golang~&quot;</span>,<span class="string">&quot;~&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">//判断字符串是否以指定字符串开头</span></span><br><span class="line">fmt.Println(strings.HasPrefix(<span class="string">&quot;https://blog.csdn.net&quot;</span>,<span class="string">&quot;https&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">//判断字符串是否以指定字符串结束</span></span><br><span class="line">fmt.Println(strings.HasSuffix(<span class="string">&quot;demo.png&quot;</span>,<span class="string">&quot;.jpg&quot;</span>))</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="日期和时间函数"><a href="#日期和时间函数" class="headerlink" title="日期和时间函数"></a>日期和时间函数</h3><p><a href="https://blog.csdn.net/Dorgan/article/details/128248547">https://blog.csdn.net/Dorgan/article/details/128248547</a></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">需要导包 time</span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">now := time.Now()</span><br><span class="line">fmt.Println(now)</span><br><span class="line">fmt.Printf(<span class="string">&quot;%T\n&quot;</span>,now)</span><br><span class="line">fmt.Printf(<span class="string">&quot;年：%v\t&quot;</span>,now.Year())</span><br><span class="line">fmt.Printf(<span class="string">&quot;月：%v\t&quot;</span>,<span class="type">int</span>(now.Month()))</span><br><span class="line">fmt.Printf(<span class="string">&quot;日：%v\t&quot;</span>,now.Day())</span><br><span class="line">fmt.Printf(<span class="string">&quot;时：%v\t&quot;</span>,now.Hour())</span><br><span class="line">fmt.Printf(<span class="string">&quot;分：%v\t&quot;</span>,now.Minute())</span><br><span class="line">fmt.Printf(<span class="string">&quot;秒：%v\t&quot;</span>,now.Second())</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="日期的格式化"><a href="#日期的格式化" class="headerlink" title="日期的格式化"></a>日期的格式化</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fmt.Printf(<span class="string">&quot;获取当前年月日: %d-%d-%d 时分秒: %d:%d:%d \n&quot;</span>,now.Year(),<span class="type">int</span>(now.Month()),now.Day(),now.Hour(),now.Minute(),now.Second())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fmt.Println(now.Format(<span class="string">&quot;2006-01-02 15:04:05&quot;</span>))</span><br><span class="line">这里<span class="number">2006</span>的时间是固定</span><br></pre></td></tr></table></figure><h3 id="内置函数"><a href="#内置函数" class="headerlink" title="内置函数"></a>内置函数</h3><h4 id="len函数"><a href="#len函数" class="headerlink" title="len函数"></a>len函数</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">str := <span class="string">&quot;beihai&quot;</span></span><br><span class="line"><span class="built_in">println</span>(<span class="built_in">len</span>(str))<span class="comment">// 6</span></span><br></pre></td></tr></table></figure><h4 id="new函数"><a href="#new函数" class="headerlink" title="new函数"></a>new函数</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">num := <span class="built_in">new</span>(<span class="type">int</span>)</span><br><span class="line">fmt.Printf(<span class="string">&quot;num的类型:%T,num的值是:%v,num的地址:%v,num指针指向的值是:%v&quot;</span>,</span><br><span class="line">num,num,&amp;num,*num)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">运行结果：</span></span><br><span class="line"><span class="comment">num的类型:*int,num的值是:0xc00000e0a8,num的地址:0xc00000a028,num指针指向的值是:0</span></span><br><span class="line"><span class="comment">值是:0</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h2 id="四、包"><a href="#四、包" class="headerlink" title="四、包"></a>四、包</h2><h3 id="包产生的原因"><a href="#包产生的原因" class="headerlink" title="包产生的原因"></a>包产生的原因</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">1</span>).我们不肯能将所有函数放在同一个源文件中，可以分门别类将函数放在不同的源文件中</span><br><span class="line"><span class="number">1.</span> <span class="comment">//main.go 主要用于主函数入口</span></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> <span class="comment">// utils.go 专门定义一些工具函数，让其他文件来调用</span></span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> <span class="comment">// db.go 专门定义对数据库操作的函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getConnection</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line">(<span class="number">2</span>).解决同名问题，两人都想定义一个同名函数，不能放在同一文件下，这时可以用不同包来表示</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20230312095852147.png" alt="image-20230312095852147"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这里go.mod 需要使用 go mod init crm来创建</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.go</span></span><br><span class="line"><span class="keyword">package</span> main<span class="comment">// 1.package进行包的声明，建议：包声明和所在包同名</span></span><br><span class="line"><span class="comment">// 2.main包是程序的入口包《一般main函数会放在这个包下</span></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;crm/dbutils&quot;</span></span><br><span class="line"><span class="string">&quot;crm/calutils&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;你好,这是main函数的执行&quot;</span>)</span><br><span class="line">dbutils.GetConn()</span><br><span class="line">aaa.Add()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dbutils</span></span><br><span class="line"><span class="keyword">package</span> dbutils</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetConn</span><span class="params">()</span></span> &#123;<span class="comment">// 首字母大写，可以被其他包访问</span></span><br><span class="line">fmt.Println(<span class="string">&quot;执行了dbutils包下的getConn函数的执行&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// aaa.go</span></span><br><span class="line"><span class="keyword">package</span> aaa</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;add 函数被执行了&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// go mod</span></span><br><span class="line">module crm</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> <span class="number">1.20</span></span><br></pre></td></tr></table></figure><p>运行结果</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">你好,这是main函数的执行</span><br><span class="line">执行了dbutils包下的getConn函数的执行</span><br><span class="line">add 函数被执行了</span><br></pre></td></tr></table></figure><h3 id="包别名"><a href="#包别名" class="headerlink" title="包别名"></a>包别名</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main<span class="comment">// 1.package进行包的声明，建议：包声明和所在包同名</span></span><br><span class="line"><span class="comment">// 2.main包是程序的入口包《一般main函数会放在这个包下</span></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;crm/dbutils&quot;</span></span><br><span class="line">test <span class="string">&quot;crm/calutils&quot;</span> <span class="comment">// ！！！！！！！！！</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;你好,这是main函数的执行&quot;</span>)</span><br><span class="line">dbutils.GetConn()</span><br><span class="line">test.Add() <span class="comment">// ！！！！！！！！！</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">闭包就是一个函数和与其相关的引用环境组合的一个整体 ，只是这个函数引入外界的变量/参数</span><br><span class="line">闭包的本质：</span><br><span class="line">闭包本质是一个匿名函数，只是这个函数引入外界的变量/参数</span><br><span class="line">匿名函数+引用的变量/参数 = 闭包</span><br></pre></td></tr></table></figure><h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> 匿名函数中引用的那个变量会一直保存在内存中，可以一直使用 ---&gt; 对内存消耗巨大</span><br><span class="line"> 跟普通的方法可不一样</span><br><span class="line"> 例如：</span><br><span class="line"> <span class="comment">// 普通方法每次调用都不能累加</span></span><br><span class="line"> <span class="function"><span class="keyword">func</span> <span class="title">getSum</span><span class="params">(num1 <span class="type">int</span>)</span></span> (<span class="type">int</span>) &#123;</span><br><span class="line"><span class="keyword">var</span> sum <span class="type">int</span> = <span class="number">0</span></span><br><span class="line">sum += num1</span><br><span class="line"><span class="keyword">return</span> sum</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 闭包方法可以累加</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getSum</span><span class="params">()</span></span> <span class="function"><span class="keyword">func</span> <span class="params">(<span class="type">int</span>)</span></span> (<span class="type">int</span>) &#123;</span><br><span class="line"><span class="keyword">var</span> sum <span class="type">int</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span> <span class="params">(num <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">        sum = sum + num</span><br><span class="line">        <span class="keyword">return</span> sum</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="五、错误处理"><a href="#五、错误处理" class="headerlink" title="五、错误处理"></a>五、错误处理</h2><p>捕获机制</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defer + recover</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">test()</span><br><span class="line">fmt.Println(<span class="string">&quot;逻辑成功，开始执行下面代码......&quot;</span>)</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="number">5</span> + <span class="number">7</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// 调用recover内置函数，可以捕获错误：</span></span><br><span class="line">err := <span class="built_in">recover</span>()</span><br><span class="line"><span class="comment">// 如果没有捕获错误，返回值为零值: nil</span></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span>&#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;错误已经捕获&quot;</span>)</span><br><span class="line">fmt.Println(<span class="string">&quot;err是: &quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;()</span><br><span class="line">num1 := <span class="number">10</span></span><br><span class="line">num2 := <span class="number">0</span><span class="comment">//这里是错误的</span></span><br><span class="line">result := num1 / num2</span><br><span class="line">fmt.Println(result)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">错误已经捕获</span></span><br><span class="line"><span class="comment">err是:  runtime error: integer divide by zero</span></span><br><span class="line"><span class="comment">逻辑成功，开始执行下面代码......</span></span><br><span class="line"><span class="comment">12</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h4 id="自定义错误"><a href="#自定义错误" class="headerlink" title="自定义错误"></a>自定义错误</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">error</span>包下的New函数</span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;errors&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">err := test()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;自定义错误: &quot;</span>,err)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(<span class="string">&quot;上面的除法操作执行成功...&quot;</span>)</span><br><span class="line">fmt.Println(<span class="string">&quot;正常执行下面的逻辑...&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> (err <span class="type">error</span>) &#123;</span><br><span class="line">num1 := <span class="number">10</span></span><br><span class="line">num2 := <span class="number">0</span></span><br><span class="line"><span class="keyword">if</span> num2 == <span class="number">0</span> &#123;</span><br><span class="line"><span class="comment">//抛出自定以错误：</span></span><br><span class="line"><span class="keyword">return</span> errors.New(<span class="string">&quot;除数不能为0哦~~~&quot;</span>)</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">result := num1 / num2</span><br><span class="line">fmt.Println(result)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程学习 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>数据抽取</title>
      <link href="/2022/12/10/%E6%95%B0%E6%8D%AE%E6%8A%BD%E5%8F%96/"/>
      <url>/2022/12/10/%E6%95%B0%E6%8D%AE%E6%8A%BD%E5%8F%96/</url>
      
        <content type="html"><![CDATA[<h1 id="数据抽取"><a href="#数据抽取" class="headerlink" title="数据抽取"></a>数据抽取</h1><p>数据抽取分为全量数据抽取，和增量数据抽取<br>全量就是讲源数据全部抽取到目标数据地，<br>增量数据抽取就是有条件性的抽取，<br>这里抽取时候可以用到一个工具Sqoop</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">在 hive 里面截图的时候最好设置上</span><br><span class="line"></span><br><span class="line"># 仅上面一行输出的是表名.列名</span><br><span class="line"><span class="keyword">set</span> hive.cli.print.header<span class="operator">=</span><span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"># 不显示表名，只显示列名</span><br><span class="line"><span class="keyword">set</span> hive.resultset.use.unique.column.names<span class="operator">=</span><span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"># 显示当前数据库</span><br><span class="line"><span class="keyword">set</span> hive.cli.print.current.db <span class="operator">=</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="一-利用Sqoop抽取"><a href="#一-利用Sqoop抽取" class="headerlink" title="一.利用Sqoop抽取"></a>一.利用Sqoop抽取</h2><h3 id="全量数据抽取："><a href="#全量数据抽取：" class="headerlink" title="全量数据抽取："></a>全量数据抽取：</h3><p>对于全量抽取来说一点也不难，但是非常容易出错，我有几个经常忘记的点：</p><ul><li>不要忘记增加targrt-dir这个配置项,，这个主要作用是sqoop先传到hdfs上面然后从hdfs导入到hive表中，所以这项不能掉</li><li>driver配置项需要加上</li></ul><p><strong>抽取shtd_store库中CUSTOMER的全量数据进入Hive的ods库中表customer。字段排序、类型不变，同时添加静态分区，分区字段类型为String，且值为当前比赛日的前一天日期（分区字段格式为yyyyMMdd）。并在hive cli执行show partitions ods.customer命令，将结果截图复制粘贴至对应报告中</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">bin<span class="operator">/</span>sqoop import \</span><br><span class="line"><span class="comment">--connect jdbc:mysql://bigdata1:3306/shtd_store \</span></span><br><span class="line"><span class="comment">--driver com.mysql.jdbc.Driver \</span></span><br><span class="line"><span class="comment">--username root \</span></span><br><span class="line"><span class="comment">--password 123456 \</span></span><br><span class="line"><span class="comment">--table CUSTOMER \</span></span><br><span class="line"><span class="comment">--fields-terminated-by &#x27;|&#x27; \</span></span><br><span class="line"><span class="comment">--target-dir /sqoop/o1 \</span></span><br><span class="line"><span class="comment">--hive-import \</span></span><br><span class="line"><span class="comment">--hive-overwrite \</span></span><br><span class="line"><span class="comment">--hive-table &#x27;ods.customer&#x27; \</span></span><br><span class="line"><span class="comment">--hive-partition-key etldate \</span></span><br><span class="line"><span class="comment">--hive-partition-value 20221209 \</span></span><br><span class="line"><span class="comment">--m 1</span></span><br><span class="line"></span><br><span class="line">bin<span class="operator">/</span>sqoop import \</span><br><span class="line"><span class="comment">--connect jdbc:mysql://bigdata1:3306/shtd_store \</span></span><br><span class="line"><span class="comment">--driver com.mysql.jdbc.Driver \</span></span><br><span class="line"><span class="comment">--username root \</span></span><br><span class="line"><span class="comment">--password 123456 \</span></span><br><span class="line"><span class="comment">--table NATION \</span></span><br><span class="line"><span class="comment">--fields-terminated-by &#x27;|&#x27; \</span></span><br><span class="line"><span class="comment">--target-dir /sqoop/o1 \</span></span><br><span class="line"><span class="comment">--hive-import \</span></span><br><span class="line"><span class="comment">--hive-overwrite \</span></span><br><span class="line"><span class="comment">--hive-table &#x27;ods.NATION&#x27; \</span></span><br><span class="line"><span class="comment">--hive-partition-key etldate \</span></span><br><span class="line"><span class="comment">--hive-partition-value 20221209 \</span></span><br><span class="line"><span class="comment">--m 1</span></span><br></pre></td></tr></table></figure><p>总体来说不难，但是要注意细节别看错题目直接忽略了增量抽取，这一部分我用spark做的时候总会出现错误，大部分是因为spark3.0有点不稳定，比赛最好还是sqoop来抽取吧</p><h3 id="增量数据抽取"><a href="#增量数据抽取" class="headerlink" title="增量数据抽取"></a>增量数据抽取</h3><p>这部分有点难度，主要还是练的少，平时嫌麻烦就没有往hive表里导数据，这里可以先用sqoop往hive原表里面搞点原始数据，这里hive里面的原表应该有分区这里一律设置为etldate=20221210</p><p>其实最好用的方法还是用sparksql来写，但是打包上集群太麻烦了</p><h4 id="第一种动态分区并设置字段内容"><a href="#第一种动态分区并设置字段内容" class="headerlink" title="第一种动态分区并设置字段内容"></a>第一种动态分区并设置字段内容</h4><blockquote><p><strong>抽取shtd_store库中ORDERS的增量数据进入Hive的ods库中表orders，要求只取1996年07月02及之后的数据（包括1996年07月02），对比MySQL和Hive中的表的ORDERKEY大小，根据ORDERS表中ORDERKEY作为增量字段，只将新增的数据抽入，字段类型不变，同时添加动态分区，分区字段类型为String，且值为ORDERDATE字段的内容（ORDERDATE的格式为yyyy-MM-dd，分区字段格式为yyyyMMdd），并在hive cli执行select count(distinct(etldate)) from  ods.orders命令，将Sqoop提交命令及hive cli的执行结果分别截图复制粘贴至对应报告中；</strong></p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">一.先伪造原始数据</span><br><span class="line"></span><br><span class="line">这里假设orders的增量字段orderkey为<span class="number">800000</span>，所以要先把<span class="number">800000</span>之前的数据抽取到hive中</span><br><span class="line">这里别忘了把orderkey转换成<span class="type">int</span>类型要不然默认是string类型就完蛋了，全抽过去了</span><br><span class="line"></span><br><span class="line">bin<span class="operator">/</span>sqoop import \</span><br><span class="line"><span class="comment">--connect jdbc:mysql://bigdata1:3306/shtd_store \</span></span><br><span class="line"><span class="comment">--username root \</span></span><br><span class="line"><span class="comment">--password 123456 \</span></span><br><span class="line"><span class="comment">--driver com.mysql.jdbc.Driver \</span></span><br><span class="line"><span class="comment">--target-dir /sqoop/o1 \</span></span><br><span class="line"><span class="comment">--query &#x27;select * from ORDERS where cast(ORDERKEY as signed integer) &lt;= 800000 and $CONDITIONS&#x27; \</span></span><br><span class="line"><span class="comment">--hive-import \</span></span><br><span class="line"><span class="comment">--hive-overwrite \</span></span><br><span class="line"><span class="comment">--hive-table &#x27;ods.orders&#x27; \</span></span><br><span class="line"><span class="comment">--hive-partition-key etldate \</span></span><br><span class="line"><span class="comment">--hive-partition-value 20221210 \</span></span><br><span class="line"><span class="comment">--m 1</span></span><br><span class="line"></span><br><span class="line">完成了原始数据的创建了这里需要第二部分</span><br><span class="line">由于比赛的时候是原表有数据，所以先进行逆向排序，查看orderkey最大值为多少，以他为增量最大字段</span><br><span class="line">hive (ods)<span class="operator">&gt;</span> <span class="keyword">select</span> orderkey <span class="keyword">from</span> orders <span class="keyword">order</span> <span class="keyword">by</span> orderkey <span class="keyword">desc</span> limit <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">二.增量抽取</span><br><span class="line">这里有几点重要：</span><br><span class="line"><span class="number">1.</span>添加动态分区的时候，需要新建一个middle_orders增加一列etldate,这一列etldate是</span><br><span class="line">orderdate 并且把格式转成 yyyyMMdd  并把orderkey<span class="operator">&gt;</span><span class="number">800000</span>的数据导入middle_orders</span><br><span class="line"></span><br><span class="line">同时添加动态分区，分区字段类型为String，且值为ORDERDATE字段的内容（ORDERDATE的格式为yyyy<span class="operator">-</span>MM<span class="operator">-</span>dd，分区字段格式为yyyyMMdd）</span><br><span class="line"></span><br><span class="line">(<span class="number">1</span>).先建一个中间表</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> middle_orders</span><br><span class="line">(</span><br><span class="line">orderkey string, </span><br><span class="line">custkey string,</span><br><span class="line">orderstatus string,</span><br><span class="line">totalprice string,</span><br><span class="line">orderdate string,</span><br><span class="line">orderpriority string, </span><br><span class="line">clerk string,</span><br><span class="line">shippriority string,</span><br><span class="line">comment string,</span><br><span class="line">etldate string</span><br><span class="line">) stored <span class="keyword">as</span> textfile</span><br><span class="line"></span><br><span class="line">(<span class="number">2</span>).往中间表里面导入数据</span><br><span class="line">bin<span class="operator">/</span>sqoop import \</span><br><span class="line"><span class="comment">--connect jdbc:mysql://bigdata1:3306/shtd_store \</span></span><br><span class="line"><span class="comment">--username root \</span></span><br><span class="line"><span class="comment">--password 123456 \</span></span><br><span class="line"><span class="comment">--driver com.mysql.jdbc.Driver \</span></span><br><span class="line"><span class="comment">--target-dir /sqoop/o1 \</span></span><br><span class="line"><span class="comment">--query &#x27;select *, replace(ORDERDATE, &quot;-&quot;, &quot;&quot;) from ORDERS where cast(ORDERKEY as SIGNED INTEGER) &gt; 800000 and ORDERDATE &gt; &quot;1996-07-02&quot; and $CONDITIONS&#x27; \</span></span><br><span class="line"><span class="comment">--hive-import \</span></span><br><span class="line"><span class="comment">--hive-overwrite \</span></span><br><span class="line"><span class="comment">--hive-table ods.middle_orders \</span></span><br><span class="line"><span class="comment">--m 1</span></span><br><span class="line"></span><br><span class="line">(<span class="number">3</span>).重点一步开启动态分区，为导入分区表做准备</span><br><span class="line"><span class="keyword">set</span> hive.exec.dynamic.partition<span class="operator">=</span><span class="literal">true</span>;</span><br><span class="line"><span class="keyword">set</span> hive.exec.dynamic.partition.mode<span class="operator">=</span><span class="literal">false</span>;</span><br><span class="line"><span class="keyword">set</span> hive.exec.max.dynamic.partitions<span class="operator">=</span><span class="number">90000</span>;</span><br><span class="line"><span class="keyword">set</span> hive.exec.max.dynamic.partitions.pernode<span class="operator">=</span><span class="number">90000</span>;</span><br><span class="line"></span><br><span class="line">(<span class="number">4</span>).新增数据到orders</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> orders <span class="keyword">partition</span>(etldate) <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> middle_orders;</span><br><span class="line"></span><br><span class="line">(<span class="number">5</span>).求<span class="keyword">distinct</span></span><br><span class="line">hive (ods)<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span>(etldate)) <span class="keyword">from</span> ods.orders;</span><br></pre></td></tr></table></figure><h4 id="第二种直接增量导入"><a href="#第二种直接增量导入" class="headerlink" title="第二种直接增量导入"></a>第二种直接增量导入</h4><blockquote><p> 抽取shtd_store库中LINEITEM的增量数据进入Hive的ods库中表lineitem，根据LINEITEM表中orderkey作为增量字段，只将新增的数据抽入，字段类型不变，同时添加静态分区，分区字段类型为String，且值为当前比赛日的前一天日期（分区字段格式为yyyyMMdd）。并在hive cli执行show partitions ods.lineitem命令，将结果截图复制粘贴至对应报告中。</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>伪造源数据</span><br><span class="line">先把orderkey<span class="operator">&lt;=</span><span class="number">5992002</span>导入分区etldate<span class="operator">=</span><span class="number">20221210</span></span><br><span class="line">bin<span class="operator">/</span>sqoop import \</span><br><span class="line"><span class="comment">--connect jdbc:mysql://bigdata1:3306/shtd_store \</span></span><br><span class="line"><span class="comment">--username root \</span></span><br><span class="line"><span class="comment">--password 123456 \</span></span><br><span class="line"><span class="comment">--driver com.mysql.jdbc.Driver \</span></span><br><span class="line"><span class="comment">--target-dir /sqoop/o3 \</span></span><br><span class="line"><span class="comment">--fields-terminated-by &#x27;|&#x27; \</span></span><br><span class="line"><span class="comment">--query &#x27;select * from LINEITEM where cast(ORDERKEY as SIGNED INTEGER) &lt;= 5992002 and $CONDITIONS&#x27; \</span></span><br><span class="line"><span class="comment">--hive-import \</span></span><br><span class="line"><span class="comment">--hive-overwrite \</span></span><br><span class="line"><span class="comment">--hive-table &#x27;ods.lineitem&#x27; \</span></span><br><span class="line"><span class="comment">--hive-partition-key etldate \</span></span><br><span class="line"><span class="comment">--hive-partition-value &#x27;20221210&#x27; \</span></span><br><span class="line"><span class="comment">--m 1</span></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>导入新增数据</span><br><span class="line">bin<span class="operator">/</span>sqoop import \</span><br><span class="line"><span class="comment">--connect jdbc:mysql://bigdata1:3306/shtd_store \</span></span><br><span class="line"><span class="comment">--username root \</span></span><br><span class="line"><span class="comment">--password 123456 \</span></span><br><span class="line"><span class="comment">--driver com.mysql.jdbc.Driver \</span></span><br><span class="line"><span class="comment">--target-dir /sqoop/o3 \</span></span><br><span class="line"><span class="comment">--fields-terminated-by &#x27;|&#x27; \</span></span><br><span class="line"><span class="comment">--query &#x27;select * from LINEITEM where cast(ORDERKEY as SIGNED INTEGER) &gt; 5992002 and $CONDITIONS&#x27; \</span></span><br><span class="line"><span class="comment">--hive-import \</span></span><br><span class="line"><span class="comment">--hive-overwrite \</span></span><br><span class="line"><span class="comment">--hive-table &#x27;ods.lineitem&#x27; \</span></span><br><span class="line"><span class="comment">--hive-partition-key etldate \</span></span><br><span class="line"><span class="comment">--hive-partition-value &#x27;20221209&#x27; \</span></span><br><span class="line"><span class="comment">--m 1</span></span><br></pre></td></tr></table></figure><p>总结一下增量抽取，需要思路清晰，把题目看清楚了有的需要添加动态分区，分区字段要新建中间表再添加，另外重要一点是<strong><em>cast(ORDERKEY as SIGNED INTEGER)</em></strong> 这里是SIGNED INTEGER ，replace(ORDERDATE, “-“, “”)</p><h2 id="二-利用SparkSql抽取"><a href="#二-利用SparkSql抽取" class="headerlink" title="二.利用SparkSql抽取"></a>二.利用SparkSql抽取</h2><h3 id="全量数据抽取：-1"><a href="#全量数据抽取：-1" class="headerlink" title="全量数据抽取："></a>全量数据抽取：</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> dask01</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.<span class="type">SparkSession</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.<span class="type">SimpleDateFormat</span></span><br><span class="line"><span class="keyword">import</span> java.util.&#123;<span class="type">Date</span>, <span class="type">Properties</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">task1_1</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> spark: <span class="type">SparkSession</span> = <span class="type">SparkSession</span>.builder()</span><br><span class="line">      .config(<span class="string">&quot;spark.sql.warehouse.dir&quot;</span>, <span class="string">&quot;hdfs://bigdata1:9000/user/hive/warehouse&quot;</span>)</span><br><span class="line">      .config(<span class="string">&quot;spark.sql.legacy.createHiveTableByDefault&quot;</span>, <span class="string">&quot;false&quot;</span>)</span><br><span class="line">      .config(<span class="string">&quot;spark.sql.legacy.timeParserPolicy&quot;</span>, <span class="string">&quot;LEGACY&quot;</span>)</span><br><span class="line">      .master(<span class="string">&quot;local[*]&quot;</span>)</span><br><span class="line">      .appName(<span class="string">&quot;task1_1&quot;</span>)</span><br><span class="line">      .enableHiveSupport()</span><br><span class="line">      .getOrCreate()</span><br><span class="line">    <span class="keyword">import</span> spark.sql</span><br><span class="line">    <span class="keyword">import</span> spark.implicits._</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> prop = <span class="keyword">new</span> <span class="type">Properties</span>()</span><br><span class="line">    <span class="keyword">val</span> url = <span class="string">&quot;jdbc:mysqL://bigdata1:3306/shtd_store?characterEncoding=utf8&amp;useSSL=false&quot;</span></span><br><span class="line">    prop.setProperty(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;root&quot;</span>)</span><br><span class="line">    prop.setProperty(<span class="string">&quot;password&quot;</span>,<span class="string">&quot;123456&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> simpleDateFormat = <span class="keyword">new</span> <span class="type">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> date = <span class="keyword">new</span> <span class="type">Date</span>()</span><br><span class="line">    <span class="keyword">val</span> timeNow: <span class="type">String</span> = simpleDateFormat.format(date)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> timeStr = <span class="string">&quot;20220413&quot;</span></span><br><span class="line"></span><br><span class="line">    spark.sql(<span class="string">&quot;use ods&quot;</span>)</span><br><span class="line"></span><br><span class="line">    spark.sql(<span class="string">&quot;set hive.exec.dynamic.partition=true&quot;</span>)</span><br><span class="line">    spark.sql(<span class="string">&quot;set hive.exec.dynamic.partition.mode=nonstrict&quot;</span>)</span><br><span class="line">    spark.sql(<span class="string">&quot;set hive.exec.max.dynamic.partitions=80000&quot;</span>)</span><br><span class="line">    spark.sql(<span class="string">&quot;set hive.exec.max.dynamic.partitions.pernode=80000&quot;</span>)</span><br><span class="line"></span><br><span class="line">    spark.sql(<span class="string">&quot;truncate table ods.customer&quot;</span>)</span><br><span class="line">    spark.read.jdbc(url,<span class="string">&quot;CUSTOMER&quot;</span>,prop).createOrReplaceTempView(<span class="string">&quot;t1&quot;</span>)</span><br><span class="line">    spark.sql(<span class="string">s&quot;insert overwrite table ods.customer partition(etldate=&#x27;<span class="subst">$timeStr</span>&#x27;) select * from t1&quot;</span>)</span><br><span class="line"></span><br><span class="line">    spark.sql(<span class="string">&quot;truncate table ods.nation&quot;</span>)</span><br><span class="line">    spark.read.jdbc(url,<span class="string">&quot;NATION&quot;</span>,prop).createOrReplaceTempView(<span class="string">&quot;t2&quot;</span>)</span><br><span class="line">    spark.sql(<span class="string">s&quot;insert overwrite table ods.nation partition(etldate=&#x27;<span class="subst">$timeStr</span>&#x27;) select * from t2&quot;</span>)</span><br><span class="line"></span><br><span class="line">    spark.sql(<span class="string">&quot;truncate table ods.part&quot;</span>)</span><br><span class="line">    spark.read.jdbc(url,<span class="string">&quot;PART&quot;</span>,prop).createOrReplaceTempView(<span class="string">&quot;t3&quot;</span>)</span><br><span class="line">    spark.sql(<span class="string">s&quot;insert overwrite table ods.part partition(etldate=&#x27;<span class="subst">$timeStr</span>&#x27;) select * from t3&quot;</span>)</span><br><span class="line"></span><br><span class="line">    spark.sql(<span class="string">&quot;truncate table ods.partsupp&quot;</span>)</span><br><span class="line">    spark.read.jdbc(url,<span class="string">&quot;PARTSUPP&quot;</span>,prop).createOrReplaceTempView(<span class="string">&quot;t4&quot;</span>)</span><br><span class="line">    spark.sql(<span class="string">s&quot;insert overwrite table ods.partsupp partition(etldate=&#x27;<span class="subst">$timeStr</span>&#x27;) select * from t4&quot;</span>)</span><br><span class="line"></span><br><span class="line">    spark.sql(<span class="string">&quot;truncate table ods.region&quot;</span>)</span><br><span class="line">    spark.read.jdbc(url,<span class="string">&quot;REGION&quot;</span>,prop).createOrReplaceTempView(<span class="string">&quot;t5&quot;</span>)</span><br><span class="line">    spark.sql(<span class="string">s&quot;insert overwrite table ods.region partition(etldate=&#x27;<span class="subst">$timeStr</span>&#x27;) select * from t5&quot;</span>)</span><br><span class="line"></span><br><span class="line">    spark.sql(<span class="string">&quot;truncate table ods.supplier&quot;</span>)</span><br><span class="line">    spark.read.jdbc(url,<span class="string">&quot;SUPPLIER&quot;</span>,prop).createOrReplaceTempView(<span class="string">&quot;t4&quot;</span>)</span><br><span class="line">    spark.sql(<span class="string">s&quot;insert overwrite table ods.supplier partition(etldate=&#x27;<span class="subst">$timeStr</span>&#x27;) select * from t4&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    spark.sql(<span class="string">&quot;insert into table ods.orders partition(etldate) select * from middle_orders&quot;</span>)</span><br><span class="line"></span><br><span class="line">    spark.sql(<span class="string">&quot;select count(distinct(etldate)) from ods.orders&quot;</span>).show()</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 工作室 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Flink</title>
      <link href="/2022/12/08/Flink/"/>
      <url>/2022/12/08/Flink/</url>
      
        <content type="html"><![CDATA[<h1 id="Flink"><a href="#Flink" class="headerlink" title="Flink"></a>Flink</h1><p>处理实时数据流，对时间的要求高，所以经常用到开窗等一系列的操作</p><h1 id="有界流"><a href="#有界流" class="headerlink" title="有界流"></a>有界流</h1><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> <span class="type">Flink</span>.<span class="type">WordCount</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.scala.&#123;<span class="type">DataStream</span>, <span class="type">StreamExecutionEnvironment</span>&#125;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.scala._</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">StreamWordCount</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">//1.创建流式执行环境</span></span><br><span class="line">    <span class="keyword">val</span> env: <span class="type">StreamExecutionEnvironment</span> = <span class="type">StreamExecutionEnvironment</span>.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.读取文件</span></span><br><span class="line">    <span class="keyword">val</span> lineDataStream: <span class="type">DataStream</span>[<span class="type">String</span>] = env.readTextFile(<span class="string">&quot;input/words.txt&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.运算</span></span><br><span class="line">    <span class="keyword">val</span> result: <span class="type">DataStream</span>[(<span class="type">String</span>, <span class="type">Int</span>)] = lineDataStream.flatMap(_.split(<span class="string">&quot; &quot;</span>)).map((_, <span class="number">1</span>)).keyBy(_._1).sum(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.结果</span></span><br><span class="line">    result.print()</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.执行任务</span></span><br><span class="line">    env.execute()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="无界流"><a href="#无界流" class="headerlink" title="无界流"></a>无界流</h1><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> <span class="type">Flink</span>.<span class="type">WordCount</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.utils.<span class="type">ParameterTool</span></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.scala._</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TrueStreamWordCount</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> env: <span class="type">StreamExecutionEnvironment</span> = <span class="type">StreamExecutionEnvironment</span>.getExecutionEnvironment</span><br><span class="line"></span><br><span class="line">    <span class="comment">//读取socket流</span></span><br><span class="line"><span class="comment">//    val lineDataStream: DataStream[String] = env.socketTextStream(&quot;master&quot;, 44444)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> parameterTool: <span class="type">ParameterTool</span> = <span class="type">ParameterTool</span>.fromArgs(args)</span><br><span class="line">    <span class="keyword">val</span> hostname: <span class="type">String</span> = parameterTool.get(<span class="string">&quot;host&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> port: <span class="type">Int</span> = parameterTool.getInt(<span class="string">&quot;port&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> lineDataStream: <span class="type">DataStream</span>[<span class="type">String</span>] = env.socketTextStream(hostname, port)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    lineDataStream.flatMap(_.split(<span class="string">&quot; &quot;</span>)).map((_,<span class="number">1</span>)).keyBy(_._1).sum(<span class="number">1</span>).print()</span><br><span class="line"></span><br><span class="line">    env.execute()</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20221114093156759.png" alt="image-20221114093156759"></p><h1 id="Flink启动和停止"><a href="#Flink启动和停止" class="headerlink" title="Flink启动和停止"></a>Flink启动和停止</h1><h2 id="本地模式"><a href="#本地模式" class="headerlink" title="本地模式"></a>本地模式</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">启动:bin/start-cluster.sh</span><br><span class="line">停止:bin/stop-cluster.sh </span><br><span class="line"></span><br><span class="line">[root@master flink]# ./bin/flink run -m master:8081 -c Flink.WordCount.TrueStreamWordCount -p 2 ./hivespark-1.0-SNAPSHOT.jar --host master --port 44444</span><br><span class="line">Job has been submitted with JobID 5889aea585779ac98350b3ad17a9e02d</span><br><span class="line"></span><br><span class="line">查看作业</span><br><span class="line">1.添加job作业编号</span><br><span class="line">[root@master flink]# ./bin/flink list 5889aea585779ac98350b3ad17a9e02d</span><br><span class="line">Waiting for response...</span><br><span class="line">------------------ Running/Restarting Jobs -------------------</span><br><span class="line">14.11.2022 10:33:54 : 5889aea585779ac98350b3ad17a9e02d : Flink Streaming Job (RUNNING)</span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">No scheduled jobs.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.直接查看</span><br><span class="line">[root@master flink]# ./bin/flink list</span><br><span class="line">Waiting for response...</span><br><span class="line">------------------ Running/Restarting Jobs -------------------</span><br><span class="line">14.11.2022 10:33:54 : 5889aea585779ac98350b3ad17a9e02d : Flink Streaming Job (RUNNING)</span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">No scheduled jobs.</span><br><span class="line"></span><br><span class="line">3.查看所有的包括之前取消的</span><br><span class="line">[root@master flink]# ./bin/flink list -a</span><br><span class="line">Waiting for response...</span><br><span class="line">------------------ Running/Restarting Jobs -------------------</span><br><span class="line">14.11.2022 10:33:54 : 5889aea585779ac98350b3ad17a9e02d : Flink Streaming Job (RUNNING)</span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">No scheduled jobs.</span><br><span class="line">---------------------- Terminated Jobs -----------------------</span><br><span class="line">14.11.2022 10:23:57 : 19a87da39b618b6053bb496d5ba5b2ee : Flink Streaming Job (CANCELED)</span><br><span class="line">--------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">4.关闭作业</span><br><span class="line">[root@master flink]# ./bin/flink cancel 5889aea585779ac98350b3ad17a9e02d</span><br><span class="line">Cancelling job 5889aea585779ac98350b3ad17a9e02d.</span><br><span class="line">Cancelled job 5889aea585779ac98350b3ad17a9e02d.</span><br></pre></td></tr></table></figure><h2 id="Yarn部署"><a href="#Yarn部署" class="headerlink" title="Yarn部署"></a>Yarn部署</h2><h3 id="一-yarn的会话模式"><a href="#一-yarn的会话模式" class="headerlink" title="(一).yarn的会话模式"></a>(一).yarn的会话模式</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">启动</span><br><span class="line">bin/yarn-session.sh -nm test -d</span><br><span class="line"></span><br><span class="line">建立job</span><br><span class="line">./bin/flink run -c Flink.WordCount.TrueStreamWordCount -p 2 ./hivespark-1.0-SNAPSHOT.jar --host master --port 44444</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 大数据 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Flume配置</title>
      <link href="/2022/12/08/Flume%E9%85%8D%E7%BD%AE/"/>
      <url>/2022/12/08/Flume%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="Flume配置"><a href="#Flume配置" class="headerlink" title="Flume配置"></a>Flume配置</h1><p> flume的数据采集部分做的很好，可以定制很多数据源，减少开发量。所以比较流行flume+kafka模式，如果为了利用flume写hdfs的能力，也可以采用kafka+flume的方式。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">模板：</span><br><span class="line">#Name</span><br><span class="line">a1.sources = r1</span><br><span class="line">a1.sinks = k1</span><br><span class="line">a1.channels = c1</span><br><span class="line"></span><br><span class="line">#Source</span><br><span class="line">a1.sources.r1.type = </span><br></pre></td></tr></table></figure><h2 id="一-netcat连接"><a href="#一-netcat连接" class="headerlink" title="(一).netcat连接"></a>(一).netcat连接</h2><h3 id="1-启动zook"><a href="#1-启动zook" class="headerlink" title="1.启动zook"></a>1.启动zook</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./zkServer.sh start</span><br></pre></td></tr></table></figure><h3 id="2-配置flume文件-flume-netcat-logger-conf"><a href="#2-配置flume文件-flume-netcat-logger-conf" class="headerlink" title="2.配置flume文件(flume-netcat-logger.conf)"></a>2.配置flume文件(flume-netcat-logger.conf)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#Name</span><br><span class="line">a1.sources = r1</span><br><span class="line">a1.sinks = k1</span><br><span class="line">a1.channels = c1</span><br><span class="line"></span><br><span class="line">#Source</span><br><span class="line">a1.sources.r1.type = netcat</span><br><span class="line">a1.sources.r1.bind = localhost</span><br><span class="line">a1.sources.r1.port = 44444</span><br><span class="line"></span><br><span class="line">#Sink</span><br><span class="line">a1.sinks.k1.type = logger</span><br><span class="line"></span><br><span class="line">#Channel</span><br><span class="line">a1.channels.c1.type = memory</span><br><span class="line">a1.channels.c1.capacity = 1000   (channel中可存放多少个Event)</span><br><span class="line">a1.channels.c1.transactionCapacity = 100 (putList和takeList的容量)</span><br><span class="line"></span><br><span class="line">#Bind</span><br><span class="line">a1.sources.r1.channels = c1</span><br><span class="line">a1.sinks.k1.channel = c1</span><br></pre></td></tr></table></figure><h3 id="3-开启flume监听端口"><a href="#3-开启flume监听端口" class="headerlink" title="3.开启flume监听端口"></a>3.开启flume监听端口</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flume&gt; bin/flume-ng agent --conf conf/ --name a1 --conf-file job/flume-netcat-logger.conf -Dflume-root.logger=INFO,console</span><br></pre></td></tr></table></figure><h3 id="4-开启客户端消费"><a href="#4-开启客户端消费" class="headerlink" title="4.开启客户端消费"></a>4.开启客户端消费</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc localhost 44444nc -lk xxx</span><br></pre></td></tr></table></figure><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20221104191834018.png" alt="image-20221104191834018"></p><h3 id="5-如果报错就是后台会有多个Application杀掉就可"><a href="#5-如果报错就是后台会有多个Application杀掉就可" class="headerlink" title="5.如果报错就是后台会有多个Application杀掉就可"></a>5.如果报错就是后台会有多个Application杀掉就可</h3><h2 id="二-实时监控HIVE日志-gt-HDFS"><a href="#二-实时监控HIVE日志-gt-HDFS" class="headerlink" title="(二).实时监控HIVE日志-&gt;HDFS"></a>(二).实时监控HIVE日志-&gt;HDFS</h2><h3 id="1-启动"><a href="#1-启动" class="headerlink" title="1.启动"></a>1.启动</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.启动zookeeper</span><br><span class="line">./zkServer.sh start</span><br><span class="line">2.启动hdfs</span><br><span class="line">hadoop&gt; sbin/start-dfs.sh</span><br><span class="line">hadoop&gt; sbin/start-yarn.sh</span><br><span class="line">3.启动hive</span><br><span class="line">hive --service metastore &amp;--&gt;启动元数据</span><br><span class="line">hive --service hiveserver2 $--&gt;启动hive2</span><br><span class="line">hive&gt;</span><br></pre></td></tr></table></figure><h3 id="2-配置flume-flume-file-hdfs-conf"><a href="#2-配置flume-flume-file-hdfs-conf" class="headerlink" title="2.配置flume(flume-file-hdfs.conf)"></a>2.配置flume(flume-file-hdfs.conf)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">#Name</span><br><span class="line">a2.sources = r2</span><br><span class="line">a2.sinks = k2</span><br><span class="line">a2.channels = c2</span><br><span class="line"></span><br><span class="line">#Source</span><br><span class="line">a2.sources.r2.type = exec</span><br><span class="line">a2.sources.r2.command = tail -F /usr/local/src/hive/logs/hive.log</span><br><span class="line">a2.sources.r2.shell = /bin/bash -c</span><br><span class="line"></span><br><span class="line">#Sink</span><br><span class="line">a2.sinks.k2.type = hdfs</span><br><span class="line">a2.sinks.k2.hdfs.path = hdfs://10.7.75.210:9000/flume/%Y%m%d/%H</span><br><span class="line">a2.sinks.k2.hdfs.filePrefix = logs-</span><br><span class="line">a2.sinks.k2.hdfs.round = true</span><br><span class="line">a2.sinks.k2.hdfs.roundValue = 1</span><br><span class="line">a2.sinks.k2.hdfs.roundUnit = hour</span><br><span class="line">a2.sinks.k2.hdfs.useLocalTimeStamp = true</span><br><span class="line">a2.sinks.k2.hdfs.batchSize = 100</span><br><span class="line">a2.sinks.k2.hdfs.fileType = DataStream</span><br><span class="line">a2.sinks.k2.hdfs.rollInterval = 60</span><br><span class="line">a2.sinks.k2.hdfs.rollSize = 134217700</span><br><span class="line">a2.sinks.k2.hdfs.rollCount = 0</span><br><span class="line"></span><br><span class="line">#Channel</span><br><span class="line">a2.channels.c2.type = memory</span><br><span class="line">a2.channels.c2.capacity = 1000</span><br><span class="line">a2.channels.c2.transactionCapacity = 100</span><br><span class="line"></span><br><span class="line">#Bind</span><br><span class="line">a2.sources.r2.channels = c2</span><br><span class="line">a2.sinks.k2.channel = c2</span><br></pre></td></tr></table></figure><h2 id="三-实时监控一个文件夹上传HDFS"><a href="#三-实时监控一个文件夹上传HDFS" class="headerlink" title="(三).实时监控一个文件夹上传HDFS"></a>(三).实时监控一个文件夹上传HDFS</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#Name</span><br><span class="line">a3.sources = r3</span><br><span class="line">a3.sinks = k3</span><br><span class="line">a3.channels = c3</span><br><span class="line"></span><br><span class="line">#Source</span><br><span class="line">a3.sources.r3.type = spooldir</span><br><span class="line">a3.sources.r3.spoolDir = /usr/local/src/flume/upload</span><br><span class="line">a3.sources.r3.fileSuffix = .COM</span><br><span class="line">a3.sources.r3.fileHeader = true</span><br><span class="line">a3.sources.r3.ignordPattern = ([^ ]*\.tmp)</span><br><span class="line"></span><br><span class="line">#Sink</span><br><span class="line">a3.sinks.k3.type = hdfs</span><br><span class="line">a3.sinks.k3.hdfs.path = hdfs://master:9000/flume/upload/%Y%m%d/%H</span><br><span class="line">a3.sinks.k3.hdfs.filePrefix = upload-</span><br><span class="line">a3.sinks.k3.hdfs.round = true</span><br><span class="line">a3.sinks.k3.hdfs.roundValue = 1</span><br><span class="line">a3.sinks.k3.hdfs.roundUnit = hour</span><br><span class="line">a3.sinks.k3.hdfs.useLocalTimeStamp = true</span><br><span class="line">a3.sinks.k3.hdfs.batchSize = 100</span><br><span class="line">a3.sinks.k3.hdfs.fileType = DataStream</span><br><span class="line">a3.sinks.k3.hdfs.rollInterval = 60</span><br><span class="line">a3.sinks.k3.hdfs.rollSize = 134217700</span><br><span class="line">a3.sinks.k3.hdfs.rollCount = 0</span><br><span class="line"></span><br><span class="line">#Channel</span><br><span class="line">a3.channels.c3.type = memory</span><br><span class="line">a3.channels.c3.capacity = 1000</span><br><span class="line">a3.channels.c3.transactionCapacity = 100</span><br><span class="line"></span><br><span class="line">#Bind</span><br><span class="line">a3.sources.r3.channels = c3</span><br><span class="line">a3.sinks.k3.channel = c3</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="四-实时监控新增文件"><a href="#四-实时监控新增文件" class="headerlink" title="(四).实时监控新增文件"></a>(四).实时监控新增文件</h2><p>使用spooldir</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#Name</span><br><span class="line">a1.sources = r1</span><br><span class="line">a1.sinks = k1</span><br><span class="line">a1.channels = c1</span><br><span class="line"></span><br><span class="line">#Sources</span><br><span class="line">a1.sources.r1.type = spooldir</span><br><span class="line">a1.sources.r1.spoolDir = /usr/local/src/flume/logs/spooldir</span><br><span class="line">a1.sources.r1.fileSuffix = .COM</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#Sink</span><br><span class="line">a1.sinks.k1.type = hdfs</span><br><span class="line">a1.sinks.k1.hdfs.path = hdfs://master:9000/flume/%Y-%m-%d/%H</span><br><span class="line">a1.sinks.k1.hdfs.filePrefix = logs-</span><br><span class="line">a1.sinks.k1.hdfs.rollInterval = 60</span><br><span class="line">a1.sinks.k1.hdfs.rollSize = 13421770</span><br><span class="line">a1.sinks.k1.hdfs.round = true</span><br><span class="line">a1.sinks.k1.hdfs.roundValue = 1</span><br><span class="line">a1.sinks.k1.hdfs.roundUnit = hour</span><br><span class="line">a1.sinks.k1.hdfs.useLocalTimeStamp = true</span><br><span class="line">a1.sinks.k1.hdfs.rollCount = 0</span><br><span class="line"></span><br><span class="line">#Channel</span><br><span class="line">a1.channels.c1.type = memory</span><br><span class="line">a1.channels.c1.capacity = 1000</span><br><span class="line">a1.channels.c1.transactionCapacity = 100</span><br><span class="line"></span><br><span class="line">#Bind</span><br><span class="line">a1.sources.r1.channels = c1</span><br><span class="line">a1.sinks.k1.channel = c1</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="五-实时监控多个追加文件"><a href="#五-实时监控多个追加文件" class="headerlink" title="(五).实时监控多个追加文件"></a>(五).实时监控多个追加文件</h2><p>使用taildir+正则</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#Name</span><br><span class="line">a1.sources = r1</span><br><span class="line">a1.sinks = k1</span><br><span class="line">a1.channels = c1</span><br><span class="line"></span><br><span class="line">#Sources</span><br><span class="line">a1.sources.r1.type = taildir</span><br><span class="line">a1.sources.r1.filegroups = f1 f2</span><br><span class="line">a1.sources.r1.filegroups.f1 = /root/job/taildir/.*\.txt</span><br><span class="line">a1.sources.r1.filegroups.f2 = /root/job/taildir/.*\.log</span><br><span class="line">a1.sources.r1.positionFile = /root/job/position/position.json</span><br><span class="line"></span><br><span class="line">#Sink</span><br><span class="line">a1.sinks.k1.type = hdfs</span><br><span class="line">a1.sinks.k1.hdfs.path = hdfs://master:9000/flume/%Y-%m-%d/%H</span><br><span class="line">a1.sinks.k1.hdfs.filePrefix = logs-</span><br><span class="line">a1.sinks.k1.hdfs.rollInterval = 60</span><br><span class="line">a1.sinks.k1.hdfs.rollSize = 13421770</span><br><span class="line">a1.sinks.k1.hdfs.round = true</span><br><span class="line">a1.sinks.k1.hdfs.roundValue = 1</span><br><span class="line">a1.sinks.k1.hdfs.roundUnit = hour</span><br><span class="line">a1.sinks.k1.hdfs.useLocalTimeStamp = true</span><br><span class="line">a1.sinks.k1.hdfs.rollCount = 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#Channel</span><br><span class="line">a1.channels.c1.type = memory</span><br><span class="line">a1.channels.c1.capacity = 1000</span><br><span class="line">a1.channels.c1.transactionCapacity = 100</span><br><span class="line"></span><br><span class="line">#Bind</span><br><span class="line">a1.sources.r1.channels = c1</span><br><span class="line">a1.sinks.k1.channel = c1</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="Flume高阶"><a href="#Flume高阶" class="headerlink" title="Flume高阶"></a>Flume高阶</h1><h2 id="一-复制"><a href="#一-复制" class="headerlink" title="(一).复制"></a>(一).复制</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">使用 Flume-1 监控文件变动，Flume-1 将变动内容传递给 Flume-2，Flume-2 负责存储</span><br><span class="line">到 HDFS。同时 Flume-1 将变动内容传递给 Flume-3，Flume-3 负责输出到 Local </span><br><span class="line">FileSystem。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flume1.conf</span><br><span class="line"></span><br><span class="line">#Name</span><br><span class="line">a1.sources = r1</span><br><span class="line">a1.sinks = k1 k2</span><br><span class="line">a1.channels = c1 c2</span><br><span class="line"></span><br><span class="line">#Sources</span><br><span class="line">a1.sources.r1.type = taildir</span><br><span class="line">a1.sources.r1.filegroups = f1</span><br><span class="line">a1.sources.r1.filegroups.f1 = /usr/local/src/flume/job/taildir/.*\.txt</span><br><span class="line">a1.sources.r1.postitionFile =/usr/local/src/flume/job/position/position.json</span><br><span class="line"></span><br><span class="line">#Channel selector</span><br><span class="line">a1.sources.r1.selector.type = replicating</span><br><span class="line"></span><br><span class="line">#Channel</span><br><span class="line">a1.channels.c1.type = memory</span><br><span class="line">a1.channels.c1.capacity = 10000</span><br><span class="line">a1.channels.c1.transactionCapacity = 100</span><br><span class="line"></span><br><span class="line">a1.channels.c2.type = memory</span><br><span class="line">a1.channels.c2.capacity = 10000</span><br><span class="line">a1.channels.c2.transactionCapacity = 100</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#Sink</span><br><span class="line">a1.sinks.k1.type = avro</span><br><span class="line">a1.sinks.k1.hostname = localhost</span><br><span class="line">a1.sinks.k1.port = 7777</span><br><span class="line"></span><br><span class="line">a1.sinks.k2.type = avro</span><br><span class="line">a1.sinks.k2.hostname = localhost</span><br><span class="line">a1.sinks.k2.port = 8888</span><br><span class="line"></span><br><span class="line">#Bind</span><br><span class="line">a1.sources.r1.channels = c1 c2</span><br><span class="line">a1.sinks.k1.channel = c1</span><br><span class="line">a1.sinks.k2.channel = c2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flume2.conf</span><br><span class="line"></span><br><span class="line">#Name</span><br><span class="line">a2.sources = r1</span><br><span class="line">a2.sinks = k1</span><br><span class="line">a2.channels = c1</span><br><span class="line"></span><br><span class="line">#Source</span><br><span class="line">a2.sources.r1.type = avro</span><br><span class="line">a2.sources.r1.bind = localhost</span><br><span class="line">a2.sources.r1.port = 7777</span><br><span class="line"></span><br><span class="line">#Sink</span><br><span class="line">a2.sinks.k1.type = hdfs</span><br><span class="line">a2.sinks.k1.hdfs.path = hdfs://master:9000/flume/%Y-%m-%d/%H</span><br><span class="line">a2.sinks.k1.hdfs.filePrefix = beihai-</span><br><span class="line">a2.sinks.k1.hdfs.round = true</span><br><span class="line">a2.sinks.k1.hdfs.roundValue = 1</span><br><span class="line">a2.sinks.k1.hdfs.roundUnit = hour</span><br><span class="line">a2.sinks.k1.hdfs.useLocalTimeStamp = true</span><br><span class="line">a2.sinks.k1.hdfs.batchSize = 100</span><br><span class="line">a2.sinks.k1.hdfs.fileType = DataStream</span><br><span class="line">a2.sinks.k1.hdfs.rollInterval = 60</span><br><span class="line">a2.sinks.k1.hdfs.rollSize = 134217700</span><br><span class="line">a2.sinks.k1.hdfs.rollCount = 0</span><br><span class="line"></span><br><span class="line">#Channel</span><br><span class="line">a2.channels.c1.type = memory</span><br><span class="line">a2.channels.c1.capacity = 10000</span><br><span class="line">a2.channels.c1.transactionCapacity = 100</span><br><span class="line"></span><br><span class="line">#Bind</span><br><span class="line">a2.sources.r1.channels = c1</span><br><span class="line">a2.sinks.k1.channel = c1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flume3.conf</span><br><span class="line"></span><br><span class="line">#Name</span><br><span class="line">a3.sources = r1</span><br><span class="line">a3.sinks = k1</span><br><span class="line">a3.channels = c1</span><br><span class="line"></span><br><span class="line">#Source</span><br><span class="line">a3.sources.r1.type = avro</span><br><span class="line">a3.sources.r1.bind = localhost</span><br><span class="line">a3.sources.r1.port = 8888</span><br><span class="line"></span><br><span class="line">#Channel</span><br><span class="line">a3.channels.c1.type = memory</span><br><span class="line">a3.channels.c1.capacity = 10000</span><br><span class="line">a3.channels.c1.transactionCapacity = 100</span><br><span class="line"></span><br><span class="line">#Sink</span><br><span class="line">a3.sinks.k1.type = file_roll</span><br><span class="line">a3.sinks.k1.sink.directory =/usr/local/src/flume/job/fileroll</span><br><span class="line"></span><br><span class="line">#Bind</span><br><span class="line">a3.sources.r1.channels = c1</span><br><span class="line">a3.sinks.k1.channel = c1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">启动：</span><br><span class="line">bin/flume-ng agent --conf conf/ --conf-file /usr/local/src/flume/job/fuzhi/flume1.conf --name a1 -Dflume.root.logger=INFO,console</span><br></pre></td></tr></table></figure><h2 id="二-聚合"><a href="#二-聚合" class="headerlink" title="(二).聚合"></a>(二).聚合</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">hadoop102 上的 Flume-1 监控文件/opt/module/group.log，</span><br><span class="line">hadoop103 上的 Flume-2 监控某一个端口的数据流，</span><br><span class="line">Flume-1 与 Flume-2 将数据发送给 hadoop104 上的 Flume-3，Flume-3 将最终数据打印</span><br><span class="line">到控制台。</span><br><span class="line"></span><br><span class="line">flume1</span><br><span class="line"></span><br><span class="line">#Name</span><br><span class="line">a1.sources = r1</span><br><span class="line">a1.sinks = k1</span><br><span class="line">a1.channels = c1</span><br><span class="line"></span><br><span class="line">#Source</span><br><span class="line">a1.sources.r1.type = netcat</span><br><span class="line">a1.sources.r1.bind = </span><br></pre></td></tr></table></figure><h1 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">导入依赖</span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flume<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flume-ng-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">package Flume.interceptor;</span><br><span class="line"></span><br><span class="line">import org.apache.flume.Context;</span><br><span class="line">import org.apache.flume.Event;</span><br><span class="line">import org.apache.flume.interceptor.Interceptor;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">public class TypeInterceptor implements Interceptor &#123;</span><br><span class="line"></span><br><span class="line">    //声明一个存放事件的集合</span><br><span class="line">    private List&lt;Event&gt; addHeaderEvents;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //初始化</span><br><span class="line">    @Override</span><br><span class="line">    public void initialize() &#123;</span><br><span class="line"></span><br><span class="line">        addHeaderEvents = new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //单个事件拦截</span><br><span class="line">    @Override</span><br><span class="line">    public Event intercept(Event event) &#123;</span><br><span class="line"></span><br><span class="line">        //1.获取事件中的头信息</span><br><span class="line">        Map&lt;String, String&gt; headers = event.getHeaders();</span><br><span class="line"></span><br><span class="line">        //2.获取事件中的body</span><br><span class="line">        String body = new String(event.getBody());</span><br><span class="line"></span><br><span class="line">        //3.根据body中是否有hello来添加怎样的头信息</span><br><span class="line">        if (body.contains(&quot;hello&quot;))&#123;</span><br><span class="line">            //4.添加头信息</span><br><span class="line">            headers.put(&quot;type&quot;,&quot;atguigu&quot;);</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            headers.put(&quot;type&quot;,&quot;beihai&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return event;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //批量事件拦截</span><br><span class="line">    @Override</span><br><span class="line">    public List&lt;Event&gt; intercept(List&lt;Event&gt; events) &#123;</span><br><span class="line">        //1.清空集合</span><br><span class="line">        addHeaderEvents.clear();</span><br><span class="line"></span><br><span class="line">        //2.</span><br><span class="line">        for (Event event : events) &#123;</span><br><span class="line">            addHeaderEvents.add(intercept(event));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return addHeaderEvents;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void close() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static class Builder implements Interceptor.Builder&#123;</span><br><span class="line">        @Override</span><br><span class="line">        public Interceptor build() &#123;</span><br><span class="line">            return new TypeInterceptor();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void configure(Context context) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">打包发到flume的lib目录下</span><br><span class="line"></span><br><span class="line">与Kafka对接的时候</span><br><span class="line">当头文件的k为topic（first,second）时候，就会覆盖原来的first配置</span><br></pre></td></tr></table></figure><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20221112155634146.png" alt="image-20221112155634146"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">flume1</span><br><span class="line"></span><br><span class="line">#Name</span><br><span class="line">a1.sources = r1</span><br><span class="line">a1.sinks = k1 k2</span><br><span class="line">a1.channels = c1 c2</span><br><span class="line"></span><br><span class="line">#Source</span><br><span class="line">a1.sources.r1.type = netcat</span><br><span class="line">a1.sources.r1.bind = localhost</span><br><span class="line">a1.sources.r1.port = 44444</span><br><span class="line"></span><br><span class="line">#Interector</span><br><span class="line">a1.sources.r1.interceptors = i1</span><br><span class="line">a1.sources.r1.interceptors.i1.type = Flume.interceptor.TypeInterceptor$Builder</span><br><span class="line"></span><br><span class="line">#Channel Selector</span><br><span class="line">a1.sources.r1.selector.type = multiplexing</span><br><span class="line">a1.sources.r1.selector.header = type</span><br><span class="line">a1.sources.r1.selector.mapping.atguigu = c1</span><br><span class="line">a1.sources.r1.selector.mapping.beihai = c2</span><br><span class="line"></span><br><span class="line">#Sink</span><br><span class="line">a1.sinks.k1.type = avro</span><br><span class="line">a1.sinks.k1.hostname = slave1</span><br><span class="line">a1.sinks.k1.port = 4141</span><br><span class="line"></span><br><span class="line">a1.sinks.k2.type= avro</span><br><span class="line">a1.sinks.k2.hostname = slave2</span><br><span class="line">a1.sinks.k2.port = 4242</span><br><span class="line"></span><br><span class="line">#Channel</span><br><span class="line">a1.channels.c1.type = memory</span><br><span class="line">a1.channels.c1.capacity = 1000</span><br><span class="line">a1.channels.c1.transactionCapacity = 100</span><br><span class="line"></span><br><span class="line">a1.channels.c2.type = memory</span><br><span class="line">a1.channels.c2.capacity = 1000</span><br><span class="line">a1.channels.c2.transactionCapacity = 100</span><br><span class="line"></span><br><span class="line">#Bind</span><br><span class="line">a1.sources.r1.channels = c1 c2</span><br><span class="line">a1.sinks.k1.channel = c1</span><br><span class="line">a1.sinks.k2.channel = c2</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">flume2</span><br><span class="line"></span><br><span class="line">a1.sources = r1</span><br><span class="line">a1.sinks = k1</span><br><span class="line">a1.channels = c1</span><br><span class="line"></span><br><span class="line">a1.sources.r1.type = avro</span><br><span class="line">a1.sources.r1.bind = slave1</span><br><span class="line">a1.sources.r1.port = 4141</span><br><span class="line"></span><br><span class="line">a1.sinks.k1.type = logger</span><br><span class="line"></span><br><span class="line">a1.channels.c1.type = memory</span><br><span class="line">a1.channels.c1.capacity = 1000</span><br><span class="line">a1.channels.c1.transactionCapacity = 100</span><br><span class="line"></span><br><span class="line">a1.sources.r1.channels = c1</span><br><span class="line">a1.sinks.k1.channel = c1</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">flume3</span><br><span class="line"></span><br><span class="line">a1.sources = r1</span><br><span class="line">a1.sinks = k1</span><br><span class="line">a1.channels = c1</span><br><span class="line"></span><br><span class="line">a1.sources.r1.type = avro</span><br><span class="line">a1.sources.r1.bind = slave2</span><br><span class="line">a1.sources.r1.port = 4242</span><br><span class="line"></span><br><span class="line">a1.sinks.k1.type = logger</span><br><span class="line"></span><br><span class="line">a1.channels.c1.type = memory</span><br><span class="line">a1.channels.c1.capacity = 1000</span><br><span class="line">a1.channels.c1.transactionCapacity = 100</span><br><span class="line"></span><br><span class="line">a1.sources.r1.channels = c1</span><br><span class="line">a1.sinks.k1.channel = c1</span><br></pre></td></tr></table></figure><h1 id="配置问题"><a href="#配置问题" class="headerlink" title="配置问题"></a>配置问题</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">1.hive的日志</span><br><span class="line">先找到所在路径 /usr/local/src/hive/conf/</span><br><span class="line">(1).重新拷贝删改后缀</span><br><span class="line">cp hive-log4j2.properties-template hive-log4j2.properties</span><br><span class="line"></span><br><span class="line">(2).改变配置信息</span><br><span class="line">property.hive.log.dir = /usr/local/src/hive/logs</span><br><span class="line">property.hive.log.file = hive.log</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.八个日志级别</span><br><span class="line">-Dflume.root.logger=INFO,console</span><br><span class="line">https://blog.csdn.net/qq_42428269/article/details/121597545</span><br><span class="line"></span><br><span class="line">3.交换文件 &quot;.flume2.conf.swp&quot; 已存在</span><br><span class="line">先使用ls -a找到隐藏的文件</span><br><span class="line">rm -f 隐藏的文件将其删除即可。</span><br></pre></td></tr></table></figure><h1 id="有意思的点："><a href="#有意思的点：" class="headerlink" title="有意思的点："></a>有意思的点：</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">(1).xshell开启缓慢</span><br><span class="line">```</span><br><span class="line">sudo vim /etc/ssh/sshd_config</span><br><span class="line">```</span><br><span class="line">将UseDNS 调为NO 不要反向解析</span><br><span class="line">(2).netcat的端口范围0~65535</span><br><span class="line">安装nc：sudo yum install -y nc</span><br><span class="line">nc手册：man nc</span><br><span class="line">(3).exec sources命令就是可以使用linux的命令来操作另外一套命令</span><br><span class="line">(4).echo &gt;&gt; 追加数据</span><br><span class="line">(5).#Bind 时候一个source可以对应多个channel所以用channels</span><br><span class="line">一个sink只能对应一个channel所以用channel</span><br><span class="line">(6).ctrl+H 替换</span><br><span class="line">(7).实时监控新文件spooldir</span><br><span class="line">(8).创建新文件touch</span><br><span class="line">(9).实时监控多个追加文件taildir</span><br><span class="line">(10).断点续传：positionFile 根据上一次所记录的数据然后直接追加添加数据这里需要添加.json的文件作为记录</span><br><span class="line">```</span><br><span class="line">/root/job/position/position.json</span><br><span class="line">```</span><br><span class="line">(11).Memory Channel 基于内存的缓存  速度快 不安全</span><br><span class="line"> File Channel 基于磁盘的缓存 速度慢 安全</span><br></pre></td></tr></table></figure><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20221107170854806.png" alt="image-20221107170854806"></p>]]></content>
      
      
      <categories>
          
          <category> 大数据 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Kafka</title>
      <link href="/2022/12/08/Kafka/"/>
      <url>/2022/12/08/Kafka/</url>
      
        <content type="html"><![CDATA[<h1 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h1><p>kafka和flume都是日志系统。kafka是分布式消息中间件，自带存储，提供push和pull存取数据功能。flume分为agent（数据采集器）[source channel sink]。</p><p>(一).启动,停止</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-server-start.sh -daemon config/server.properties </span><br><span class="line">bin/kafka-server-stop.sh</span><br></pre></td></tr></table></figure><p>(二).<a href="https://blog.csdn.net/weixin_42854904/article/details/118424361?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=%E2%80%93bootstrap-server%20%E5%92%8C%20--zookeepe&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-1-118424361.142">两种方式</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.bootstrap-server master:9092 </span><br><span class="line">2.zookeeper master:2181 </span><br><span class="line"></span><br><span class="line">kafka 2.2版本之后才能用boot</span><br></pre></td></tr></table></figure><p>(三).创建topic</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-topic.sh --zookeeper master:2181/kafka --topic first --create --partitions --replication-factor 2</span><br></pre></td></tr></table></figure><p>这里，出现的问题是因为<a href="https://blog.csdn.net/u010003835/article/details/106956702?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522166804874416782414952137%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=166804874416782414952137&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-2-106956702-null-null.142^v63^control,201^v3^control_1,213^v2^t3_control2&amp;utm_term=ERROR%20org.apache.kafka.common.errors.InvalidReplicationFactorException%3A%20Replication%20factor%3A%203%20larger%20than%20available%20brokers%3A%201.&amp;spm=1018.2226.3001.4187">Kafka</a> Broker 在 zookeeper 存储的路径并不是根目录，而是 <strong>/kafka</strong> 路径</p><p>对于之前的指令，只需要增加 kafka 的config目录下的server.properties的存储路径后缀 ：zookeeper.connect=master:2181,slave1:2181,slave2:2181 <strong>/kafka</strong> 即可</p><p>(四).创建脚本</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#! /bin/bash</span><br><span class="line"></span><br><span class="line">case $1 in </span><br><span class="line">&quot;start&quot;)&#123;</span><br><span class="line"></span><br><span class="line">for i in master slave1 slave2</span><br><span class="line">do</span><br><span class="line">echo &quot;***********kafka $i 启动 ***********&quot;</span><br><span class="line">ssh $i &quot;/usr/local/src/kafka/bin/kafka-server-start.sh -daemon /usr/local/src/kafka/config/server.properties&quot;</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">&#125;;;</span><br><span class="line">&quot;stop&quot;)&#123;</span><br><span class="line"></span><br><span class="line">for i in master slave1 slave2</span><br><span class="line">do</span><br><span class="line">echo &quot;***********kafka $i 关闭 ***********&quot;</span><br><span class="line">ssh $i &quot;/usr/local/src/kafka/bin/kafka-server-stop.sh&quot;</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">&#125;;;</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">创建：kk.sh</span><br><span class="line">给权限：chmod 777 kk.sh</span><br></pre></td></tr></table></figure><p>(五).生产者，消费者</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.生产者：</span><br><span class="line">[root@master kafka]# bin/kafka-console-producer.sh --topic first --broker-list master:9092</span><br><span class="line"></span><br><span class="line">2.消费者：</span><br><span class="line">[root@slave1 kafka]# bin/kafka-console-consumer.sh --topic first --bootstrap-server master:9092</span><br><span class="line"></span><br><span class="line">从头消费：</span><br><span class="line">[root@slave2 kafka]# bin/kafka-console-consumer.sh --topic first --bootstrap-server master:9092 --from-beginning</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>(六).彻底删除</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.先删除kafka的logs rm-rf</span><br><span class="line">2.再删除zookeeper中的zkData目录下的Version2</span><br><span class="line">3.进入zkCli.sh查看是否只有zookeeper</span><br></pre></td></tr></table></figure><p>(七).对topic分析</p><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20221110163111738.png" alt="image-20221110163111738"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.indesx 索引机制</span><br><span class="line">.log 存放真实数据</span><br></pre></td></tr></table></figure><h1 id="消费者"><a href="#消费者" class="headerlink" title="消费者"></a>消费者</h1><h2 id="自定义消费者组"><a href="#自定义消费者组" class="headerlink" title="自定义消费者组"></a>自定义消费者组</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master config]# vim consumer.properties</span><br></pre></td></tr></table></figure><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20221111082616231.png" alt="image-20221111082616231"></p><h2 id="消费自定义消费者组"><a href="#消费自定义消费者组" class="headerlink" title="消费自定义消费者组"></a>消费自定义消费者组</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master kafka]# bin/kafka-console-consumer.sh --bootstrap-server master:9092 --topic bigdata --consumer.config config/consumer.properties </span><br></pre></td></tr></table></figure><h2 id="消费者API"><a href="#消费者API" class="headerlink" title="消费者API"></a>消费者API</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">自动提交</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">package</span> com.atguigu.consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecord;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.ConsumerRecords;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.consumer.KafkaConsumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConsumer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.创建消费者信息</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.给配置信息赋值</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//连接集群</span></span><br><span class="line">        properties.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG,<span class="string">&quot;master:9092&quot;</span>);</span><br><span class="line">        <span class="comment">//开启自动提交</span></span><br><span class="line">        properties.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG,<span class="literal">true</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//延迟提交</span></span><br><span class="line"><span class="comment">//        properties.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG,false);</span></span><br><span class="line">        <span class="comment">//自动提交的延时</span></span><br><span class="line">        properties.put(ConsumerConfig.AUTO_COMMIT_INTERVAL_MS_CONFIG,<span class="string">&quot;1000&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//Key,Value的序列化</span></span><br><span class="line">        properties.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG,<span class="string">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span>);</span><br><span class="line">        properties.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG,<span class="string">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//消费者组</span></span><br><span class="line">        properties.put(ConsumerConfig.GROUP_ID_CONFIG,<span class="string">&quot;bigdata&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//重置消费者的offset</span></span><br><span class="line"><span class="comment">//        properties.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG,&quot;earliest&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建消费者</span></span><br><span class="line">        KafkaConsumer&lt;String, String&gt; consumer = <span class="keyword">new</span> <span class="title class_">KafkaConsumer</span>&lt;&gt;(properties);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//订阅主题</span></span><br><span class="line">        consumer.subscribe(Arrays.asList(<span class="string">&quot;first&quot;</span>,<span class="string">&quot;second&quot;</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="comment">//获取数据</span></span><br><span class="line">            ConsumerRecords&lt;String, String&gt; consumerRecords = consumer.poll(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//解析并打印consumerRecords</span></span><br><span class="line">            <span class="keyword">for</span> (ConsumerRecord&lt;String, String&gt; consumerRecord : consumerRecords) &#123;</span><br><span class="line"></span><br><span class="line">                System.out.println(consumerRecord.key() + <span class="string">&quot;--&quot;</span> + consumerRecord.value());</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="生产者"><a href="#生产者" class="headerlink" title="生产者"></a>生产者</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master kafka]# bin/kafka-console-producer.sh --topic clicks --broker-list master:9092</span><br></pre></td></tr></table></figure><h2 id="生产者API"><a href="#生产者API" class="headerlink" title="生产者API"></a>生产者API</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">普通API</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">package</span> com.atguigu.producer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.KafkaProducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.ProducerConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.ProducerRecord;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyProducer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.创建Kafka生产者的配置信息</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.指定连接的Kafka级别</span></span><br><span class="line">        properties.put(<span class="string">&quot;bootstrap.servers&quot;</span>,<span class="string">&quot;master:9092&quot;</span>);</span><br><span class="line"><span class="comment">//        properties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.ACK应答机制</span></span><br><span class="line">        properties.put(<span class="string">&quot;acks&quot;</span>,<span class="string">&quot;all&quot;</span>);</span><br><span class="line"><span class="comment">//        properties.put(ProducerConfig.ACKS_CONFIG,&quot;all&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.重试次数</span></span><br><span class="line">        properties.put(<span class="string">&quot;reties&quot;</span>,<span class="number">3</span>);</span><br><span class="line"><span class="comment">//        properties.put(ProducerConfig.RETRIES_CONFIG,3);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//5.批次大小</span></span><br><span class="line">        properties.put(<span class="string">&quot;batch.size&quot;</span>,<span class="string">&quot;16384&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//6.等待时间</span></span><br><span class="line">        properties.put(<span class="string">&quot;linger.ms&quot;</span>,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//7.缓冲区大小</span></span><br><span class="line">        properties.put(<span class="string">&quot;buffer.memory&quot;</span>,<span class="number">33554432</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//8.Key,Value的序列化类</span></span><br><span class="line">        properties.put(<span class="string">&quot;key.serializer&quot;</span>,</span><br><span class="line">                <span class="string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span>);</span><br><span class="line"></span><br><span class="line">        properties.put(<span class="string">&quot;value.serializer&quot;</span>,</span><br><span class="line">                <span class="string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//9.创建生产者对象</span></span><br><span class="line">        KafkaProducer&lt;String, String&gt; producer = <span class="keyword">new</span> <span class="title class_">KafkaProducer</span>&lt;String, String&gt;(properties);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//10.发送</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            producer.send(<span class="keyword">new</span> <span class="title class_">ProducerRecord</span>&lt;String, String&gt;(<span class="string">&quot;first&quot;</span>,<span class="string">&quot;beihai--&quot;</span> + i));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        Thread.sleep(100);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//11.关闭</span></span><br><span class="line">        producer.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">回调API</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.atguigu.producer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 回调函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CallBackMyProducer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.配置信息</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line"></span><br><span class="line">        properties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG,<span class="string">&quot;master:9092&quot;</span>);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            快捷搜索 shift + shift -&gt; StringSerializer -&gt; 复制全局路径</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG,</span><br><span class="line">                <span class="string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span>);</span><br><span class="line">        properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG,</span><br><span class="line">                <span class="string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.创建生产者对象</span></span><br><span class="line">        KafkaProducer&lt;String, String&gt; producer = <span class="keyword">new</span> <span class="title class_">KafkaProducer</span>&lt;String, String&gt;(properties);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        //模拟分区创建key</span></span><br><span class="line"><span class="comment">//        ArrayList&lt;String&gt; list = new ArrayList&lt;&gt;();</span></span><br><span class="line"><span class="comment">//        list.add(&quot;a&quot;);</span></span><br><span class="line"><span class="comment">//        list.add(&quot;b&quot;);</span></span><br><span class="line"><span class="comment">//        list.add(&quot;c&quot;);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.发送数据   这个如果用scala写是真的蛇皮</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="comment">//key没什么用，就是在缺分区的时候做哈希，按照key的哈希值模拟分区数</span></span><br><span class="line">            producer.send(<span class="keyword">new</span> <span class="title class_">ProducerRecord</span>&lt;String, String&gt;(<span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;beihai&quot;</span>, <span class="string">&quot;beihai--&quot;</span> + i), <span class="keyword">new</span> <span class="title class_">Callback</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCompletion</span><span class="params">(RecordMetadata metadata, Exception exception)</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (exception == <span class="literal">null</span>) &#123;</span><br><span class="line">                        System.out.println(metadata.partition() + <span class="string">&quot;--&quot;</span> + metadata.offset());</span><br><span class="line">                    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                        exception.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//关闭资源</span></span><br><span class="line">        producer.close();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h1><h2 id="时间拦截器"><a href="#时间拦截器" class="headerlink" title="时间拦截器"></a>时间拦截器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.ProducerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.ProducerRecord;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.RecordMetadata;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TimeInterceptor</span> <span class="keyword">implements</span> <span class="title class_">ProducerInterceptor</span>&lt;String, String&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(Map&lt;String, ?&gt; configs)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ProducerRecord&lt;String, String&gt; <span class="title function_">onSend</span><span class="params">(ProducerRecord&lt;String, String&gt; record)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.取出数据</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> record.value();</span><br><span class="line"></span><br><span class="line">     <span class="comment">/*</span></span><br><span class="line"><span class="comment">    时间戳拦截器，取出具体的数据，返回值的数据类型是关键，创建一个新的对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ProducerRecord</span>&lt;String,String&gt;(record.topic(),record.partition()</span><br><span class="line">        , record.key(), System.currentTimeMillis()+<span class="string">&quot;,&quot;</span>+value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAcknowledgement</span><span class="params">(RecordMetadata metadata, Exception exception)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="数量拦截器"><a href="#数量拦截器" class="headerlink" title="数量拦截器"></a>数量拦截器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.ProducerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.ProducerRecord;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.RecordMetadata;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CounterInterceptor</span> <span class="keyword">implements</span> <span class="title class_">ProducerInterceptor</span>&lt;String,String&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> success;</span><br><span class="line">    <span class="type">int</span> error;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(Map&lt;String, ?&gt; configs)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ProducerRecord&lt;String, String&gt; <span class="title function_">onSend</span><span class="params">(ProducerRecord&lt;String, String&gt; record)</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> record;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAcknowledgement</span><span class="params">(RecordMetadata metadata, Exception exception)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (metadata != <span class="literal">null</span>)&#123;</span><br><span class="line">            success++;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            error++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;success:&quot;</span> + success );</span><br><span class="line">        System.out.println(<span class="string">&quot;error:&quot;</span> + error );</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="拦截器实例"><a href="#拦截器实例" class="headerlink" title="拦截器实例"></a>拦截器实例</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line"></span><br><span class="line">        properties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG,<span class="string">&quot;master:9092&quot;</span>);</span><br><span class="line">        properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG,<span class="string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span>);</span><br><span class="line">        properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG,<span class="string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//添加拦截器</span></span><br><span class="line">        ArrayList&lt;String&gt; interceptors = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        interceptors.add(<span class="string">&quot;com.atguigu.interceptor.TimeInterceptor&quot;</span>);</span><br><span class="line">        interceptors.add(<span class="string">&quot;com.atguigu.interceptor.CounterInterceptor&quot;</span>);</span><br><span class="line">        properties.put(ProducerConfig.INTERCEPTOR_CLASSES_CONFIG,interceptors);</span><br><span class="line"></span><br><span class="line">        KafkaProducer&lt;String, String&gt; producer = <span class="keyword">new</span> <span class="title class_">KafkaProducer</span>&lt;String, String&gt;(properties);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            producer.send(<span class="keyword">new</span> <span class="title class_">ProducerRecord</span>&lt;String, String&gt;(<span class="string">&quot;first&quot;</span>, <span class="number">0</span>,<span class="string">&quot;beihai&quot;</span>,<span class="string">&quot;beihai--&quot;</span> + i), <span class="keyword">new</span> <span class="title class_">Callback</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCompletion</span><span class="params">(RecordMetadata metadata, Exception exception)</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (exception == <span class="literal">null</span>) &#123;</span><br><span class="line">                        System.out.println(metadata.partition() + <span class="string">&quot;--&quot;</span> + metadata.offset());</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        exception.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        producer.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="Kafka-flume对接"><a href="#Kafka-flume对接" class="headerlink" title="Kafka-flume对接"></a>Kafka-flume对接</h1><h2 id="1-简单案例利用netcat"><a href="#1-简单案例利用netcat" class="headerlink" title="1.简单案例利用netcat"></a>1.简单案例利用netcat</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">flume配置：</span><br><span class="line"></span><br><span class="line">#Name</span><br><span class="line">a1.sources = r1</span><br><span class="line">a1.sinks = k1</span><br><span class="line">a1.channels = c1</span><br><span class="line"></span><br><span class="line">#Source</span><br><span class="line">a1.sources.r1.type = netcat</span><br><span class="line">a1.sources.r1.bind = localhost</span><br><span class="line">a1.sources.r1.port = 44444</span><br><span class="line"></span><br><span class="line">#Sink</span><br><span class="line">a1.sinks.k1.type = org.apache.flume.sink.kafka.KafkaSink</span><br><span class="line">a1.sinks.k1.kafka.topic = mytopic</span><br><span class="line">a1.sinks.k1.kafka.bootstrap.servers = master:9092</span><br><span class="line">a1.sinks.k1.kafka.flumeBatchSize = 20</span><br><span class="line">a1.sinks.k1.kafka.producer.acks = 1</span><br><span class="line">a1.sinks.k1.kafka.producer.linger.ms = 1</span><br><span class="line"></span><br><span class="line">#Channel</span><br><span class="line">a1.channels.c1.type = memory</span><br><span class="line">a1.channels.c1.capacity = 1000</span><br><span class="line">a1.channels.c1.transactionCapacity = 100</span><br><span class="line"></span><br><span class="line">#Bind</span><br><span class="line">a1.sources.r1.channels = c1</span><br><span class="line">a1.sinks.k1.channel = c1</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2-使用多路复用模式"><a href="#2-使用多路复用模式" class="headerlink" title="2.使用多路复用模式"></a>2.使用多路复用模式</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1、在Master节点使用Flume采集实时数据生成器10050端口的socket数据，将数据存入到Kafka的Topic中（Topic名称为order，分区数为4），使用Kafka自带的消费者消费order（Topic）中的数据，将前2条数据的结果截图粘贴至对应报告中；</span><br><span class="line">2、采用多路复用模式，Flume接收数据注入kafka 的同时，将数据备份到HDFS目录/user/test/flumebackup下，将查看备份目录下的第一个文件的前2条数据的命令与结果截图粘贴至对应报告中。</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">flume1</span><br><span class="line"></span><br><span class="line">#Name</span><br><span class="line">a1.sources = r1</span><br><span class="line">a1.sinks = k1 k2</span><br><span class="line">a1.channels = c1 c2</span><br><span class="line"></span><br><span class="line">#Source</span><br><span class="line">a1.sources.r1.type = netcat</span><br><span class="line">a1.sources.r1.bind = localhost</span><br><span class="line">a1.sources.r1.port = 10050</span><br><span class="line"></span><br><span class="line">#Sink</span><br><span class="line">a1.sinks.k1.type = avro</span><br><span class="line">a1.sinks.k1.hostname = localhost</span><br><span class="line">a1.sinks.k1.port = 7777</span><br><span class="line"></span><br><span class="line">a1.sinks.k2.type = avro</span><br><span class="line">a1.sinks.k2.hostname = localhost</span><br><span class="line">a1.sinks.k2.port = 8888</span><br><span class="line"></span><br><span class="line">#Channel selector</span><br><span class="line">a1.sources.r1.selector.type = replicating</span><br><span class="line"></span><br><span class="line">#Channel</span><br><span class="line">a1.channels.c1.type = memory</span><br><span class="line">a1.channels.c1.capacity = 10000</span><br><span class="line">a1.channels.c1.transactionCapacity = 100</span><br><span class="line"></span><br><span class="line">a1.channels.c2.type = memory</span><br><span class="line">a1.channels.c2.capacity = 10000</span><br><span class="line">a1.channels.c2.transactionCapacity = 100</span><br><span class="line"></span><br><span class="line">#Bind</span><br><span class="line">a1.sources.r1.channels = c1 c2</span><br><span class="line">a1.sinks.k1.channel = c1</span><br><span class="line">a1.sinks.k2.channel = c2</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">kafka</span><br><span class="line"></span><br><span class="line">#Name</span><br><span class="line">a2.sources = r1</span><br><span class="line">a2.sinks = k1</span><br><span class="line">a2.channels = c1</span><br><span class="line"></span><br><span class="line">#Source</span><br><span class="line">a2.sources.r1.type = avro</span><br><span class="line">a2.sources.r1.bind = localhost</span><br><span class="line">a2.sources.r1.port = 7777</span><br><span class="line"></span><br><span class="line">#Sink</span><br><span class="line">a2.sinks.k1.type = org.apache.flume.sink.kafka.KafkaSink</span><br><span class="line">a2.sinks,k1.kafka.topic = order</span><br><span class="line">a2.sinks.k1.kafka.bootstrap.servers = master:9092</span><br><span class="line">a2.sinks.k1.kafka.flumeBatchSize = 20</span><br><span class="line">a2.sinks.k1.kafka.producer.acks = 1</span><br><span class="line">a2.sinks.k1.kafka.producer.linger.ms = 1</span><br><span class="line"></span><br><span class="line">#Channel</span><br><span class="line">a2.channels.c1.type = memory</span><br><span class="line">a2.channels.c1.capacity = 1000</span><br><span class="line">a2.channels.c1.transactionCapacity = 100</span><br><span class="line"></span><br><span class="line">#Bind</span><br><span class="line">a2.sources.r1.channels = c1</span><br><span class="line">a2.sinks.k1.channel = c1</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">HDFS</span><br><span class="line"></span><br><span class="line">#Name</span><br><span class="line">a3.sources = r1</span><br><span class="line">a3.sinks = k1</span><br><span class="line">a3.channels = c1</span><br><span class="line"></span><br><span class="line">#Source</span><br><span class="line">a3.sources.r1.type =avro</span><br><span class="line">a3.sources.r1.bind = localhost</span><br><span class="line">a3.sources.r1.port = 8888</span><br><span class="line"></span><br><span class="line">#Sink</span><br><span class="line">a3.sinks.k1.type = hdfs</span><br><span class="line">a3.sinks.k1.hdfs.path = hdfs://master:9000/user/test/flumebackup</span><br><span class="line">a3.sinks.k1.hdfs.filePrefix = beihai-</span><br><span class="line">a3.sinks.k1.hdfs.round = true</span><br><span class="line">a3.sinks.k1.hdfs.roundValue = 1</span><br><span class="line">a3.sinks.k1.hdfs.roundUnit = hour</span><br><span class="line">a3.sinks.k1.hdfs.useLocalTimeStamp = true</span><br><span class="line">a3.sinks.k1.hdfs.batchSize = 100</span><br><span class="line">a3.sinks.k1.hdfs.fileType = DataStream</span><br><span class="line">a3.sinks.k1.hdfs.rollInterval = 60</span><br><span class="line">a3.sinks.k1.hdfs.rollSize = 134217700</span><br><span class="line">a3.sinks.k1.hdfs.rollCount = 0</span><br><span class="line"></span><br><span class="line">#Channel</span><br><span class="line">a3.channels.c1.type = memory</span><br><span class="line">a3.channels.c1.capacity = 10000</span><br><span class="line">a3.channels.c1.transactionCapacity = 100</span><br><span class="line"></span><br><span class="line">#Bind</span><br><span class="line">a3.sources.r1.channels = c1</span><br><span class="line">a3.sinks.k1.channel = c1</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# hadoop fs -cat /user/test/flumebackup/logs-.1668222346787 |head -2</span><br><span class="line">156</span><br><span class="line">5322</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 大数据 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>SparkStreaming</title>
      <link href="/2022/12/08/SparkStreaming/"/>
      <url>/2022/12/08/SparkStreaming/</url>
      
        <content type="html"><![CDATA[<h2 id="SparkStreaming"><a href="#SparkStreaming" class="headerlink" title="SparkStreaming"></a>SparkStreaming</h2><p>准实时(秒，分钟)，微批次(多长时间处理一次)的数据处理框架</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> <span class="type">SparkStreaming</span>.<span class="type">Dstream</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.<span class="type">SparkConf</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.streaming.&#123;<span class="type">Seconds</span>, <span class="type">StreamingContext</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">wordcount</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//todo 创建环境</span></span><br><span class="line">    <span class="comment">//第一个参数是环境配置</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="keyword">val</span> sparkConf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setMaster(<span class="string">&quot;local[*]&quot;</span>).setAppName(<span class="string">&quot;sparkStreaming&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> ssc = <span class="keyword">new</span> <span class="type">StreamingContext</span>(sparkConf, <span class="type">Seconds</span>(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="keyword">val</span> lines = ssc.socketTextStream(<span class="string">&quot;localhost&quot;</span>, <span class="number">9999</span>)</span><br><span class="line">    <span class="keyword">val</span> words = lines.flatMap(_.split(<span class="string">&quot; &quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> wordToOne = words.map((_, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> result = wordToOne.reduceByKey(_ + _)</span><br><span class="line"></span><br><span class="line">    result.print()</span><br><span class="line"></span><br><span class="line">    ssc.start()</span><br><span class="line"></span><br><span class="line">    ssc.awaitTermination()</span><br><span class="line"></span><br><span class="line">    <span class="comment">//todo</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//发送数据：</span></span><br><span class="line">nc -lp <span class="number">9999</span>需要下载netcat软件，linux自带</span><br><span class="line">hello spark</span><br></pre></td></tr></table></figure><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">RDDStream</span> </span>&#123;</span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line"> <span class="comment">//1.初始化 Spark 配置信息</span></span><br><span class="line"> <span class="keyword">val</span> conf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setMaster(<span class="string">&quot;local[*]&quot;</span>).setAppName(<span class="string">&quot;RDDStream&quot;</span>)</span><br><span class="line"> <span class="comment">//2.初始化 SparkStreamingContext</span></span><br><span class="line"> <span class="keyword">val</span> ssc = <span class="keyword">new</span> <span class="type">StreamingContext</span>(conf, <span class="type">Seconds</span>(<span class="number">4</span>))</span><br><span class="line"> <span class="comment">//3.创建 RDD 队列</span></span><br><span class="line"> <span class="keyword">val</span> rddQueue = <span class="keyword">new</span> mutable.<span class="type">Queue</span>[<span class="type">RDD</span>[<span class="type">Int</span>]]()</span><br><span class="line"> <span class="comment">//4.创建 QueueInputDStream</span></span><br><span class="line"> <span class="keyword">val</span> inputStream = ssc.queueStream(rddQueue,oneAtATime = <span class="literal">false</span>)</span><br><span class="line"> <span class="comment">//5.处理队列中的 RDD 数据</span></span><br><span class="line"> <span class="keyword">val</span> mappedStream = inputStream.map((_,<span class="number">1</span>))</span><br><span class="line"> <span class="keyword">val</span> reducedStream = mappedStream.reduceByKey(_ + _)</span><br><span class="line"> <span class="comment">//6.打印结果</span></span><br><span class="line"> reducedStream.print()</span><br><span class="line"> <span class="comment">//7.启动任务</span></span><br><span class="line"> ssc.start()</span><br><span class="line"><span class="comment">//8.循环创建并向 RDD 队列中放入 RDD</span></span><br><span class="line"> <span class="keyword">for</span> (i &lt;- <span class="number">1</span> to <span class="number">5</span>) &#123;</span><br><span class="line"> rddQueue += ssc.sparkContext.makeRDD(<span class="number">1</span> to <span class="number">300</span>, <span class="number">10</span>)</span><br><span class="line"> <span class="type">Thread</span>.sleep(<span class="number">2000</span>)</span><br><span class="line"> &#125;</span><br><span class="line"> ssc.awaitTermination()</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-------------------------------------------</span><br><span class="line"><span class="type">Time</span>: <span class="number">1539075280000</span> ms</span><br><span class="line">-------------------------------------------</span><br><span class="line">(<span class="number">4</span>,<span class="number">60</span>)</span><br><span class="line">(<span class="number">0</span>,<span class="number">60</span>)</span><br><span class="line">(<span class="number">6</span>,<span class="number">60</span>)</span><br><span class="line">(<span class="number">8</span>,<span class="number">60</span>)</span><br><span class="line">(<span class="number">2</span>,<span class="number">60</span>)</span><br><span class="line">(<span class="number">1</span>,<span class="number">60</span>)</span><br><span class="line">(<span class="number">3</span>,<span class="number">60</span>)</span><br><span class="line">(<span class="number">7</span>,<span class="number">60</span>)</span><br><span class="line">(<span class="number">9</span>,<span class="number">60</span>)</span><br><span class="line">(<span class="number">5</span>,<span class="number">60</span>)</span><br><span class="line">-------------------------------------------</span><br><span class="line"><span class="type">Time</span>: <span class="number">1539075284000</span> ms</span><br><span class="line">-------------------------------------------</span><br><span class="line">(<span class="number">4</span>,<span class="number">60</span>)</span><br><span class="line">(<span class="number">0</span>,<span class="number">60</span>)</span><br><span class="line">(<span class="number">6</span>,<span class="number">60</span>)</span><br><span class="line">(<span class="number">8</span>,<span class="number">60</span>)</span><br><span class="line">(<span class="number">2</span>,<span class="number">60</span>)</span><br><span class="line">(<span class="number">1</span>,<span class="number">60</span>)</span><br><span class="line">(<span class="number">3</span>,<span class="number">60</span>)</span><br><span class="line">(<span class="number">7</span>,<span class="number">60</span>)</span><br><span class="line">(<span class="number">9</span>,<span class="number">60</span>)</span><br><span class="line">(<span class="number">5</span>,<span class="number">60</span>)</span><br><span class="line">-------------------------------------------</span><br><span class="line"><span class="type">Time</span>: <span class="number">1539075288000</span> ms</span><br><span class="line">-------------------------------------------</span><br><span class="line">(<span class="number">4</span>,<span class="number">30</span>)</span><br><span class="line">(<span class="number">0</span>,<span class="number">30</span>)</span><br><span class="line">(<span class="number">6</span>,<span class="number">30</span>)</span><br><span class="line">(<span class="number">8</span>,<span class="number">30</span>)</span><br><span class="line">(<span class="number">2</span>,<span class="number">30</span>)</span><br><span class="line">(<span class="number">1</span>,<span class="number">30</span>)</span><br><span class="line">(<span class="number">3</span>,<span class="number">30</span>)</span><br><span class="line">(<span class="number">7</span>,<span class="number">30</span>)</span><br><span class="line">(<span class="number">9</span>,<span class="number">30</span>)</span><br><span class="line">(<span class="number">5</span>,<span class="number">30</span>)</span><br><span class="line">-------------------------------------------</span><br><span class="line"><span class="type">Time</span>: <span class="number">1539075292000</span> ms</span><br><span class="line">-------------------------------------------</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 大数据 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>sqoop</title>
      <link href="/2022/12/08/Sqoop/"/>
      <url>/2022/12/08/Sqoop/</url>
      
        <content type="html"><![CDATA[<h1 id="Sqoop"><a href="#Sqoop" class="headerlink" title="Sqoop"></a>Sqoop</h1><p>sqoop是在Hadoop生态体系和关系型数据库之间传送数据的一种工具<br>工作机制：<br>    将导入或导出的命令翻译成mapreduce程序</p><p><img src="C:\Users\beihai\AppData\Roaming\Typora\typora-user-images\image-20221020153227605.png" alt="image-20221020153227605"></p><h2 id="Sqoop验证启动"><a href="#Sqoop验证启动" class="headerlink" title="Sqoop验证启动"></a>Sqoop验证启动</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/sqoop list-databases --connect jdbc:mysql://localhost:3306/ --username root --password 000000</span><br></pre></td></tr></table></figure><h1 id="Sqoop全量数据导入"><a href="#Sqoop全量数据导入" class="headerlink" title="Sqoop全量数据导入"></a>Sqoop全量数据导入</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">全量数据：所有数据</span><br></pre></td></tr></table></figure><h2 id="Sqoop全量导入Mysql表数据到HDFS"><a href="#Sqoop全量导入Mysql表数据到HDFS" class="headerlink" title="Sqoop全量导入Mysql表数据到HDFS"></a>Sqoop全量导入Mysql表数据到HDFS</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">下面的命令用于从 MySQL 数据库服务器中的 emp 表导入 HDFS。</span><br><span class="line">bin/sqoop import \</span><br><span class="line">--connect jdbc:mysql://Master:3306/yyh \</span><br><span class="line">--username root \</span><br><span class="line">--password 000000 \</span><br><span class="line">--delete-target-dir \</span><br><span class="line">--target-dir /sqoopresult \</span><br><span class="line">--fields-terminated-by &#x27;\t&#x27; \</span><br><span class="line">--table beihaibei --m 1</span><br><span class="line"></span><br><span class="line">bin/sqoop import \</span><br><span class="line">--connect jdbc:mysql://master:3306/userdb \</span><br><span class="line">--username root \</span><br><span class="line">--password 000000 \</span><br><span class="line">--target-dir /sqoopresult2 \</span><br><span class="line">--fields-terminated-by &#x27;\t&#x27; \</span><br><span class="line">--table emp --m 1</span><br><span class="line"></span><br><span class="line">bin/sqoop import \</span><br><span class="line">--connect jdbc:mysql://master:3306/userdb \</span><br><span class="line">--username root \</span><br><span class="line">--password 000000 \</span><br><span class="line">--target-dir /sqoopresult3 \</span><br><span class="line">--fields-terminated-by &#x27;\t&#x27; \</span><br><span class="line">--split-by id \</span><br><span class="line">--table emp </span><br><span class="line">--m 2</span><br><span class="line">--driver com.mysql.jdbc.Driver  </span><br><span class="line"></span><br><span class="line">这里driver必须加上</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">这里的sqoop import是固定搭配</span><br><span class="line"></span><br><span class="line">Master是主节点，如果本地可以写localhost，  userdb是mysql所选数据库</span><br><span class="line"></span><br><span class="line">username/password 是mysql的账号和密码</span><br><span class="line"></span><br><span class="line">delete-target-dir 它的意思是查看hdfs上是否有所创的文件夹，如果有就删去重新覆盖</span><br><span class="line"></span><br><span class="line">target-dir /sqoopresult 是在hdfs上创一文件夹sqoopresult，将emp表导入hdfs</span><br><span class="line"></span><br><span class="line">emp 是mysql数据库的表名</span><br><span class="line"></span><br><span class="line">--m 1 是运行map操作的一个进程</span><br><span class="line"></span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--columns</span><br></pre></td></tr></table></figure><h2 id="利用Hive2方式连接"><a href="#利用Hive2方式连接" class="headerlink" title="利用Hive2方式连接"></a>利用Hive2方式连接</h2><h3 id="1-开启服务"><a href="#1-开启服务" class="headerlink" title="1.开启服务"></a>1.开启服务</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop bin]# nohup hive --service metastore &amp;</span><br><span class="line">[root@hadoop bin]# nohup hive --service hiveserver2 &amp;</span><br></pre></td></tr></table></figure><h3 id="2-建立连接"><a href="#2-建立连接" class="headerlink" title="2.建立连接"></a>2.建立连接</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@slave2 bin]# beeline</span><br><span class="line">Beeline version 1.2.1.spark2 by Apache Hive</span><br><span class="line">beeline&gt; ! connect jdbc:hive2://master:10000</span><br><span class="line">Connecting to jdbc:hive2://master:10000</span><br><span class="line">Enter username for jdbc:hive2://master:10000: root</span><br><span class="line">Enter password for jdbc:hive2://master:10000: </span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line">0: jdbc:hive2://master:10000&gt;</span><br></pre></td></tr></table></figure><h3 id=""><a href="#" class="headerlink" title=" "></a> </h3><h2 id="Sqoop全量导入Mysql表数据到Hive"><a href="#Sqoop全量导入Mysql表数据到Hive" class="headerlink" title="Sqoop全量导入Mysql表数据到Hive"></a>Sqoop全量导入Mysql表数据到Hive</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">方式一：复制表结构</span><br><span class="line">1.将关系型数据的表结构复制到hive中</span><br><span class="line">bin/sqoop create-hive-table \</span><br><span class="line">--connect jdbc:mysql://master:3306/shtd_store \</span><br><span class="line">--table ChangeRecord \</span><br><span class="line">--username root \</span><br><span class="line">--password 000000 \</span><br><span class="line">--hive-table &#x27;dwd.fact_change_record&#x27;</span><br><span class="line"></span><br><span class="line">2.从关系数据库导入文件到hive中</span><br><span class="line">bin/sqoop import \</span><br><span class="line">--connect jdbc:mysql://master:3306/userdb \</span><br><span class="line">--username root \</span><br><span class="line">--password hadoop \</span><br><span class="line">--table emp_add \</span><br><span class="line">--hive-table test.emp_add1 \</span><br><span class="line">--hive-import \</span><br><span class="line">--m 1</span><br><span class="line"></span><br><span class="line">查看表结构：desc emp_add1</span><br><span class="line">查看表：select * from emp_add1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">方式二：直接导入数据到hive中 包括表结构和数据</span><br><span class="line">bin/sqoop import \</span><br><span class="line">--connect jdbc:mysql://master:3306/userdb \</span><br><span class="line">--username root \</span><br><span class="line">--password 000000 \</span><br><span class="line">--table emp_add \</span><br><span class="line">--hive-import \</span><br><span class="line">--m 1 \</span><br><span class="line">--hive-database sqoop;</span><br></pre></td></tr></table></figure><p>导入遇到的错误解决：</p><p>1.报错：FAILED: SemanticException [Error 10072]: Database does not exist: liantong0826</p><p>解决方法：复制hive/conf下的hive-site.xml到sqoop工作目录的conf下</p><p>2.时区问题</p><p>3.SSH</p><p>4.hive的环境变量</p><h2 id="Where查询过滤"><a href="#Where查询过滤" class="headerlink" title="Where查询过滤"></a>Where查询过滤</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@master bin]# sqoop import \</span><br><span class="line">&gt; --connect jdbc:mysql://master:3306/userdb \</span><br><span class="line">&gt; --username root \</span><br><span class="line">&gt; --password 000000 \</span><br><span class="line">&gt; --table emp_add \</span><br><span class="line">&gt; --where &quot;city = &#x27;sec-bad&#x27; &quot; \</span><br><span class="line">&gt; --target-dir /sqoopresult02 \</span><br><span class="line">&gt; --m 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">输出结果：</span><br><span class="line">[root@master bin]# hdfs dfs -cat /sqoopresult02/part-m-00000</span><br><span class="line">1202,108I,aoc,sec-bad</span><br><span class="line">1204,78B,old city,sec-bad</span><br><span class="line">1205,720X,hitec,sec-bad</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Query查询"><a href="#Query查询" class="headerlink" title="Query查询"></a>Query查询</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@master bin]# sqoop import \</span><br><span class="line">&gt; --connect jdbc:mysql://master:3306/userdb \</span><br><span class="line">&gt; --username root \</span><br><span class="line">&gt; --password 000000 \</span><br><span class="line">&gt; --target-dir /querysqoop01 \</span><br><span class="line">&gt; --query &#x27;select id,name,deg from emp WHERE  id&gt;1203 and $CONDITIONS&#x27; \</span><br><span class="line">&gt; --split-by id \</span><br><span class="line">&gt; --fields-terminated-by &#x27;\001&#x27; \</span><br><span class="line">&gt; --m 2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">必要点：</span><br><span class="line">1.使用query sql 语句来查询不用加参数--table</span><br><span class="line">2.必须添加where条件</span><br><span class="line">3.where条件之后必须带一个$CONDITIONS 字符串</span><br><span class="line">4.query sql 语句必须用单引号&#x27;&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="增量数据导入"><a href="#增量数据导入" class="headerlink" title="增量数据导入"></a>增量数据导入</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">增量导入是仅导入新添加的表中的行的技术。 </span><br><span class="line"></span><br><span class="line">--check-column (col) 用来指定一些列，这些列在增量导入时用来检查这些数据是否作为增量数据 进行导入，和关系型数据库中的自增字段及时间戳类似。 注意:这些被指定的列的类型不能使任意字符类型，如 char、varchar 等类 型都是不可以的，同时-- check-column 可以去指定多个列。 </span><br><span class="line">--incremental (mode) append：追加，比如对大于 last-value 指定的值之后的记录进行追加导入。 lastmodified：最后的修改时间，追加 last-value 指定的日期之后的记录 </span><br><span class="line"></span><br><span class="line">--last-value (value)  指定自从上次导入后列的最大值（大于该指定的值），也可以自己设定某一值</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Append模式增量导入"><a href="#Append模式增量导入" class="headerlink" title="Append模式增量导入"></a>Append模式增量导入</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">字段增量</span><br><span class="line">[root@master bin]# sqoop import \</span><br><span class="line">&gt; --connect jdbc:mysql://master:3306/userdb \</span><br><span class="line">&gt; --username root \</span><br><span class="line">&gt; --password 000000 \</span><br><span class="line">&gt; --table emp --m 1 \</span><br><span class="line">&gt; --target-dir /appendsult \</span><br><span class="line">&gt; --incremental append \</span><br><span class="line">&gt; --check-column id \</span><br><span class="line">&gt; --last-value 1205</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Lastmodified模式增量导入-append-merge-key"><a href="#Lastmodified模式增量导入-append-merge-key" class="headerlink" title="Lastmodified模式增量导入(append+merge-key)"></a>Lastmodified模式增量导入(append+merge-key)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">时间戳增量</span><br><span class="line">create table customertest(id int,name varchar(20),last_mod timestamp default current_timestamp on update current_timestamp);</span><br><span class="line"></span><br><span class="line">insert into customertest(id,name) values(1,&#x27;neil&#x27;);</span><br><span class="line">insert into customertest(id,name) values(2,&#x27;jack&#x27;);</span><br><span class="line">insert into customertest(id,name) values(3,&#x27;martin&#x27;);</span><br><span class="line">insert into customertest(id,name) values(4,&#x27;tony&#x27;);</span><br><span class="line">insert into customertest(id,name) values(5,&#x27;eric&#x27;);</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">再次插入一条数据进入customertest表</span><br><span class="line">insert into customertest(id,name) values(6,&#x27;james&#x27;);</span><br><span class="line"></span><br><span class="line">使用incremental的方式进行增量的导入:</span><br><span class="line">bin/sqoop import \</span><br><span class="line">--connect jdbc:mysql://master:3306/userdb \</span><br><span class="line">--username root \</span><br><span class="line">--password 000000 \</span><br><span class="line">--table customertest \</span><br><span class="line">--target-dir /lastmodifiedresult \</span><br><span class="line">--check-column last_mod \</span><br><span class="line">--incremental lastmodified \</span><br><span class="line">--last-value &quot;2022-10-23 16:05:39&quot; \</span><br><span class="line">--m 1 \</span><br><span class="line">--append</span><br><span class="line"></span><br><span class="line">此处已经会导入我们最后插入的一条记录,但是我们却发现此处插入了2条数据，这是为什么呢？ </span><br><span class="line">这是因为采用lastmodified模式去处理增量时，会将大于等于last-value值的数据当做增量插入</span><br><span class="line"></span><br><span class="line">注意: </span><br><span class="line">使用lastmodified模式进行增量处理要指定增量数据是以append模式(附加)还是merge-key(合并)模式添加 </span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">merge-by的模式</span><br><span class="line"></span><br><span class="line">update customertest set name = &#x27;Neil&#x27; where id = 1;</span><br><span class="line">更新之后，这条数据的时间戳会更新为我们更新数据时的系统时间.</span><br><span class="line">执行如下指令，把id字段作为merge-key:</span><br><span class="line"></span><br><span class="line">bin/sqoop import \</span><br><span class="line">--connect jdbc:mysql://master:3306/userdb \</span><br><span class="line">--username root \</span><br><span class="line">--password 000000 \</span><br><span class="line">--table customertest \</span><br><span class="line">--target-dir /lastmodifiedresult \</span><br><span class="line">--check-column last_mod \</span><br><span class="line">--incremental lastmodified \</span><br><span class="line">--last-value &quot;2022-10-23 16:05:39&quot; \</span><br><span class="line">--m 1 \</span><br><span class="line">--merge-key id </span><br></pre></td></tr></table></figure><h1 id="Sqoop导出"><a href="#Sqoop导出" class="headerlink" title="Sqoop导出"></a>Sqoop导出</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">从Hadoop生态体系导出到RDBMS数据库</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">将数据从 Hadoop 生态体系导出到 RDBMS 数据库导出前，目标表必须存在于</span><br><span class="line">目标数据库中。</span><br><span class="line">export 有三种模式：</span><br><span class="line">默认操作是从将文件中的数据使用 INSERT 语句插入到表中。</span><br><span class="line">更新模式：Sqoop 将生成 UPDATE 替换数据库中现有记录的语句。</span><br><span class="line">调用模式：Sqoop 将为每条记录创建一个存储过程调用。</span><br></pre></td></tr></table></figure><p>默认模式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sqoop export \</span><br><span class="line">--connect jdbc:mysql://node-1:3306/userdb \</span><br><span class="line">--username root \</span><br><span class="line">--password hadoop \</span><br><span class="line">--table employee1 \</span><br><span class="line">--export-dir /emp_data/</span><br><span class="line"></span><br><span class="line">注意导出到mysql数据库时候需要先建表，然后导出</span><br></pre></td></tr></table></figure><p>默认配置：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">相关配置参数</span><br><span class="line">--input-fields-terminated-by &#x27;\t&#x27;</span><br><span class="line">指定文件中的分隔符</span><br><span class="line">--columns </span><br><span class="line">选择列并控制它们的排序。当导出数据文件和目标表字段列顺序完全一</span><br><span class="line">致的时候可以不写。否则以逗号为间隔选择和排列各个列。没有被包含在–</span><br><span class="line">columns 后面列名或字段要么具备默认值，要么就允许插入空值。否则数据</span><br><span class="line">库会拒绝接受 sqoop 导出的数据，导致 Sqoop 作业失败</span><br><span class="line">--export-dir 导出目录，在执行导出的时候，必须指定这个参数，同时需要具</span><br><span class="line">备--table 或--call 参数两者之一，--table 是指的导出数据库当中对应的表，</span><br><span class="line">--call 是指的某个存储过程。</span><br><span class="line">--input-null-string --input-null-non-string</span><br><span class="line">如果没有指定第一个参数，对于字符串类型的列来说，“NULL”这个字符</span><br><span class="line">串就回被翻译成空值，如果没有使用第二个参数，无论是“NULL”字符串还</span><br><span class="line">是说空字符串也好，对于非字符串类型的字段来说，这两个类型的空串都会</span><br><span class="line">被翻译成空值。比如：</span><br><span class="line">--input-null-string &quot;\\N&quot; --input-null-non-string &quot;\\N&quot;</span><br></pre></td></tr></table></figure><p><a href="file:///E:/大数据资料/黑马程序员/Apache Sqoop资料/讲义sqoop/Apache Sqoop.pdf">Apache Sqoop.pdf</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn logs -applicationId application_1666744533757_0006</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 大数据 </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
